// Goo Engine. Copyright 2013 Goo Technologies AB
(function(window,undefined){ var f=function(){'use strict';define("goo/entities/components/Component",[],function(){return function(){this.enabled=!0}});
define("goo/addons/box2d/components/Box2DComponent",["goo/entities/components/Component"],function(e){function c(b){this.type="Box2DComponent";this.world=this.body=null;this.mass=1;this.settings=b||{};this.shape=b.shape?b.shape:"box";this.width=b.width?b.width:1;this.height=b.height?b.height:1;this.radius=b.radius?b.radius:1;this.vertices=b.vertices?b.vertices:[0,1,2,2,0,2];this.movable=b.movable===!0?!0:!1;this.friction=b.friction?b.friction:1;this.offsetX=b.offsetX?b.offsetX:0;this.offsetY=b.offsetY?
b.offsetY:0}c.prototype=Object.create(e.prototype);return c});
define("goo/entities/systems/System",[],function(){function e(c,b){this.type=c;this.interests=b;this._activeEntities=[];this.passive=!1}e.prototype.added=function(c){this._check(c)};e.prototype.changed=function(c){this._check(c)};e.prototype.removed=function(c){var b=this._activeEntities.indexOf(c);b!==-1&&(this._activeEntities.splice(b,1),this.deleted&&this.deleted(c))};e.prototype._check=function(c){var b=this.interests===null;if(!b&&this.interests.length<=c._components.length)for(var b=!0,a=0;a<
this.interests.length;a++){var f=this.interests[a].charAt(0).toLowerCase()+this.interests[a].substr(1);if(!c[f]){b=!1;break}}a=this._activeEntities.indexOf(c);b&&a===-1?(this._activeEntities.push(c),this.inserted&&this.inserted(c)):!b&&a!==-1&&(this._activeEntities.splice(a,1),this.deleted&&this.deleted(c))};e.prototype._process=function(c){this.process&&this.process(this._activeEntities,c)};return e});
define("goo/addons/box2d/systems/Box2DSystem",["goo/entities/systems/System"],function(e){function c(){e.call(this,"Box2DSystem",["Box2DComponent","MeshDataComponent"]);this.SCALE=0.5;this.world=new Box2D.b2World(new Box2D.b2Vec2(0,-9));this.sortVertexesClockWise=function(b,a){var f=Math.atan2(b.get_y(),b.get_x()),d=Math.atan2(a.get_y(),a.get_x());return f>d?1:-1};this.createPolygonShape=function(b){for(var a=new Box2D.b2PolygonShape,f=Box2D.allocate(b.length*8,"float",Box2D.ALLOC_STACK),d=0,g=0;g<
b.length;g++)Box2D.setValue(f+d,b[g].get_x(),"float"),Box2D.setValue(f+(d+4),b[g].get_y(),"float"),d+=8;f=Box2D.wrapPointer(f,Box2D.b2Vec2);a.Set(f,b.length);return a}}c.prototype=Object.create(e.prototype);c.prototype.inserted=function(b){var a=b.physics2DComponent,f=0,d=0,g=new Box2D.b2PolygonShape;if(a.shape==="box")g.SetAsBox(a.width*this.SCALE,a.height*this.SCALE);else if(a.shape==="circle")g=new Box2D.b2CircleShape,g.set_m_radius(a.radius);else if(a.shape==="mesh"){for(var c=b.meshDataComponent.meshData.getAttributeBuffer("POSITION"),
g=0,k=[],f=1E4,e=-1E4,d=1E4,h=-1E4;g<=c.length-3;){var l=c[g],n=c[++g];n<f&&(f=n);n>e&&(e=n);l<d&&(d=l);l>h&&(h=l);++g;b.transformComponent.updateWorldTransform();l=new Box2D.b2Vec2(l,n);k.push(l)}g=this.createPolygonShape(k);f=Math.abs(e-f);d=Math.abs(h-d)}else if(a.shape==="polygon"){k=[];for(g=0;g<=a.vertices.length-2;)l=new Box2D.b2Vec2(a.vertices[g],a.vertices[++g]),k.push(l),++g;g=this.createPolygonShape(k);console.log(k)}k=new Box2D.b2FixtureDef;k.set_shape(g);k.set_density(1);k.set_friction(a.friction);
g=new Box2D.b2BodyDef;a.movable===!0&&g.set_type(Box2D.b2_dynamicBody);g.set_position(new Box2D.b2Vec2(b.transformComponent.transform.translation.x+a.offsetX,b.transformComponent.transform.translation.y+a.offsetY));g=this.world.CreateBody(g);g.CreateFixture(k);g.SetLinearDamping(0.95);g.SetAngularDamping(0.6);a.body=g;a.world=this.world;b.body=g;b.body.h=f;b.body.w=d};c.prototype.deleted=function(){};c.prototype.process=function(b,a){this.world.Step(a,2,2);for(var f=0;f<b.length;f++){var d=b[f].body.GetPosition();
b[f].transformComponent.transform.translation.y=d.get_y()-b[f].physics2DComponent.offsetY;b[f].transformComponent.transform.translation.x=d.get_x()-b[f].physics2DComponent.offsetX;b[f].transformComponent.setUpdated();b[f].transformComponent.transform.rotation.z=b[f].body.GetAngle();d.get_y()>100&&b[f].body.ApplyForce(new Box2D.b2Vec2(0,-100),b[f].body.GetPosition())}};return c});
define("goo/addons/cannon/components/CannonjsComponent",["goo/entities/components/Component"],function(e){function c(b){this.type="CannonjsComponent";this.settings=b||{};this.mass=b.mass!==void 0?b.mass:0;this.useBounds=b.useBounds!==void 0?b.useBounds:!1;this.linearDamping=b.linearDamping!==void 0?b.linearDamping:0;this.angularDamping=b.angularDamping!==void 0?b.angularDamping:0}c.prototype=Object.create(e.prototype);return c});
define("goo/math/MathUtils",[],function(){function e(){}e.DEG_TO_RAD=Math.PI/180;e.RAD_TO_DEG=180/Math.PI;e.HALF_PI=0.5*Math.PI;e.TWO_PI=2*Math.PI;e.EPSILON=1.0E-7;e.radFromDeg=function(c){return c*e.DEG_TO_RAD};e.degFromRad=function(c){return c*e.RAD_TO_DEG};e.lerp=function(c,b,a){return b===a?b:b+(a-b)*c};e.clamp=function(c,b,a){return b<a?c<b?b:c>a?a:c:c<a?a:c>b?b:c};e.moduloPositive=function(c,b){var a=c%b;a+=a<0?b:0;return a};e.scurve3=function(c){return(-2*c+3)*c*c};e.scurve5=function(c){return((6*
c-15)*c+10)*c*c*c};e.sphericalToCartesian=function(c,b,a,f){var d=c*Math.cos(a);f.x=d*Math.cos(b);f.y=c*Math.sin(a);f.z=d*Math.sin(b)};e.cartesianToSpherical=function(c,b,a,f){var d=Math.sqrt(c*c+a*a);f.x=Math.sqrt(c*c+b*b+a*a);f.y=Math.atan2(a,c);f.z=Math.atan2(b,d)};e.getTriangleNormals=function(c,b,a,f,d,g,j,k,e){f-=c;d-=b;g-=a;c=j-c;b=k-b;a=e-a;return[d*a-g*b,g*c-f*a,f*b-d*c]};return e});
define("goo/math/Vector",["goo/math/MathUtils"],function(e){function c(b){this.data=new Float32Array(b||0)}c.prototype.setupAliases=function(b){for(var a=this,f=0;f<b.length;f++)(function(d){for(var g=0;g<b[d].length;g++)Object.defineProperty(a,b[d][g],{get:function(){return this.data[d]},set:function(a){this.data[d]=a}});Object.defineProperty(a,f,{get:function(){return this.data[d]},set:function(a){this.data[d]=a}})})(f)};c.add=function(b,a,f){var b=b.data||b,a=a.data||a,d=b.length;f||(f=new c(d));
if(a.length!==d||f.data.length!==d)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(var g=0;g<d;g++)f.data[g]=b[g]+a[g];return f};c.prototype.add=function(b){return c.add(this,b,this)};c.sub=function(b,a,f){var b=b.data||b,a=a.data||a,d=b.length;f||(f=new c(d));if(a.length!==d||f.data.length!==d)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(var g=0;g<d;g++)f.data[g]=b[g]-a[g];return f};c.prototype.sub=function(b){return c.sub(this,
b,this)};c.mul=function(b,a,f){var b=b.data||b,a=a.data||a,d=b.length;f||(f=new c(d));if(a.length!==d||f.data.length!==d)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(var g=0;g<d;g++)f.data[g]=b[g]*a[g];return f};c.prototype.mul=function(b){return c.mul(this,b,this)};c.div=function(b,a,f){var b=b.data||b,a=a.data||a,d=b.length;f||(f=new c(d));if(a.length!==d||f.data.length!==d)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};
for(var g=0;g<d;g++)f.data[g]=b[g]/a[g];return f};c.prototype.div=function(b){return c.div(this,b,this)};c.copy=function(b,a){var f=b.data.length;a||(a=new c(f));if(a.data.length!==f)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};a.data.set(b.data);return a};c.prototype.copy=function(b){return c.copy(b,this)};c.dot=function(b,a){var f=b.data||b,d=a.data||a,g=f.length;if(d.length!==g)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};
for(var c=0,k=0;k<g;k++)c+=f[k]*d[k];return c};c.prototype.dot=function(b){return c.dot(this,b)};c.apply=function(b,a,f){var d=b.rows,g=b.cols,j=a.data.length;f||(f=new c(d));if(f.data.length!==d||g!==j)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};if(f===a)return c.copy(c.apply(b,a),f);for(var k=0;k<g;k++)for(var e=k*d,h=0;h<d;h++){for(var l=0,n=0;n<j;n++)l+=b.data[n*b.rows+h]*a.data[n];f.data[e+h]=l}return f};c.prototype.apply=function(b){return c.apply(b,this,
this)};c.equals=function(b,a){var f=b.data.length;if(f!==a.data.length)return!1;for(var d=0;d<f;d++)if(Math.abs(b.data[d]-a.data[d])>e.EPSILON)return!1;return!0};c.prototype.equals=function(b){return c.equals(this,b)};c.distanceSquared=function(b,a){return c.sub(b,a).lengthSquared()};c.prototype.distanceSquared=function(b){return c.sub(this,b).lengthSquared()};c.distance=function(b,a){return c.sub(b,a).length()};c.prototype.distance=function(b){return c.sub(this,b).length()};c.prototype.lengthSquared=
function(){return c.dot(this,this)};c.prototype.length=function(){return Math.sqrt(c.dot(this,this))};c.prototype.scale=function(b){for(var a=this.data.length-1;a>=0;a--)this.data[a]*=b;return this};c.prototype.invert=function(){for(var b=0;b<this.data.length;b++)this.data[b]=0-this.data[b];return this};c.prototype.normalize=function(){var b=this.length(),a=this.data.length;if(b<e.EPSILON)for(var f=0;f<a;f++)this.data[f]=0;else{b=1/b;for(f=0;f<a;f++)this.data[f]*=b}return this};c.prototype.clone=
function(){return c.copy(this)};c.prototype.set=function(){if(arguments.length===1&&typeof arguments[0]==="object")if(arguments[0]instanceof c)this.copy(arguments[0]);else if(arguments[0].length>1)for(var b=0;b<arguments[0].length;b++)this.data[b]=arguments[0][b];else this.set(arguments[0][0]);else for(b=0;b<arguments.length;b++)this.data[b]=arguments[b];return this};c.prototype.toString=function(){var b="";b+="[";for(var a=0;a<this.data.length;a++)b+=this.data[a],b+=a!==this.data.length-1?", ":"";
b+="]";return b};return c});
define("goo/math/Vector3",["goo/math/Vector"],function(e){function c(){e.call(this,3);arguments.length!==0?this.set(arguments):this.setd(0,0,0)}c.prototype=Object.create(e.prototype);c.prototype.setupAliases([["x","u","r"],["y","v","g"],["z","w","b"]]);c.ZERO=new c(0,0,0);c.ONE=new c(1,1,1);c.UNIT_X=new c(1,0,0);c.UNIT_Y=new c(0,1,0);c.UNIT_Z=new c(0,0,1);c.add=function(b,a,f){typeof b==="number"&&(b=[b,b,b]);typeof a==="number"&&(a=[a,a,a]);f||(f=new c);b=b.data||b;a=a.data||a;if(b.length!==3||a.length!==
3)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};f.data[0]=b[0]+a[0];f.data[1]=b[1]+a[1];f.data[2]=b[2]+a[2];return f};c.addv=function(b,a,f){f||(f=new c);f.data[0]=b.data[0]+a.data[0];f.data[1]=b.data[1]+a.data[1];f.data[2]=b.data[2]+a.data[2];return f};c.prototype.add=function(b){return c.add(this,b,this)};c.sub=function(b,a,f){typeof b==="number"&&(b=[b,b,b]);typeof a==="number"&&(a=[a,a,a]);f||(f=new c);b=b.data||b;a=a.data||a;if(b.length!==3||a.length!==3)throw{name:"Illegal Arguments",
message:"The arguments are of incompatible sizes."};f.data[0]=b[0]-a[0];f.data[1]=b[1]-a[1];f.data[2]=b[2]-a[2];return f};c.subv=function(b,a,f){f||(f=new c);f.data[0]=b.data[0]-a.data[0];f.data[1]=b.data[1]-a.data[1];f.data[2]=b.data[2]-a.data[2];return f};c.prototype.sub=function(b){return c.sub(this,b,this)};c.mul=function(b,a,f){typeof b==="number"&&(b=[b,b,b]);typeof a==="number"&&(a=[a,a,a]);f||(f=new c);b=b.data||b;a=a.data||a;if(b.length!==3||a.length!==3)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};
f.data[0]=b[0]*a[0];f.data[1]=b[1]*a[1];f.data[2]=b[2]*a[2];return f};c.prototype.mul=function(b){return c.mul(this,b,this)};c.div=function(b,a,f){typeof b==="number"&&(b=[b,b,b]);typeof a==="number"&&(a=[a,a,a]);f||(f=new c);b=b.data||b;a=a.data||a;if(b.length!==3||a.length!==3)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};f.data[0]=b[0]/a[0];f.data[1]=b[1]/a[1];f.data[2]=b[2]/a[2];return f};c.prototype.div=function(b){return c.div(this,b,this)};c.dot=function(b,
a){typeof b==="number"&&(b=[b,b,b]);typeof a==="number"&&(a=[a,a,a]);var f=b.data||b,d=a.data||a;if(f.length!==3||d.length!==3)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};var g=0;g+=f[0]*d[0];g+=f[1]*d[1];g+=f[2]*d[2];return g};c.prototype.dot=function(b){return c.dot(this,b)};c.cross=function(b,a,f){f||(f=new c);var d=a.data||a;if((b.data||b).length!==3||d.length!==3)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};var d=a.data[0]*
b.data[2]-a.data[2]*b.data[0],g=a.data[1]*b.data[0]-a.data[0]*b.data[1];f.data[0]=a.data[2]*b.data[1]-a.data[1]*b.data[2];f.data[1]=d;f.data[2]=g;return f};c.prototype.cross=function(b){return c.cross(this,b,this)};c.prototype.lerp=function(b,a){this.data[0]=(1-a)*this.data[0]+a*b.data[0];this.data[1]=(1-a)*this.data[1]+a*b.data[1];this.data[2]=(1-a)*this.data[2]+a*b.data[2];return this};c.prototype.setd=function(b,a,f){this.data[0]=b;this.data[1]=a;this.data[2]=f;return this};c.prototype.seta=function(b){this.data[0]=
b[0];this.data[1]=b[1];this.data[2]=b[2];return this};c.prototype.setv=function(b){this.data[0]=b.data[0];this.data[1]=b.data[1];this.data[2]=b.data[2];return this};c.prototype.add_d=function(b,a,f){this.data[0]+=b;this.data[1]+=a;this.data[2]+=f;return this};c.prototype.addv=function(b){this.data[0]+=b.data[0];this.data[1]+=b.data[1];this.data[2]+=b.data[2];return this};c.prototype.mulv=function(b){this.data[0]*=b.data[0];this.data[1]*=b.data[1];this.data[2]*=b.data[2];return this};c.prototype.muld=
function(b,a,f){this.data[0]*=b;this.data[1]*=a;this.data[2]*=f;return this};c.prototype.subv=function(b){this.data[0]-=b.data[0];this.data[1]-=b.data[1];this.data[2]-=b.data[2];return this};c.prototype.sub_d=function(b,a,f){this.data[0]-=b;this.data[1]-=a;this.data[2]-=f;return this};c.prototype.lengthSquared=function(){return this.data[0]*this.data[0]+this.data[1]*this.data[1]+this.data[2]*this.data[2]};return c});
define("goo/renderer/bounds/BoundingVolume",["goo/math/Vector3"],function(e){function c(b){this.center=new e;b!==void 0&&this.center.setv(b);this.min=new e(Infinity,Infinity,Infinity);this.max=new e(-Infinity,-Infinity,-Infinity)}c.Outside=0;c.Inside=1;c.Intersects=2;return c});
define("goo/renderer/bounds/BoundingBox",["goo/math/Vector3","goo/renderer/bounds/BoundingVolume","goo/math/MathUtils"],function(e,c,b){function a(a,d,g,b){c.call(this,a);this.xExtent=d!==void 0?d:1;this.yExtent=g!==void 0?g:1;this.zExtent=b!==void 0?b:1;this._compVect1=new e;this._compVect2=new e;this.vec=new e}a.prototype=Object.create(c.prototype);a.prototype.computeFromPoints=function(a){var d=this.min,g=this.max,b=this.vec;d.setd(Infinity,Infinity,Infinity);g.setd(-Infinity,-Infinity,-Infinity);
for(var c,e,h,l=0;l<a.length;l+=3)c=a[l+0],e=a[l+1],h=a[l+2],d.x=c<d.x?c:d.x,d.y=e<d.y?e:d.y,d.z=h<d.z?h:d.z,g.x=c>g.x?c:g.x,g.y=e>g.y?e:g.y,g.z=h>g.z?h:g.z;b.setv(g).subv(d).div(2);this.xExtent=b.x;this.yExtent=b.y;this.zExtent=b.z;this.center.setv(g).addv(d).div(2)};a.prototype.computeFromPrimitives=function(f,d,g,b,c){if(!(c-b<=0)){for(var e=this._compVect1.set(Infinity,Infinity,Infinity),h=this._compVect2.set(-Infinity,-Infinity,-Infinity),l=[];b<c;b++)for(var l=f.getPrimitiveVertices(g[b],d,
l),n=0;n<l.length;n++)a.checkMinMax(e,h,l[n]);this.center.copy(e.add(h));this.center.mul(0.5);this.xExtent=h.x-this.center.x;this.yExtent=h.y-this.center.y;this.zExtent=h.z-this.center.z}};a.checkMinMax=function(a,d,g){if(g.x<a.x)a.x=g.x;if(g.x>d.x)d.x=g.x;if(g.y<a.y)a.y=g.y;if(g.y>d.y)d.y=g.y;if(g.z<a.z)a.z=g.z;if(g.z>d.z)d.z=g.z};a.prototype.transform=function(f,d){d===null&&(d=new a);for(var g=[],b=0;b<8;b++)g.push(new e);this.getCorners(g);for(b=0;b<g.length;b++)f.matrix.applyPostPoint(g[b]);
for(var c=g[0].x,i=g[0].y,h=g[0].z,l=c,n=i,o=h,b=1;b<g.length;b++)var p=g[b].x,m=g[b].y,s=g[b].z,c=Math.min(c,p),i=Math.min(i,m),h=Math.min(h,s),l=Math.max(l,p),n=Math.max(n,m),o=Math.max(o,s);g=(l+c)*0.5;i=(n+i)*0.5;h=(o+h)*0.5;d.center.set(g,i,h);d.xExtent=l-g;d.yExtent=n-i;d.zExtent=o-h;return d};a.prototype.getCorners=function(a){if(!a||a.length!==8)for(var a=[],d=0;d<a.length;d++)a.push(new e);a[0].set(this.center.x+this.xExtent,this.center.y+this.yExtent,this.center.z+this.zExtent);a[1].set(this.center.x+
this.xExtent,this.center.y+this.yExtent,this.center.z-this.zExtent);a[2].set(this.center.x+this.xExtent,this.center.y-this.yExtent,this.center.z+this.zExtent);a[3].set(this.center.x+this.xExtent,this.center.y-this.yExtent,this.center.z-this.zExtent);a[4].set(this.center.x-this.xExtent,this.center.y+this.yExtent,this.center.z+this.zExtent);a[5].set(this.center.x-this.xExtent,this.center.y+this.yExtent,this.center.z-this.zExtent);a[6].set(this.center.x-this.xExtent,this.center.y-this.yExtent,this.center.z+
this.zExtent);a[7].set(this.center.x-this.xExtent,this.center.y-this.yExtent,this.center.z-this.zExtent);return a};a.prototype.whichSide=function(a){var d=Math.abs(this.xExtent*a.normal.x)+Math.abs(this.yExtent*a.normal.y)+Math.abs(this.zExtent*a.normal.z),g=a.normal.data,b=this.center.data,a=g[0]*b[0]+g[1]*b[1]+g[2]*b[2]-a.constant;return a<-d?c.Inside:a>d?c.Outside:c.Intersects};a.prototype._pseudoDistance=function(a,d){return a.normal.x*d.x+a.normal.y*d.y+a.normal.z*d.z-a.constant};a.prototype._maxAxis=
function(a){return Math.max(Math.abs(a.x),Math.max(Math.abs(a.y),Math.abs(a.z)))};a.prototype.toString=function(){var a=Math.round(this.center.x*10)/10,d=Math.round(this.center.y*10)/10,g=Math.round(this.center.z*10)/10;return"["+a+","+d+","+g+"] - ["+this.xExtent+","+this.yExtent+","+this.zExtent+"]"};a.prototype.intersects=function(a){return a.intersectsBoundingBox(this)};a.prototype.intersectsBoundingBox=function(a){return this.center.x+this.xExtent<a.center.x-a.xExtent||this.center.x-this.xExtent>
a.center.x+a.xExtent?!1:this.center.y+this.yExtent<a.center.y-a.yExtent||this.center.y-this.yExtent>a.center.y+a.yExtent?!1:this.center.z+this.zExtent<a.center.z-a.zExtent||this.center.z-this.zExtent>a.center.z+a.zExtent?!1:!0};a.prototype.intersectsSphere=function(a){return Math.abs(this.center.x-a.center.x)<a.radius+this.xExtent&&Math.abs(this.center.y-a.center.y)<a.radius+this.yExtent&&Math.abs(this.center.z-a.center.z)<a.radius+this.zExtent?!0:!1};a.prototype.testStaticAABBAABB=function(a,d){var g=
{mtvDistance:1E10,mtvAxis:new e};if(!this.testAxisStatic(e.UNIT_X,this.center.x-this.xExtent,this.center.x+this.xExtent,a.center.x-a.xExtent,a.center.x+a.xExtent,g))return!1;if(!this.testAxisStatic(e.UNIT_Y,this.center.y-this.yExtent,this.center.y+this.yExtent,a.center.y-a.yExtent,a.center.y+a.yExtent,g))return!1;if(!this.testAxisStatic(e.UNIT_Z,this.center.z-this.zExtent,this.center.z+this.zExtent,a.center.z-a.zExtent,a.center.z+a.zExtent,g))return!1;if(d)d.isIntersecting=!0,d.normal=g.mtvAxis,d.penetration=
Math.sqrt(g.mtvDistance)*1.001;return!0};a.prototype.testAxisStatic=function(a,d,g,b,c,i){var h=e.dot(a,a);if(h<1.0E-6)return!0;d=c-d;g-=b;if(d<=0||g<=0)return!1;g=d<g?d:-g;h=(new e).copy(a).mul(g/h);h=e.dot(h,h);if(h<i.mtvDistance)i.mtvDistance=h,i.mtvAxis=a;return!0};a.prototype.intersectsRay=function(f){if(isNaN(this.center.x)||isNaN(this.center.y)||isNaN(this.center.z))return!1;var d=e.sub(f.origin,this.center,this._compVect1),f=f.direction,g=[0,Infinity],c=this.xExtent;if(c<b.ZERO_TOLERANCE&&
c>=0)c=b.ZERO_TOLERANCE;var k=this.yExtent;if(k<b.ZERO_TOLERANCE&&k>=0)k=b.ZERO_TOLERANCE;var i=this.zExtent;if(i<b.ZERO_TOLERANCE&&i>=0)i=b.ZERO_TOLERANCE;return a.clip(f.x,-d.x-c,g)&&a.clip(-f.x,d.x-c,g)&&a.clip(f.y,-d.y-k,g)&&a.clip(-f.y,d.y-k,g)&&a.clip(f.z,-d.z-i,g)&&a.clip(-f.z,d.z-i,g)&&(g[0]!==0||g[1]!==Infinity)?!0:!1};a.prototype.intersectsRayWhere=function(f){if(isNaN(this.center.x)||isNaN(this.center.y)||isNaN(this.center.z))return null;var d=e.sub(f.origin,this.center,this._compVect1),
g=f.direction,c=[0,Infinity],k=this.xExtent;if(k<b.ZERO_TOLERANCE&&k>=0)k=b.ZERO_TOLERANCE;var i=this.yExtent;if(i<b.ZERO_TOLERANCE&&i>=0)i=b.ZERO_TOLERANCE;var h=this.zExtent;if(h<b.ZERO_TOLERANCE&&h>=0)h=b.ZERO_TOLERANCE;if(a.clip(g.x,-d.x-k,c)&&a.clip(-g.x,d.x-k,c)&&a.clip(g.y,-d.y-i,c)&&a.clip(-g.y,d.y-i,c)&&a.clip(g.z,-d.z-h,c)&&a.clip(-g.z,d.z-h,c)&&(c[0]!==0||c[1]!==Infinity)){if(c[1]>c[0])return d=c,f=[(new e(f.direction)).mul(d[0]).add(f.origin),(new e(f.direction)).mul(d[1]).add(f.origin)],
{distances:d,points:f};d=[c[0]];f=[(new e(f.direction)).mul(d[0]).add(f.origin)];return{distances:d,points:f}}return null};a.clip=function(a,d,g){if(a>0){if(d>a*g[1])return!1;d>a*g[0]&&(g[0]=d/a);return!0}else if(a<0){if(d>a*g[0])return!1;d>a*g[1]&&(g[1]=d/a);return!0}else return d<=0};a.prototype.merge=function(f){return f instanceof a?this.mergeBox(f.center,f.xExtent,f.yExtent,f.zExtent,this):this.mergeBox(f.center,f.radius,f.radius,f.radius,this)};a.prototype.mergeBox=function(f,d,g,b,c){c||(c=
new a);var e=this._compVect1,h=this._compVect2;e.x=this.center.x-this.xExtent;if(e.x>f.x-d)e.x=f.x-d;e.y=this.center.y-this.yExtent;if(e.y>f.y-g)e.y=f.y-g;e.z=this.center.z-this.zExtent;if(e.z>f.z-b)e.z=f.z-b;h.x=this.center.x+this.xExtent;if(h.x<f.x+d)h.x=f.x+d;h.y=this.center.y+this.yExtent;if(h.y<f.y+g)h.y=f.y+g;h.z=this.center.z+this.zExtent;if(h.z<f.z+b)h.z=f.z+b;c.center.set(h).addv(e).muld(0.5,0.5,0.5);c.xExtent=h.x-c.center.x;c.yExtent=h.y-c.center.y;c.zExtent=h.z-c.center.z;return c};a.prototype.clone=
function(f){return f&&f instanceof a?(f.center.setv(this.center),f.xExtent=this.xExtent,f.yExtent=this.yExtent,f.zExtent=this.zExtent,f):new a(this.center,this.xExtent,this.yExtent,this.zExtent)};return a});define("goo/renderer/BufferData",[],function(){function e(c,b){this.data=c;this.target=b;this.glBuffer=null;this._dataUsage="StaticDraw";this._dataNeedsRefresh=!1}e.prototype.setDataUsage=function(c){this._dataUsage=c};e.prototype.setDataNeedsRefresh=function(){this._dataNeedsRefresh=!0};return e});
define("goo/renderer/Util",[],function(){function e(){}e.getByteSize=function(c){switch(c){case "Byte":return 1;case "UnsignedByte":return 1;case "Short":return 2;case "UnsignedShort":return 2;case "Int":return 4;case "HalfFloat":return 2;case "Float":return 4;case "Double":return 8;default:throw"Unknown type: "+c;}};e.checkGLError=function(c){for(var b=c.getError(),a=!1;b!==c.NO_ERROR;){a=!0;if(b===c.INVALID_ENUM)console.error("An unacceptable value is specified for an enumerated argument. The offending command is ignored and has no other side effect than to set the error flag.");
else if(b===c.INVALID_VALUE)console.error("A numeric argument is out of range. The offending command is ignored and has no other side effect than to set the error flag.");else if(b===c.INVALID_OPERATION)console.error("The specified operation is not allowed in the current state. The offending command is ignored and has no other side effect than to set the error flag.");else if(b===c.FRAMEBUFFER_COMPLETE)console.error("The command is trying to render to or read from the framebuffer while the currently bound framebuffer is not framebuffer complete (i.e. the return value from glCheckFramebufferStatus is not GL_FRAMEBUFFER_COMPLETE). The offending command is ignored and has no other side effect than to set the error flag.");
else if(b===c.OUT_OF_MEMORY)throw"There is not enough memory left to execute the command. The state of the GL is undefined, except for the state of the error flags, after this error is recorded.";b=c.getError()}if(a)throw"Stopping due to error";};e.isPowerOfTwo=function(c){return(c&c-1)===0};e.nearestPowerOfTwo=function(c){return Math.pow(2,Math.ceil(Math.log(c)/Math.log(2)))};e.clone=function(c){if(c===null||typeof c!=="object")return c;if(c instanceof Uint8Array)return c;if(c instanceof Date){var b=
new Date;b.setTime(c.getTime());return b}if(c instanceof Array){for(var b=[],a=0,f=c.length;a<f;++a)b[a]=e.clone(c[a]);return b}if(c instanceof Object){b={};for(a in c)c.hasOwnProperty(a)&&(b[a]=e.clone(c[a]));return b}throw Error("Unable to copy obj! Its type isn't supported.");};return e});
define("goo/renderer/BufferUtils",[],function(){function e(){}e.createIndexBuffer=function(c,b){var a;if(b<256)a=new Uint8Array(c);else if(b<65536)a=new Uint16Array(c);else throw Error("Maximum number of vertices is 65535. Got: "+b);return a};return e});
define("goo/math/Vector2",["goo/math/Vector"],function(e){function c(){e.call(this,2);arguments.length!==0?this.set(arguments):this.setd(0,0)}c.prototype=Object.create(e.prototype);c.prototype.setupAliases([["x","u","s"],["y","v","t"]]);c.ZERO=new c(0,0);c.ONE=new c(1,1);c.UNIT_X=new c(1,0);c.UNIT_Y=new c(0,1);c.add=function(b,a,f){typeof b==="number"&&(b=[b,b]);typeof a==="number"&&(a=[a,a]);f||(f=new c);b=b.data||b;a=a.data||a;if(b.length!==2||a.length!==2)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};
f.data[0]=b[0]+a[0];f.data[1]=b[1]+a[1];return f};c.prototype.add=function(b){return c.add(this,b,this)};c.sub=function(b,a,f){typeof b==="number"&&(b=[b,b]);typeof a==="number"&&(a=[a,a]);f||(f=new c);b=b.data||b;a=a.data||a;if(b.length!==2||a.length!==2)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};f.data[0]=b[0]-a[0];f.data[1]=b[1]-a[1];return f};c.prototype.sub=function(b){return c.sub(this,b,this)};c.mul=function(b,a,f){typeof b==="number"&&(b=[b,b]);typeof a===
"number"&&(a=[a,a]);f||(f=new c);b=b.data||b;a=a.data||a;if(b.length!==2||a.length!==2)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};f.data[0]=b[0]*a[0];f.data[1]=b[1]*a[1];return f};c.prototype.mul=function(b){return c.mul(this,b,this)};c.div=function(b,a,f){typeof b==="number"&&(b=[b,b]);typeof a==="number"&&(a=[a,a]);f||(f=new c);b=b.data||b;a=a.data||a;if(b.length!==2||a.length!==2)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};
f.data[0]=b[0]/a[0];f.data[1]=b[1]/a[1];return f};c.prototype.div=function(b){return c.div(this,b,this)};c.dot=function(b,a){typeof b==="number"&&(b=[b,b]);typeof a==="number"&&(a=[a,a]);var f=b.data||b,d=a.data||a;if(f.length!==2||d.length!==2)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};var g=0;g+=f[0]*d[0];g+=f[1]*d[1];return g};c.prototype.dot=function(b){return c.dot(this,b)};c.prototype.setd=function(b,a){this.data[0]=b;this.data[1]=a;return this};c.prototype.seta=
function(b){this.data[0]=b[0];this.data[1]=b[1];return this};c.prototype.setv=function(b){this.data[0]=b.data[0];this.data[1]=b.data[1];return this};return c});
define("goo/math/Vector4",["goo/math/Vector"],function(e){function c(){e.call(this,4);arguments.length!==0?this.set(arguments):this.setd(0,0,0,0)}c.prototype=Object.create(e.prototype);c.prototype.setupAliases([["x","r"],["y","g"],["z","b"],["w","a"]]);c.ZERO=new c(0,0,0,0);c.ONE=new c(1,1,1,1);c.UNIT_X=new c(1,0,0,0);c.UNIT_Y=new c(0,1,0,0);c.UNIT_Z=new c(0,0,1,0);c.UNIT_W=new c(0,0,0,1);c.add=function(b,a,f){typeof b==="number"&&(b=[b,b,b,b]);typeof a==="number"&&(a=[a,a,a,a]);f||(f=new c);b=b.data||
b;a=a.data||a;if(b.length!==4||a.length!==4)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};f.data[0]=b[0]+a[0];f.data[1]=b[1]+a[1];f.data[2]=b[2]+a[2];f.data[3]=b[3]+a[3];return f};c.prototype.add=function(b){return c.add(this,b,this)};c.sub=function(b,a,f){typeof b==="number"&&(b=[b,b,b,b]);typeof a==="number"&&(a=[a,a,a,a]);f||(f=new c);b=b.data||b;a=a.data||a;if(b.length!==4||a.length!==4)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};
f.data[0]=b[0]-a[0];f.data[1]=b[1]-a[1];f.data[2]=b[2]-a[2];f.data[3]=b[3]-a[3];return f};c.prototype.sub=function(b){return c.sub(this,b,this)};c.mul=function(b,a,f){typeof b==="number"&&(b=[b,b,b,b]);typeof a==="number"&&(a=[a,a,a,a]);f||(f=new c);b=b.data||b;a=a.data||a;if(b.length!==4||a.length!==4)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};f.data[0]=b[0]*a[0];f.data[1]=b[1]*a[1];f.data[2]=b[2]*a[2];f.data[3]=b[3]*a[3];return f};c.prototype.mul=function(b){return c.mul(this,
b,this)};c.div=function(b,a,f){typeof b==="number"&&(b=[b,b,b,b]);typeof a==="number"&&(a=[a,a,a,a]);f||(f=new c);b=b.data||b;a=a.data||a;if(b.length!==4||a.length!==4)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};f.data[0]=b[0]/a[0];f.data[1]=b[1]/a[1];f.data[2]=b[2]/a[2];f.data[3]=b[3]/a[3];return f};c.prototype.div=function(b){return c.div(this,b,this)};c.dot=function(b,a){typeof b==="number"&&(b=[b,b,b,b]);typeof a==="number"&&(a=[a,a,a,a]);var f=b.data||b,
d=a.data||a;if(f.length!==4||d.length!==4)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};var g=0;g+=f[0]*d[0];g+=f[1]*d[1];g+=f[2]*d[2];g+=f[3]*d[3];return g};c.prototype.dot=function(b){return c.dot(this,b)};c.prototype.lerp=function(b,a){this.x=(1-a)*this.x+a*b.x;this.y=(1-a)*this.y+a*b.y;this.z=(1-a)*this.z+a*b.z;this.w=(1-a)*this.w+a*b.w;return this};c.prototype.setd=function(b,a,f,d){this.data[0]=b;this.data[1]=a;this.data[2]=f;this.data[3]=d;return this};
c.prototype.seta=function(b){this.data[0]=b[0];this.data[1]=b[1];this.data[2]=b[2];this.data[3]=b[3];return this};c.prototype.setv=function(b){this.data[0]=b.data[0];this.data[1]=b.data[1];this.data[2]=b.data[2];this.data[3]=b.data[3];return this};return c});
define("goo/renderer/MeshData","goo/renderer/BufferData,goo/renderer/Util,goo/renderer/BufferUtils,goo/math/Vector2,goo/math/Vector3,goo/math/Vector4".split(","),function(e,c,b,a,f,d){function g(a,d,f){this.attributeMap=a;this.vertexCount=d!==void 0?d:0;this.indexCount=f!==void 0?f:0;this.primitiveCounts=[0];this.indexData=this.vertexData=null;this.dataViews={};this.indexLengths=null;this.indexModes=["Triangles"];this.type=g.MESH;this.rebuildData(this.vertexCount,this.indexCount)}function j(a){for(var d=
{},f=0;f<a.length;f++){var g=a[f];if(h[g]!==void 0)d[g]=c.clone(h[g]);else throw"No default attribute named: "+g;}return d}var k=window.Uint8ClampedArray;g.MESH=0;g.SKINMESH=1;g.prototype.rebuildData=function(a,d,f){var g={},b=null;if(f){for(var c in this.attributeMap){var j=this.dataViews[c];j&&(g[c]=j)}if(this.indexData)b=this.indexData.data}this.rebuildVertexData(a);this.rebuildIndexData(d);if(f){for(c in this.attributeMap)if(a=g[c])j=this.dataViews[c],j.set(a);b&&this.indexData.data.set(b)}};
g.prototype.rebuildVertexData=function(a){if(!isNaN(a))this._vertexCountStore=this.vertexCount=a;if(this.vertexCount>0){var a=0,d;for(d in this.attributeMap){var f=this.attributeMap[d];a+=c.getByteSize(f.type)*f.count}this.vertexData=new e(new ArrayBuffer(a*this.vertexCount),"ArrayBuffer");this.generateAttributeData()}};g.prototype.rebuildIndexData=function(a){if(a!==void 0)this.indexCount=a;if(this.indexCount>0)a=b.createIndexBuffer(this.indexCount,this.vertexCount),this.indexData=new e(a,"ElementArrayBuffer")};
g.prototype.setVertexDataUpdated=function(){this.vertexData._dataNeedsRefresh=!0};g.prototype.getSectionCount=function(){return this.indexLengths?this.indexLengths.length:1};g.prototype.getPrimitiveCount=function(a){return a>=0&&a<this.primitiveCounts.length?this.primitiveCounts[a]:0};g.prototype.getPrimitiveVertices=function(a,d,b){var c=this.getPrimitiveCount(d);if(a>=c||a<0)throw Error("Invalid primitiveIndex '"+a+"'.  Count is "+c);c=g.getVertexCount(this.indexModes[d]);if(!b||b.length<c)b=[];
for(var j=this.getAttributeBuffer(g.POSITION),e=0;e<c;e++){b[e]||(b[e]=new f);var k=this.getIndexBuffer()?this.getIndexBuffer()[this.getVertexIndex(a,e,d)]:this.getVertexIndex(a,e,d);b[e].x=j[k*3+0];b[e].y=j[k*3+1];b[e].z=j[k*3+2]}return b};g.prototype.getVertexIndex=function(a,d,f){for(var b=0,c=0;c<f;c++)b+=this.indexLengths[c];switch(this.indexModes[f]){case "Triangles":b+=a*3+d;break;case "TriangleStrip":b+=a+d;break;case "TriangleFan":b+=d===0?0:a+d;break;case "Points":b+=a;break;case "Lines":b+=
a*2+d;break;case "LineStrip":case "LineLoop":b+=a+d;break;default:return g.logger.warning("unimplemented index mode: "+this.indexModes[f]),-1}return b};g.prototype.getTotalPrimitiveCount=function(){for(var a=0,d=0,f=this.primitiveCounts.length;d<f;d++)a+=this.primitiveCounts[d];return a};g.prototype.updatePrimitiveCounts=function(){var a=this.indexData?this.indexData.data.length:this.vertexCount,d=this.getSectionCount();if(this.primitiveCounts.length!==d)this.primitiveCounts=[];for(var f=0;f<d;f++){var b=
g.getPrimitiveCount(this.indexModes[f],this.indexLengths?this.indexLengths[f]:a);this.primitiveCounts[f]=b}};g.getPrimitiveCount=function(a,d){switch(a){case "Triangles":return d/3;case "TriangleFan":case "TriangleStrip":return d-2;case "Lines":return d/2;case "LineStrip":return d-1;case "LineLoop":return d;case "Points":return d}throw Error("unimplemented index mode: "+a);};g.getVertexCount=function(a){switch(a){case "Triangles":case "TriangleFan":case "TriangleStrip":return 3;case "Lines":case "LineStrip":case "LineLoop":return 2;
case "Points":return 1}throw Error("unimplemented index mode: "+a);};var i={Byte:Int8Array,UnsignedByte:Uint8Array,UnsignedByteClamped:k,Short:Int16Array,UnsignedShort:Uint16Array,Int:Int32Array,UnsignedInt:Uint32Array,Float:Float32Array,Double:Float64Array};g.prototype.generateAttributeData=function(){var a=this.vertexData.data,d,f=0,g;for(g in this.attributeMap){d=this.attributeMap[g];d.offset=f;var b=this.vertexCount*d.count;f+=b*c.getByteSize(d.type);var j=i[d.type];if(j)d=new j(a,d.offset,b);
else throw"Unsupported DataType: "+d.type;this.dataViews[g]=d}};g.prototype.makeInterleavedData=function(){var a=0,d=0,f;for(f in this.attributeMap){var g=this.attributeMap[f];g.offset=a;a+=g.count*c.getByteSize(g.type)}var b=new e(new ArrayBuffer(a*this.vertexCount),this.vertexData.target);b._dataUsage=this.vertexData._dataUsage;b._dataNeedsRefresh=!0;var j=new DataView(b.data);for(f in this.attributeMap){var k=this.dataViews[f],g=this.attributeMap[f];g.stride=a;for(var d=g.offset,i=g.count,h=c.getByteSize(g.type),
g=this.getDataMethod(g.type),g=j[g],v=0;v<this.vertexCount;v++)for(var r=0;r<i;r++)g.apply(j,[d+a*v+r*h,k[v*i+r],!0])}this.vertexData=b};g.prototype.getDataMethod=function(a){switch(a){case "Byte":return"setInt8";case "UnsignedByte":return"setUInt8";case "Short":return"setInt16";case "UnsignedShort":return"setUInt16";case "Int":return"setInt32";case "HalfFloat":return"setInt16";case "Float":return"setFloat32";case "Double":return"setFloat64"}};g.prototype.getAttributeBuffer=function(a){return this.dataViews[a]};
g.prototype.getIndexData=function(){return this.indexData};g.prototype.getIndexBuffer=function(){return this.indexData!==null?this.indexData.data:null};g.prototype.getIndexLengths=function(){return this.indexLengths};g.prototype.getIndexModes=function(){return this.indexModes};g.prototype.resetVertexCount=function(){this.vertexCount=this.vertexCountStore};g.prototype.applyTransform=function(a,d){var b=new f,c=this.getAttributeBuffer(a),j=c.length;if(a===g.POSITION)for(var e=0;e<j;e+=3)b.setd(c[e+
0],c[e+1],c[e+2]),d.matrix.applyPostPoint(b),c[e+0]=b[0],c[e+1]=b[1],c[e+2]=b[2];else if(a===g.NORMAL)for(e=0;e<j;e+=3)b.setd(c[e+0],c[e+1],c[e+2]),d.rotation.applyPost(b),c[e+0]=b[0],c[e+1]=b[1],c[e+2]=b[2];else if(a===g.TANGENT)for(e=0;e<j;e+=3)b.setd(c[e+0],c[e+1],c[e+2]),d.rotation.applyPost(b),c[e+0]=b[0],c[e+1]=b[1],c[e+2]=b[2];return this};g.prototype.applyFunction=function(g,b){var c,j,e=this.getAttributeBuffer(g),k=e.length;switch(this.attributeMap[g].count){case 1:for(var i=0;i<k;i++)e[i]=
b(e[i]);break;case 2:c=new a;for(i=0;i<k;i+=2)c.setd(e[i+0],e[i+1]),j=b(c),e[i+0]=j[0],e[i+1]=j[1];break;case 3:c=new f;for(i=0;i<k;i+=3)c.setd(e[i+0],e[i+1],e[i+2]),j=b(c),e[i+0]=j[0],e[i+1]=j[1],e[i+2]=j[2];break;case 4:c=new d;for(i=0;i<k;i+=4)c.setd(e[i+0],e[i+1],e[i+2],e[i+3]),j=b(c),e[i+0]=j[0],e[i+1]=j[1],e[i+2]=j[2],e[i+3]=j[3]}return this};g.prototype.getNormalsMeshData=function(a){if(this.getAttributeBuffer("POSITION")!==void 0&&this.getAttributeBuffer("NORMAL")!==void 0){for(var a=a!==
void 0?a:1,d=[],f=[],b=this.dataViews.POSITION.length/3,c=0;c<b;c++)d.push(this.dataViews.POSITION[c*3+0],this.dataViews.POSITION[c*3+1],this.dataViews.POSITION[c*3+2],this.dataViews.POSITION[c*3+0]+this.dataViews.NORMAL[c*3+0]*a,this.dataViews.POSITION[c*3+1]+this.dataViews.NORMAL[c*3+1]*a,this.dataViews.POSITION[c*3+2]+this.dataViews.NORMAL[c*3+2]*a);for(c=0;c<b*2;c+=2)f.push(c,c+1);a=new g(g.defaultMap([g.POSITION]),d.length,f.length);a.getAttributeBuffer(g.POSITION).set(d);a.getIndexBuffer().set(f);
a.indexModes[0]="Lines";return a}};g.POSITION="POSITION";g.NORMAL="NORMAL";g.COLOR="COLOR";g.TANGENT="TANGENT";g.TEXCOORD0="TEXCOORD0";g.TEXCOORD1="TEXCOORD1";g.TEXCOORD2="TEXCOORD2";g.TEXCOORD3="TEXCOORD3";g.WEIGHTS="WEIGHTS";g.JOINTIDS="JOINTIDS";g.createAttribute=function(a,d,f){return{count:a,type:d,stride:0,offset:0,normalized:f!==void 0?f:!1}};var h={POSITION:g.createAttribute(3,"Float"),NORMAL:g.createAttribute(3,"Float"),COLOR:g.createAttribute(4,"Float"),TANGENT:g.createAttribute(4,"Float"),
TEXCOORD0:g.createAttribute(2,"Float"),TEXCOORD1:g.createAttribute(2,"Float"),TEXCOORD2:g.createAttribute(2,"Float"),TEXCOORD3:g.createAttribute(2,"Float"),WEIGHTS:g.createAttribute(4,"Float"),JOINTIDS:g.createAttribute(4,"Short")};g.defaultMap=function(a){return a===void 0?j(Object.keys(h)):j(a)};return g});
define("goo/renderer/bounds/BoundingSphere",["goo/math/Vector3","goo/math/MathUtils","goo/renderer/bounds/BoundingVolume","goo/renderer/MeshData"],function(e,c,b,a){function f(a,f){b.call(this,a);this.radius=f!==void 0?f:1;this.vec=new e}f.prototype=Object.create(b.prototype);f.prototype.constructor=f;f.prototype.computeFromPoints=function(a){var f=this.min,b=this.max,c=this.vec;f.setd(Infinity,Infinity,Infinity);b.setd(-Infinity,-Infinity,-Infinity);for(var e,h,l,n=0;n<a.length;n+=3)e=a[n+0],h=a[n+
1],l=a[n+2],f.x=e<f.x?e:f.x,f.y=h<f.y?h:f.y,f.z=l<f.z?l:f.z,b.x=e>b.x?e:b.x,b.y=h>b.y?h:b.y,b.z=l>b.z?l:b.z;f=b.addv(f).div(2);for(n=b=0;n<a.length;n+=3)c.setd(a[n],a[n+1],a[n+2]),e=c.subv(f).lengthSquared(),e>b&&(b=e);this.radius=Math.sqrt(b);this.center.setv(f)};f.prototype.computeFromPrimitives=function(d,f,b,c,i){if(!(i-c<=0)){for(var h=[],l=[],n=a.getVertexCount(d.indexModes[f]),o=0;c<i;c++)for(var l=d.getPrimitiveVertices(b[c],f,l),p=0;p<n;p++)h[o++]=(new e).set(l[p]);this.averagePoints(h)}};
f.prototype.averagePoints=function(a){this.center.set(a[0]);for(var f=1;f<a.length;f++)this.center.add(a[f]);this.center.mul(1/a.length);for(var b=0,f=0;f<a.length;f++){var c=e.sub(a[f],this.center,this.vec).lengthSquared();c>b&&(b=c)}this.radius=Math.sqrt(b)+1.0E-5};f.prototype.transform=function(a,b){b===null&&(b=new f);a.applyForward(this.center,b.center);b.radius=Math.abs(this._maxAxis(a.scale)*this.radius);return b};f.prototype.whichSide=function(a){var f=a.normal.data,c=this.center.data,a=f[0]*
c[0]+f[1]*c[1]+f[2]*c[2]-a.constant;return a<-this.radius?b.Inside:a>this.radius?b.Outside:b.Intersects};f.prototype._pseudoDistance=function(a,f){return a.normal.x*f.x+a.normal.y*f.y+a.normal.z*f.z-a.constant};f.prototype._maxAxis=function(a){return Math.max(Math.abs(a.x),Math.max(Math.abs(a.y),Math.abs(a.z)))};f.prototype.toString=function(){var a=Math.round(this.center.x*10)/10,f=Math.round(this.center.y*10)/10,b=Math.round(this.center.z*10)/10,c=Math.round(this.radius*10)/10;return"["+a+","+f+
","+b+"] - "+c};f.prototype.intersects=function(a){return a.intersectsSphere(this)};f.prototype.intersectsBoundingBox=function(a){return Math.abs(a.center.x-this.center.x)<this.radius+a.xExtent&&Math.abs(a.center.y-this.center.y)<this.radius+a.yExtent&&Math.abs(a.center.z-this.center.z)<this.radius+a.zExtent?!0:!1};f.prototype.intersectsSphere=function(a){var f=this.vec.setv(this.center).subv(a.center),a=this.radius+a.radius;return f.dot(f)<=a*a};f.prototype.intersectsRay=function(a){if(!this.center)return!1;
var f=(new e).copy(a.origin).sub(this.center),b=f.dot(f)-this.radius*this.radius;if(b<=0)return!0;a=a.direction.dot(f);return a>=0?!1:a*a>=b};f.prototype.intersectsRayWhere=function(a){var f=(new e).copy(a.origin).sub(this.center),b=f.dot(f)-this.radius*this.radius;if(b<=0)return f=a.direction.dot(f),b=Math.sqrt(f*f-b),f=[b-f],a=[(new e).copy(a.direction).mul(f[0]).add(a.origin)],{distances:f,points:a};f=a.direction.dot(f);if(f>=0)return null;b=f*f-b;if(b<0)return null;else if(b>=1.0E-5)return b=
Math.sqrt(b),f=[-f-b,-f+b],a=[(new e).copy(a.direction).mul(f[0]).add(a.origin),(new e).copy(a.direction).mul(f[1]).add(a.origin)],{distances:f,points:a};f=[-f];a=[(new e).copy(a.direction).mul(f[0]).add(a.origin)];return{distances:f,points:a}};f.prototype.merge=function(a){if(a instanceof f)return this.mergeSphere(a.center,a.radius,this);else{var b=this.vec.setd(a.xExtent,a.yExtent,a.zExtent).length();return this.mergeSphere(a.center,b,this)}};f.prototype.mergeSphere=function(a,b,j){j||(j=new f);
var e=this.vec.setv(a).subv(this.center),i=e.lengthSquared(),h=b-this.radius;if(h*h>=i)return h<=0?(j.center.setv(this.center),j.radius=this.radius):(j.center.setv(a),j.radius=b),j;a=Math.sqrt(i);i=j.center;a>c.EPSILON&&i.addv(e.mul((a+h)/(2*a)));j.radius=0.5*(a+this.radius+b);return j};f.prototype.clone=function(a){return a&&a instanceof f?(a.center.setv(this.center),a.radius=this.radius,a):new f(this.center,this.radius)};return f});
define("goo/math/Matrix",["goo/math/MathUtils"],function(e){function c(b,a){this.rows=b||0;this.cols=a||0;this.data=new Float32Array(this.rows*this.cols)}c.prototype.setupAliases=function(b){for(var a=this,f=0;f<b.length;f++)(function(d){for(var g=0;g<b[d].length;g++)Object.defineProperty(a,b[d][g],{get:function(){return this.data[d]},set:function(a){this.data[d]=a}});Object.defineProperty(a,f,{get:function(){return this.data[d]},set:function(a){this.data[d]=a}})})(f)};c.add=function(b,a,f){var d=
b.rows,g=b.cols;f||(f=new c(d,g));if(a instanceof c){if(a.rows!==d||a.cols!==g||f.rows!==d||f.cols!==g)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(d=0;d<b.data.length;d++)f.data[d]=b.data[d]+a.data[d]}else{if(f.rows!==d||f.cols!==g)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(d=0;d<b.data.length;d++)f.data[d]=b.data[d]+a}return f};c.prototype.add=function(b){return c.add(this,b,this)};c.sub=function(b,a,f){var d=
b.rows,g=b.cols;f||(f=new c(d,g));if(a instanceof c){if(a.rows!==d||a.cols!==g||f.rows!==d||f.cols!==g)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(d=0;d<b.data.length;d++)f.data[d]=b.data[d]-a.data[d]}else{if(f.rows!==d||f.cols!==g)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(d=0;d<b.data.length;d++)f.data[d]=b.data[d]-a}return f};c.prototype.sub=function(b){return c.sub(this,b,this)};c.mul=function(b,a,f){var d=
b.rows,g=b.cols;f||(f=new c(d,g));if(a instanceof c){if(a.rows!==d||a.cols!==g||f.rows!==d||f.cols!==g)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(d=0;d<b.data.length;d++)f.data[d]=b.data[d]*a.data[d]}else{if(f.rows!==d||f.cols!==g)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(d=0;d<b.data.length;d++)f.data[d]=b.data[d]*a}return f};c.prototype.mul=function(b){return c.mul(this,b,this)};c.div=function(b,a,f){var d=
b.rows,g=b.cols;f||(f=new c(d,g));if(a instanceof c){if(a.rows!==d||a.cols!==g||f.rows!==d||f.cols!==g)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(d=0;d<b.data.length;d++)f.data[d]=b.data[d]/a.data[d]}else{if(f.rows!==d||f.cols!==g)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};a=1/a;for(d=0;d<b.data.length;d++)f.data[d]=b.data[d]*a}return f};c.prototype.div=function(b){return c.div(this,b,this)};c.combine=function(b,a,
f){var d=b.rows,g=a.cols,j=b.cols=a.rows;f||(f=new c(d,g));if(b.cols!==j||a.rows!==j||f.rows!==d||f.cols!==g)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};if(f===b||f===a)return c.copy(c.combine(b,a),f);for(var e=0;e<g;e++)for(var i=e*d,h=0;h<d;h++){for(var l=0,n=0;n<j;n++)l+=b.data[n*b.rows+h]*a.data[e*a.rows+n];f.data[i+h]=l}return f};c.prototype.combine=function(b){return c.combine(this,b,this)};c.transpose=function(b,a){var f=b.cols,d=b.rows;a||(a=new c(f,
d));if(a.rows!==f||a.cols!==d)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};if(a===b)return c.copy(c.transpose(b),a);for(var g=0;g<d;g++)for(var j=g*f,e=0;e<f;e++)a.data[j+e]=b.data[e*d+g];return a};c.prototype.transpose=function(){return c.transpose(this,this)};c.copy=function(b,a){var f=b.rows,d=b.cols;a||(a=new c(f,d));if(a.rows!==f||a.cols!==d)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};a.data.set(b.data);return a};c.prototype.copy=
function(b){return c.copy(b,this)};c.equals=function(b,a){if(b.rows!==a.rows||b.cols!==a.cols)return!1;for(var f=0;f<b.data.length;f++)if(Math.abs(b.data[f]-a.data[f])>e.EPSILON)return!1;return!0};c.prototype.equals=function(b){return c.equals(this,b)};c.prototype.isOrthogonal=function(){for(var b=0;b<this.cols;b++)for(var a=b+1;a<this.cols;a++){for(var f=b*this.rows,d=a*this.rows,g=0,c=0;c<this.rows;c++)g+=this.data[f+c]*this.data[d+c];if(Math.abs(g)>e.EPSILON)return!1}return!0};c.prototype.isNormal=
function(){for(var b=0;b<this.cols;b++){for(var a=b*this.rows,f=0,d=0;d<this.rows;d++)f+=this.data[a+d]*this.data[a+d];if(Math.abs(f-1)>e.EPSILON)return!1}return!0};c.prototype.isOrthonormal=function(){return this.isOrthogonal()&&this.isNormal()};c.prototype.clone=function(){return c.copy(this)};c.prototype.set=function(){if(arguments.length===1&&typeof arguments[0]==="object")if(arguments[0]instanceof c)this.copy(arguments[0]);else for(var b=0;b<arguments[0].length;b++)this.data[b]=arguments[0][b];
else for(b=0;b<arguments.length;b++)this.data[b]=arguments[b];return this};c.prototype.toString=function(){for(var b="",a=0;a<this.cols;a++){var f=a*this.rows;b+="[";for(var d=0;d<this.rows;d++)b+=this.data[f+d],b+=d!==this.rows-1?", ":"";b+=a!==this.cols-1?"], ":"]"}return b};return c});
define("goo/math/Matrix3x3",["goo/math/MathUtils","goo/math/Matrix","goo/math/Vector3"],function(e,c,b){function a(){c.call(this,3,3);arguments.length===0?this.setIdentity():this.set(arguments);this._tempX=new b;this._tempY=new b;this._tempZ=new b}a.prototype=Object.create(c.prototype);a.prototype.setupAliases([["e00"],["e10"],["e20"],["e01"],["e11"],["e21"],["e02"],["e12"],["e22"]]);a.IDENTITY=new a(1,0,0,0,1,0,0,0,1);a.add=function(f,d,b){b||(b=new a);var c=b.data,f=f.data;d instanceof a?(d=d.data,
c[0]=f[0]+d[0],c[1]=f[1]+d[1],c[2]=f[2]+d[2],c[3]=f[3]+d[3],c[4]=f[4]+d[4],c[5]=f[5]+d[5],c[6]=f[6]+d[6],c[7]=f[7]+d[7],c[8]=f[8]+d[8]):(c[0]=f[0]+d,c[1]=f[1]+d,c[2]=f[2]+d,c[3]=f[3]+d,c[4]=f[4]+d,c[5]=f[5]+d,c[6]=f[6]+d,c[7]=f[7]+d,c[8]=f[8]+d);return b};a.prototype.add=function(f){return a.add(this,f,this)};a.sub=function(f,d,b){b||(b=new a);var c=b.data,f=f.data;d instanceof a?(d=d.data,c[0]=f[0]-d[0],c[1]=f[1]-d[1],c[2]=f[2]-d[2],c[3]=f[3]-d[3],c[4]=f[4]-d[4],c[5]=f[5]-d[5],c[6]=f[6]-d[6],c[7]=
f[7]-d[7],c[8]=f[8]-d[8]):(c[0]=f[0]-d,c[1]=f[1]-d,c[2]=f[2]-d,c[3]=f[3]-d,c[4]=f[4]-d,c[5]=f[5]-d,c[6]=f[6]-d,c[7]=f[7]-d,c[8]=f[8]-d);return b};a.prototype.sub=function(f){return a.sub(this,f,this)};a.mul=function(f,d,b){b||(b=new a);var c=b.data,f=f.data;d instanceof a?(d=d.data,c[0]=f[0]*d[0],c[1]=f[1]*d[1],c[2]=f[2]*d[2],c[3]=f[3]*d[3],c[4]=f[4]*d[4],c[5]=f[5]*d[5],c[6]=f[6]*d[6],c[7]=f[7]*d[7],c[8]=f[8]*d[8]):(c[0]=f[0]*d,c[1]=f[1]*d,c[2]=f[2]*d,c[3]=f[3]*d,c[4]=f[4]*d,c[5]=f[5]*d,c[6]=f[6]*
d,c[7]=f[7]*d,c[8]=f[8]*d);return b};a.prototype.mul=function(f){return a.mul(this,f,this)};a.div=function(f,d,b){b||(b=new a);var c=b.data,f=f.data;d instanceof a?(d=d.data,c[0]=f[0]/d[0],c[1]=f[1]/d[1],c[2]=f[2]/d[2],c[3]=f[3]/d[3],c[4]=f[4]/d[4],c[5]=f[5]/d[5],c[6]=f[6]/d[6],c[7]=f[7]/d[7],c[8]=f[8]/d[8]):(c[0]=f[0]/d,c[1]=f[1]/d,c[2]=f[2]/d,c[3]=f[3]/d,c[4]=f[4]/d,c[5]=f[5]/d,c[6]=f[6]/d,c[7]=f[7]/d,c[8]=f[8]/d);return b};a.prototype.div=function(f){return a.div(this,f,this)};a.combine=function(f,
d,b){b||(b=new a);var c=f.data,f=c[0],e=c[3],i=c[6],h=c[1],l=c[4],n=c[7],o=c[2],p=c[5],c=c[8],m=d.data,d=m[0],s=m[3],q=m[6],t=m[1],u=m[4],v=m[7],r=m[2],w=m[5],m=m[8],y=b.data;y[0]=f*d+e*t+i*r;y[3]=f*s+e*u+i*w;y[6]=f*q+e*v+i*m;y[1]=h*d+l*t+n*r;y[4]=h*s+l*u+n*w;y[7]=h*q+l*v+n*m;y[2]=o*d+p*t+c*r;y[5]=o*s+p*u+c*w;y[8]=o*q+p*v+c*m;return b};a.prototype.combine=function(f){return a.combine(this,f,this)};a.transpose=function(f,d){d||(d=new a);var b=f.data,c=d.data;if(d===f){var e=b[3],i=b[6],h=b[7];c[3]=
b[1];c[6]=b[2];c[7]=b[5];c[1]=e;c[2]=i;c[5]=h;return d}c[0]=b[0];c[1]=b[3];c[2]=b[6];c[3]=b[1];c[4]=b[4];c[5]=b[7];c[6]=b[2];c[7]=b[5];c[8]=b[8];return d};a.prototype.transpose=function(){return a.transpose(this,this)};a.invert=function(f,d){d||(d=new a);if(d===f)return c.copy(a.invert(f),d);var b=f.determinant();if(Math.abs(b)<e.EPSILON)throw{name:"Singular Matrix",message:"The matrix is singular and cannot be inverted."};var b=1/b,j=d.data,k=f.data;j[0]=(k[4]*k[8]-k[7]*k[5])*b;j[1]=(k[7]*k[2]-k[1]*
k[8])*b;j[2]=(k[1]*k[5]-k[4]*k[2])*b;j[3]=(k[6]*k[5]-k[3]*k[8])*b;j[4]=(k[0]*k[8]-k[6]*k[2])*b;j[5]=(k[3]*k[2]-k[0]*k[5])*b;j[6]=(k[3]*k[7]-k[6]*k[4])*b;j[7]=(k[6]*k[1]-k[0]*k[7])*b;j[8]=(k[0]*k[4]-k[3]*k[1])*b;return d};a.prototype.invert=function(){return a.invert(this,this)};a.prototype.isOrthogonal=function(){var a=this.data,d=a[0]*a[3]+a[1]*a[4]+a[2]*a[5];if(Math.abs(d)>e.EPSILON)return!1;d=a[0]*a[6]+a[1]*a[7]+a[2]*a[8];if(Math.abs(d)>e.EPSILON)return!1;d=a[3]*a[6]+a[4]*a[7]+a[5]*a[8];return Math.abs(d)>
e.EPSILON?!1:!0};a.prototype.isNormal=function(){var a=this.data,d=a[0]*a[0]+a[1]*a[1]+a[2]*a[2];if(Math.abs(d-1)>e.EPSILON)return!1;d=a[3]*a[3]+a[4]*a[4]+a[5]*a[5];if(Math.abs(d-1)>e.EPSILON)return!1;d=a[6]*a[6]+a[7]*a[7]+a[8]*a[8];return Math.abs(d-1)>e.EPSILON?!1:!0};a.prototype.isOrthonormal=function(){return this.isOrthogonal()&&this.isNormal()};a.prototype.determinant=function(){var a=this.data;return a[0]*(a[4]*a[8]-a[7]*a[5])-a[3]*(a[1]*a[8]-a[7]*a[2])+a[6]*(a[1]*a[5]-a[4]*a[2])};a.prototype.setIdentity=
function(){var a=this.data;a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return this};a.prototype.applyPost=function(a){var d=a.data,b=this.data,c=d[0],e=d[1],i=d[2];d[0]=b[0]*c+b[3]*e+b[6]*i;d[1]=b[1]*c+b[4]*e+b[7]*i;d[2]=b[2]*c+b[5]*e+b[8]*i;return a};a.prototype.applyPre=function(a){var d=a.data,b=this.data,c=d[0],e=d[1],i=d[2];d[0]=b[0]*c+b[1]*e+b[2]*i;d[1]=b[3]*c+b[4]*e+b[5]*i;d[2]=b[6]*c+b[7]*e+b[8]*i;return a};a.prototype.multiplyDiagonalPost=function(a,d){var b=a.data[0],
c=a.data[1],e=a.data[2],i=this.data,h=d.data;h[0]=b*i[0];h[1]=b*i[1];h[2]=b*i[2];h[3]=c*i[3];h[4]=c*i[4];h[5]=c*i[5];h[6]=e*i[6];h[7]=e*i[7];h[8]=e*i[8];return d};a.prototype.fromAngles=function(a,d,b){var c=Math.cos(a),a=Math.sin(a),e=Math.cos(d),d=Math.sin(d),i=Math.cos(b),b=Math.sin(b),h=this.data;h[0]=e*i;h[3]=d*a-e*b*c;h[6]=e*b*a+d*c;h[1]=b;h[4]=i*c;h[7]=-i*a;h[2]=-d*i;h[5]=d*b*c+e*a;h[8]=-d*b*a+e*c;return this};a.prototype.rotateX=function(a,d){var b=this.data,c=(d||this).data,e=Math.sin(a),
i=Math.cos(a),h=b[3],l=b[4],n=b[5],o=b[6],p=b[7],m=b[8];b!==c&&(c[0]=b[0],c[1]=b[1],c[2]=b[2]);c[3]=h*i+o*e;c[4]=l*i+p*e;c[5]=n*i+m*e;c[6]=o*i-h*e;c[7]=p*i-l*e;c[8]=m*i-n*e;return c};a.prototype.rotateY=function(a,d){var b=this.data,c=(d||this).data,e=Math.sin(a),i=Math.cos(a),h=b[0],l=b[1],n=b[2],o=b[6],p=b[7],m=b[8];b!==c&&(c[3]=b[3],c[4]=b[4],c[5]=b[5]);c[0]=h*i-o*e;c[1]=l*i-p*e;c[2]=n*i-m*e;c[6]=h*e+o*i;c[7]=l*e+p*i;c[8]=n*e+m*i;return c};a.prototype.rotateZ=function(a,d){var b=this.data,c=(d||
this).data,e=Math.sin(a),i=Math.cos(a),h=b[0],l=b[1],n=b[2],o=b[3],p=b[4],m=b[5];b!==c&&(c[6]=b[6],c[7]=b[7],c[8]=b[8]);c[0]=h*i+o*e;c[1]=l*i+p*e;c[2]=n*i+m*e;c[3]=o*i-h*e;c[4]=p*i-l*e;c[5]=m*i-n*e;return c};a.prototype.toAngles=function(a){a||(a=new b);var d=this.data,c=a.data;d[3]>1-e.EPSILON?(c[1]=Math.atan2(d[2],d[8]),c[2]=Math.PI/2,c[0]=0):d[3]<-1+e.EPSILON?(c[1]=Math.atan2(d[2],d[8]),c[2]=-Math.PI/2,c[0]=0):(c[1]=Math.atan2(-d[2],d[0]),c[0]=Math.atan2(-d[7],d[4]),c[2]=Math.asin(d[1]));return a};
a.prototype.fromAngleNormalAxis=function(a,d,b,c){var e=Math.cos(a),i=Math.sin(a),a=1-e,h=d*b*a,l=d*c*a,n=b*c*a,o=d*i,p=b*i;i*=c;var m=this.data;m[0]=d*d*a+e;m[3]=h-i;m[6]=l+p;m[1]=h+i;m[4]=b*b*a+e;m[7]=n-o;m[2]=l-p;m[5]=n+o;m[8]=c*c*a+e;return this};a.prototype.lookAt=function(a,d){var c=this._tempX,e=this._tempY,k=this._tempZ;k.setv(a).normalize();c.setv(d).cross(k).normalize();c.equals(b.ZERO)&&(k.data[0]!==0?c.setd(k.data[1],-k.data[0],0):c.setd(0,k.data[2],-k.data[1]));e.setv(k).cross(c);var i=
this.data;i[0]=c.data[0];i[1]=c.data[1];i[2]=c.data[2];i[3]=e.data[0];i[4]=e.data[1];i[5]=e.data[2];i[6]=k.data[0];i[7]=k.data[1];i[8]=k.data[2];return this};a.prototype.copyQuaternion=function(a){return a.toRotationMatrix(this)};a.prototype.copy=function(a){var d=this.data,a=a.data;d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=a[3];d[4]=a[4];d[5]=a[5];d[6]=a[6];d[7]=a[7];d[8]=a[8];return this};a.prototype.clone=function(){var b=this.data;return new a(b[0],b[1],b[2],b[3],b[4],b[5],b[4],b[5],b[6])};return a});
define("goo/math/Quaternion",["goo/math/Vector","goo/math/Vector3","goo/math/Matrix3x3","goo/math/MathUtils"],function(e,c,b,a){function f(){e.call(this,4);arguments.length!==0?this.set(arguments):this.setd(0,0,0,1)}f.prototype=Object.create(e.prototype);f.prototype.setupAliases([["x"],["y"],["z"],["w"]]);f.IDENTITY=new f(0,0,0,1);f.ALLOWED_DEVIANCE=1.0E-8;f.add=function(a,b,c){c||(c=new f);c.data[0]=a.data[0]+b.data[0];c.data[1]=a.data[1]+b.data[1];c.data[2]=a.data[2]+b.data[2];c.data[3]=a.data[3]+
b.data[3];return c};f.sub=function(a,b,c){c||(c=new f);c.data[0]=a.data[0]-b.data[0];c.data[1]=a.data[1]-b.data[1];c.data[2]=a.data[2]-b.data[2];c.data[3]=a.data[3]-b.data[3];return c};f.mul=function(a,b,c){c||(c=new f);c.data[0]=a.data[0]*b.data[0];c.data[1]=a.data[1]*b.data[1];c.data[2]=a.data[2]*b.data[2];c.data[3]=a.data[3]*b.data[3];return c};f.div=function(a,b,c){c||(c=new f);var e=!0;c.data[0]=(e&=b.data[0]<0||b.data[0]>0)?a.data[0]/b.data[0]:0;c.data[1]=(e&=b.data[1]<0||b.data[1]>0)?a.data[1]/
b.data[1]:0;c.data[2]=(e&=b.data[2]<0||b.data[2]>0)?a.data[2]/b.data[2]:0;c.data[3]=(e&=b.data[3]<0||b.data[3]>0)?a.data[3]/b.data[3]:0;e===!1&&console.warn("[Quaternion.div] Attempted to divide by zero!");return c};f.scalarAdd=function(a,b,c){c||(c=new f);c.data[0]=a.data[0]+b;c.data[1]=a.data[1]+b;c.data[2]=a.data[2]+b;c.data[3]=a.data[3]+b;return c};f.scalarSub=function(a,b,c){c||(c=new f);c.data[0]=a.data[0]-b;c.data[1]=a.data[1]-b;c.data[2]=a.data[2]-b;c.data[3]=a.data[3]-b;return c};f.scalarMul=
function(a,b,c){c||(c=new f);c.data[0]=a.data[0]*b;c.data[1]=a.data[1]*b;c.data[2]=a.data[2]*b;c.data[3]=a.data[3]*b;return c};f.scalarDiv=function(a,b,c){c||(c=new f);var e=!0,b=(e&=b<0||b>0)?1/b:0;c.data[0]=a.data[0]*b;c.data[1]=a.data[1]*b;c.data[2]=a.data[2]*b;c.data[3]=a.data[3]*b;e===!1&&console.warn("[Quaternion.scalarDiv] Attempted to divide by zero!");return c};f.slerp=function(a,b,f,c){if(f===0)return c.setv(a);else if(f===1)return c.setv(b);if(a.equals(b))return c.setv(a);var e=a.dot(b);
c.setv(b);e<0&&(c.negate(),e=-e);var b=1-f,h=f;1-e>0.1&&(e=Math.acos(e),h=1/Math.sin(e),b=Math.sin((1-f)*e)*h,h*=Math.sin(f*e));c.setd(b*a.data[0]+h*c.data[0],b*a.data[1]+h*c.data[1],b*a.data[2]+h*c.data[2],b*a.data[3]+h*c.data[3]);return c};f.prototype.negate=function(){this.x*=-1;this.y*=-1;this.z*=-1;this.w*=-1;return this};f.prototype.add=function(a){return f.add(this,a,this)};f.prototype.sub=function(a){return f.sub(this,a,this)};f.prototype.mul=function(a){return f.mul(this,a,this)};f.prototype.div=
function(a){return f.div(this,a,this)};f.prototype.scalarAdd=function(a){return f.scalarAdd(this,a,this)};f.prototype.scalarSub=function(a){return f.scalarSub(this,a,this)};f.prototype.scalarMul=function(a){return f.scalarMul(this,a,this)};f.prototype.scalarDiv=function(a){return f.scalarDiv(this,a,this)};f.prototype.slerp=function(a,b){var c=(new f).copy(a);f.slerp(this,a,b,c);this.copy(c);return this};f.prototype.fromRotationMatrix=function(a){var b=a.e00+a.e11+a.e22,f,c,e;if(b>=0){var h=Math.sqrt(b+
1);e=0.5*h;h=0.5/h;b=(a.e21-a.e12)*h;f=(a.e02-a.e20)*h;c=(a.e10-a.e01)*h}else a.e00>a.e11&&a.e00>a.e22?(h=Math.sqrt(1+a.e00-a.e11-a.e22),b=h*0.5,h=0.5/h,f=(a.e10+a.e01)*h,c=(a.e02+a.e20)*h,e=(a.e21-a.e12)*h):a.e11>a.e22?(h=Math.sqrt(1+a.e11-a.e00-a.e22),f=h*0.5,h=0.5/h,b=(a.e10+a.e01)*h,c=(a.e21+a.e12)*h,e=(a.e02-a.e20)*h):(h=Math.sqrt(1+a.e22-a.e00-a.e11),c=h*0.5,h=0.5/h,b=(a.e02+a.e20)*h,f=(a.e21+a.e12)*h,e=(a.e10-a.e01)*h);return this.set(b,f,c,e)};f.prototype.toRotationMatrix=function(a){a||(a=
new b);var f=this.magnitudeSquared(),f=f>0?2/f:0,c=this.data,e=c[0]*f,i=c[1]*f,h=c[2]*f,f=c[0]*e,l=c[0]*i,n=c[0]*h;e*=c[3];var o=c[1]*i,p=c[1]*h;i*=c[3];var m=c[2]*h,c=c[3]*h,h=a.data;h[0]=1-(o+m);h[1]=l+c;h[2]=n-i;h[3]=l-c;h[4]=1-(f+m);h[5]=p+e;h[6]=n+i;h[7]=p-e;h[8]=1-(f+o);return a};f.prototype.fromVectorToVector=function(d,b){var e=d.length()*b.length();if(Math.abs(e)>a.EPSILON){var k=new c,i=d.dot(b)/e,e=Math.acos(Math.max(-1,Math.min(i,1)));d.cross(b,k);i<0&&k.length()<a.EPSILON&&(i=Math.abs(d.x)>
Math.abs(d.y)?Math.abs(d.x)>Math.abs(d.z)?0:2:Math.abs(d.y)>Math.abs(d.z)?1:2,k.setValue(i,-d[(i+1)%3]),k.setValue((i+1)%3,d[i]),k.setValue((i+2)%3,0));return this.fromAngleAxis(e,k)}else return this.set(f.IDENTITY)};f.prototype.normalize=function(){var a=1/this.magnitude();return this.set(this.x*a,this.y*a,this.z*a,this.w*a)};f.prototype.magnitude=function(){var a=this.data[0]*this.data[0]+this.data[1]*this.data[1]+this.data[2]*this.data[2]+this.data[3]*this.data[3];return a===1?1:Math.sqrt(a)};
f.prototype.magnitudeSquared=function(){return this.data[0]*this.data[0]+this.data[1]*this.data[1]+this.data[2]*this.data[2]+this.data[3]*this.data[3]};f.prototype.fromAngleAxis=function(a,b){var f=(new c(b)).normalize();return this.fromAngleNormalAxis(a,f)};f.prototype.fromAngleNormalAxis=function(b,g){if(g.equals(c.ZERO))return this.set(f.IDENTITY);var e=0.5*b,k=a.sin(e),e=a.cos(e),i=k*g.getX(),h=k*g.getY();k*=g.getZ();return this.set(i,h,k,e)};f.prototype.toAngleAxis=function(a){var b=this.x*this.x+
this.y*this.y+this.z*this.z,c;if(Math.abs(b)<=f.ALLOWED_DEVIANCE){if(c=0,a!==null)a.x=1,a.y=0,a.z=0}else if(c=2*Math.acos(this.w),a!==null)b=1/Math.sqrt(b),a.x=this.x*b,a.y=this.y*b,a.z=this.z*b;return c};f.prototype.equals=function(a){return this===a?!0:!a instanceof f?!1:Math.abs(this.data[0]-a.data[0])<f.ALLOWED_DEVIANCE&&Math.abs(this.data[1]-a.data[1])<f.ALLOWED_DEVIANCE&&Math.abs(this.data[2]-a.data[2])<f.ALLOWED_DEVIANCE&&Math.abs(this.data[3]-a.data[3])<f.ALLOWED_DEVIANCE};f.prototype.setd=
function(a,b,f,c){this.data[0]=a;this.data[1]=b;this.data[2]=f;this.data[3]=c;return this};f.prototype.seta=function(a){this.data[0]=a[0];this.data[1]=a[1];this.data[2]=a[2];this.data[3]=a[3];return this};f.prototype.setv=function(a){this.data[0]=a.data[0];this.data[1]=a.data[1];this.data[2]=a.data[2];this.data[3]=a.data[3];return this};return f});
define("goo/shapes/Box",["goo/renderer/MeshData"],function(e){function c(b,a,f,d,c){this.xExtent=b!==void 0?b*0.5:0.5;this.yExtent=a!==void 0?a*0.5:0.5;this.zExtent=f!==void 0?f*0.5:0.5;this.tileX=d||1;this.tileY=c||1;b=e.defaultMap([e.POSITION,e.NORMAL,e.TEXCOORD0]);e.call(this,b,24,36);this.rebuild()}c.prototype=Object.create(e.prototype);c.prototype.rebuild=function(){var b=this.xExtent,a=this.yExtent,f=this.zExtent,d=this.tileX,c=this.tileY,j=[-b,-a,-f,b,-a,-f,b,a,-f,-b,a,-f,b,-a,f,-b,-a,f,b,
a,f,-b,a,f],k=[];(function(a){for(var b=0;b<a.length;b++){var d=a[b]*3;k.push(j[d]);k.push(j[d+1]);k.push(j[d+2])}})([0,1,2,3,1,4,6,2,4,5,7,6,5,0,3,7,2,6,7,3,0,5,4,1]);this.getAttributeBuffer(e.POSITION).set(k);var i=[0,0,-1,1,0,0,0,0,1,-1,0,0,0,1,0,0,-1,0],h=[];(function(){for(var a=0;a<i.length/3;a++)for(var b=0;b<4;b++){var d=a*3;h.push(i[d]);h.push(i[d+1]);h.push(i[d+2])}})();this.getAttributeBuffer(e.NORMAL).set(h);b=[];for(a=0;a<6;a++)b.push(d),b.push(0),b.push(0),b.push(0),b.push(0),b.push(c),
b.push(d),b.push(c);this.getAttributeBuffer(e.TEXCOORD0).set(b);this.getIndexBuffer().set([2,1,0,3,2,0,6,5,4,7,6,4,10,9,8,11,10,8,14,13,12,15,14,12,18,17,16,19,18,16,22,21,20,23,22,20]);return this};return c});
define("goo/shapes/Quad",["goo/renderer/MeshData"],function(e){function c(b,a,f,d){this.xExtent=b!==void 0?b*0.5:0.5;this.yExtent=a!==void 0?a*0.5:0.5;this.tileX=f||1;this.tileY=d||1;b=e.defaultMap([e.POSITION,e.NORMAL,e.TEXCOORD0]);e.call(this,b,4,6);this.rebuild()}c.prototype=Object.create(e.prototype);c.prototype.rebuild=function(){var b=this.xExtent,a=this.yExtent,f=this.tileX,d=this.tileY;this.getAttributeBuffer(e.POSITION).set([-b,-a,0,-b,a,0,b,a,0,b,-a,0]);this.getAttributeBuffer(e.NORMAL).set([0,
0,1,0,0,1,0,0,1,0,0,1]);this.getAttributeBuffer(e.TEXCOORD0).set([0,0,0,d,f,d,f,0]);this.getIndexBuffer().set([0,3,1,1,3,2]);return this};return c});
define("goo/util/Enum",[],function(){function e(a,b){Object.getOwnPropertyNames(b).forEach(function(d){Object.defineProperty(a,d,Object.getOwnPropertyDescriptor(b,d))});return a}function c(a,b){this.name=a;b&&e(this,b);Object.freeze(this)}function b(a){arguments.length===1&&a!==null&&typeof a==="object"?Object.keys(a).forEach(function(b){this[b]=new c(b,a[b])},this):Array.prototype.forEach.call(arguments,function(a){this[a]=new c(a)},this);Object.freeze(this)}c.prototype=Object.create(null);c.prototype.constructor=
c;c.prototype.toString=function(){return"|"+this.name+"|"};Object.freeze(c.prototype);b.prototype.symbols=function(){return Object.keys(this).map(function(a){return this[a]},this)};b.prototype.contains=function(a){return!a instanceof c?!1:this[a.name]===a};return b});
define("goo/shapes/Sphere",["goo/renderer/MeshData","goo/util/Enum","goo/math/Vector3","goo/math/MathUtils"],function(e,c,b,a){function f(a,b,d,c){this.zSamples=(a!==void 0?a:8)+1;this.radialSamples=b!==void 0?b:8;this.radius=d!==void 0?d:0.5;this.textureMode=c!==void 0?c:f.TextureModes.Polar;this.viewInside=!1;a=e.defaultMap([e.POSITION,e.NORMAL,e.TEXCOORD0]);e.call(this,a,(this.zSamples-2)*(this.radialSamples+1)+2,6*(this.zSamples-2)*this.radialSamples);this.rebuild()}function d(a,b,d){a[d*3+0]=
a[b*3+0];a[d*3+1]=a[b*3+1];a[d*3+2]=a[b*3+2]}f.prototype=Object.create(e.prototype);f.prototype.rebuild=function(){for(var c=this.getAttributeBuffer(e.POSITION),j=this.getAttributeBuffer(e.NORMAL),k=this.getAttributeBuffer(e.TEXCOORD0),i=this.getIndexBuffer(),h=1/this.radialSamples,l=2/(this.zSamples-1),n=[],o=[],p=0;p<this.radialSamples;p++){var m=a.TWO_PI*h*p;o[p]=Math.cos(m);n[p]=Math.sin(m)}n[this.radialSamples]=n[0];o[this.radialSamples]=o[0];for(var m=0,s=new b,q=new b,t=new b,u=1;u<this.zSamples-
1;u++){var v=a.HALF_PI*(-1+l*u),r=Math.sin(v),p=this.radius*r,w=q.set(0,0,0);w.z+=p;for(var y=Math.sqrt(Math.abs(this.radius*this.radius-p*p)),x,A=m,p=0;p<this.radialSamples;p++){var z=p*h;x=t.set(o[p],n[p],0);b.mul(x,y,s);c[m*3+0]=w.x+s.x;c[m*3+1]=w.y+s.y;c[m*3+2]=w.z+s.z;x=s.set(c[m*3+0],c[m*3+1],c[m*3+2]);x.normalize();this.viewInside?(j[m*3+0]=-x.x,j[m*3+1]=-x.y,j[m*3+2]=-x.z):(j[m*3+0]=x.x,j[m*3+1]=x.y,j[m*3+2]=x.z);this.textureMode===f.TextureModes.Linear?(k[m*2+0]=z,k[m*2+1]=0.5*(r+1)):this.textureMode===
f.TextureModes.Projected?(k[m*2+0]=z,k[m*2+1]=a.HALF_PI+Math.asin(r)/Math.PI):this.textureMode===f.TextureModes.Polar&&(z=(a.HALF_PI-Math.abs(v))/Math.PI,x=z*n[p]+0.5,k[m*2+0]=z*o[p]+0.5,k[m*2+1]=x);m++}d(c,A,m);d(j,A,m);this.textureMode===f.TextureModes.Linear?(k[m*2+0]=1,k[m*2+1]=0.5*(r+1)):this.textureMode===f.TextureModes.Projected?(k[m*2+0]=1,k[m*2+1]=a.INV_PI*(a.HALF_PI+Math.asin(r))):this.textureMode===f.TextureModes.Polar&&(z=(a.HALF_PI-Math.abs(v))/Math.PI,k[m*2+0]=z+0.5,k[m*2+1]=0.5);m++}c[m*
3+0]=0;c[m*3+1]=0;c[m*3+2]=-this.radius;this.viewInside?(j[m*3+0]=0,j[m*3+1]=0,j[m*3+2]=1):(j[m*3+0]=0,j[m*3+1]=0,j[m*3+2]=-1);this.textureMode===f.TextureModes.Polar?(k[m*2+0]=0.5,k[m*2+1]=0.5):(k[m*2+0]=0.5,k[m*2+1]=0);m++;c[m*3+0]=0;c[m*3+1]=0;c[m*3+2]=this.radius;this.viewInside?(j[m*3+0]=0,j[m*3+1]=0,j[m*3+2]=-1):(j[m*3+0]=0,j[m*3+1]=0,j[m*3+2]=1);this.textureMode===f.TextureModes.Polar?(k[m*2+0]=0.5,k[m*2+1]=0.5):(k[m*2+0]=0.5,k[m*2+1]=1);for(j=u=c=0;u<this.zSamples-3;u++){k=j;h=k+1;j+=this.radialSamples+
1;l=j;n=l+1;for(m=0;m<this.radialSamples;m++)this.viewInside?(i[c++]=k++,i[c++]=l,i[c++]=h,i[c++]=h++,i[c++]=l++,i[c++]=n++):(i[c++]=k++,i[c++]=h,i[c++]=l,i[c++]=h++,i[c++]=n++,i[c++]=l++)}for(m=0;m<this.radialSamples;m++)this.viewInside?(i[c++]=m,i[c++]=m+1,i[c++]=this.vertexCount-2):(i[c++]=m,i[c++]=this.vertexCount-2,i[c++]=m+1);u=(this.zSamples-3)*(this.radialSamples+1);for(m=0;m<this.radialSamples;m++)this.viewInside?(i[c++]=m+u,i[c++]=this.vertexCount-1,i[c++]=m+1+u):(i[c++]=m+u,i[c++]=m+1+
u,i[c++]=this.vertexCount-1);return this};f.TextureModes=new c("Linear","Projected","Polar");return f});
define("goo/addons/cannon/systems/CannonjsSystem","goo/entities/systems/System,goo/renderer/bounds/BoundingBox,goo/renderer/bounds/BoundingSphere,goo/math/Quaternion,goo/shapes/Box,goo/shapes/Quad,goo/shapes/Sphere,goo/renderer/MeshData".split(","),function(e,c,b,a,f,d,g,j){function k(b){e.call(this,"CannonjsSystem",["CannonjsComponent","TransformComponent"]);var b=b||{},d=this.world=new i.World;d.gravity.y=-9.82;d.broadphase=new i.NaiveBroadphase;this.stepFrequency=b.stepFrequency||60;this.quat=
new a}var i=window.CANNON;k.prototype=Object.create(e.prototype);k.prototype.createShape=function(a){var e=a.cannonjsComponent,k=a.transformComponent,o;if(a.meshDataComponent)if(a=a.meshDataComponent,e.useBounds)a.computeBoundFromPoints(),e=a.modelBound,e instanceof c?o=new i.Box(new i.Vec3(e.xExtent,e.yExtent,e.zExtent)):e instanceof b&&(o=new i.Sphere(e.radius));else if(o=a.meshData,o instanceof f)o=new i.Box(new i.Vec3(o.xExtent,o.yExtent,o.zExtent));else if(o instanceof g)o=new i.Sphere(o.radius);
else if(o instanceof d)o=new i.Plane;else{for(var a=[],k=[],p=o.getAttributeBuffer(j.POSITION),m=o.getIndexBuffer(),e=0;e<o.vertexCount*3;e+=3)a.push(new i.Vec3(p[e],p[e+1],p[e+2]));for(e=0;e<o.indexCount;e+=3)k.push([m[e],m[e+1],m[e+2]]);o=new i.ConvexPolyhedron(a,k)}else{a=k.children;for(e=0;e<a.length;e++)if(m=a[e].entity,k=this.createShape(m))o||(o=new i.Compound),p=m.transformComponent.transform.translation,m=m.transformComponent.transform.rotation,p=new i.Vec3(p.x,p.y,p.z),this.quat.fromRotationMatrix(m),
m=new i.Quaternion(this.quat.x,this.quat.y,this.quat.z,this.quat.w),o.addChild(k,p,m)}return o};k.prototype.inserted=function(a){var b=a.cannonjsComponent,d=a.transformComponent,f=this.createShape(a);f?(a=new i.RigidBody(b.mass,f),a.position.set(d.transform.translation.x,d.transform.translation.y,d.transform.translation.z),this.quat.fromRotationMatrix(d.transform.rotation),a.quaternion.set(this.quat.x,this.quat.y,this.quat.z,this.quat.w),b.body=a,this.world.add(a)):a.clearComponent("CannonjsComponent")};
k.prototype.deleted=function(a){(a=a.cannonjsComponent)&&this.world.remove(a.body)};k.prototype.process=function(a){this.world.step(1/this.stepFrequency);for(var b=0;b<a.length;b++){var d=a[b],f=d.cannonjsComponent,c=f.body.position;d.transformComponent.transform.translation.x=c.x;d.transformComponent.transform.translation.y=c.y;d.transformComponent.transform.translation.z=c.z;f=f.body.quaternion;this.quat.set(f.x,f.y,f.z,f.w);d.transformComponent.transform.rotation.copyQuaternion(this.quat);d.transformComponent.setUpdated()}};
return k});define("goo/addons/soundmanager2/components/SoundManager2Component",["goo/entities/components/Component"],function(e){function c(b){this.type="SoundManager2Component";this.settings=b||{};this.sounds={}}c.prototype=Object.create(e.prototype);c.prototype.addSound=function(b,a){this.sounds[b]=a};c.prototype.playSound=function(b){this.sounds[b].soundObject.play()};return c});
define("goo/addons/soundmanager2/systems/SoundManager2System",["goo/entities/systems/System"],function(e){function c(){e.call(this,"SoundManager2System",["SoundManager2Component","TransformComponent"]);this.isReady=!1;window.soundManager?window.soundManager.bind(this).setup({url:"swf",onready:function(){this.isReady=!0},ontimeout:function(){console.warn("Failed to load soundmanager")}}):console.warn("SoundManager2System: soundManager global not found")}c.prototype=Object.create(e.prototype);c.prototype.inserted=
function(b){for(var b=b.soundManager2Component,a=0;a<b.sounds.length;a++){var f=b.sounds[a],d=window.soundManager.createSound(f);f.soundObject=d}};c.prototype.deleted=function(){};c.prototype.process=function(){};return c});
define("goo/entities/components/MeshDataComponent",["goo/renderer/bounds/BoundingSphere","goo/entities/components/Component"],function(e,c){function b(a){this.type="MeshDataComponent";this.meshData=a;this.modelBound=new e;this.autoCompute=!0}b.prototype=Object.create(c.prototype);b.prototype.setModelBound=function(a,b){this.modelBound=a;this.autoCompute=b};b.prototype.computeBoundFromPoints=function(){if(this.autoCompute&&this.modelBound!==null){var a=this.meshData.getAttributeBuffer("POSITION");
if(a!==void 0)this.modelBound.computeFromPoints(a),this.autoCompute=!1}};return b});define("goo/entities/components/MeshRendererComponent",["goo/entities/components/Component"],function(e){function c(){this.type="MeshRendererComponent";this.materials=[];this.worldBound=null;this.cullMode="Dynamic";this.isPickable=this.receiveShadows=this.castShadows=!1}c.prototype=Object.create(e.prototype);c.prototype.updateBounds=function(b,a){this.worldBound=b.transform(a,this.worldBound)};return c});
define("goo/renderer/ShaderCall",[],function(){function e(a,b,d){this.context=a;this.location=b;this.location.value=void 0;if(d)switch(d){case "float":this.typeCall=this.uniform1f;break;case "bool":case "int":case "integer":case "sampler2D":case "sampler3D":case "samplerCube":this.typeCall=this.uniform1i;break;case "floatarray":this.typeCall=this.uniform1fv;break;case "intarray":this.typeCall=this.uniform1iv;break;case "vec2":this.typeCall=this.uniform2fv;break;case "vec3":this.typeCall=this.uniform3fv;
break;case "vec4":this.typeCall=this.uniform4fv;break;case "mat2":this.typeCall=this.uniformMatrix2fv;break;case "mat3":this.typeCall=this.uniformMatrix3fv;break;case "mat4":this.typeCall=this.uniformMatrix4fv;break;default:throw"Uniform type not handled: "+d;}}function c(a,b,d){for(d-=1;d>=0;d--)if(a[d]!==b[d])return!1;return!0}function b(a,b){var d=a.length;if(d!==b.length)return!1;for(var c=0;c<d;c++)if(a[c]!==b[c])return!1;return!0}e.prototype.call=function(a){this.typeCall(a)};e.prototype.uniform1f=
function(a){if(this.location.value!==a)this.context.uniform1f(this.location,a),this.location.value=a};e.prototype.uniform1fv=function(a){var f=this.location.value;if(!(f!==void 0&&b(a,f)))this.context.uniform1fv(this.location,a),this.location.value=a.slice()};e.prototype.uniform1i=function(a){if(this.location.value!==a)this.context.uniform1i(this.location,a),this.location.value=a};e.prototype.uniform1iv=function(a){var f=this.location.value;if(!(f!==void 0&&b(a,f)))this.context.uniform1iv(this.location,
a),this.location.value=a.slice()};e.prototype.uniform2f=function(a,b){var d=this.location.value;if(!(d!==void 0&&d.length===2&&d[0]===a&&d[1]===b))this.context.uniform2f(this.location,a,b),this.location.value=[a,b]};e.prototype.uniform2fv=function(a){var f=this.location.value;if(!(f!==void 0&&b(a,f)))this.context.uniform2fv(this.location,a),this.location.value=a.slice()};e.prototype.uniform2i=function(a,b){var d=this.location.value;if(!(d!==void 0&&d.length===2&&d[0]===a&&d[1]===b))this.context.uniform2i(this.location,
a,b),this.location.value=[a,b]};e.prototype.uniform2iv=function(a){var f=this.location.value;if(!(f!==void 0&&b(a,f)))this.context.uniform2iv(this.location,a),this.location.value=a.slice()};e.prototype.uniform3f=function(a,b,d){var c=this.location.value;if(!(c!==void 0&&c.length===3&&c[0]===a&&c[1]===b&&c[2]===d))this.context.uniform3f(this.location,a,b,d),this.location.value=[a,b,d]};e.prototype.uniform3fv=function(a){var f=this.location.value;if(!(f!==void 0&&b(a,f)))this.context.uniform3fv(this.location,
a),this.location.value=a.slice()};e.prototype.uniform3i=function(a,b,d){var c=this.location.value;if(!(c!==void 0&&c.length===3&&c[0]===a&&c[1]===b&&c[2]===d))this.context.uniform3i(this.location,a,b,d),this.location.value=[a,b,d]};e.prototype.uniform3iv=function(a){var f=this.location.value;if(!(f!==void 0&&b(a,f)))this.context.uniform3iv(this.location,a),this.location.value=a.slice()};e.prototype.uniform4f=function(a,b,d,c){var e=this.location.value;if(!(e!==void 0&&e.length===4&&e[0]===a&&e[1]===
b&&e[2]===d&&e[3]===c))this.context.uniform4f(this.location,a,b,d,c),this.location.value=[a,b,d,c]};e.prototype.uniform4fv=function(a){var f=this.location.value;if(!(f!==void 0&&b(a,f)))this.context.uniform4fv(this.location,a),this.location.value=a.slice()};e.prototype.uniform4i=function(a,b,d,c){var e=this.location.value;if(!(e!==void 0&&e.length===4&&e[0]===a&&e[1]===b&&e[2]===d&&e[3]===c))this.context.uniform4i(this.location,a,b,d,c),this.location.value=[a,b,d,c]};e.prototype.uniform4iv=function(a){var f=
this.location.value;if(!(f!==void 0&&b(a,f)))this.context.uniform4iv(this.location,a),this.location.value=a.slice()};e.prototype.uniformMatrix2fv=function(a,b){b=b===!0;if(a.data){var d=this.location.value;if(d!==void 0)if(c(d.data,a.data,4))return;else d.copy(a);else this.location.value=a.clone();this.context.uniformMatrix2fv(this.location,b,a.data)}else this.context.uniformMatrix2fv(this.location,b,a)};e.prototype.uniformMatrix3fv=function(a,b){b=b===!0;if(a.data){var d=this.location.value;if(d!==
void 0)if(c(d.data,a.data,9))return;else d.copy(a);else this.location.value=a.clone();this.context.uniformMatrix3fv(this.location,b,a.data)}else this.context.uniformMatrix3fv(this.location,b,a)};e.prototype.uniformMatrix4fv=function(a,b){b=b===!0;if(a.data){var d=this.location.value;if(d!==void 0)if(c(d.data,a.data,16))return;else d.copy(a);else this.location.value=a.clone();this.context.uniformMatrix4fv(this.location,b,a.data)}else this.context.uniformMatrix4fv(this.location,b,a)};return e});
define("goo/math/Matrix4x4",["goo/math/MathUtils","goo/math/Matrix"],function(e,c){function b(){c.call(this,4,4);arguments.length===0?this.setIdentity():this.set(arguments)}b.prototype=Object.create(c.prototype);b.prototype.setupAliases([["e00"],["e10"],["e20"],["e30"],["e01"],["e11"],["e21"],["e31"],["e02"],["e12"],["e22"],["e32"],["e03"],["e13"],["e23"],["e33"]]);b.IDENTITY=new b(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);b.add=function(a,f,d){d||(d=new b);f instanceof b?(d.e00=a.e00+f.e00,d.e10=a.e10+f.e10,
d.e20=a.e20+f.e20,d.e30=a.e30+f.e30,d.e01=a.e01+f.e01,d.e11=a.e11+f.e11,d.e21=a.e21+f.e21,d.e31=a.e31+f.e31,d.e02=a.e02+f.e02,d.e12=a.e12+f.e12,d.e22=a.e22+f.e22,d.e32=a.e32+f.e32,d.e03=a.e03+f.e03,d.e13=a.e13+f.e13,d.e23=a.e23+f.e23,d.e33=a.e33+f.e33):(d.e00=a.e00+f,d.e10=a.e10+f,d.e20=a.e20+f,d.e30=a.e30+f,d.e01=a.e01+f,d.e11=a.e11+f,d.e21=a.e21+f,d.e31=a.e31+f,d.e02=a.e02+f,d.e12=a.e12+f,d.e22=a.e22+f,d.e32=a.e32+f,d.e03=a.e03+f,d.e13=a.e13+f,d.e23=a.e23+f,d.e33=a.e33+f);return d};b.prototype.add=
function(a){return b.add(this,a,this)};b.sub=function(a,f,d){d||(d=new b);f instanceof b?(d.e00=a.e00-f.e00,d.e10=a.e10-f.e10,d.e20=a.e20-f.e20,d.e30=a.e30-f.e30,d.e01=a.e01-f.e01,d.e11=a.e11-f.e11,d.e21=a.e21-f.e21,d.e31=a.e31-f.e31,d.e02=a.e02-f.e02,d.e12=a.e12-f.e12,d.e22=a.e22-f.e22,d.e32=a.e32-f.e32,d.e03=a.e03-f.e03,d.e13=a.e13-f.e13,d.e23=a.e23-f.e23,d.e33=a.e33-f.e33):(d.e00=a.e00-f,d.e10=a.e10-f,d.e20=a.e20-f,d.e30=a.e30-f,d.e01=a.e01-f,d.e11=a.e11-f,d.e21=a.e21-f,d.e31=a.e31-f,d.e02=a.e02-
f,d.e12=a.e12-f,d.e22=a.e22-f,d.e32=a.e32-f,d.e03=a.e03-f,d.e13=a.e13-f,d.e23=a.e23-f,d.e33=a.e33-f);return d};b.prototype.sub=function(a){return b.sub(this,a,this)};b.mul=function(a,f,d){d||(d=new b);f instanceof b?(d.e00=a.e00*f.e00,d.e10=a.e10*f.e10,d.e20=a.e20*f.e20,d.e30=a.e30*f.e30,d.e01=a.e01*f.e01,d.e11=a.e11*f.e11,d.e21=a.e21*f.e21,d.e31=a.e31*f.e31,d.e02=a.e02*f.e02,d.e12=a.e12*f.e12,d.e22=a.e22*f.e22,d.e32=a.e32*f.e32,d.e03=a.e03*f.e03,d.e13=a.e13*f.e13,d.e23=a.e23*f.e23,d.e33=a.e33*f.e33):
(d.e00=a.e00*f,d.e10=a.e10*f,d.e20=a.e20*f,d.e30=a.e30*f,d.e01=a.e01*f,d.e11=a.e11*f,d.e21=a.e21*f,d.e31=a.e31*f,d.e02=a.e02*f,d.e12=a.e12*f,d.e22=a.e22*f,d.e32=a.e32*f,d.e03=a.e03*f,d.e13=a.e13*f,d.e23=a.e23*f,d.e33=a.e33*f);return d};b.prototype.mul=function(a){return b.mul(this,a,this)};b.div=function(a,f,d){d||(d=new b);f instanceof b?(d.e00=a.e00/f.e00,d.e10=a.e10/f.e10,d.e20=a.e20/f.e20,d.e30=a.e30/f.e30,d.e01=a.e01/f.e01,d.e11=a.e11/f.e11,d.e21=a.e21/f.e21,d.e31=a.e31/f.e31,d.e02=a.e02/f.e02,
d.e12=a.e12/f.e12,d.e22=a.e22/f.e22,d.e32=a.e32/f.e32,d.e03=a.e03/f.e03,d.e13=a.e13/f.e13,d.e23=a.e23/f.e23,d.e33=a.e33/f.e33):(f=1/f,d.e00=a.e00*f,d.e10=a.e10*f,d.e20=a.e20*f,d.e30=a.e30*f,d.e01=a.e01*f,d.e11=a.e11*f,d.e21=a.e21*f,d.e31=a.e31*f,d.e02=a.e02*f,d.e12=a.e12*f,d.e22=a.e22*f,d.e32=a.e32*f,d.e03=a.e03*f,d.e13=a.e13*f,d.e23=a.e23*f,d.e33=a.e33*f);return d};b.prototype.div=function(a){return b.div(this,a,this)};b.combine=function(a,f,d){d||(d=new b);var c=a.data,a=c[0],e=c[4],k=c[8],i=c[12],
h=c[1],l=c[5],n=c[9],o=c[13],p=c[2],m=c[6],s=c[10],q=c[14],t=c[3],u=c[7],v=c[11],c=c[15],r=f.data,f=r[0],w=r[4],y=r[8],x=r[12],A=r[1],z=r[5],D=r[9],E=r[13],C=r[2],F=r[6],G=r[10],H=r[14],I=r[3],J=r[7],K=r[11],r=r[15],B=d.data;B[0]=a*f+e*A+k*C+i*I;B[4]=a*w+e*z+k*F+i*J;B[8]=a*y+e*D+k*G+i*K;B[12]=a*x+e*E+k*H+i*r;B[1]=h*f+l*A+n*C+o*I;B[5]=h*w+l*z+n*F+o*J;B[9]=h*y+l*D+n*G+o*K;B[13]=h*x+l*E+n*H+o*r;B[2]=p*f+m*A+s*C+q*I;B[6]=p*w+m*z+s*F+q*J;B[10]=p*y+m*D+s*G+q*K;B[14]=p*x+m*E+s*H+q*r;B[3]=t*f+u*A+v*C+c*I;
B[7]=t*w+u*z+v*F+c*J;B[11]=t*y+u*D+v*G+c*K;B[15]=t*x+u*E+v*H+c*r;return d};b.prototype.combine=function(a){return b.combine(this,a,this)};b.transpose=function(a,f){f||(f=new b);var d=a.data,c=f.data;if(f===a){var e=d[4],k=d[8],i=d[12],h=d[9],l=d[13],n=d[14];c[4]=d[1];c[8]=d[2];c[12]=d[3];c[9]=d[6];c[13]=d[7];c[14]=d[11];c[1]=e;c[2]=k;c[3]=i;c[6]=h;c[7]=l;c[11]=n;return f}c[0]=d[0];c[1]=d[4];c[2]=d[8];c[3]=d[12];c[4]=d[1];c[5]=d[5];c[6]=d[9];c[7]=d[13];c[8]=d[2];c[9]=d[6];c[10]=d[10];c[11]=d[14];c[12]=
d[3];c[13]=d[7];c[14]=d[11];c[15]=d[15];return f};b.prototype.transpose=function(){return b.transpose(this,this)};b.invert=function(a,f){f||(f=new b);if(f===a)return c.copy(b.invert(a),f);var d=a.determinant();if(Math.abs(d)<e.EPSILON)throw{name:"Singular Matrix",message:"The matrix is singular and cannot be inverted."};var g=a.data,j=f.data,d=1/d;j[0]=(g[5]*(g[10]*g[15]-g[14]*g[11])-g[9]*(g[6]*g[15]-g[14]*g[7])+g[13]*(g[6]*g[11]-g[10]*g[7]))*d;j[1]=(g[1]*(g[14]*g[11]-g[10]*g[15])-g[9]*(g[14]*g[3]-
g[2]*g[15])+g[13]*(g[10]*g[3]-g[2]*g[11]))*d;j[2]=(g[1]*(g[6]*g[15]-g[14]*g[7])-g[5]*(g[2]*g[15]-g[14]*g[3])+g[13]*(g[2]*g[7]-g[6]*g[3]))*d;j[3]=(g[1]*(g[10]*g[7]-g[6]*g[11])-g[5]*(g[10]*g[3]-g[2]*g[11])+g[9]*(g[6]*g[3]-g[2]*g[7]))*d;j[4]=(g[4]*(g[14]*g[11]-g[10]*g[15])-g[8]*(g[14]*g[7]-g[6]*g[15])+g[12]*(g[10]*g[7]-g[6]*g[11]))*d;j[5]=(g[0]*(g[10]*g[15]-g[14]*g[11])-g[8]*(g[2]*g[15]-g[14]*g[3])+g[12]*(g[2]*g[11]-g[10]*g[3]))*d;j[6]=(g[0]*(g[14]*g[7]-g[6]*g[15])-g[4]*(g[14]*g[3]-g[2]*g[15])+g[12]*
(g[6]*g[3]-g[2]*g[7]))*d;j[7]=(g[0]*(g[6]*g[11]-g[10]*g[7])-g[4]*(g[2]*g[11]-g[10]*g[3])+g[8]*(g[2]*g[7]-g[6]*g[3]))*d;j[8]=(g[4]*(g[9]*g[15]-g[13]*g[11])-g[8]*(g[5]*g[15]-g[13]*g[7])+g[12]*(g[5]*g[11]-g[9]*g[7]))*d;j[9]=(g[0]*(g[13]*g[11]-g[9]*g[15])-g[8]*(g[13]*g[3]-g[1]*g[15])+g[12]*(g[9]*g[3]-g[1]*g[11]))*d;j[10]=(g[0]*(g[5]*g[15]-g[13]*g[7])-g[4]*(g[1]*g[15]-g[13]*g[3])+g[12]*(g[1]*g[7]-g[5]*g[3]))*d;j[11]=(g[0]*(g[9]*g[7]-g[5]*g[11])-g[4]*(g[9]*g[3]-g[1]*g[11])+g[8]*(g[5]*g[3]-g[1]*g[7]))*d;
j[12]=(g[4]*(g[13]*g[10]-g[9]*g[14])-g[8]*(g[13]*g[6]-g[5]*g[14])+g[12]*(g[9]*g[6]-g[5]*g[10]))*d;j[13]=(g[0]*(g[9]*g[14]-g[13]*g[10])-g[8]*(g[1]*g[14]-g[13]*g[2])+g[12]*(g[1]*g[10]-g[9]*g[2]))*d;j[14]=(g[0]*(g[13]*g[6]-g[5]*g[14])-g[4]*(g[13]*g[2]-g[1]*g[14])+g[12]*(g[5]*g[2]-g[1]*g[6]))*d;j[15]=(g[0]*(g[5]*g[10]-g[9]*g[6])-g[4]*(g[1]*g[10]-g[9]*g[2])+g[8]*(g[1]*g[6]-g[5]*g[2]))*d;return f};b.prototype.invert=function(){return b.invert(this,this)};b.prototype.isOrthogonal=function(){var a;a=this.e00*
this.e01+this.e10*this.e11+this.e20*this.e21+this.e30*this.e31;if(Math.abs(a)>e.EPSILON)return!1;a=this.e00*this.e02+this.e10*this.e12+this.e20*this.e22+this.e30*this.e32;if(Math.abs(a)>e.EPSILON)return!1;a=this.e00*this.e03+this.e10*this.e13+this.e20*this.e23+this.e30*this.e33;if(Math.abs(a)>e.EPSILON)return!1;a=this.e01*this.e02+this.e11*this.e12+this.e21*this.e22+this.e31*this.e32;if(Math.abs(a)>e.EPSILON)return!1;a=this.e01*this.e03+this.e11*this.e13+this.e21*this.e23+this.e31*this.e33;if(Math.abs(a)>
e.EPSILON)return!1;a=this.e02*this.e03+this.e12*this.e13+this.e22*this.e23+this.e32*this.e33;return Math.abs(a)>e.EPSILON?!1:!0};b.prototype.isNormal=function(){var a;a=this.e00*this.e00+this.e10*this.e10+this.e20*this.e20+this.e30*this.e30;if(Math.abs(a-1)>e.EPSILON)return!1;a=this.e01*this.e01+this.e11*this.e11+this.e21*this.e21+this.e31*this.e31;if(Math.abs(a-1)>e.EPSILON)return!1;a=this.e02*this.e02+this.e12*this.e12+this.e22*this.e22+this.e32*this.e32;if(Math.abs(a-1)>e.EPSILON)return!1;a=this.e03*
this.e03+this.e13*this.e13+this.e23*this.e23+this.e33*this.e33;return Math.abs(a-1)>e.EPSILON?!1:!0};b.prototype.isOrthonormal=function(){return this.isOrthogonal()&&this.isNormal()};b.prototype.determinant=function(){var a=this.data;return a[0]*(a[5]*a[10]*a[15]+a[9]*a[14]*a[7]+a[13]*a[6]*a[11]-a[13]*a[10]*a[7]-a[9]*a[6]*a[15]-a[5]*a[14]*a[11])-a[4]*(a[1]*a[10]*a[15]+a[9]*a[14]*a[3]+a[13]*a[2]*a[11]-a[13]*a[10]*a[3]-a[9]*a[2]*a[15]-a[1]*a[14]*a[11])+a[8]*(a[1]*a[6]*a[15]+a[5]*a[14]*a[3]+a[13]*a[2]*
a[7]-a[13]*a[6]*a[3]-a[5]*a[2]*a[15]-a[1]*a[14]*a[7])-a[12]*(a[1]*a[6]*a[11]+a[5]*a[10]*a[3]+a[9]*a[2]*a[7]-a[9]*a[6]*a[3]-a[5]*a[2]*a[11]-a[1]*a[10]*a[7])};b.prototype.setIdentity=function(){var a=this.data;a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return this};b.prototype.setRotationFromVector=function(a){var b=Math.sin(a.x),d=Math.cos(a.x),c=Math.sin(a.y),e=Math.cos(a.y),k=Math.sin(a.z),a=Math.cos(a.z);this.e00=a*e;this.e10=
k*e;this.e20=0-c;this.e01=a*c*b-k*d;this.e11=k*c*b+a*d;this.e21=e*b;this.e02=a*c*d+k*b;this.e12=k*c*d-a*b;this.e22=e*d;return this};b.prototype.setRotationFromQuaternion=function(a){var b=a.lengthSquared(),b=b>0?2/b:0,d=a.x*b,c=a.y*b,e=a.z*b,b=a.w*d,k=a.w*c,i=a.w*e;d*=a.x;var h=a.x*c,l=a.x*e;c*=a.y;var n=a.y*e,a=a.z*e;this.e00=1-c-a;this.e10=h+i;this.e20=l-k;this.e01=h-i;this.e11=1-d-a;this.e21=n+b;this.e02=l+k;this.e12=n-b;this.e22=1-d-c;return this};b.prototype.setTranslation=function(a){this.e03=
a.x;this.e13=a.y;this.e23=a.z;return this};b.prototype.getTranslation=function(a){a.x=this.data[12];a.y=this.data[13];a.z=this.data[14];return this};b.prototype.getScale=function(a){var b=Math.sqrt(a.setd(this.data[0],this.data[4],this.data[8]).lengthSquared()),d=Math.sqrt(a.setd(this.data[1],this.data[5],this.data[9]).lengthSquared()),c=Math.sqrt(a.setd(this.data[2],this.data[6],this.data[10]).lengthSquared());a.x=b;a.y=d;a.z=c;return this};b.prototype.setScale=function(a){this.e00*=a.x;this.e10*=
a.y;this.e20*=a.z;this.e01*=a.x;this.e11*=a.y;this.e21*=a.z;this.e02*=a.x;this.e12*=a.y;this.e22*=a.z;return this};b.prototype.applyPre=function(a){var b=a.data[0],d=a.data[1],c=a.data[2],e=a.data[3],k=this.data;a.data[0]=k[0]*b+k[1]*d+k[2]*c+k[3]*e;a.data[1]=k[4]*b+k[5]*d+k[6]*c+k[7]*e;a.data[2]=k[8]*b+k[9]*d+k[10]*c+k[11]*e;a.data[3]=k[12]*b+k[13]*d+k[14]*c+k[15]*e;return a};b.prototype.applyPost=function(a){var b=a.data[0],d=a.data[1],c=a.data[2],e=a.data[3],k=this.data;a.data[0]=k[0]*b+k[4]*d+
k[8]*c+k[12]*e;a.data[1]=k[1]*b+k[5]*d+k[9]*c+k[13]*e;a.data[2]=k[2]*b+k[6]*d+k[10]*c+k[14]*e;a.data[3]=k[3]*b+k[7]*d+k[11]*c+k[15]*e;return a};b.prototype.applyPostPoint=function(a){var b=a.data[0],d=a.data[1],c=a.data[2],e=this.data;a.data[0]=e[0]*b+e[4]*d+e[8]*c+e[12];a.data[1]=e[1]*b+e[5]*d+e[9]*c+e[13];a.data[2]=e[2]*b+e[6]*d+e[10]*c+e[14];return a};b.prototype.applyPostVector=function(a){var b=a.x,d=a.y,c=a.z,e=this.data;a.x=e[0]*b+e[4]*d+e[8]*c;a.y=e[1]*b+e[5]*d+e[9]*c;a.z=e[2]*b+e[6]*d+e[10]*
c;return a};b.prototype.copy=function(a){var b=this.data,a=a.data;b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return this};b.prototype.clone=function(){var a=this.data;return new b(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15])};return b});
define("goo/entities/Entity",[],function(){function e(b,a){this._world=b;this._components=[];Object.defineProperty(this,"id",{value:e.entityCount++,writable:!1});this.name=a!==void 0?a:"Entity_"+this.id;this.skip=!1}function c(b){return b.charAt(0).toLowerCase()+b.substr(1)}e.prototype.addToWorld=function(){this._world.addEntity(this)};e.prototype.removeFromWorld=function(){this._world.removeEntity(this)};e.prototype.setComponent=function(b){var a=this._components.indexOf(b);a===-1?this._components.push(b):
this._components[a]=b;this[c(b.type)]=b;if(b.type==="TransformComponent")b.entity=this;this._world.entityManager.containsEntity(this)&&this._world.changedEntity(this,b,"addedComponent")};e.prototype.hasComponent=function(b){return this[c(b)]!==void 0};e.prototype.getComponent=function(b){return this[c(b)]};e.prototype.clearComponent=function(b){var a=this[c(b)],f=this._components.indexOf(a);if(f!==-1){a=this._components[f];if(a.type==="TransformComponent")a.entity=void 0;this._components.splice(f,
1)}delete this[c(b)];this._world.entityManager.containsEntity(this)&&this._world.changedEntity(this,a,"removedComponent")};e.prototype.toString=function(){return this.name};e.entityCount=0;return e});
define("goo/entities/managers/EntityManager",[],function(){function e(){this.type="EntityManager";this._entitiesById=[]}e.prototype.added=function(c){this.containsEntity(c)||(this._entitiesById[c.id]=c)};e.prototype.removed=function(c){this.containsEntity(c)&&delete this._entitiesById[c.id]};e.prototype.containsEntity=function(c){return this._entitiesById[c.id]!==void 0};e.prototype.getEntityById=function(c){return this._entitiesById[c]};e.prototype.getEntityByName=function(c){for(var b in this._entitiesById){var a=
this._entitiesById[b];if(a.name===c)return a}};e.prototype.getEntities=function(){var c=[],b;for(b in this._entitiesById)c.push(this._entitiesById[b]);return c};e.prototype.getTopEntities=function(){var c=[],b;for(b in this._entitiesById){var a=this._entitiesById[b];a.transformComponent?a.transformComponent.parent||c.push(a):c.push(a)}return c};return e});
define("goo/math/Transform",["goo/math/Vector3","goo/math/Matrix3x3","goo/math/Matrix4x4"],function(e,c,b){function a(){this.matrix=new b;this.translation=new e;this.rotation=new c;this.scale=new e(1,1,1);this.tmpVec=new e;this.tmpVec2=new e;this.tmpMat1=new c;this.tmpMat2=new c}a.combine=function(b,d,g){if(b.scale.data[0]!==b.scale.data[1]||b.scale.data[0]!==b.scale.data[2])throw{name:"NonUniformScaleException",message:"Non-uniform scaling in left hand transform, cannot resolve combined transform"};
var g=g||new a,e=g.tmpVec;e.setv(d.translation);b.rotation.applyPost(e);e.mulv(b.scale);e.addv(b.translation);var k=g.tmpVec2;k.setv(d.scale);k.mulv(b.scale);var i=g.tmpMat1;c.combine(b.rotation,d.rotation,i);g.rotation.copy(i);g.scale.setv(k);g.translation.setv(e);return g};a.prototype.combine=function(b){return a.combine(this,b,this)};a.prototype.multiply=function(a,d){b.combine(a.matrix,d.matrix,this.matrix);this.tmpMat1.data.set(a.rotation.data);this.tmpMat1.multiplyDiagonalPost(a.scale,this.tmpMat1);
this.tmpMat2.data.set(d.rotation.data);this.tmpMat2.multiplyDiagonalPost(d.scale,this.tmpMat2);c.combine(this.tmpMat1,this.tmpMat2,this.rotation);this.translation.setv(d.translation);this.tmpMat1.applyPost(this.translation).addv(a.translation);this.scale.setv(a.scale).mulv(d.scale)};a.prototype.setIdentity=function(){this.matrix.setIdentity();this.translation.setv(e.ZERO);this.rotation.setIdentity();this.scale.setv(e.ONE)};a.prototype.applyForward=function(a,b){b.setv(a);this.matrix.applyPostPoint(b);
return b};a.prototype.applyForwardVector=function(a,b){b.copy(a);b.set(b.x*this.scale.x,b.y*this.scale.y,b.z*this.scale.z);this.rotation.applyPost(b);return b};a.prototype.update=function(){var a=this.matrix.data,b=this.rotation.data,c=this.scale.data,e=this.translation.data;a[0]=c[0]*b[0];a[1]=c[0]*b[1];a[2]=c[0]*b[2];a[3]=0;a[4]=c[1]*b[3];a[5]=c[1]*b[4];a[6]=c[1]*b[5];a[7]=0;a[8]=c[2]*b[6];a[9]=c[2]*b[7];a[10]=c[2]*b[8];a[11]=0;a[12]=e[0];a[13]=e[1];a[14]=e[2];a[15]=1};a.prototype.copy=function(a){this.matrix.copy(a.matrix);
this.translation.setv(a.translation);this.rotation.copy(a.rotation);this.scale.setv(a.scale)};a.prototype.setRotationXYZ=function(a,b,c){this.rotation.fromAngles(a,b,c)};a.prototype.lookAt=function(a,b){this.tmpVec.setv(this.translation).subv(a).normalize();this.rotation.lookAt(this.tmpVec,b)};a.prototype.invert=function(b){b||(b=new a);b.matrix.copy(this.matrix);b.matrix.invert();var d=b.rotation.copy(this.rotation);d.multiplyDiagonalPost(this.scale,d).invert();b.translation.copy(this.translation);
b.rotation.applyPost(b.translation).invert();return b};a.prototype.toString=function(){return""+this.matrix};return a});
define("goo/entities/components/TransformComponent",["goo/math/Transform","goo/entities/components/Component"],function(e,c){function b(){this.type="TransformComponent";this.parent=null;this.children=[];this.transform=new e;this.worldTransform=new e;this._dirty=!0;this._updated=!1}b.prototype=Object.create(c.prototype);b.prototype.setUpdated=function(){this._dirty=!0};b.prototype.attachChild=function(a){for(var b=this;b;){if(b===a){console.warn("attachChild: An object can't be added as a descendant of itself.");
return}b=b.parent}a.parent&&a.parent.detachChild(a);a.parent=this;this.children.push(a)};b.prototype.detachChild=function(a){if(a===this)console.warn("attachChild: An object can't be removed from itself.");else{var b=this.children.indexOf(a);if(b!==-1)a.parent=null,this.children.splice(b,1)}};b.prototype.updateTransform=function(){this.transform.update()};b.prototype.updateWorldTransform=function(){this.parent?this.worldTransform.multiply(this.parent.worldTransform,this.transform):this.worldTransform.copy(this.transform);
this._dirty=!1;this._updated=!0};return b});
define("goo/entities/World",["goo/entities/Entity","goo/entities/managers/EntityManager","goo/entities/components/TransformComponent"],function(e,c,b){function a(){this._managers=[];this._systems=[];this._addedEntities=[];this._changedEntities=[];this._removedEntities=[];this.entityManager=new c;this.setManager(this.entityManager);this.time=0;this.tpf=1}a.time=0;a.prototype.setManager=function(a){this._managers.push(a)};a.prototype.getManager=function(a){for(var b=0;b<this._managers.length;b++){var c=
this._managers[b];if(c.type===a)return c}};a.prototype.setSystem=function(a){this._systems.push(a)};a.prototype.getSystem=function(a){for(var b=0;b<this._systems.length;b++){var c=this._systems[b];if(c.type===a)return c}};a.prototype.createEntity=function(a){a=new e(this,a);a.setComponent(new b);return a};a.prototype.getEntities=function(){return this.entityManager.getEntities()};a.prototype.addEntity=function(a){this._addedEntities.push(a)};a.prototype.removeEntity=function(a){this._removedEntities.push(a)};
a.prototype.changedEntity=function(a,b,c){a={entity:a};if(b!==void 0)a.component=b;if(c!==void 0)a.eventType=c;this._changedEntities.push(a)};a.prototype.process=function(){this._check(this._addedEntities,function(a,b){a.added&&a.added(b);if(a.addedComponent)for(var d=0;d<b._components.length;d++)a.addedComponent(b,b._components[d])});this._check(this._changedEntities,function(a,b){a.changed&&a.changed(b.entity);if(b.eventType!==void 0&&a[b.eventType])a[b.eventType](b.entity,b.component)});this._check(this._removedEntities,
function(a,b){a.removed&&a.removed(b);if(a.removedComponent)for(var d=0;d<b._components.length;d++)a.removedComponent(b,b._components[d])});for(var a=0;a<this._systems.length;a++){var b=this._systems[a];b.passive||b._process(this.tpf)}};a.prototype._check=function(a,b){for(var c=0;c<a.length;c++){for(var e=a[c],k=0;k<this._managers.length;k++)b(this._managers[k],e);for(k=0;k<this._systems.length;k++)b(this._systems[k],e)}a.length=0};return a});
define("goo/renderer/RenderQueue",["goo/math/Vector3"],function(e){function c(){var b=this,a=new e;this.opaqueSorter=function(c,d){var g=c.meshRendererComponent.materials[0].shader,e=d.meshRendererComponent.materials[0].shader;if(g===null||e===null)return 0;return g._id===e._id?(e=c.meshRendererComponent.worldBound,g=d.meshRendererComponent.worldBound,e=a.setv(b.camera.translation).subv(e.center).lengthSquared(),g=a.setv(b.camera.translation).subv(g.center).lengthSquared(),e-g):g._id-e._id};this.transparentSorter=
function(c,d){var g=c.meshRendererComponent.worldBound,e=d.meshRendererComponent.worldBound,g=a.setv(b.camera.translation).subv(g.center).lengthSquared();return a.setv(b.camera.translation).subv(e.center).lengthSquared()-g};this.bucketSorter=function(a,b){return a-b}}c.prototype.sort=function(b,a){var f=0;this.camera=a;for(var d={},g=[],e=0;e<b.length;e++){var k=b[e];if(!k.meshRendererComponent||k.meshRendererComponent.materials.length===0)b[f]=k,f++;else{var i=k.meshRendererComponent.materials[0].getRenderQueue(),
h=d[i];h||(h=[],d[i]=h,g.push(i));h.push(k)}}g.length>1&&g.sort(this.bucketSorter);for(k=0;k<g.length;k++){e=g[k];h=d[e];e<=c.TRANSPARENT?h.sort(this.opaqueSorter):h.sort(this.transparentSorter);for(e=0;e<h.length;e++)b[f]=h[e],f++}};c.BACKGROUND=0;c.OPAQUE=1E3;c.TRANSPARENT=2E3;c.OVERLAY=3E3;return c});
define("goo/renderer/Shader",["goo/renderer/ShaderCall","goo/math/Matrix4x4","goo/math/Vector3","goo/entities/World","goo/renderer/RenderQueue"],function(e,c,b,a,f){function d(a,b){if(!b.vshader||!b.fshader)throw Error("Missing shader sources for shader: "+a);this.name=a;this.origVertexSource=this.vertexSource=b.vshader;this.origFragmentSource=this.fragmentSource=b.fshader;this.shaderProgram=null;this.attributeMapping={};this.attributeIndexMapping={};this.uniformMapping={};this.uniformCallMapping=
{};this.textureSlots=[];this.defaultCallbacks={};g(this.defaultCallbacks);this.currentCallbacks={};this.overridePrecision=b.precision||null;this.processors=b.processors;this.defines=b.defines;this.attributes=b.attributes;this.uniforms=b.uniforms;this.renderQueue=f.OPAQUE;this._id=d.id++;this.errorOnce=!1}function g(b){var f=new c;b[d.PROJECTION_MATRIX]=function(a,b){var d=b.camera.getProjectionMatrix();a.uniformMatrix4fv(d)};b[d.VIEW_MATRIX]=function(a,b){var d=b.camera.getViewMatrix();a.uniformMatrix4fv(d)};
b[d.WORLD_MATRIX]=function(a,b){a.uniformMatrix4fv(b.transform!==void 0?b.transform.matrix:f)};b[d.VIEW_INVERSE_MATRIX]=function(a,b){var d=b.camera.getViewInverseMatrix();a.uniformMatrix4fv(d)};b[d.VIEW_PROJECTION_MATRIX]=function(a,b){var d=b.camera.getViewProjectionMatrix();a.uniformMatrix4fv(d)};b[d.VIEW_PROJECTION_INVERSE_MATRIX]=function(a,b){var d=b.camera.getViewProjectionInverseMatrix();a.uniformMatrix4fv(d)};for(var g=0;g<16;g++)b[d["TEXTURE"+g]]=function(a){return function(b){b.uniform1i(a)}}(g);
for(g=0;g<8;g++)b[d["LIGHT"+g]]=function(a){return function(b,d){var c=d.lights[a];c!==void 0?b.uniform3f(c.translation.x,c.translation.y,c.translation.z):b.uniform3f(-20,20,20)}}(g);b[d.LIGHTCOUNT]=function(a,b){a.uniform1i(b.lights.length)};b[d.CAMERA]=function(a,b){var d=b.camera.translation;a.uniform3f(d.x,d.y,d.z)};b[d.NEAR_PLANE]=function(a,b){a.uniform1f(b.camera.near)};b[d.FAR_PLANE]=function(a,b){a.uniform1f(b.camera.far)};b[d.MAIN_NEAR_PLANE]=function(a,b){a.uniform1f(b.mainCamera.near)};
b[d.MAIN_FAR_PLANE]=function(a,b){a.uniform1f(b.mainCamera.far)};var e=[0.1,0.1,0.1,1],k=[0,0,0,0],i=[1,1,1,1],h=[0.8,0.8,0.8,1];b[d.AMBIENT]=function(a,b){a.uniform4fv(b.material.materialState!==void 0?b.material.materialState.ambient:e)};b[d.EMISSIVE]=function(a,b){a.uniform4fv(b.material.materialState!==void 0?b.material.materialState.emissive:k)};b[d.DIFFUSE]=function(a,b){a.uniform4fv(b.material.materialState!==void 0?b.material.materialState.diffuse:i)};b[d.SPECULAR]=function(a,b){a.uniform4fv(b.material.materialState!==
void 0?b.material.materialState.specular:h)};b[d.SPECULAR_POWER]=function(a,b){var d=b.material.materialState!==void 0?b.material.materialState.shininess:16,d=Math.max(d,1);a.uniform1f(d)};b[d.TIME]=function(b){b.uniform1f(a.time)};b[d.LIGHT_PROJECTION_MATRIX]=function(a,b){var d=b.lightCamera.getProjectionMatrix();a.uniformMatrix4fv(d)};b[d.LIGHT_VIEW_MATRIX]=function(a,b){var d=b.lightCamera.getViewMatrix();a.uniformMatrix4fv(d)};b[d.LIGHT_NEAR_PLANE]=function(a,b){a.uniform1f(b.lightCamera.near)};
b[d.LIGHT_FAR_PLANE]=function(a,b){a.uniform1f(b.lightCamera.far)};b[d.RESOLUTION]=function(a,b){a.uniform2f(b.renderer.viewportWidth,b.renderer.viewportHeight)}}var j=window.WebGLRenderingContext;d.id=0;d.prototype.clone=function(){return new d(this.name,{precision:this.precision,processors:this.processors,defines:this.defines,attributes:this.attributes,uniforms:this.uniforms,vshader:this.origVertexSource,fshader:this.origFragmentSource})};var k=/\b(attribute|uniform)\s+(float|int|bool|vec2|vec3|vec4|mat3|mat4|sampler2D|sampler3D|samplerCube)\s+(\w+)(\s*\[\s*\w+\s*\])*;/g;
d.prototype.apply=function(a,b){var d=b.context,c=b.rendererRecord;this.shaderProgram===null&&(this._investigateShaders(),this.addDefines(this.defines),this.addPrecision(this.overridePrecision||b.shaderPrecision),this.compile(b));var f=!1;if(c.usedProgram!==this.shaderProgram)d.useProgram(this.shaderProgram),c.usedProgram=this.shaderProgram,f=!0;if(this.attributes){var d=a.meshData.attributeMap,g;for(g in this.attributes)if(c=d[this.attributes[g]]){var e=this.attributeIndexMapping[g];e!==void 0&&
(f&&b.context.enableVertexAttribArray(e),b.bindVertexAttribute(e,c))}}if(this.uniforms)try{for(var k in this.uniforms)this._bindUniform(k,a);this.errorOnce=!1}catch(i){if(this.errorOnce===!1)console.error(i.stack),this.errorOnce=!0}};d.prototype._bindUniform=function(a,b){var d=this.uniformCallMapping[a];if(d){var c=b.material.uniforms[a]||this.uniforms[a];if(typeof c==="string")if(c=this.currentCallbacks[a])c(d,b);else for(c=0;c<this.textureSlots.length;c++){if(this.textureSlots[c].name===a){d.call(c);
break}}else c=typeof c==="function"?c(b):c,d.call(c)}};d.prototype.rebuild=function(){this.shaderProgram=null;this.attributeMapping={};this.attributeIndexMapping={};this.uniformMapping={};this.uniformCallMapping={};this.currentCallbacks={};this.vertexSource=this.origVertexSource;this.fragmentSource=this.origFragmentSource};d.prototype._investigateShaders=function(){this.textureSlots=[];d.investigateShader(this.vertexSource,this);d.investigateShader(this.fragmentSource,this)};d.investigateShader=function(a,
b){k.lastIndex=0;for(var d=k.exec(a);d!==null;){var c={format:d[2]},f=d[1],g=d[3];if(d[4])if(c.format==="float")c.format="floatarray";else if(c.format==="int")c.format="intarray";"attribute"===f?b.attributeMapping[g]=c:(c.format.indexOf("sampler")===0&&b.textureSlots.push({format:c.format,name:g,mapping:b.uniforms[g]}),b.uniformMapping[g]=c);d=k.exec(a)}};d.prototype.compile=function(a){var a=a.context,b=this._getShader(a,j.VERTEX_SHADER,this.vertexSource),d=this._getShader(a,j.FRAGMENT_SHADER,this.fragmentSource);
(b===null||d===null)&&console.error("Shader error - no shaders");this.shaderProgram=a.createProgram();var c=a.getError();(this.shaderProgram===null||c!==j.NO_ERROR)&&console.error("Shader error: "+c+" [shader: "+this.name+"]");a.attachShader(this.shaderProgram,b);a.attachShader(this.shaderProgram,d);a.linkProgram(this.shaderProgram);a.getProgramParameter(this.shaderProgram,j.LINK_STATUS)||console.error("Could not initialise shaders: "+a.getProgramInfoLog(this.shaderProgram));for(var f in this.attributeMapping)b=
a.getAttribLocation(this.shaderProgram,f),b!==-1&&(this.attributeIndexMapping[f]=b);for(f in this.uniformMapping)b=a.getUniformLocation(this.shaderProgram,f),b!==null&&(this.uniformCallMapping[f]=new e(a,b,this.uniformMapping[f].format));if(this.uniforms){if(this.uniforms.$link){a=this.uniforms.$link instanceof Array?this.uniforms.$link:[this.uniforms.$link];for(b=0;b<a.length;b++)for(f in d=a[b],d)this.uniforms[f]=d[f];delete this.uniforms.$link}for(var g in this.uniforms)f=this.uniforms[g],this.defaultCallbacks[f]&&
(this.currentCallbacks[g]=this.defaultCallbacks[f])}console.log("Shader ["+this.name+"]["+this._id+"] compiled")};var i=/\bERROR: \d+:(\d+):\s(.+)\b/g;d.prototype._getShader=function(a,b,d){var c=a.createShader(b);a.shaderSource(c,d);a.compileShader(c);if(!a.getShaderParameter(c,j.COMPILE_STATUS)){a=a.getShaderInfoLog(c);b=b===j.VERTEX_SHADER?"VertexShader":"FragmentShader";i.lastIndex=0;var f=i.exec(a);if(f!==null)for(;f!==null;){var c=d.split("\n"),g=f[1],f=f[2];console.error("Error in "+b+" - ["+
this.name+"]["+this._id+"] at line "+g+":");console.error("\tError: "+f);console.error("\tSource: "+c[g-1]);f=i.exec(a)}else console.error("Error in "+b+" - ["+this.name+"]["+this._id+"] "+a);return null}return c};var h=/\bprecision\s+(lowp|mediump|highp)\s+(float|int);/g;d.prototype.addPrecision=function(a){h.lastIndex=0;if(h.exec(this.vertexSource)===null)this.vertexSource="precision "+a+" float;\n"+this.vertexSource;h.lastIndex=0;if(h.exec(this.fragmentSource)===null)this.fragmentSource="precision "+
a+" float;\n"+this.fragmentSource};d.prototype.addDefines=function(a){if(a)a=this.generateDefines(a),this.vertexSource=a+"\n"+this.vertexSource,this.fragmentSource=a+"\n"+this.fragmentSource};d.prototype.generateDefines=function(a){var b=[],d;for(d in a){var c=a[d];c!==!1&&b.push("#define "+d+" "+c)}return b.join("\n")};d.prototype.getShaderDefinition=function(){return{vshader:this.vertexSource,fshader:this.fragmentSource,defines:this.defines,attributes:this.attributes,uniforms:this.uniforms}};d.prototype.toString=
function(){return this.name};d.PROJECTION_MATRIX="PROJECTION_MATRIX";d.VIEW_MATRIX="VIEW_MATRIX";d.VIEW_INVERSE_MATRIX="VIEW_INVERSE_MATRIX";d.VIEW_PROJECTION_MATRIX="VIEW_PROJECTION_MATRIX";d.VIEW_PROJECTION_INVERSE_MATRIX="VIEW_PROJECTION_INVERSE_MATRIX";d.WORLD_MATRIX="WORLD_MATRIX";for(b=0;b<8;b++)d["LIGHT"+b]="LIGHT"+b;d.CAMERA="CAMERA";d.AMBIENT="AMBIENT";d.EMISSIVE="EMISSIVE";d.DIFFUSE="DIFFUSE";d.SPECULAR="SPECULAR";d.SPECULAR_POWER="SPECULAR_POWER";d.NEAR_PLANE="NEAR_PLANE";d.FAR_PLANE="FAR_PLANE";
d.MAIN_NEAR_PLANE="NEAR_PLANE";d.MAIN_FAR_PLANE="FAR_PLANE";d.TIME="TIME";d.RESOLUTION="RESOLUTION";d.LIGHT_PROJECTION_MATRIX="LIGHT_PROJECTION_MATRIX";d.LIGHT_VIEW_MATRIX="LIGHT_VIEW_MATRIX";d.LIGHT_NEAR_PLANE="LIGHT_NEAR_PLANE";d.LIGHT_FAR_PLANE="LIGHT_FAR_PLANE";d.DIFFUSE_MAP="DIFFUSE_MAP";d.NORMAL_MAP="NORMAL_MAP";d.SPECULAR_MAP="SPECULAR_MAP";d.LIGHT_MAP="LIGHT_MAP";d.SHADOW_MAP="SHADOW_MAP";d.AO_MAP="AO_MAP";d.EMISSIVE_MAP="EMISSIVE_MAP";d.DEPTH_MAP="DEPTH_MAP";return d});
define("goo/renderer/Material",["goo/renderer/Shader"],function(e){function c(b){this.name=b;this.shader=null;this.uniforms={};this._textureMaps={};this.materialState=void 0;this.cullState={enabled:!0,cullFace:"Back",frontFace:"CCW"};this.blendState={blending:"NoBlending",blendEquation:"AddEquation",blendSrc:"SrcAlphaFactor",blendDst:"OneMinusSrcAlphaFactor"};this.depthState={enabled:!0,write:!0};this.offsetState={enabled:!1,factor:1,units:1};this.wireframe=!1;this.renderQueue=null}c.prototype.setTexture=
function(b,a){this._textureMaps[b]=a};c.prototype.getTexture=function(b){return this._textureMaps[b]};c.prototype.removeTexture=function(b){delete this._textureMaps[b]};c.prototype.getTextures=function(){var b=[],a;for(a in this._textureMaps)b.push(this._textureMaps[a]);return b};c.prototype.getTextureEntries=function(){return this._textureMaps};c.prototype.getRenderQueue=function(){if(this.renderQueue!==null)return this.renderQueue;else if(this.shader!==null)return this.shader.renderQueue;return 1E3};
c.prototype.setRenderQueue=function(b){this.renderQueue=b};c.store=[];c.hash=[];c.createShader=function(b,a){var f=c.store.indexOf(b);if(f!==-1)return c.hash[f];f=new e(a||"DefaultShader",b);c.store.push(b);c.hash.push(f);return f};c.clearShaderCache=function(){c.store.length=0;c.hash.length=0};c.createMaterial=function(b,a){var f=new c(a||"DefaultMaterial");f.shader=c.createShader(b);return f};return c});
define("goo/util/rsvp",["exports"],function(e){function c(b,d){a.async(function(){b.trigger("promise:resolved",{detail:d});b.isResolved=!0;b.resolvedValue=d})}function b(b,d){a.async(function(){b.trigger("promise:failed",{detail:d});b.isRejected=!0;b.rejectedValue=d})}var a={},f=typeof window!=="undefined"?window:{},f=f.MutationObserver||f.WebKitMutationObserver,d=window.process;if(typeof d!=="undefined"&&{}.toString.call(d)==="[object process]")a.async=function(a,b){d.nextTick(function(){a.call(b)})};
else if(f){var g=[],j=new f(function(){var a=g.slice();g=[];a.forEach(function(a){a[0].call(a[1])})}),k=document.createElement("div");j.observe(k,{attributes:!0});window.addEventListener("unload",function(){j.disconnect();j=null});a.async=function(a,b){g.push([a,b]);k.setAttribute("drainQueue","drainQueue")}}else a.async=function(a,b){setTimeout(function(){a.call(b)},1)};var i=function(a,b){this.type=a;for(var d in b)b.hasOwnProperty(d)&&(this[d]=b[d])},h=function(a,b){for(var d=0,c=a.length;d<c;d++)if(a[d][0]===
b)return d;return-1},l=function(a){var b=a._promiseCallbacks;if(!b)b=a._promiseCallbacks={};return b},f={mixin:function(a){a.on=this.on;a.off=this.off;a.trigger=this.trigger;return a},on:function(a,b,d){for(var c=l(this),f,g,a=a.split(/\s+/),d=d||this;g=a.shift();)(f=c[g])||(f=c[g]=[]),h(f,b)===-1&&f.push([b,d])},off:function(a,b){for(var d=l(this),c,f,a=a.split(/\s+/);c=a.shift();)b?(c=d[c],f=h(c,b),f!==-1&&c.splice(f,1)):d[c]=[]},trigger:function(a,b){var d,c,f,g;if(d=l(this)[a])for(var e=0,k=d.length;e<
k;e++)c=d[e],f=c[0],c=c[1],typeof b!=="object"&&(b={detail:b}),g=new i(a,b),f.call(c,g)}},n=function(){this.on("promise:resolved",function(a){this.trigger("success",{detail:a.detail})},this);this.on("promise:failed",function(a){this.trigger("error",{detail:a.detail})},this)},o=function(){},p=function(a,b,d,c){var f=typeof d==="function",g,e,k,i;if(f)try{g=d(c.detail),k=!0}catch(h){i=!0,e=h}else g=c.detail,k=!0;if(g&&typeof g.then==="function")g.then(function(a){b.resolve(a)},function(a){b.reject(a)});
else if(f&&k)b.resolve(g);else if(i)b.reject(e);else b[a](g)};n.prototype={then:function(b,d){var c=new n;this.isResolved&&a.async(function(){p("resolve",c,b,{detail:this.resolvedValue})},this);this.isRejected&&a.async(function(){p("reject",c,d,{detail:this.rejectedValue})},this);this.on("promise:resolved",function(a){p("resolve",c,b,a)});this.on("promise:failed",function(a){p("reject",c,d,a)});return c},resolve:function(a){c(this,a);this.reject=this.resolve=o},reject:function(a){b(this,a);this.reject=
this.resolve=o}};f.mixin(n.prototype);e.Promise=n;e.Event=i;e.EventTarget=f;e.all=function(a){var b,d=[],c=new n,f=a.length;f===0&&c.resolve([]);var g=function(a){return function(b){d[a]=b;--f===0&&c.resolve(d)}},e=function(a){c.reject(a)};for(b=0;b<f;b++)a[b].then(g(b),e);return c};e.configure=function(b,d){a[b]=d}});
define("goo/util/Ajax",["goo/util/rsvp"],function(e){function c(b){this._loadStack=[];this._callback=b}c.prototype.get=function(b){var a=new e.Promise,c=this._progress.bind(this),d={loaded:0,total:0,lengthComputable:!1};this._loadStack.push(d);var b=b||{},g=new XMLHttpRequest;g.open("GET",b.url||"",!0);if(b.responseType)g.responseType=b.responseType;g.onreadystatechange=function(){if(g.readyState===4)g.status>=200&&g.status<=299?(d.loaded=d.total,c(),a.resolve(g)):a.reject(g.statusText)};g.addEventListener("progress",
function(a){d.loaded=a.loaded||a.position;d.total=a.total||a.totalSize;d.lengthComputable=a.lengthComputable;c()},!1);g.send();return a};c.prototype._progress=function(){if(this._callback){for(var b={total:0,loaded:0,count:this._loadStack.length},a=0;a<this._loadStack.length;a++)b.total+=this._loadStack[a].total,b.loaded+=this._loadStack[a].loaded;this._callback(b)}};c.ARRAY_BUFFER="arraybuffer";c.prototype.load=function(b,a){if(typeof b==="undefined"||b===null)throw Error("Ajax(): `path` was undefined/null");
var f={url:b};if(a===c.ARRAY_BUFFER)f.responseType=c.ARRAY_BUFFER;var d=this.get(f).then(function(a){return a.response});d.then(null,function(a){console.error("Ajax.load(): Could not retrieve data from `"+f.url+"`.\n Reason: "+a);throw Error("Ajax.load(): Could not retrieve data from `"+f.url+"`.\n Reason: "+a);});return d};c.prototype.loadImage=function(b){var a=new e.Promise,f=new Image;f.addEventListener("load",function(){f.dataReady=!0;window.URL.revokeObjectURL(f.src);a.resolve(f)},!1);f.addEventListener("error",
function(){a.reject("Ajax.loadImage(): Couldn't load from ["+b+"]")},!1);this.load(b,c.ARRAY_BUFFER).then(function(a){var a=new Uint8Array(a,0,a.byteLength),c="image/jpeg";/\.png$/.test(b)&&(c="image/png");a=new Blob([a],{type:c});f.src=window.URL.createObjectURL(a);return f});return a};return c});
define("goo/loaders/Loader",["goo/util/rsvp","goo/util/Ajax"],function(e,c){function b(a){if(typeof a!=="undefined"&&a!==null&&typeof a!=="object")throw Error("Loader(): Argument `parameters` must be of type `object`");else if(typeof a==="undefined"||a===null)a={};this.rootPath=a.rootPath||"";this.xhr=a.xhr||new c(this._progressCallback.bind(this));this._progressCallbacks=[];this.total=0}b.prototype.load=function(a,c,d){if(typeof a==="undefined"||a===null)throw Error("Loader(): `path` was undefined/null");
var g={url:this._buildURL(a)};if(d===b.ARRAY_BUFFER)g.responseType=b.ARRAY_BUFFER;a=this.xhr.get(g).then(function(a){return a.response});c&&(a=a.then(function(a){return typeof c==="function"?c(a):a}));a.then(function(){console.log("Loaded: "+g.url)});a.then(null,function(a){console.error("Loader.load(): Could not retrieve data from `"+g.url+"`.\n Reason: "+a);throw Error("Loader.load(): Could not retrieve data from `"+g.url+"`.\n Reason: "+a);});return a};b.prototype.addProgressCallback=function(a){this._progressCallbacks.push(a)};
b.prototype.removeProgressCallback=function(a){for(var b=0;b<this._progressCallbacks.length;b++)if(this._progressCallbacks[b]===a){this._progressCallbacks.splice(b,1);break}};b.prototype._progressCallback=function(a){if(this.total)a.total=this.total;for(var b=0;b<this._progressCallbacks.length;b++)this._progressCallbacks[b](a)};b.prototype.loadImage=function(a){var c=new e.Promise,d=new Image;d.addEventListener("load",function(){d.dataReady=!0;window.URL.revokeObjectURL(d.src);c.resolve(d)},!1);d.addEventListener("error",
function(){c.reject("Loader.loadImage(): Couldn't load from ["+a+"]")},!1);this.load(a,function(b){var b=new Uint8Array(b,0,b.byteLength),c="image/jpeg";/\.png$/.test(a)&&(c="image/png");b=new Blob([b],{type:c});d.src=window.URL.createObjectURL(b)},b.ARRAY_BUFFER);return c};b.prototype._buildURL=function(a){return this.rootPath+window.escape(a)};b.ARRAY_BUFFER="arraybuffer";return b});
define("goo/renderer/Texture",["goo/math/Vector2"],function(e){function c(b,a,c,d){this.glTexture=null;a=a||{};this.wrapS=a.wrapS||"Repeat";this.wrapT=a.wrapT||"Repeat";this.magFilter=a.magFilter||"Bilinear";this.minFilter=a.minFilter||"Trilinear";this.anisotropy=a.anisotropy!==void 0?a.anisotropy:1;this.format=a.format||"RGBA";this.type=a.type||"UnsignedByte";this.variant="2D";this.offset=new e(0,0);this.repeat=new e(1,1);this.generateMipmaps=a.generateMipmaps!==void 0?a.generateMipmaps:!0;this.premultiplyAlpha=
a.premultiplyAlpha!==void 0?a.premultiplyAlpha:!1;this.flipY=a.flipY!==void 0?a.flipY:!0;this.needsUpdate=this.hasBorder=!1;this.readyCallback=this.updateCallback=null;b&&this.setImage(b,a,c,d)}c.prototype.checkDataReady=function(){return this.image&&(this.image.dataReady||this.image instanceof HTMLImageElement)||this.readyCallback!==null&&this.readyCallback()};c.prototype.checkNeedsUpdate=function(){return this.needsUpdate||this.updateCallback!==null&&this.updateCallback()};c.prototype.setNeedsUpdate=
function(){this.needsUpdate=!0};c.prototype.setImage=function(b,a,c,d){this.image=b;var g=b instanceof Array?b[0]:b;if(g instanceof Uint8Array||g instanceof Uint8ClampedArray||g instanceof Uint16Array)if(c=c||b.width,d=d||b.height,c!==void 0&&d!==void 0)if(this.image={data:b},this.image.width=c,this.image.height=d,this.image.isData=!0,this.image.dataReady=!0,g instanceof Uint8Array||g instanceof Uint8ClampedArray)a.type="UnsignedByte";else{if(g instanceof Uint16Array)a.type="UnsignedShort4444"}else throw"Data textures need width and height";
else if(b instanceof Array)this.image={data:b}};c.CUBE_FACES="PositiveX,NegativeX,PositiveY,NegativeY,PositiveZ,NegativeZ".split(",");return c});
define("goo/loaders/dds/DdsUtils",[],function(){function e(){}e.getDdsExtension=function(c){for(var b=["","WEBKIT_","MOZ_"],a=0;a<b.length;a++){var f=c.getExtension(b[a]+"WEBGL_compressed_texture_s3tc");if(typeof f!=="undefined"&&f!==null)return f}return null};e.isSupported=function(c){return e.getDdsExtension(c)!==null};e.shiftCount=function(c){if(c===0)return 0;for(var b=0;(c&1)===0;)if(c>>=1,b++,b>32)throw"invalid mask!";return b};e.isSet=function(c,b){return(c&b)===b};e.getIntFromString=function(c){for(var b=
[],a=0;a<c.length;a++)b[a]=c.charCodeAt(a);return e.getIntFromBytes(b)};e.getIntFromBytes=function(c){var b=0;b|=(c[0]&255)<<0;c.length>1&&(b|=(c[1]&255)<<8);c.length>2&&(b|=(c[2]&255)<<16);c.length>3&&(b|=(c[3]&255)<<24);return b};e.getComponents=function(c){switch(c){case "Alpha":return 1;case "RGB":return 3;case "RGBA":return 4;case "Luminance":return 1;case "LuminanceAlpha":return 2;case "PrecompressedDXT1":return 1;case "PrecompressedDXT1A":return 1;case "PrecompressedDXT3":return 2;case "PrecompressedDXT5":return 2}return 0};
e.flipDXT=function(c,b,a,f){for(var d=new Uint8Array(c.length),b=b+3>>2,a=a+3>>2,g=e.getComponents(f)*8,j=0;j<a;j++)for(var k=a-j-1,i=0;i<b;i++){var h=(k*b+i)*g,l=(j*b+i)*g;switch(f){case "PrecompressedDXT1":case "PrecompressedDXT1A":d[h+0]=c[l+0];d[h+1]=c[l+1];d[h+2]=c[l+2];d[h+3]=c[l+3];d[h+4]=c[l+7];d[h+5]=c[l+6];d[h+6]=c[l+5];d[h+7]=c[l+4];break;case "PrecompressedDXT3":d[h+0]=c[l+6];d[h+1]=c[l+7];d[h+2]=c[l+4];d[h+3]=c[l+5];d[h+4]=c[l+2];d[h+5]=c[l+3];d[h+6]=c[l+0];d[h+7]=c[l+1];d[h+8]=c[l+8];
d[h+9]=c[l+9];d[h+10]=c[l+10];d[h+11]=c[l+11];d[h+12]=c[l+15];d[h+13]=c[l+14];d[h+14]=c[l+13];d[h+15]=c[l+12];break;case "PrecompressedDXT5":d[h+0]=c[l+0],d[h+1]=c[l+1],e.getBytesFromUInt24(d,h+5,e.flipUInt24(e.getUInt24(c,l+2))),e.getBytesFromUInt24(d,h+2,e.flipUInt24(e.getUInt24(c,l+5))),d[h+8]=c[l+8],d[h+9]=c[l+9],d[h+10]=c[l+10],d[h+11]=c[l+11],d[h+12]=c[l+15],d[h+13]=c[l+14],d[h+14]=c[l+13],d[h+15]=c[l+12]}}return d};e.getUInt24=function(c,b){var a=0;a|=(c[b+0]&255)<<0;a|=(c[b+1]&255)<<8;a|=
(c[b+2]&255)<<16;return a};e.getBytesFromUInt24=function(c,b,a){c[b+0]=a&255;c[b+1]=(a&65280)>>8;c[b+2]=(a&16711680)>>16};e.ThreeBitMask=7;e.flipUInt24=function(c){for(var b=[],a=0;a<2;a++)b.push([0,0,0,0]);b[0][0]=c&e.ThreeBitMask;c>>=3;b[0][1]=c&e.ThreeBitMask;c>>=3;b[0][2]=c&e.ThreeBitMask;c>>=3;b[0][3]=c&e.ThreeBitMask;c>>=3;b[1][0]=c&e.ThreeBitMask;c>>=3;b[1][1]=c&e.ThreeBitMask;c>>=3;b[1][2]=c&e.ThreeBitMask;c>>=3;b[1][3]=c&e.ThreeBitMask;c=0;c|=b[1][0]<<0;c|=b[1][1]<<3;c|=b[1][2]<<6;c|=b[1][3]<<
9;c|=b[0][0]<<12;c|=b[0][1]<<15;c|=b[0][2]<<18;c|=b[0][3]<<21;return c};return e});
define("goo/loaders/dds/DdsLoader",["goo/loaders/dds/DdsUtils"],function(e){function c(){this.dwABitMask=this.dwBBitMask=this.dwGBitMask=this.dwRBitMask=this.dwRGBBitCount=this.dwFourCC=this.dwFlags=this.dwSize=0}function b(){this.dwAlphaBitDepth=this.dwMipMapCount=this.dwDepth=this.dwLinearSize=this.dwWidth=this.dwHeight=this.dwFlags=this.dwSize=0;this.dwReserved1=[];this.ddpf=null;this.dwTextureStage=this.dwCaps4=this.dwCaps3=this.dwCaps2=this.dwCaps=0}function a(){this.flipVertically=!1;this.bpp=
0;this.headerDX10=this.header=null;this.mipmapByteSizes=[]}function f(){}c.HEADER_OFFSET=19;c.DDPF_ALPHAPIXELS=1;c.DDPF_ALPHA=2;c.DDPF_FOURCC=4;c.DDPF_RGB=64;c.DDPF_YUV=512;c.DDPF_LUMINANCE=131072;c.read=function(a){var b=new c;b.dwSize=a[c.HEADER_OFFSET+0];if(b.dwSize!==32)throw"invalid pixel format size: "+b.dwSize;b.dwFlags=a[c.HEADER_OFFSET+1];b.dwFourCC=a[c.HEADER_OFFSET+2];b.dwRGBBitCount=a[c.HEADER_OFFSET+3];b.dwRBitMask=a[c.HEADER_OFFSET+4];b.dwGBitMask=a[c.HEADER_OFFSET+5];b.dwBBitMask=a[c.HEADER_OFFSET+
6];b.dwABitMask=a[c.HEADER_OFFSET+7];return b};b.DDSD_CAPS=1;b.DDSD_HEIGHT=2;b.DDSD_WIDTH=4;b.DDSD_PITCH=8;b.DDSD_PIXELFORMAT=4096;b.DDSD_MIPMAPCOUNT=131072;b.DDSD_LINEARSIZE=524288;b.DDSD_DEPTH=8388608;b.DDSCAPS_COMPLEX=8;b.DDSCAPS_MIPMAP=4194304;b.DDSCAPS_TEXTURE=4096;b.DDSCAPS2_CUBEMAP=512;b.DDSCAPS2_CUBEMAP_POSITIVEX=1024;b.DDSCAPS2_CUBEMAP_NEGATIVEX=2048;b.DDSCAPS2_CUBEMAP_POSITIVEY=4096;b.DDSCAPS2_CUBEMAP_NEGATIVEY=8192;b.DDSCAPS2_CUBEMAP_POSITIVEZ=16384;b.DDSCAPS2_CUBEMAP_NEGATIVEZ=32768;b.DDSCAPS2_VOLUME=
2097152;b.read=function(a){var f=new b;f.dwSize=a[1];if(f.dwSize!==124)throw"invalid dds header size: "+f.dwSize;f.dwFlags=a[2];f.dwHeight=a[3];f.dwWidth=a[4];f.dwLinearSize=a[5];f.dwDepth=a[6];f.dwMipMapCount=a[7];f.dwAlphaBitDepth=a[8];for(var j=0;j<f.dwReserved1.length;j++)f.dwReserved1[j]=a[9+j];f.ddpf=c.read(a);f.dwCaps=a[27];f.dwCaps2=a[28];f.dwCaps3=a[29];f.dwCaps4=a[30];f.dwTextureStage=a[31];a=1+Math.ceil(Math.log(Math.max(f.dwHeight,f.dwWidth))/Math.log(2));e.isSet(f.dwCaps,b.DDSCAPS_MIPMAP)?
e.isSet(f.dwFlags,b.DDSD_MIPMAPCOUNT)?f.dwMipMapCount!==a&&console.warn("Got "+f.dwMipMapCount+" mipmaps, expected "+a):f.dwMipMapCount=a:f.dwMipMapCount=1;return f};a.prototype.calcMipmapSizes=function(a){for(var b=this.header.dwWidth,c=this.header.dwHeight,f=0,e=0;e<this.header.dwMipMapCount;e++)f=a?~~((b+3)/4)*~~((c+3)/4)*this.bpp*2:~~(b*c*this.bpp/8),this.mipmapByteSizes.push(~~((f+3)/4)*4),b=~~(b/2)>1?~~(b/2):1,c=~~(c/2)>1?~~(c/2):1};f.updateDepth=function(a,c){if(e.isSet(c.header.dwCaps2,b.DDSCAPS2_CUBEMAP)){var f=
0;e.isSet(c.header.dwCaps2,b.DDSCAPS2_CUBEMAP_POSITIVEX)&&f++;e.isSet(c.header.dwCaps2,b.DDSCAPS2_CUBEMAP_NEGATIVEX)&&f++;e.isSet(c.header.dwCaps2,b.DDSCAPS2_CUBEMAP_POSITIVEY)&&f++;e.isSet(c.header.dwCaps2,b.DDSCAPS2_CUBEMAP_NEGATIVEY)&&f++;e.isSet(c.header.dwCaps2,b.DDSCAPS2_CUBEMAP_POSITIVEZ)&&f++;e.isSet(c.header.dwCaps2,b.DDSCAPS2_CUBEMAP_NEGATIVEZ)&&f++;if(f!==6)throw Error("Cubemaps without all faces defined are not currently supported.");a.depth=f}else a.depth=c.header.dwDepth>0?c.header.dwDepth:
1};f.readDXT=function(a,b,c,f){f.image.isCompressed=!0;if(!c.flipVertically)return new Uint8Array(a.buffer,a.byteOffset+0,b);for(var i=c.header.dwWidth,h=c.header.dwHeight,b=new Uint8Array(b),l=0,n=0;n<c.header.dwMipMapCount;n++){for(var o=[],p=0,m=c.mipmapByteSizes[n];p<m;p++)o.push(a[p+l]);o=e.flipDXT(o,i,h,f.format);b.set(o,l);l+=o.length;i=~~(i/2)>1?~~(i/2):1;h=~~(h/2)>1?~~(h/2):1}return b};f.readUncompressed=function(a,b,c,f,i,h,l,n){for(var o=e.shiftCount(l.header.ddpf.dwRBitMask),p=e.shiftCount(l.header.ddpf.dwGBitMask),
m=e.shiftCount(l.header.ddpf.dwBBitMask),s=e.shiftCount(l.header.ddpf.dwABitMask),q=~~(l.header.ddpf.dwRGBBitCount/8),n=e.getComponents(n.format)*1,b=new Uint8Array(b),t=l.header.dwWidth,u=l.header.dwHeight,v=0,r=0,w=0,y=[],w=0;w<q;w++)y.push(0);for(var x=0;x<l.header.dwMipMapCount;x++){for(var A=0;A<u;A++)for(var z=0;z<t;z++){for(w=0;w<q;w++)y[w]=a[r++];var w=e.getIntFromBytes(y),D=(w&l.header.ddpf.dwRBitMask)>>o,E=(w&l.header.ddpf.dwGBitMask)>>p,C=(w&l.header.ddpf.dwBBitMask)>>m,w=(w&l.header.ddpf.dwABitMask)>>
s;i?b[v++]=w:f?(b[v++]=D,h&&(b[v++]=w)):c&&(b[v++]=D,b[v++]=E,b[v++]=C,h&&(b[v++]=w))}v+=t*u*n;t=~~(t/2)>1?~~(t/2):1;u=~~(u/2)>1?~~(u/2):1}return b};f.populate=function(a,b,j){var k=b.header.ddpf.dwFlags,i=e.isSet(k,c.DDPF_FOURCC),h=e.isSet(k,c.DDPF_RGB),l=e.isSet(k,c.DDPF_ALPHAPIXELS),n=e.isSet(k,c.DDPF_LUMINANCE),k=e.isSet(k,c.DDPF_ALPHA);a.type="UnsignedByte";if(i){var o=b.header.ddpf.dwFourCC;if(o===e.getIntFromString("DXT1"))b.bpp=4,a.format="PrecompressedDXT1A";else if(o===e.getIntFromString("DXT3"))b.bpp=
8,a.format="PrecompressedDXT3";else if(o===e.getIntFromString("DXT5"))b.bpp=8,a.format="PrecompressedDXT5";else if(o===e.getIntFromString("DX10"))throw Error("dxt10 LATC formats not supported currently: "+b.headerDX10.dxgiFormat);else if(o===e.getIntFromString("DXT2"))throw"DXT2 is not supported.";else if(o===e.getIntFromString("DXT4"))throw"DXT4 is not supported.";else throw"unsupported compressed dds format found ("+o+")";}else if(b.bpp=b.header.ddpf.dwRGBBitCount,h)a.format=l?"RGBA":"RGB";else if(n||
l)if(n&&l)a.format="LuminanceAlpha";else if(n)a.format="Luminance";else{if(k)a.format="Alpha"}else throw Error("unsupported uncompressed dds format found.");b.calcMipmapSizes(i);a.image.mipmapSizes=b.mipmapByteSizes;for(var p=o=0;p<b.mipmapByteSizes.length;p++)o+=b.mipmapByteSizes[p];for(var m=[],p=0;p<a.image.depth;p++)i?m.push(f.readDXT(j,o,b,a)):(h||n||k)&&m.push(f.readUncompressed(j,o,h,n,k,l,b,a));a.image.data=a.image.depth===1?m[0]:m;a.image.useArrays=!0};f.prototype.load=function(c,g,j,k,i){var h=
new Int32Array(c,k+0,32);if(h[0]!==e.getIntFromString("DDS "))throw"Not a dds file.";var l=new a;l.flipVertically=j;l.header=b.read(h);l.headerDX10=l.header.ddpf.dwFourCC===e.getIntFromString("DX10")?b.read(Int32Array.create(c,k+128,5)):null;j=g.image;if(typeof j==="undefined"||j===null)j={},g.image=j;j.width=l.header.dwWidth;j.height=l.header.dwHeight;f.updateDepth(j,l);h=128+(l.headerDX10?20:0);f.populate(g,l,new Uint8Array(c,k+h,i-h));if(!l.mipmapByteSizes||l.mipmapByteSizes.length<2)g.minFilter=
"BilinearNoMipMaps";j.bpp=l.bpp;j.dataReady=!0;g.needsUpdate=!0};f.SUPPORTS_DDS=!1;f.prototype.isSupported=function(){return f.SUPPORTS_DDS};f.prototype.toString=function(){return"DdsLoader"};return f});
define("goo/loaders/tga/TgaLoader",[],function(){function e(){this.header=null;this.offset=0;this.use_grey=this.use_rgb=this.use_pal=this.use_rle=!1}e.TYPE_NO_DATA=0;e.TYPE_INDEXED=1;e.TYPE_RGB=2;e.TYPE_GREY=3;e.TYPE_RLE_INDEXED=9;e.TYPE_RLE_RGB=10;e.TYPE_RLE_GREY=11;e.ORIGIN_MASK=48;e.ORIGIN_SHIFT=4;e.ORIGIN_BL=0;e.ORIGIN_BR=1;e.ORIGIN_UL=2;e.ORIGIN_UR=3;e.prototype.load=function(c,b){this.loadData(new Uint8Array(c));var a=this.getImageData();b.setImage(a,null,a.width,a.height);a.dataReady=!0;b.needsUpdate=
!0};e.prototype.loadData=function(c){if(c.length<19)throw Error("Targa::load() - Not enough data to contain header.");this.offset=0;this.header={id_length:c[this.offset++],colormap_type:c[this.offset++],image_type:c[this.offset++],colormap_index:c[this.offset++]|c[this.offset++]<<8,colormap_length:c[this.offset++]|c[this.offset++]<<8,colormap_size:c[this.offset++],origin:[c[this.offset++]|c[this.offset++]<<8,c[this.offset++]|c[this.offset++]<<8],width:c[this.offset++]|c[this.offset++]<<8,height:c[this.offset++]|
c[this.offset++]<<8,pixel_size:c[this.offset++],flags:c[this.offset++]};this.checkHeader();if(this.header.id_length+this.offset>c.length)throw Error("Targa::load() - No data ?");this.offset+=this.header.id_length;switch(this.header.image_type){case e.TYPE_RLE_INDEXED:this.use_rle=!0;break;case e.TYPE_INDEXED:this.use_pal=!0;break;case e.TYPE_RLE_RGB:this.use_rle=!0;break;case e.TYPE_RGB:this.use_rgb=!0;break;case e.TYPE_RLE_GREY:this.use_rle=!0;break;case e.TYPE_GREY:this.use_grey=!0}this.parse(c)};
e.prototype.checkHeader=function(){switch(this.header.image_type){case e.TYPE_INDEXED:case e.TYPE_RLE_INDEXED:if(this.header.colormap_length>256||this.header.colormap_size!==24||this.header.colormap_type!==1)throw Error("Targa::checkHeader() - Invalid type colormap data for indexed type");break;case e.TYPE_RGB:case e.TYPE_GREY:case e.TYPE_RLE_RGB:case e.TYPE_RLE_GREY:if(this.header.colormap_type)throw Error("Targa::checkHeader() - Invalid type colormap data for colormap type");break;case e.TYPE_NO_DATA:throw Error("Targa::checkHeader() - No data on this TGA file");
default:throw Error("Targa::checkHeader() - Invalid type '"+this.header.image_type+"'");}if(this.header.width<=0||this.header.height<=0)throw Error("Targa::checkHeader() - Invalid image size");if(this.header.pixel_size!==8&&this.header.pixel_size!==16&&this.header.pixel_size!==24&&this.header.pixel_size!==32)throw Error("Targa::checkHeader() - Invalid pixel size '"+this.header.pixel_size+"'");};e.prototype.parse=function(c){var h;var b,a,f;b=this.header;a=b.pixel_size>>3;f=b.width*b.height*a;if(this.use_pal)this.palettes=
c.subarray(this.offset,this.offset+=b.colormap_length*a);if(this.use_rle){b=new Uint8Array(f);for(var d,g,e=0,k=new Uint8Array(a);e<f;)if(d=c[this.offset++],g=(d&127)+1,d&128){for(d=0;d<a;++d)k[d]=c[this.offset++];for(d=0;d<g;++d)b.set(k,e+d*a);e+=a*g}else{g*=a;for(d=0;d<g;++d)b[e+d]=c[this.offset++];e+=g}}else h=c.subarray(this.offset,this.offset+=this.use_pal?b.width*b.height:f),b=h;this.image=b};e.prototype.getImageData=function(c){var b=this.header.width,a=this.header.height,f,d,g,j;j=c||document&&
document.createElement("canvas").getContext("2d").createImageData(b,a)||{width:b,height:a,data:new Uint8Array(b*a*4)};switch((this.header.flags&e.ORIGIN_MASK)>>e.ORIGIN_SHIFT){default:case e.ORIGIN_UL:c=0;f=1;g=b;b=0;d=1;break;case e.ORIGIN_BL:c=0;f=1;g=b;b=a-1;a=d=-1;break;case e.ORIGIN_UR:c=b-1;g=f=-1;b=0;d=1;break;case e.ORIGIN_BR:c=b-1,g=f=-1,b=a-1,a=d=-1}this["getImageData"+(this.use_grey?"Grey":"")+this.header.pixel_size+"bits"](j.data,b,d,a,c,f,g);return j};e.prototype.getCanvas=function(){var c=
document.createElement("canvas"),b=c.getContext("2d"),a=b.createImageData(this.header.width,this.header.height);c.width=this.header.width;c.height=this.header.height;b.putImageData(this.getImageData(a),0,0);return c};e.prototype.getDataURL=function(c){return this.getCanvas().toDataURL(c||"image/png")};e.prototype.getImageData8bits=function(c,b,a,f,d,g,e){var k=this.image,i=this.palettes,h=this.header.width,l=0,n,o;for(o=b;o!==f;o+=a)for(n=d;n!==e;n+=g,l++)b=k[l],c[(n+h*o)*4+3]=255,c[(n+h*o)*4+2]=
i[b*3+0],c[(n+h*o)*4+1]=i[b*3+1],c[(n+h*o)*4+0]=i[b*3+2];return c};e.prototype.getImageData16bits=function(c,b,a,f,d,g,e){var k=this.image,i=this.header.width,h=0,l,n;for(n=b;n!==f;n+=a)for(l=d;l!==e;l+=g,h+=2)b=k[h+0]+(k[h+1]<<8),c[(l+i*n)*4+0]=(b&31744)>>7,c[(l+i*n)*4+1]=(b&992)>>2,c[(l+i*n)*4+2]=(b&31)>>3,c[(l+i*n)*4+3]=b&32768?0:255;return c};e.prototype.getImageData24bits=function(c,b,a,f,d,g,e){var k=this.image,i=this.header.width,h=0,l;for(l=b;l!==f;l+=a)for(b=d;b!==e;b+=g,h+=3)c[(b+i*l)*4+
3]=255,c[(b+i*l)*4+2]=k[h+0],c[(b+i*l)*4+1]=k[h+1],c[(b+i*l)*4+0]=k[h+2];return c};e.prototype.getImageData32bits=function(c,b,a,f,d,g,e){var k=this.image,i=this.header.width,h=0,l;for(l=b;l!==f;l+=a)for(b=d;b!==e;b+=g,h+=4)c[(b+i*l)*4+2]=k[h+0],c[(b+i*l)*4+1]=k[h+1],c[(b+i*l)*4+0]=k[h+2],c[(b+i*l)*4+3]=k[h+3];return c};e.prototype.getImageDataGrey8bits=function(c,b,a,f,d,g,e){var k=this.image,i=this.header.width,h=0,l,n;for(n=b;n!==f;n+=a)for(l=d;l!==e;l+=g,h++)b=k[h],c[(l+i*n)*4+0]=b,c[(l+i*n)*
4+1]=b,c[(l+i*n)*4+2]=b,c[(l+i*n)*4+3]=255;return c};e.prototype.getImageDataGrey16bits=function(c,b,a,f,d,g,e){var k=this.image,i=this.header.width,h=0,l;for(l=b;l!==f;l+=a)for(b=d;b!==e;b+=g,h+=2)c[(b+i*l)*4+0]=k[h+0],c[(b+i*l)*4+1]=k[h+0],c[(b+i*l)*4+2]=k[h+0],c[(b+i*l)*4+3]=k[h+1];return c};e.prototype.isSupported=function(){return!0};e.prototype.toString=function(){return"TgaLoader"};return e});
define("goo/util/SimpleResourceUtil",[],function(){function e(){}e.countdown=function(c,b,a){c[0]--;if(c[0]===0)b.onSuccess(a)};e.loadTextAsset=function(c,b,a,f,d,g){var j=new XMLHttpRequest;j.open("GET",a[b],!0);j.onreadystatechange=function(){if(j.readyState===4)if(j.status>=200&&j.status<=299)d[f[b]]=j.responseText,e.countdown(c,g,d);else g.onError(j.statusText)};j.send()};e.loadTextAssets=function(c,b,a){for(var f=[c.length],d={},g=0,j=c.length;g<j;g++)e.loadTextAsset(f,g,c,b,d,a)};e.loadBinaryAsArrayBuffer=
function(c,b){var a=new XMLHttpRequest;a.open("GET",c);a.responseType="arraybuffer";a.onload=function(){if(a.status!==404)b.onSuccess(a.response);else a.onerror(null)};a.onerror=function(){b.onError(null)};a.send()};return e});
define("goo/util/Latch",[],function(){function e(c,b){this.count=c;this.callback=b}e.prototype.countDown=function(){this.count--;this.isDone()&&this.callback&&this.callback.done?this.callback.done():this.callback&&this.callback.progress&&this.callback.progress(this.count)};e.prototype.isDone=function(){return this.count===0};return e});
define("goo/renderer/TextureCreator","goo/loaders/Loader,goo/renderer/Texture,goo/loaders/dds/DdsLoader,goo/loaders/tga/TgaLoader,goo/util/SimpleResourceUtil,goo/renderer/Util,goo/util/Latch".split(","),function(e,c,b,a,f,d,g){function j(c){c=c||{};this.verticalFlip=c.verticalFlip!==void 0?c.verticalFlip:!0;this._loader=c.loader!==void 0?c.loader:new e;this.textureLoaders={".dds":new b,".tga":new a}}function k(a,b){return a.indexOf(b,a.length-b.length)!==-1}j.cache={};j.UNSUPPORTED_FALLBACK=".png";
j.clearCache=function(){j.cache={}};j.prototype.loadTexture2D=function(a,b,f){if(j.cache[a]!==void 0)return f&&f(),j.cache[a];var g=function(a){s.load(a,q,p.verticalFlip,0,a.byteLength);j._finishedLoading();f&&f()}.bind(this),o=function(b){console.warn("Error loading texture: "+a+" | "+b)}.bind(this),p=this,m;for(m in this.textureLoaders)if(k(a.toLowerCase(),m)){var s=this.textureLoaders[m];if(!s||!s.isSupported()){a=a.substring(0,a.length-m.length);a+=j.UNSUPPORTED_FALLBACK;b=b||{};b.flipY=!1;break}var q=
new c(d.clone(j.DEFAULT_TEXTURE_2D.image),b);q.image.dataReady=!1;q.a=a;j.cache[a]=q;this._loader.load(a,null,e.ARRAY_BUFFER).then(g,o);return q}if(j.cache[a]!==void 0)return f&&f(),j.cache[a];var t=new c(null,b);j.cache[a]=t;this._loader.loadImage(a).then(function(a){t.setImage(a);j._finishedLoading(a);f&&f()}).then(null,function(a){console.error(a)});return t};j.prototype.loadTextureVideo=function(a,b){if(j.cache[a]!==void 0)return j.cache[a];var f=document.createElement("video");f.loop=typeof b===
"boolean"?b:!0;f.addEventListener("error",function(){console.warn("Couldn't load video URL ["+a+"]")},!1);var g=new c(f,{wrapS:"EdgeClamp",wrapT:"EdgeClamp"});g.readyCallback=function(){if(f.readyState>=3){console.log("Video ready: "+f.videoWidth+", "+f.videoHeight);f.width=f.videoWidth;f.height=f.videoHeight;if(d.isPowerOfTwo(f.width)===!1||d.isPowerOfTwo(f.height)===!1)g.generateMipmaps=!1,g.minFilter="BilinearNoMipMaps";f.play();return f.dataReady=!0}return!1};g.updateCallback=function(){return!f.paused};
f.crossOrigin="anonymous";f.src=a;return j.cache[a]=g};j.prototype.loadTextureWebCam=function(){var a=document.createElement("video");a.autoplay=!0;a.loop=!0;var b=new c(a,{wrapS:"EdgeClamp",wrapT:"EdgeClamp"});b.readyCallback=function(){if(a.readyState>=3){console.log("WebCam video ready: "+a.videoWidth+", "+a.videoHeight);a.width=a.videoWidth;a.height=a.videoHeight;if(d.isPowerOfTwo(a.width)===!1||d.isPowerOfTwo(a.height)===!1)b.generateMipmaps=!1,b.minFilter="BilinearNoMipMaps";return a.dataReady=
!0}return!1};b.updateCallback=function(){return!a.paused};window.URL=window.URL||window.webkitURL;navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;navigator.getUserMedia?navigator.getUserMedia({video:!0},function(b){a.src=window.URL.createObjectURL(b)},function(a){console.warn("Unable to capture WebCam. Please reload the page.",a)}):console.warn("No support for WebCam getUserMedia found!");return b};j.prototype.loadTextureCube=
function(a,b){var d=new c(null,b);d.variant="CUBE";for(var f=[],e=new g(6,{done:function(){for(var a=f[0].width,b=f[0].height,c=0;c<6;c++){var g=f[c];if(a!==g.width||b!==g.height)d.generateMipmaps=!1,d.minFilter="BilinearNoMipMaps",console.error("Images not all the same size!")}d.setImage(f);d.image.dataReady=!0;d.image.width=a;d.image.height=b}}),k=this,j=0;j<a.length;j++)(function(b){var c=a[b];typeof c==="string"?k._loader.loadImage(c).then(function(a){f[b]=a;e.countDown()}):(f[b]=c,e.countDown())})(j);
return d};j._globalCallback=null;j._finishedLoading=function(a){if(j._globalCallback)try{j._globalCallback(a)}catch(b){console.error("Error in texture callback:",b)}};f=new Uint8Array([255,255,255,255]);j.DEFAULT_TEXTURE_2D=new c(f,null,1,1);j.DEFAULT_TEXTURE_CUBE=new c([f,f,f,f,f,f],null,1,1);j.DEFAULT_TEXTURE_CUBE.variant="CUBE";return j});
define("goo/addons/terrain/Terrain","goo/entities/components/MeshDataComponent,goo/entities/components/MeshRendererComponent,goo/renderer/MeshData,goo/renderer/Material,goo/renderer/Shader,goo/renderer/TextureCreator".split(","),function(e,c,b,a,f,d){function g(b){var c=a.createMaterial(j),f=(new d).loadTexture2D("../resources/head_diffuse.jpg");c.setTexture("DIFFUSE_MAP",f);var g=a.createMaterial(j);g.setTexture("HEIGHT_MAP",f);g.wireframe=!0;this.material=c;this.material2=g;c=b.createEntity();c.addToWorld();
for(f=0;f<6;f++)g=this.createClipmapLevel(b,f,f===0),c.transformComponent.attachChild(g.transformComponent)}g.prototype.createClipmapLevel=function(a,b,c){var d=a.createEntity(),f=Math.pow(2,b);d.transformComponent.transform.scale.set(f,f,1);f=(2*Math.pow(-1,b+1)+Math.pow(2,b+1))/6;b=b%2===0?f:-f;d.transformComponent.transform.translation.set(b,-b,0);d.addToWorld();this.createQuadEntity(a,d,0,0,3,3);this.createQuadEntity(a,d,3,0,3,3);this.createQuadEntity(a,d,6,0,2,3);this.createQuadEntity(a,d,8,
0,3,3);this.createQuadEntity(a,d,11,0,3,3);this.createQuadEntity(a,d,0,3,3,3);this.createQuadEntity(a,d,11,3,3,3);this.createQuadEntity(a,d,0,6,3,2);this.createQuadEntity(a,d,11,6,3,2);this.createQuadEntity(a,d,0,8,3,3);this.createQuadEntity(a,d,11,8,3,3);this.createQuadEntity(a,d,0,11,3,3);this.createQuadEntity(a,d,3,11,3,3);this.createQuadEntity(a,d,6,11,2,3);this.createQuadEntity(a,d,8,11,3,3);this.createQuadEntity(a,d,11,11,3,3);c&&this.createQuadEntity(a,d,3,4,7,7);return d};g.prototype.createQuadEntity=
function(a,b,d,f,g,j){d=this.createGrid(d,f,g,j);a=a.createEntity();b.transformComponent.attachChild(a.transformComponent);b=new e(d);a.setComponent(b);b=new c;b.materials.push(this.material2);a.setComponent(b);a.addToWorld();return a};g.prototype.createGrid=function(a,c,d,f){for(var g=b.defaultMap([b.POSITION,b.TEXCOORD0]),g=new b(g,(d+1)*(f+1),d*f*6),e=g.getAttributeBuffer(b.POSITION),j=g.getAttributeBuffer(b.TEXCOORD0),m=g.getIndexBuffer(),s=0;s<d+1;s++)for(var q=0;q<f+1;q++){var t=q*(d+1)+s;e[t*
3+0]=s+a-7;e[t*3+1]=q+c-7;e[t*3+2]=0;j[t*2+0]=(s+a)/15;j[t*2+1]=(q+c)/15}for(s=0;s<d;s++)for(q=0;q<f;q++)t=q*(d+1)+s,a=q*d+s,m[a*6+0]=t,m[a*6+1]=t+1,m[a*6+2]=t+d+1,m[a*6+3]=t+1,m[a*6+4]=t+d+1+1,m[a*6+5]=t+d+1;return g};var j={attributes:{vertexPosition:b.POSITION,vertexUV0:b.TEXCOORD0},uniforms:{viewMatrix:f.VIEW_MATRIX,projectionMatrix:f.PROJECTION_MATRIX,worldMatrix:f.WORLD_MATRIX,diffuseMap:"DIFFUSE_MAP",time:f.TIME},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nuniform float time;\nuniform sampler2D diffuseMap;\nvarying vec4 texCol;\nvoid main(void) {\n\ttexCol = texture2D(diffuseMap, vertexUV0 + vec2(time*0.0));\n\tfloat height = length(texCol.rgb);\n\tgl_Position = projectionMatrix * viewMatrix * worldMatrix * \n\t\tvec4(vertexPosition.x,vertexPosition.y,height*5.0, 1.0);\n}",
fshader:"precision mediump float;\nvarying vec4 texCol;\nvoid main(void)\n{\n\tgl_FragColor = texCol;\n}"};return g});
define("goo/util/Handy",[],function(){function e(){}e.deepFreeze=function(c){var b,a;Object.freeze(c);for(a in c)b=c[a],c.hasOwnProperty(a)&&!(typeof b!=="object"||Object.isFrozen(b))&&e.deepFreeze(b)};e.defineProperty=function(c,b,a,f){var d=a;Object.defineProperty(c,b,{get:function(){return d},set:function(a){d=a;f(d)},configurable:!0,enumerable:!0})};e.addListener=function(c,b,a,f){var d=c[b];Object.defineProperty(c,b,{get:function(){a&&a();return d},set:function(a){d=a;f&&f(d)},configurable:!0,
enumerable:!0})};return e});
define("goo/math/Plane",["goo/math/Vector3"],function(e){function c(b,a){this.normal=b!==void 0?new e(b):new e(e.UNIT_Y);this.constant=isNaN(a)?0:a}c.XZ=new c(e.UNIT_Y,0);c.XY=new c(e.UNIT_Z,0);c.YZ=new c(e.UNIT_X,0);c.prototype.pseudoDistance=function(b){return this.normal.dot(b)-this.constant};c.prototype.setPlanePoints=function(b,a,c){this.normal.set(a).subtractLocal(b);this.normal.crossLocal(c.x-b.x,c.y-b.y,c.z-b.z).normalizeLocal();this.constant=this.normal.dot(b);return this};c.prototype.reflectVector=
function(b,a){var c=a;c===null&&(c=new e);var d=this.normal.dot(b)*2;c.set(b).subtractLocal(this.normal.x*d,this.normal.y*d,this.normal.z*d);return c};return c});
define("goo/math/Ray",["goo/math/Vector3","goo/math/MathUtils"],function(e,c){function b(a,b){this.origin=a||new e;this.direction=b||(new e).copy(e.UNIT_Z)}b.prototype.intersects=function(a,b,c){if(a.length===3)return this.intersectsTriangle(a[0],a[1],a[2],b,c);else if(a.length===4)return this.intersectsTriangle(a[0],a[1],a[2],b,c)||this.intersectsTriangle(a[0],a[2],a[3],b,c);return!1};b.prototype.intersectsTriangle=function(a,b,d,g,j){var k=(new e).set(this.origin).sub(a),b=(new e).set(b).sub(a),
a=(new e).set(d).sub(a),i=(new e).set(b).cross(a),d=this.direction.dot(i),h;if(d>c.EPSILON)h=1;else if(d<-c.EPSILON)h=-1,d=-d;else return!1;var a=h*this.direction.dot(e.cross(k,a,a)),l=!1;if(a>=0&&(b=h*this.direction.dot(b.cross(k)),b>=0&&a+b<=d&&(k=-h*k.dot(i),k>=0))){if(!j)return!0;d=1/d;k*=d;g?j.setd(k,a*d,b*d):j.setv(this.origin).add_d(this.direction.x*k,this.direction.y*k,this.direction.z*k);l=!0}return l};b.prototype.getDistanceToPrimitive=function(a){var b=new e;return this.intersects(a,!1,
b)?this.origin.distance(b.x,b.y,b.z):Infinity};b.prototype.intersectsPlane=function(a,b){var c=a.normal,g=c.dot(this.direction);if(Math.abs(g)<1.0E-5)return!1;c=(-c.dot(this.origin)+a.constant)/g;if(c<1.0E-5)return!1;b!==null&&b.set(this.direction).multiplyLocal(c).addLocal(this.origin);return!0};b.prototype.distanceSquared=function(a,b){var c=new e;c.set(a).subtractLocal(this.origin);var g=this.direction.dot(c);g>0?(c.set(this.direction).multiplyLocal(g),c.addLocal(this.origin)):c.set(this.origin);
b!==null&&b.set(c);a.subtract(c,c);return c.lengthSquared()};return b});
define("goo/renderer/Camera","goo/util/Handy,goo/math/Vector3,goo/math/Vector4,goo/math/Matrix4x4,goo/math/Plane,goo/math/MathUtils,goo/math/Ray,goo/renderer/bounds/BoundingBox,goo/renderer/bounds/BoundingSphere,goo/renderer/bounds/BoundingVolume".split(","),function(e,c,b,a,f,d,g,j,k,i){function h(d,g,k,i){this.translation=new c(0,0,0);this._left=new c(-1,0,0);this._up=new c(0,1,0);this._direction=new c(0,0,-1);e.defineProperty(this,"this._depthRangeNear",0,function(){this._depthRangeDirty=!0});
e.defineProperty(this,"this._depthRangeFar",1,function(){this._depthRangeDirty=!0});this._depthRangeDirty=!0;this._frustumNear=1;this._frustumFar=2;this._frustumLeft=-0.5;this._frustumTop=this._frustumRight=0.5;this._frustumBottom=-0.5;this._coeffLeft=[];this._coeffRight=[];this._coeffBottom=[];this._coeffTop=[];this._viewPortLeft=0;this._viewPortTop=this._viewPortRight=1;this._viewPortBottom=0;this._planeQuantity=6;this._worldPlane=[];for(var j=0;j<h.FRUSTUM_PLANES;j++)this._worldPlane[j]=new f;
this._newDirection=new c;this.projectionMode=h.Perspective;this._updateInverseMVPMatrix=this._updateMVPMatrix=this._updatePMatrix=this._updateInverseMVMatrix=this._updateMVMatrix=!0;this.modelView=new a;this.modelViewInverse=new a;this.projection=new a;this.modelViewProjection=new a;this.modelViewProjectionInverse=new a;this._viewPortDirty=this._depthRangeDirty=!0;this._planeState=0;this._clipPlane=new b;this._qCalc=new b;this._corners=[];for(j=0;j<8;j++)this._corners.push(new c);this._extents=new c;
this.vNearPlaneCenter=new c;this.vFarPlaneCenter=new c;this.direction=new c;this.left=new c;this.up=new c;this.planeNormal=new c;this.setFrustumPerspective(d,g,k,i);this.onFrameChange()}h.LEFT_PLANE=0;h.RIGHT_PLANE=1;h.BOTTOM_PLANE=2;h.TOP_PLANE=3;h.FAR_PLANE=4;h.NEAR_PLANE=5;h.FRUSTUM_PLANES=6;h.Perspective=0;h.Parallel=1;h.Custom=2;h.Outside=0;h.Inside=1;h.Intersects=2;h.prototype.normalize=function(){this._left.normalize();this._up.normalize();this._direction.normalize();this.onFrameChange()};
h.prototype.setFrustumPerspective=function(a,b,c,f){if(a!==void 0&&a!==null)this.fov=a;if(b!==void 0&&b!==null)this.aspect=b;if(c!==void 0&&c!==null)this.near=c;if(f!==void 0&&f!==null)this.far=f;if(this.fov!==void 0)a=Math.tan(this.fov*d.DEG_TO_RAD*0.5)*this.near,b=a*this.aspect,this._frustumLeft=-b,this._frustumRight=b,this._frustumBottom=-a,this._frustumTop=a,this._frustumNear=this.near,this._frustumFar=this.far,this.onFrustumChange()};h.prototype.setFrustum=function(a,b,c,d,f,g){this.near=this._frustumNear=
a;this.far=this._frustumFar=b;this._frustumLeft=c;this._frustumRight=d;this._frustumTop=f;this._frustumBottom=g;this.onFrustumChange()};h.prototype.copy=function(a){this.translation.setv(a.translation);this._left.setv(a._left);this._up.setv(a._up);this._direction.setv(a._direction);this.fov=a.fov;this.aspect=a.aspect;this.near=a.near;this.far=a.far;this._frustumLeft=a._frustumLeft;this._frustumRight=a._frustumRight;this._frustumBottom=a._frustumBottom;this._frustumTop=a._frustumTop;this._frustumNear=
a._frustumNear;this._frustumFar=a._frustumFar;this.projectionMode=a.projectionMode;this._depthRangeDirty=!0;this.onFrustumChange();this.onFrameChange()};h.prototype.setFrame=function(a,b,c,d){this._left.copy(b);this._up.copy(c);this._direction.copy(d);this.translation.copy(a);this.onFrameChange()};h.prototype.lookAt=function(a,b){this._newDirection.copy(a).sub(this.translation).normalize();this._newDirection.equals(this._direction)||(this._direction.copy(this._newDirection),this._up.copy(b).normalize(),
this._up.equals(c.ZERO)&&this._up.copy(c.UNIT_Y),this._left.copy(this._up).cross(this._direction).normalize(),this._left.equals(c.ZERO)&&(this._direction.x!==0?this._left.set(this._direction.y,-this._direction.x,0):this._left.set(0,this._direction.z,-this._direction.y)),this._up.copy(this._direction).cross(this._left).normalize(),this.onFrameChange())};h.prototype.makeDirty=function(){this._viewPortDirty=this._depthRangeDirty=!0};h.prototype.update=function(){this._depthRangeDirty=!0;this.onFrustumChange();
this.onFrameChange()};h.prototype.setViewPort=function(){console.warn("Camera.setViewPort() not implemented.")};h.prototype.contains=function(a){if(!a)return h.Inside;for(var b=h.Inside,c=h.FRUSTUM_PLANES-1;c>=0;c--)switch(a.whichSide(this._worldPlane[c])){case i.Inside:return h.Outside;case i.Intersects:b=h.Intersects}return b};h.prototype.onFrustumChange=function(){if(this.projectionMode===h.Perspective){var a=this._frustumNear*this._frustumNear,b=this._frustumRight*this._frustumRight,c=this._frustumBottom*
this._frustumBottom,d=this._frustumTop*this._frustumTop,f=1/Math.sqrt(a+this._frustumLeft*this._frustumLeft);this._coeffLeft[0]=this._frustumNear*f;this._coeffLeft[1]=-this._frustumLeft*f;f=1/Math.sqrt(a+b);this._coeffRight[0]=-this._frustumNear*f;this._coeffRight[1]=this._frustumRight*f;f=1/Math.sqrt(a+c);this._coeffBottom[0]=this._frustumNear*f;this._coeffBottom[1]=-this._frustumBottom*f;f=1/Math.sqrt(a+d);this._coeffTop[0]=-this._frustumNear*f;this._coeffTop[1]=this._frustumTop*f}else this.projectionMode===
h.Parallel&&(this._frustumRight>this._frustumLeft?(this._coeffLeft[0]=-1,this._coeffLeft[1]=0,this._coeffRight[0]=1):(this._coeffLeft[0]=1,this._coeffLeft[1]=0,this._coeffRight[0]=-1),this._coeffRight[1]=0,this._frustumTop>this._frustumBottom?(this._coeffBottom[0]=-1,this._coeffBottom[1]=0,this._coeffTop[0]=1):(this._coeffBottom[0]=1,this._coeffBottom[1]=0,this._coeffTop[0]=-1),this._coeffTop[1]=0);this._updateInverseMVPMatrix=this._updateInverseMVMatrix=this._updateMVPMatrix=this._updatePMatrix=
!0};h.prototype.onFrameChange=function(){var a=this._direction.dot(this.translation),b=this.planeNormal;b.x=this._left.x*this._coeffLeft[0];b.y=this._left.y*this._coeffLeft[0];b.z=this._left.z*this._coeffLeft[0];b.add([this._direction.x*this._coeffLeft[1],this._direction.y*this._coeffLeft[1],this._direction.z*this._coeffLeft[1]]);this._worldPlane[h.LEFT_PLANE].normal.copy(b);this._worldPlane[h.LEFT_PLANE].constant=this.translation.dot(b);b.x=this._left.x*this._coeffRight[0];b.y=this._left.y*this._coeffRight[0];
b.z=this._left.z*this._coeffRight[0];b.add([this._direction.x*this._coeffRight[1],this._direction.y*this._coeffRight[1],this._direction.z*this._coeffRight[1]]);this._worldPlane[h.RIGHT_PLANE].normal.copy(b);this._worldPlane[h.RIGHT_PLANE].constant=this.translation.dot(b);b.x=this._up.x*this._coeffBottom[0];b.y=this._up.y*this._coeffBottom[0];b.z=this._up.z*this._coeffBottom[0];b.add([this._direction.x*this._coeffBottom[1],this._direction.y*this._coeffBottom[1],this._direction.z*this._coeffBottom[1]]);
this._worldPlane[h.BOTTOM_PLANE].normal.copy(b);this._worldPlane[h.BOTTOM_PLANE].constant=this.translation.dot(b);b.x=this._up.x*this._coeffTop[0];b.y=this._up.y*this._coeffTop[0];b.z=this._up.z*this._coeffTop[0];b.add([this._direction.x*this._coeffTop[1],this._direction.y*this._coeffTop[1],this._direction.z*this._coeffTop[1]]);this._worldPlane[h.TOP_PLANE].normal.copy(b);this._worldPlane[h.TOP_PLANE].constant=this.translation.dot(b);if(this.projectionMode===h.Parallel)this._frustumRight>this._frustumLeft?
(this._worldPlane[h.LEFT_PLANE].constant=this._worldPlane[h.LEFT_PLANE].contant+this._frustumLeft,this._worldPlane[h.RIGHT_PLANE].constant=this._worldPlane[h.RIGHT_PLANE].contant-this._frustumRight):(this._worldPlane[h.LEFT_PLANE].constant=this._worldPlane[h.LEFT_PLANE].contant-this._frustumLeft,this._worldPlane[h.RIGHT_PLANE].constant=this._worldPlane[h.RIGHT_PLANE].contant+this._frustumRight),this._frustumBottom>this._frustumTop?(this._worldPlane[h.TOP_PLANE].constant=this._worldPlane[h.TOP_PLANE].contant+
this._frustumTop,this._worldPlane[h.BOTTOM_PLANE].constant=this._worldPlane[h.BOTTOM_PLANE].contant-this._frustumBottom):(this._worldPlane[h.TOP_PLANE].constant=this._worldPlane[h.TOP_PLANE].contant-this._frustumTop,this._worldPlane[h.BOTTOM_PLANE].constant=this._worldPlane[h.BOTTOM_PLANE].contant+this._frustumBottom);b.copy(this._direction).invert();this._worldPlane[h.FAR_PLANE].normal.copy(b);this._worldPlane[h.FAR_PLANE].constant=-(a+this._frustumFar);this._worldPlane[h.NEAR_PLANE].normal.copy(this._direction);
this._worldPlane[h.NEAR_PLANE].constant=a+this._frustumNear;this._updateInverseMVPMatrix=this._updateInverseMVMatrix=this._updateMVPMatrix=this._updateMVMatrix=!0};h.prototype.updateProjectionMatrix=function(){if(this.projectionMode===h.Parallel){this.projection.setIdentity();var a=this.projection.data;a[0]=2/(this._frustumRight-this._frustumLeft);a[5]=2/(this._frustumTop-this._frustumBottom);a[10]=-2/(this._frustumFar-this._frustumNear);a[12]=-(this._frustumRight+this._frustumLeft)/(this._frustumRight-
this._frustumLeft);a[13]=-(this._frustumTop+this._frustumBottom)/(this._frustumTop-this._frustumBottom);a[14]=-(this._frustumFar+this._frustumNear)/(this._frustumFar-this._frustumNear)}else if(this.projectionMode===h.Perspective)this.projection.setIdentity(),a=this.projection.data,a[0]=2*this._frustumNear/(this._frustumRight-this._frustumLeft),a[5]=2*this._frustumNear/(this._frustumTop-this._frustumBottom),a[8]=(this._frustumRight+this._frustumLeft)/(this._frustumRight-this._frustumLeft),a[9]=(this._frustumTop+
this._frustumBottom)/(this._frustumTop-this._frustumBottom),a[10]=-(this._frustumFar+this._frustumNear)/(this._frustumFar-this._frustumNear),a[11]=-1,a[14]=-(2*this._frustumFar*this._frustumNear)/(this._frustumFar-this._frustumNear),a[15]=0};h.prototype.updateModelViewMatrix=function(){this.modelView.setIdentity();var a=this.modelView.data;a[0]=-this._left.x;a[4]=-this._left.y;a[8]=-this._left.z;a[1]=this._up.x;a[5]=this._up.y;a[9]=this._up.z;a[2]=-this._direction.x;a[6]=-this._direction.y;a[10]=
-this._direction.z;a[12]=this._left.dot(this.translation);a[13]=-this._up.dot(this.translation);a[14]=this._direction.dot(this.translation)};h.prototype.getPickRay=function(a,b,d,f,e){e||(e=new g);var k=new c,i=new c;this.getWorldCoordinates(a,f-b,d,f,0,k);this.getWorldCoordinates(a,f-b,d,f,0.3,i).sub(k).normalize();e.origin.copy(k);e.direction.copy(i);return e};h.prototype.getWorldCoordinates=function(a,d,f,g,e,k){k||(k=new c);this.checkInverseModelViewProjection();var i=new b;i.set((a/f-this._viewPortLeft)/
(this._viewPortRight-this._viewPortLeft)*2-1,(d/g-this._viewPortBottom)/(this._viewPortTop-this._viewPortBottom)*2-1,e*2-1,1);this.modelViewProjectionInverse.applyPost(i);i.mul(1/i.w);k.x=i.x;k.y=i.y;k.z=i.z;return k};h.prototype.getScreenCoordinates=function(a,b,c,d){d=this.getNormalizedDeviceCoordinates(a,d);d.x=(d.x+1)*(this._viewPortRight-this._viewPortLeft)/2*b;d.y=(d.y+1)*(this._viewPortTop-this._viewPortBottom)/2*c;d.z=(d.z+1)/2;return d};h.prototype.getFrustumCoordinates=function(a,b){b=this.getNormalizedDeviceCoordinates(a,
b);b.x=(b.x+1)*(this._frustumRight-this._frustumLeft)/2+this._frustumLeft;b.y=(b.y+1)*(this._frustumTop-this._frustumBottom)/2+this._frustumBottom;b.z=(b.z+1)*(this._frustumFar-this._frustumNear)/2+this._frustumNear;return b};h.prototype.getNormalizedDeviceCoordinates=function(a,d){d||(d=new c);this.checkModelViewProjection();var f=new b;f.set(a.x,a.y,a.z,1);this.modelViewProjection.applyPost(f);f.mul(1/f.w);d.x=f.x;d.y=f.y;d.z=f.z;return d};h.prototype.checkModelView=function(){if(this._updateMVMatrix)this.updateModelViewMatrix(),
this._updateMVMatrix=!1};h.prototype.checkProjection=function(){if(this._updatePMatrix)this.updateProjectionMatrix(),this._updatePMatrix=!1};h.prototype.checkModelViewProjection=function(){if(this._updateMVPMatrix)this.checkModelView(),this.checkProjection(),this.modelViewProjection.copy(this.getProjectionMatrix()).combine(this.getViewMatrix()),this._updateMVPMatrix=!1};h.prototype.checkInverseModelView=function(){if(this._updateInverseMVMatrix)this.checkModelView(),a.invert(this.modelView,this.modelViewInverse),
this._updateInverseMVMatrix=!1};h.prototype.checkInverseModelViewProjection=function(){if(this._updateInverseMVPMatrix)this.checkModelViewProjection(),a.invert(this.modelViewProjection,this.modelViewProjectionInverse),this._updateInverseMVPMatrix=!1};h.prototype.getViewMatrix=function(){this.checkModelView();return this.modelView};h.prototype.getProjectionMatrix=function(){this.checkProjection();return this.projection};h.prototype.getViewProjectionMatrix=function(){this.checkModelViewProjection();
return this.modelViewProjection};h.prototype.getViewInverseMatrix=function(){this.checkInverseModelView();return this.modelViewInverse};h.prototype.getViewProjectionInverseMatrix=function(){this.checkInverseModelViewProjection();return this.modelViewProjectionInverse};h.prototype.pack=function(a){for(var c=a.center,d=this._corners,f=this._extents,g=0;g<d.length;g++)d[g].set(c);a instanceof j?f.setd(a.xExtent,a.yExtent,a.zExtent):a instanceof k&&f.setd(a.radius,a.radius,a.radius);d[0].add_d(f.x,f.y,
f.z);d[1].add_d(f.x,-f.y,f.z);d[2].add_d(f.x,f.y,-f.z);d[3].add_d(f.x,-f.y,-f.z);d[4].add_d(-f.x,f.y,f.z);d[5].add_d(-f.x,-f.y,f.z);d[6].add_d(-f.x,f.y,-f.z);d[7].add_d(-f.x,-f.y,-f.z);for(var f=this.getViewMatrix(),a=Number.MAX_VALUE,c=-Number.MAX_VALUE,e=new b,g=0;g<d.length;g++)e.setd(d[g].x,d[g].y,d[g].z,1),f.applyPre(e),a=Math.min(-e.z,a),c=Math.max(-e.z,c);a=Math.min(Math.max(this._frustumNear,a),this._frustumFar);c=Math.max(a,Math.min(this._frustumFar,c));d=a/this._frustumNear;this._frustumLeft*=
d;this._frustumRight*=d;this._frustumTop*=d;this._frustumBottom*=d;this._frustumNear=a;this._frustumFar=c};h.prototype.calculateFrustumCorners=function(a,b){var a=a!==void 0?a:this._frustumNear,b=b!==void 0?b:this._frustumFar,c=(this._frustumTop-this._frustumBottom)*a*0.5/this._frustumNear,d=(this._frustumRight-this._frustumLeft)*a*0.5/this._frustumNear,f=(this._frustumTop-this._frustumBottom)*b*0.5/this._frustumNear,g=(this._frustumRight-this._frustumLeft)*b*0.5/this._frustumNear;this.projectionMode===
h.Parallel&&(c=(this._frustumTop-this._frustumBottom)*0.5,d=(this._frustumRight-this._frustumLeft)*0.5,f=(this._frustumTop-this._frustumBottom)*0.5,g=(this._frustumRight-this._frustumLeft)*0.5);var e=this.vNearPlaneCenter,k=this.vFarPlaneCenter,i=this.direction,j=this.left,l=this.up;i.setv(this._direction).mul(a);e.setv(this.translation).addv(i);i.setv(this._direction).mul(b);k.setv(this.translation).addv(i);j.setv(this._left).mul(d);l.setv(this._up).mul(c);this._corners[0].setv(e).subv(j).subv(l);
this._corners[1].setv(e).addv(j).subv(l);this._corners[2].setv(e).addv(j).addv(l);this._corners[3].setv(e).subv(j).addv(l);j.setv(this._left).mul(g);l.setv(this._up).mul(f);this._corners[4].setv(k).subv(j).subv(l);this._corners[5].setv(k).addv(j).subv(l);this._corners[6].setv(k).addv(j).addv(l);this._corners[7].setv(k).subv(j).addv(l);return this._corners};var l=function(a){if(a>0)return 1;else if(a<0)return-1;return 0};h.prototype.setToObliqueMatrix=function(a,c){var c=c||0,d=this._clipPlane.setv(a);
this.getViewMatrix().applyPost(d);d.w=this.translation.y*a.y+c;this._updatePMatrix=!0;var f=this.getProjectionMatrix();this._qCalc.setd((l(d.x)+f[8])/f[0],(l(d.y)+f[9])/f[5],-1,(1+f[10])/f[14]);d.mul(2/b.dot(d,this._qCalc));f[2]=d.x;f[6]=d.y;f[10]=d.z+1;f[14]=d.w;this._updateInverseMVPMatrix=this._updateMVPMatrix=!0};return h});
define("goo/renderer/pass/RenderTarget",["goo/math/Vector2"],function(e){function c(b,a,c){this._glFrameBuffer=this._glRenderBuffer=this.glTexture=null;this.width=b;this.height=a;c=c||{};this.wrapS=c.wrapS!==void 0?c.wrapS:"EdgeClamp";this.wrapT=c.wrapT!==void 0?c.wrapT:"EdgeClamp";this.magFilter=c.magFilter!==void 0?c.magFilter:"Bilinear";this.minFilter=c.minFilter!==void 0?c.minFilter:"BilinearNoMipMaps";this.anisotropy=c.anisotropy!==void 0?c.anisotropy:1;this.offset=new e(0,0);this.repeat=new e(1,
1);this.format=c.format!==void 0?c.format:"RGBA";this.type=c.type!==void 0?c.type:"UnsignedByte";this.variant="2D";this.depthBuffer=c.depthBuffer!==void 0?c.depthBuffer:!0;this.stencilBuffer=c.stencilBuffer!==void 0?c.stencilBuffer:!0;this.generateMipmaps=!1}c.prototype.clone=function(){var b=new c(this.width,this.height);b.wrapS=this.wrapS;b.wrapT=this.wrapT;b.magFilter=this.magFilter;b.anisotropy=this.anisotropy;b.minFilter=this.minFilter;b.offset.copy(this.offset);b.repeat.copy(this.repeat);b.format=
this.format;b.type=this.type;b.variant=this.variant;b.depthBuffer=this.depthBuffer;b.stencilBuffer=this.stencilBuffer;b.generateMipmaps=this.generateMipmaps;return b};return c});
define("goo/renderer/shaders/ShaderFragment",[],function(){function e(){}e.noisecommon="vec4 mod289(vec4 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nvec3 mod289(vec3 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nvec2 mod289(vec2 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nvec3 permute(vec3 x) {\n  return mod289(((x*34.0)+1.0)*x);\n}\nvec4 permute(vec4 x) {\n  return mod289(((x*34.0)+1.0)*x);\n}";e.noise2d=[e.noisecommon,"float snoise(vec2 v)\n  {\n  const vec4 C = vec4(0.211324865405187,  // (3.0-sqrt(3.0))/6.0\n                      0.366025403784439,  // 0.5*(sqrt(3.0)-1.0)\n                     -0.577350269189626,  // -1.0 + 2.0 * C.x\n                      0.024390243902439); // 1.0 / 41.0\n  vec2 i  = floor(v + dot(v, C.yy) );\n  vec2 x0 = v -   i + dot(i, C.xx);\n  vec2 i1;\n  //i1.x = step( x0.y, x0.x ); // x0.x > x0.y ? 1.0 : 0.0\n  //i1.y = 1.0 - i1.x;\n  i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n  // x0 = x0 - 0.0 + 0.0 * C.xx ;\n  // x1 = x0 - i1 + 1.0 * C.xx ;\n  // x2 = x0 - 1.0 + 2.0 * C.xx ;\n  vec4 x12 = x0.xyxy + C.xxzz;\n  x12.xy -= i1;\n  i = mod289(i); // Avoid truncation effects in permutation\n  vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))\n\t\t+ i.x + vec3(0.0, i1.x, 1.0 ));\n  vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);\n  m = m*m ;\n  m = m*m ;\n  vec3 x = 2.0 * fract(p * C.www) - 1.0;\n  vec3 h = abs(x) - 0.5;\n  vec3 ox = floor(x + 0.5);\n  vec3 a0 = x - ox;\n  m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );\n  vec3 g;\n  g.x  = a0.x  * x0.x  + h.x  * x0.y;\n  g.yz = a0.yz * x12.xz + h.yz * x12.yw;\n  return 130.0 * dot(m, g);\n}"].join("\n");
e.noise3d=[e.noisecommon,"vec4 taylorInvSqrt(vec4 r) {\n\treturn 1.79284291400159 - 0.85373472095314 * r;\n}\nfloat snoise(vec3 v) {\n\tconst vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\n\tconst vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\n\tvec3 i  = floor(v + dot(v, C.yyy) );\n\tvec3 x0 =   v - i + dot(i, C.xxx) ;\n\tvec3 g = step(x0.yzx, x0.xyz);\n\tvec3 l = 1.0 - g;\n\tvec3 i1 = min( g.xyz, l.zxy );\n\tvec3 i2 = max( g.xyz, l.zxy );\n\tvec3 x1 = x0 - i1 + C.xxx;\n\tvec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\n\tvec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y\n\ti = mod289(i); \n\tvec4 p = permute( permute( permute( \n         i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n       + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) \n       + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n\tfloat n_ = 0.142857142857; // 1.0/7.0\n\tvec3  ns = n_ * D.wyz - D.xzx;\n\tvec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)\n\tvec4 x_ = floor(j * ns.z);\n\tvec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\n\tvec4 x = x_ *ns.x + ns.yyyy;\n\tvec4 y = y_ *ns.x + ns.yyyy;\n\tvec4 h = 1.0 - abs(x) - abs(y);\n\tvec4 b0 = vec4( x.xy, y.xy );\n\tvec4 b1 = vec4( x.zw, y.zw );\n\tvec4 s0 = floor(b0)*2.0 + 1.0;\n\tvec4 s1 = floor(b1)*2.0 + 1.0;\n\tvec4 sh = -step(h, vec4(0.0));\n\tvec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n\tvec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n\tvec3 p0 = vec3(a0.xy,h.x);\n\tvec3 p1 = vec3(a0.zw,h.y);\n\tvec3 p2 = vec3(a1.xy,h.z);\n\tvec3 p3 = vec3(a1.zw,h.w);\n\tvec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n\tp0 *= norm.x;\n\tp1 *= norm.y;\n\tp2 *= norm.z;\n\tp3 *= norm.w;\n\tvec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n\tm = m * m;\n\treturn 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), dot(p2,x2), dot(p3,x3) ) );\n}"].join("\n");
e.methods={packDepth:"vec4 packDepth( const in float depth ) {\n\tconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\n\tconst vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\n\tvec4 res = fract( depth * bit_shift );\n\tres -= res.xxyz * bit_mask;\n\treturn res;\n}",unpackDepth:"float unpackDepth( const in vec4 rgba_depth ) {\n\tconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\n\tfloat depth = dot( rgba_depth, bit_shift );\n\treturn depth;\n}"};
return e});define("goo/renderer/light/Light",["goo/math/Vector3"],function(e){return function(){this.translation=new e;this.color=new e(1,1,1);this.specularIntensity=this.intensity=1;this.shadowCaster=!1;this.shadowSettings={type:"Blur",projection:"Perspective",fov:55,size:100,near:1,far:1E3}}});
define("goo/renderer/light/PointLight",["goo/math/Vector3","goo/renderer/light/Light"],function(e,c){function b(){c.call(this);this.range=1E3}b.prototype=Object.create(c.prototype);b.prototype.update=function(a){a.matrix.getTranslation(this.translation)};return b});
define("goo/renderer/light/DirectionalLight",["goo/math/Vector3","goo/renderer/light/Light"],function(e,c){function b(){c.call(this);this.direction=new e}b.prototype=Object.create(c.prototype);b.prototype.update=function(a){a.matrix.getTranslation(this.translation);this.direction.setd(0,0,1);a.matrix.applyPostVector(this.direction)};return b});
define("goo/renderer/light/SpotLight",["goo/math/Vector3","goo/renderer/light/Light"],function(e,c){function b(){c.call(this);this.direction=new e;this.range=1E3;this.angle=45;this.exponent=16}b.prototype=Object.create(c.prototype);b.prototype.update=function(a){a.matrix.getTranslation(this.translation);this.direction.setd(0,0,1);a.matrix.applyPostVector(this.direction)};return b});
define("goo/util/TangentGenerator",["goo/math/Vector2","goo/math/Vector3","goo/renderer/MeshData"],function(e,c,b){function a(){}a.addTangentBuffer=function(a,d){function g(a){for(var b=[],d=0;d<a.length;d+=3)b.push(new c(a[d+0],a[d+1],a[d+2]));return b}var d=d||0,j=a.getAttributeBuffer(b.POSITION);if(!j)throw Error("Vertex buffer is null!");var k=a.getAttributeBuffer(b.NORMAL);if(!k)throw Error("Normal buffer is null!");var i=a.getAttributeBuffer("TEXCOORD"+d);!i&&d!==0&&(i=a.getAttributeBuffer(b.TEXCOORD0));
if(!i)throw Error("Texture buffer is null!");var h=a.getIndexBuffer();if(!h)throw Error("Index buffer is null!");for(var l=a.vertexCount,n=a.indexCount/3,o=[],p=[],m=0;m<l;m++)o[m]=new c,p[m]=new c;j=g(j);k=g(k);m=function(a){for(var b=[],c=0;c<a.length;c+=2)b.push(new e(a[c+0],a[c+1]));return b}(i);for(i=0;i<n;i++){var s=h[i*3],q=h[i*3+1],t=h[i*3+2],u=j[s],v=j[q],r=j[t],w=m[s],y=m[q],x=m[t],A=v.x-u.x,z=r.x-u.x,D=v.y-u.y,E=r.y-u.y,v=v.z-u.z,u=r.z-u.z,r=y.x-w.x,C=x.x-w.x,y=y.y-w.y,x=x.y-w.y,w=1/(r*
x-C*y);isFinite(w)!==!1&&(x=new c((x*A-y*z)*w,(x*D-y*E)*w,(x*v-y*u)*w),A=new c((r*z-C*A)*w,(r*E-C*D)*w,(r*u-C*v)*w),o[s].add(x),o[q].add(x),o[t].add(x),p[s].add(A),p[q].add(A),p[t].add(A))}a.attributeMap[b.TANGENT]=b.createAttribute(4,"Float");a.rebuildData(a.vertexCount,a.indexCount,!0);h=a.getAttributeBuffer(b.TANGENT);n=new c;j=new c;for(i=0;i<l;i++)m=k[i],s=o[i],q=m.dot(s),n.copy(s).sub(j.copy(m).mul(q)).normalize(),h[i*4+0]=n.x,h[i*4+1]=n.y,h[i*4+2]=n.z,q=n.copy(m).cross(s).dot(p[i]),h[i*4+3]=
q<0?-1:1;return h};return a});
define("goo/renderer/shaders/ShaderBuilder","goo/renderer/shaders/ShaderFragment,goo/renderer/MeshData,goo/renderer/light/PointLight,goo/renderer/light/DirectionalLight,goo/renderer/light/SpotLight,goo/math/MathUtils,goo/util/TangentGenerator".split(","),function(e,c,b,a,f,d,g){function j(){}e=new a;e.translation.setd(10,10,10);e.direction.setd(1,1,1).normalize();j.defaultLight=e;j.uber={processor:function(a,b){var d=b.meshData.attributeMap,f=b.material._textureMaps;a.defines=a.defines||{};for(var e in d)a.defines[e]||
(a.defines[e]=!0);for(var j in f)a.defines[j]||(a.defines[j]=!0);for(e in a.defines)e==="MAX_POINT_LIGHTS"||e==="MAX_DIRECTIONAL_LIGHTS"||e==="MAX_SPOT_LIGHTS"||!d[e]&&!f[e]&&delete a.defines[e];a.defines.NORMAL&&a.defines.NORMAL_MAP&&!b.meshData.getAttributeBuffer(c.TANGENT)&&g.addTangentBuffer(b.meshData)}};j.light={processor:function(c,g){c.uniforms.materialAmbient=c.uniforms.materialAmbient||"AMBIENT";c.uniforms.materialEmissive=c.uniforms.materialEmissive||"EMISSIVE";c.uniforms.materialDiffuse=
c.uniforms.materialDiffuse||"DIFFUSE";c.uniforms.materialSpecular=c.uniforms.materialSpecular||"SPECULAR";c.uniforms.materialSpecularPower=c.uniforms.materialSpecularPower||"SPECULAR_POWER";var e=0;c.uniforms.pointLightColor=c.uniforms.pointLightColor||[];c.uniforms.pointLight=c.uniforms.pointLight||[];var j=0;c.uniforms.directionalLightColor=c.uniforms.directionalLightColor||[];c.uniforms.directionalLightDirection=c.uniforms.directionalLightDirection||[];var n=0;c.uniforms.spotLightColor=c.uniforms.spotLightColor||
[];c.uniforms.spotLight=c.uniforms.spotLight||[];c.uniforms.spotLightDirection=c.uniforms.spotLightDirection||[];c.uniforms.spotLightAngle=c.uniforms.spotLightAngle||[];c.uniforms.spotLightExponent=c.uniforms.spotLightExponent||[];for(var o=g.lights,p=0;p<o.length;p++){var m=o[p];if(m instanceof b)c.uniforms.pointLight[e*4+0]=m.translation.x,c.uniforms.pointLight[e*4+1]=m.translation.y,c.uniforms.pointLight[e*4+2]=m.translation.z,c.uniforms.pointLight[e*4+3]=m.range,c.uniforms.pointLightColor[e*4+
0]=m.color.r*m.intensity,c.uniforms.pointLightColor[e*4+1]=m.color.g*m.intensity,c.uniforms.pointLightColor[e*4+2]=m.color.b*m.intensity,c.uniforms.pointLightColor[e*4+3]=m.specularIntensity,e++;else if(m instanceof a)c.uniforms.directionalLightDirection[j*3+0]=m.direction.x,c.uniforms.directionalLightDirection[j*3+1]=m.direction.y,c.uniforms.directionalLightDirection[j*3+2]=m.direction.z,c.uniforms.directionalLightColor[j*4+0]=m.color.r*m.intensity,c.uniforms.directionalLightColor[j*4+1]=m.color.g*
m.intensity,c.uniforms.directionalLightColor[j*4+2]=m.color.b*m.intensity,c.uniforms.directionalLightColor[j*4+3]=m.specularIntensity,j++;else if(m instanceof f)c.uniforms.spotLight[n*4+0]=m.translation.x,c.uniforms.spotLight[n*4+1]=m.translation.y,c.uniforms.spotLight[n*4+2]=m.translation.z,c.uniforms.spotLight[n*4+3]=m.range,c.uniforms.spotLightColor[n*4+0]=m.color.r*m.intensity,c.uniforms.spotLightColor[n*4+1]=m.color.g*m.intensity,c.uniforms.spotLightColor[n*4+2]=m.color.b*m.intensity,c.uniforms.spotLightColor[n*
4+3]=m.specularIntensity,c.uniforms.spotLightDirection[n*3+0]=m.direction.x,c.uniforms.spotLightDirection[n*3+1]=m.direction.y,c.uniforms.spotLightDirection[n*3+2]=m.direction.z,c.uniforms.spotLightAngle[n]=Math.cos(m.angle*d.DEG_TO_RAD),c.uniforms.spotLightExponent[n]=m.exponent,n++}if(c.pointCount!==e)c.defines=c.defines||{},c.defines.MAX_POINT_LIGHTS=e,c.uniforms.pointLight.length=e*4,c.uniforms.pointLightColor.length=e*4,c.pointCount=e;if(c.directionalCount!==j)c.defines=c.defines||{},c.defines.MAX_DIRECTIONAL_LIGHTS=
j,c.uniforms.directionalLightDirection.length=j*3,c.uniforms.directionalLightColor.length=j*4,c.directionalCount=j;if(c.spotCount!==n)c.defines=c.defines||{},c.defines.MAX_SPOT_LIGHTS=n,c.uniforms.spotLight.length=n*4,c.uniforms.spotLightColor.length=n*4,c.uniforms.spotLightDirection.length=n*3,c.uniforms.spotLightAngle.length=n*1,c.uniforms.spotLightExponent.length=n*1,c.spotCount=n},prevertex:"",vertex:"",prefragment:"uniform vec4 materialAmbient;\nuniform vec4 materialEmissive;\nuniform vec4 materialDiffuse;\nuniform vec4 materialSpecular;\nuniform float materialSpecularPower;\n#ifndef MAX_DIRECTIONAL_LIGHTS\n#define MAX_DIRECTIONAL_LIGHTS 0\n#endif\n#ifndef MAX_POINT_LIGHTS\n#define MAX_POINT_LIGHTS 0\n#endif\n#ifndef MAX_SPOT_LIGHTS\n#define MAX_SPOT_LIGHTS 0\n#endif\n#if MAX_DIRECTIONAL_LIGHTS > 0\nuniform vec4 directionalLightColor[MAX_DIRECTIONAL_LIGHTS];\nuniform vec3 directionalLightDirection[MAX_DIRECTIONAL_LIGHTS];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec4 pointLight[MAX_POINT_LIGHTS];\nuniform vec4 pointLightColor[MAX_POINT_LIGHTS];\nvarying vec4 vPointLight[MAX_POINT_LIGHTS];\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec4 spotLightColor[MAX_SPOT_LIGHTS];\nuniform vec4 spotLight[MAX_SPOT_LIGHTS];\nuniform vec3 spotLightDirection[MAX_SPOT_LIGHTS];\nuniform float spotLightAngle[MAX_SPOT_LIGHTS];\nuniform float spotLightExponent[MAX_SPOT_LIGHTS];\nvarying vec4 vSpotLight[MAX_SPOT_LIGHTS];\n#endif",
fragment:"#ifdef SPECULAR_MAP\nfloat specularStrength = texture2D(specularMap, texCoord0).x;\n#else\nfloat specularStrength = 1.0;\n#endif\n#if MAX_POINT_LIGHTS > 0\nvec3 pointDiffuse  = vec3(0.0);\nvec3 pointSpecular = vec3(0.0);\nfor (int i = 0; i < MAX_POINT_LIGHTS; i++) {\nvec3 lVector = normalize(pointLight[i].xyz - vWorldPos.xyz);\nfloat lDistance = 1.0 - min((length(lVector) / pointLight[i].w), 1.0);\nfloat dotProduct = dot(N, lVector);\n#ifdef WRAP_AROUND\nfloat pointDiffuseWeightFull = max(dotProduct, 0.0);\nfloat pointDiffuseWeightHalf = max(0.5 * dotProduct + 0.5, 0.0);\nvec3 pointDiffuseWeight = mix(vec3(pointDiffuseWeightFull), vec3(pointDiffuseWeightHalf), wrapRGB);\n#else\nfloat pointDiffuseWeight = max(dotProduct, 0.0);\n#endif\npointDiffuse += materialDiffuse.rgb * pointLightColor[i].rgb * pointDiffuseWeight * lDistance;\nvec3 pointHalfVector = normalize(lVector + viewPosition);\nfloat pointDotNormalHalf = max(dot(N, pointHalfVector), 0.0);\nfloat pointSpecularWeight = pointLightColor[i].a * specularStrength * max(pow(pointDotNormalHalf, materialSpecularPower), 0.0);\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = (materialSpecularPower + 2.0001 ) / 8.0;\nvec3 schlick = materialSpecular.rgb + vec3(1.0 - materialSpecular.rgb) * pow(1.0 - dot(lVector, pointHalfVector), 5.0);\npointSpecular += schlick * pointLightColor[i].rgb * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;\n#else\npointSpecular += materialSpecular.rgb * pointLightColor[i].rgb * pointSpecularWeight * pointDiffuseWeight * lDistance;\n#endif\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nvec3 spotDiffuse  = vec3(0.0);\nvec3 spotSpecular = vec3(0.0);\nfor (int i = 0; i < MAX_SPOT_LIGHTS; i++) {\nvec3 lVector = normalize(spotLight[i].xyz - vWorldPos.xyz);\nfloat lDistance = 1.0 - min((length(lVector) / spotLight[i].w), 1.0);\nfloat spotEffect = dot( normalize(-spotLightDirection[i]), lVector);\nif (spotEffect > spotLightAngle[i]) {\nspotEffect = max(pow(spotEffect, spotLightExponent[i]), 0.0);\nfloat dotProduct = dot(N, lVector);\n#ifdef WRAP_AROUND\nfloat spotDiffuseWeightFull = max(dotProduct, 0.0);\nfloat spotDiffuseWeightHalf = max(0.5 * dotProduct + 0.5, 0.0);\nvec3 spotDiffuseWeight = mix(vec3(spotDiffuseWeightFull), vec3(spotDiffuseWeightHalf), wrapRGB);\n#else\nfloat spotDiffuseWeight = max(dotProduct, 0.0);\n#endif\nspotDiffuse += materialDiffuse.rgb * spotLightColor[i].rgb * spotDiffuseWeight * lDistance * spotEffect;\nvec3 spotHalfVector = normalize(lVector + viewPosition);\nfloat spotDotNormalHalf = max( dot(N, spotHalfVector), 0.0);\nfloat spotSpecularWeight = spotLightColor[i].a * specularStrength * max(pow(spotDotNormalHalf, materialSpecularPower), 0.0);\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = (materialSpecularPower + 2.0001) / 8.0;\nvec3 schlick = materialSpecular.rgb + vec3(1.0 - materialSpecular.rgb) * pow(1.0 - dot(lVector, spotHalfVector), 5.0);\nspotSpecular += schlick * spotLightColor[i].rgb * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;\n#else\nspotSpecular += materialSpecular.rgb * spotLightColor[i].rgb * spotSpecularWeight * spotDiffuseWeight * lDistance * spotEffect;\n#endif\n}\n}\n#endif\n#if MAX_DIRECTIONAL_LIGHTS > 0\nvec3 dirDiffuse  = vec3(0.0);\nvec3 dirSpecular = vec3(0.0);\nfor(int i = 0; i < MAX_DIRECTIONAL_LIGHTS; i++) {\nvec4 lDirection = vec4(directionalLightDirection[i], 0.0);\nvec3 dirVector = normalize(lDirection.xyz);\nfloat dotProduct = dot(N, dirVector);\n#ifdef WRAP_AROUND\nfloat dirDiffuseWeightFull = max(dotProduct, 0.0);\nfloat dirDiffuseWeightHalf = max(0.5 * dotProduct + 0.5, 0.0);\nvec3 dirDiffuseWeight = mix(vec3(dirDiffuseWeightFull), vec3(dirDiffuseWeightHalf), wrapRGB);\n#else\nfloat dirDiffuseWeight = max(dotProduct, 0.0);\n#endif\ndirDiffuse += materialDiffuse.rgb * directionalLightColor[i].rgb * dirDiffuseWeight;\nvec3 dirHalfVector = normalize(dirVector + viewPosition);\nfloat dirDotNormalHalf = max(dot(N, dirHalfVector), 0.0);\nfloat dirSpecularWeight = directionalLightColor[i].a * specularStrength * max(pow(dirDotNormalHalf, materialSpecularPower), 0.0);\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = (materialSpecularPower + 2.0001) / 8.0;\nvec3 schlick = materialSpecular.rgb + vec3(1.0 - materialSpecular.rgb) * pow(1.0 - dot(dirVector, dirHalfVector), 5.0);\ndirSpecular += schlick * directionalLightColor[i].rgb * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n#else\ndirSpecular += materialSpecular.rgb * directionalLightColor[i].rgb * dirSpecularWeight * dirDiffuseWeight;\n#endif\n}\n#endif\nvec3 totalDiffuse = vec3(0.0);\nvec3 totalSpecular = vec3(0.0);\n#if MAX_DIRECTIONAL_LIGHTS > 0\ntotalDiffuse += dirDiffuse;\ntotalSpecular += dirSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalDiffuse += pointDiffuse;\ntotalSpecular += pointSpecular;\n#endif\n#if MAX_SPOT_LIGHTS > 0\ntotalDiffuse += spotDiffuse;\ntotalSpecular += spotSpecular;\n#endif\nvec3 ambientLightColor = vec3(1.0, 1.0, 1.0);\n#ifdef METAL\nfinal_color.xyz = final_color.xyz * (materialEmissive.rgb + totalDiffuse + ambientLightColor * materialAmbient.rgb + totalSpecular);\n#else\nfinal_color.xyz = final_color.xyz * (materialEmissive.rgb + totalDiffuse + ambientLightColor * materialAmbient.rgb) + totalSpecular;\n#endif"};
j.shadow={processor:function(a,b){var c=b.material._textureMaps;a.defines=a.defines||{};c.SHADOW_MAP!==void 0&&!a.defines.SHADOW_MAP?(a.defines.SHADOW_MAP=!0,a.uniforms.viewMatrix="VIEW_MATRIX",a.uniforms.projectionMatrix="PROJECTION_MATRIX",a.uniforms.lightViewMatrix="LIGHT_VIEW_MATRIX",a.uniforms.lightProjectionMatrix="LIGHT_PROJECTION_MATRIX",a.uniforms.shadowMap="SHADOW_MAP",a.uniforms.depthControl=950,a.uniforms.attenuationPower=500):c.SHADOW_MAP===void 0&&a.defines.SHADOW_MAP&&delete a.defines.SHADOW_MAP},
prevertex:"",vertex:"",prefragment:"#ifdef SHADOW_MAP\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 lightViewMatrix;\nuniform mat4 lightProjectionMatrix;\nuniform sampler2D shadowMap;\nuniform float depthControl;\nuniform float attenuationPower;\nconst float PI = 3.1415926535897932384626;\nfloat linstep(float low, float high, float v){\n    return clamp((v-low)/(high-low), 0.0, 1.0);\n}\nfloat VSM(sampler2D depths, vec2 uv, float compare){\n    vec2 moments = texture2D(depths, uv).xy;\n    float p = smoothstep(compare-0.02, compare, moments.x);\n    float variance = max(moments.y - moments.x*moments.x, -0.001);\n    float d = compare - moments.x;\n    float p_max = linstep(0.3, 1.0, variance / (variance + d*d));\n    return clamp(max(p, p_max), 0.0, 1.0);\n}\n#endif",
fragment:"#ifdef SHADOW_MAP\n\tvec3 camPos = (viewMatrix * vec4(vWorldPos, 1.0)).xyz;\n\tvec3 lightPos = (lightViewMatrix * vec4(vWorldPos, 1.0)).xyz;\n\tvec3 lightPosNormal = normalize(lightPos);\n\tvec4 lightDevice = lightProjectionMatrix * vec4(lightPos, 1.0);\n\tvec2 lightDeviceNormal = lightDevice.xy/lightDevice.w;\n\tvec2 lightUV = lightDeviceNormal*0.5+0.5;\n\tfloat lightDepth2 = clamp(length(lightPos) / depthControl, 0.0, 1.0);\n\tfloat illuminated = VSM(shadowMap, lightUV, lightDepth2);// * 0.8 + 0.2;\n\tfinal_color.rgb *= vec3(illuminated);\n#endif"};
return j});
define("goo/renderer/shaders/ShaderLib",["goo/renderer/MeshData","goo/renderer/Shader","goo/renderer/shaders/ShaderFragment","goo/renderer/shaders/ShaderBuilder","goo/entities/World"],function(e,c,b,a,f){function d(){}d.screenCopy={attributes:{vertexPosition:e.POSITION,vertexUV0:e.TEXCOORD0},uniforms:{diffuseMap:c.DIFFUSE_MAP},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nvarying vec2 texCoord0;\nvoid main(void) {\n\ttexCoord0 = vertexUV0;\n\tgl_Position = vec4(vertexPosition, 1.0);\n}",fshader:"precision mediump float;\nuniform sampler2D diffuseMap;\nvarying vec2 texCoord0;\nvoid main(void)\n{\n\tgl_FragColor = texture2D(diffuseMap, texCoord0);\n}"};
d.copy={attributes:{vertexPosition:e.POSITION,vertexUV0:e.TEXCOORD0},uniforms:{viewProjectionMatrix:c.VIEW_PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,opacity:1,diffuseMap:c.DIFFUSE_MAP},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewProjectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 texCoord0;\nvoid main(void) {\n\ttexCoord0 = vertexUV0;\n\tgl_Position = viewProjectionMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n}",fshader:"precision mediump float;\nuniform sampler2D diffuseMap;\nuniform float opacity;\nvarying vec2 texCoord0;\nvoid main(void)\n{\n\tgl_FragColor = vec4(texture2D(diffuseMap, texCoord0).rgb, opacity);\n}"};
d.copyPure={attributes:{vertexPosition:e.POSITION,vertexUV0:e.TEXCOORD0},uniforms:{viewProjectionMatrix:c.VIEW_PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,opacity:1,diffuseMap:c.DIFFUSE_MAP},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewProjectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 texCoord0;\nvoid main(void) {\n\ttexCoord0 = vertexUV0;\n\tgl_Position = viewProjectionMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n}",fshader:"precision mediump float;\nuniform sampler2D diffuseMap;\nuniform float opacity;\nvarying vec2 texCoord0;\nvoid main(void)\n{\n\tvec4 col = texture2D(diffuseMap, texCoord0);\n\tgl_FragColor = vec4(col.rgb, col.a * opacity);\n}"};
d.simple={attributes:{vertexPosition:e.POSITION},uniforms:{viewProjectionMatrix:c.VIEW_PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX},vshader:"attribute vec3 vertexPosition;\nuniform mat4 viewProjectionMatrix;\nuniform mat4 worldMatrix;\nvoid main(void) {\n\tgl_Position = viewProjectionMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n}",fshader:"precision mediump float;\nvoid main(void)\n{\n\tgl_FragColor = vec4(1.0);\n}"};d.simpleColored={attributes:{vertexPosition:e.POSITION},uniforms:{viewProjectionMatrix:c.VIEW_PROJECTION_MATRIX,
worldMatrix:c.WORLD_MATRIX,color:[1,1,1]},vshader:"attribute vec3 vertexPosition;\nuniform mat4 viewProjectionMatrix;\nuniform mat4 worldMatrix;\nvoid main(void) {\n\tgl_Position = viewProjectionMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n}",fshader:"precision mediump float;\nuniform vec3 color;\nvoid main(void)\n{\n\tgl_FragColor = vec4(color, 1.0);\n}"};d.simpleLit={processors:[a.light.processor,a.shadow.processor],attributes:{vertexPosition:e.POSITION,vertexNormal:e.NORMAL},uniforms:{viewProjectionMatrix:c.VIEW_PROJECTION_MATRIX,
worldMatrix:c.WORLD_MATRIX,cameraPosition:c.CAMERA},vshader:["attribute vec3 vertexPosition;\nattribute vec3 vertexNormal;\nuniform mat4 viewProjectionMatrix;\nuniform mat4 worldMatrix;\nuniform vec3 cameraPosition;",a.light.prevertex,"varying vec3 normal;\nvarying vec3 vWorldPos;\nvarying vec3 viewPosition;\nvoid main(void) {\n\tvec4 worldPos = worldMatrix * vec4(vertexPosition, 1.0);\n\tvWorldPos = worldPos.xyz;\n\tgl_Position = viewProjectionMatrix * worldPos;",a.light.vertex,"\tnormal = (worldMatrix * vec4(vertexNormal, 0.0)).xyz;\n\tviewPosition = cameraPosition - worldPos.xyz;\n}"].join("\n"),
fshader:["precision mediump float;",a.light.prefragment,a.shadow.prefragment,"varying vec3 normal;\nvarying vec3 vWorldPos;\nvarying vec3 viewPosition;\nvoid main(void)\n{\n\tvec3 N = normalize(normal);\n\tvec4 final_color = vec4(1.0);",a.light.fragment,a.shadow.fragment,"\tgl_FragColor = final_color;\n}"].join("\n")};d.textured={attributes:{vertexPosition:e.POSITION,vertexUV0:e.TEXCOORD0},uniforms:{viewProjectionMatrix:c.VIEW_PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,diffuseMap:c.DIFFUSE_MAP},
vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewProjectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 texCoord0;\nvoid main(void) {\n\ttexCoord0 = vertexUV0;\n\tgl_Position = viewProjectionMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n}",fshader:"precision mediump float;\nuniform sampler2D diffuseMap;\nvarying vec2 texCoord0;\nvoid main(void)\n{\n\tgl_FragColor = texture2D(diffuseMap, texCoord0);\n}"};d.texturedLit={processors:[a.light.processor],attributes:{vertexPosition:e.POSITION,
vertexNormal:e.NORMAL,vertexUV0:e.TEXCOORD0},uniforms:{viewProjectionMatrix:c.VIEW_PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,cameraPosition:c.CAMERA,diffuseMap:c.DIFFUSE_MAP},vshader:["attribute vec3 vertexPosition;\nattribute vec3 vertexNormal;\nattribute vec2 vertexUV0;\nuniform mat4 viewProjectionMatrix;\nuniform mat4 worldMatrix;\nuniform vec3 cameraPosition;",a.light.prevertex,"varying vec3 normal;\nvarying vec3 vWorldPos;\nvarying vec3 viewPosition;\nvarying vec2 texCoord0;\nvoid main(void) {\n\tvec4 worldPos = worldMatrix * vec4(vertexPosition, 1.0);\n\tvWorldPos = worldPos.xyz;\n\tgl_Position = viewProjectionMatrix * worldPos;",
a.light.vertex,"\tnormal = (worldMatrix * vec4(vertexNormal, 0.0)).xyz;\n\ttexCoord0 = vertexUV0;\n\tviewPosition = cameraPosition - worldPos.xyz;\n}"].join("\n"),fshader:["uniform sampler2D diffuseMap;",a.light.prefragment,"varying vec3 normal;\nvarying vec3 vWorldPos;\nvarying vec3 viewPosition;\nvarying vec2 texCoord0;\nvoid main(void)\n{\n\tvec3 N = normalize(normal);\n\tvec4 final_color = texture2D(diffuseMap, texCoord0);",a.light.fragment,"\tgl_FragColor = final_color;\n}"].join("\n")};d.texturedNormalAOLit=
{attributes:{vertexPosition:e.POSITION,vertexNormal:e.NORMAL,vertexTangent:e.TANGENT,vertexUV0:e.TEXCOORD0,vertexUV1:e.TEXCOORD1,vertexUV2:e.TEXCOORD2},uniforms:{viewProjectionMatrix:c.VIEW_PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,cameraPosition:c.CAMERA,lightPosition:c.LIGHT0,diffuseMap:c.DIFFUSE_MAP,normalMap:c.NORMAL_MAP,aoMap:c.AO_MAP,materialAmbient:c.AMBIENT,materialDiffuse:c.DIFFUSE,materialSpecular:c.SPECULAR,materialSpecularPower:c.SPECULAR_POWER},vshader:"attribute vec3 vertexPosition;\nattribute vec3 vertexNormal;\nattribute vec4 vertexTangent;\nattribute vec2 vertexUV0;\nattribute vec2 vertexUV1;\nattribute vec2 vertexUV2;\nuniform mat4 viewProjectionMatrix;\nuniform mat4 worldMatrix;\nuniform vec3 cameraPosition;\nuniform vec3 lightPosition;\nvarying vec3 normal;\nvarying vec3 binormal;\nvarying vec3 tangent;\nvarying vec3 lightDir;\nvarying vec3 eyeVec;\nvarying vec2 texCoord0;\nvarying vec2 texCoord1;\nvarying vec2 texCoord2;\nvoid main(void) {\n\tvec4 worldPos = worldMatrix * vec4(vertexPosition, 1.0);\n\tgl_Position = viewProjectionMatrix * worldPos;\n\tnormal = normalize((worldMatrix * vec4(vertexNormal, 0.0)).xyz);\n\ttangent = normalize((worldMatrix * vec4(vertexTangent.xyz, 0.0)).xyz);\n\tbinormal = cross(normal, tangent) * vec3(vertexTangent.w);\n\ttexCoord0 = vertexUV0;\n\ttexCoord1 = vertexUV1;\n\ttexCoord2 = vertexUV2;\n\tlightDir = lightPosition - worldPos.xyz;\n\teyeVec = cameraPosition - worldPos.xyz;\n}",
fshader:"precision mediump float;\nuniform sampler2D diffuseMap;\nuniform sampler2D normalMap;\nuniform sampler2D aoMap;\nuniform vec4 materialAmbient;\nuniform vec4 materialDiffuse;\nuniform vec4 materialSpecular;\nuniform float materialSpecularPower;\nvarying vec3 normal;\nvarying vec3 binormal;\nvarying vec3 tangent;\nvarying vec3 lightDir;\nvarying vec3 eyeVec;\nvarying vec2 texCoord0;\nvarying vec2 texCoord1;\nvarying vec2 texCoord2;\nvoid main(void)\n{\n\tmat3 tangentToWorld = mat3(tangent,\n\t\t\t\t\t\t\t\tbinormal,\n\t\t\t\t\t\t\t\tnormal);\n\tvec4 texCol = texture2D(diffuseMap, texCoord0);\n\tvec4 final_color = materialAmbient;\n\tvec3 tangentNormal = texture2D(normalMap, texCoord0).xyz * vec3(2.0) - vec3(1.0);\n\tvec3 worldNormal = (tangentToWorld * tangentNormal);\n\tvec3 N = normalize(worldNormal);\n\tvec4 aoCol = texture2D(aoMap, texCoord2);\n\tvec3 L = normalize(lightDir);\n\tfloat lambertTerm = dot(N,L)*0.75+0.25;\n\tif(lambertTerm > 0.0)\n\t{\n\t\tfinal_color += materialDiffuse * // gl_LightSource[0].diffuse * \n\t\t\tlambertTerm;\n\t\tvec3 E = normalize(eyeVec);\n\t\tvec3 R = reflect(-L, N);\n\t\tfloat specular = pow( max(dot(R, E), 0.0),\n\t\t\t\t\t\tmaterialSpecularPower);\n\t\tfinal_color += materialSpecular * // gl_LightSource[0].specular * \n\t\t\tspecular;\n\t}\n\tgl_FragColor = vec4(texCol.rgb * aoCol.rgb * final_color.rgb, texCol.a);\n}"};
d.convolution={defines:{KERNEL_SIZE_FLOAT:"25.0",KERNEL_SIZE_INT:"25"},attributes:{position:e.POSITION,uv:e.TEXCOORD0},uniforms:{viewMatrix:c.VIEW_MATRIX,projectionMatrix:c.PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,tDiffuse:c.DIFFUSE_MAP,uImageIncrement:[0.001953125,0],cKernel:[]},vshader:"attribute vec3 position;\nattribute vec2 uv;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nuniform vec2 uImageIncrement;\nvarying vec2 vUv;\nvoid main() {\n\tvUv = uv - ( ( KERNEL_SIZE_FLOAT - 1.0 ) / 2.0 ) * uImageIncrement;\n\tgl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( position, 1.0 );\n}",
fshader:"precision mediump float;\nuniform float cKernel[ KERNEL_SIZE_INT ];\nuniform sampler2D tDiffuse;\nuniform vec2 uImageIncrement;\nvarying vec2 vUv;\nvoid main() {\n\tvec2 imageCoord = vUv;\n\tvec4 sum = vec4( 0.0 );\n\tfor( int i = 0; i < KERNEL_SIZE_INT; i ++ ) {\n\t\tsum += texture2D( tDiffuse, imageCoord ) * cKernel[ i ];\n\t\timageCoord += uImageIncrement;\n\t}\n\tgl_FragColor = sum;\n}",buildKernel:function(a){var b,c,d,f,e=2*Math.ceil(a*3)+1;e>25&&(e=25);f=(e-1)*0.5;c=Array(e);for(b=
d=0;b<e;++b)c[b]=Math.exp(-((b-f)*(b-f))/(2*a*a)),d+=c[b];for(b=0;b<e;++b)c[b]/=d;return c}};d.showDepth={attributes:{vertexPosition:e.POSITION},uniforms:{viewMatrix:c.VIEW_MATRIX,projectionMatrix:c.PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,near:c.NEAR_PLANE,far:c.FAR_PLANE},vshader:"attribute vec3 vertexPosition;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvoid main(void) {\n\tgl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n}",
fshader:"precision mediump float;\nuniform float near;\nuniform float far;\nvoid main(void)\n{\n\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n\tfloat d = 1.0 - smoothstep( near, far, depth );\n\tgl_FragColor = vec4(d);\n}"};d.showNormals={attributes:{vertexPosition:e.POSITION,vertexNormal:e.NORMAL},uniforms:{viewMatrix:c.VIEW_MATRIX,projectionMatrix:c.PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,opacity:1},vshader:"attribute vec3 vertexPosition;\nattribute vec3 vertexNormal;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec3 vNormal;\nvoid main() {\nvec4 mvPosition = viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );\nvNormal = vec3(worldMatrix * vec4(vertexNormal, 0.0));\ngl_Position = projectionMatrix * mvPosition;\n}",
fshader:"precision mediump float;\nuniform float opacity;\nvarying vec3 vNormal;\nvoid main() {\ngl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );\n}"};d.bokehShader={attributes:{position:e.POSITION,uv:e.TEXCOORD0},uniforms:{viewMatrix:c.VIEW_MATRIX,projectionMatrix:c.PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,tColor:c.DIFFUSE_MAP,tDepth:c.DEPTH_MAP,focus:1,aspect:1,aperture:0.025,maxblur:1},vshader:"attribute vec3 position;\nattribute vec2 uv;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 vUv;\nvoid main() {\n\tvUv = uv;\n\tgl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( position, 1.0 );\n}",
fshader:"precision mediump float;\nvarying vec2 vUv;\nuniform sampler2D tColor;\nuniform sampler2D tDepth;\nuniform float maxblur;\nuniform float aperture;\nuniform float focus;\nuniform float aspect;\nvoid main() {\nvec2 aspectcorrect = vec2( 1.0, aspect );\nvec4 depth1 = texture2D( tDepth, vUv );\nfloat factor = depth1.x - focus;\nvec2 dofblur = vec2 ( clamp( factor * aperture, -maxblur, maxblur ) );\nvec2 dofblur9 = dofblur * 0.9;\nvec2 dofblur7 = dofblur * 0.7;\nvec2 dofblur4 = dofblur * 0.4;\nvec4 col = vec4( 0.0 );\ncol += texture2D( tColor, vUv.xy );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur4 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.4,   0.0  ) * aspectcorrect ) * dofblur4 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur4 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur4 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur4 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur4 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur4 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur4 );\ngl_FragColor = col / 41.0;\ngl_FragColor.a = 1.0;\n}"};
d.particles={attributes:{vertexPosition:e.POSITION,vertexColor:e.COLOR,vertexUV0:e.TEXCOORD0},uniforms:{viewProjectionMatrix:c.VIEW_PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,diffuseMap:c.DIFFUSE_MAP},vshader:"attribute vec3 vertexPosition;\nattribute vec4 vertexColor;\nattribute vec2 vertexUV0;\nuniform mat4 viewProjectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 texCoord0;\nvarying vec4 color;\nvoid main(void) {\n    texCoord0 = vertexUV0;\n    color = vertexColor;\n\t gl_Position = viewProjectionMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n}",
fshader:"precision mediump float;\nuniform sampler2D diffuseMap;\nvarying vec2 texCoord0;\nvarying vec4 color;\nvoid main(void)\n{\n\tvec4 texCol = texture2D(diffuseMap, texCoord0);\n   if (color.a == 0.0 || texCol.a == 0.0) discard;\n\telse gl_FragColor = texCol * color;\n}"};d.sepia={attributes:{vertexPosition:e.POSITION,vertexUV0:e.TEXCOORD0},uniforms:{viewMatrix:c.VIEW_MATRIX,projectionMatrix:c.PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,tDiffuse:c.DIFFUSE_MAP,amount:1},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 vUv;\nvoid main() {\nvUv = vertexUV0;\ngl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );\n}",
fshader:"precision mediump float;\nuniform float amount;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\nvec4 color = texture2D( tDiffuse, vUv );\nvec3 c = color.rgb;\ncolor.r = dot( c, vec3( 1.0 - 0.607 * amount, 0.769 * amount, 0.189 * amount ) );\ncolor.g = dot( c, vec3( 0.349 * amount, 1.0 - 0.314 * amount, 0.168 * amount ) );\ncolor.b = dot( c, vec3( 0.272 * amount, 0.534 * amount, 1.0 - 0.869 * amount ) );\ngl_FragColor = vec4( min( vec3( 1.0 ), color.rgb ), color.a );\n}"};
d.dotscreen={attributes:{vertexPosition:e.POSITION,vertexUV0:e.TEXCOORD0},uniforms:{viewMatrix:c.VIEW_MATRIX,projectionMatrix:c.PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,tDiffuse:c.DIFFUSE_MAP,tSize:[256,256],center:[0.5,0.5],angle:1.57,scale:1},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 vUv;\nvoid main() {\nvUv = vertexUV0;\ngl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );\n}",
fshader:"precision mediump float;\nuniform vec2 center;\nuniform float angle;\nuniform float scale;\nuniform vec2 tSize;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nfloat pattern() {\nfloat s = sin( angle ), c = cos( angle );\nvec2 tex = vUv * tSize - center;\nvec2 point = vec2( c * tex.x - s * tex.y, s * tex.x + c * tex.y ) * scale;\nreturn ( sin( point.x ) * sin( point.y ) ) * 4.0;\n}\nvoid main() {\nvec4 color = texture2D( tDiffuse, vUv );\nfloat average = ( color.r + color.g + color.b ) / 3.0;\ngl_FragColor = vec4( vec3( average * 10.0 - 5.0 + pattern() ), color.a );\n}"};
d.vignette={attributes:{vertexPosition:e.POSITION,vertexUV0:e.TEXCOORD0},uniforms:{viewMatrix:c.VIEW_MATRIX,projectionMatrix:c.PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,tDiffuse:c.DIFFUSE_MAP,offset:1,darkness:1.5},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 vUv;\nvoid main() {\nvUv = vertexUV0;\ngl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );\n}",
fshader:"precision mediump float;\nuniform float offset;\nuniform float darkness;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\nvec4 texel = texture2D( tDiffuse, vUv );\nvec2 uv = ( vUv - vec2( 0.5 ) ) * vec2( offset );\ngl_FragColor = vec4( mix( texel.rgb, vec3( 1.0 - darkness ), dot( uv, uv ) ), texel.a );\n}"};d.film={attributes:d.copy.attributes,uniforms:{tDiffuse:c.DIFFUSE_MAP,time:function(){return f.time},nIntensity:0.5,sIntensity:0.5,sCount:1024,grayscale:0,$link:d.copy.uniforms},
vshader:d.copy.vshader,fshader:"precision mediump float;\nuniform float time;\nuniform bool grayscale;\nuniform float nIntensity;\nuniform float sIntensity;\nuniform float sCount;\nuniform sampler2D tDiffuse;\nvarying vec2 texCoord0;\nvoid main() {\n\tvec4 cTextureScreen = texture2D( tDiffuse, texCoord0 );\n\tfloat x = texCoord0.x * texCoord0.y * time * 1000.0;\nx = mod( x, 13.0 ) * mod( x, 123.0 );\nfloat dx = mod( x, 0.01 );\n\tvec3 cResult = cTextureScreen.rgb + cTextureScreen.rgb * clamp( 0.1 + dx * 100.0, 0.0, 1.0 );\n\tvec2 sc = vec2( sin( texCoord0.y * sCount ), cos( texCoord0.y * sCount ) );\n\tcResult += cTextureScreen.rgb * vec3( sc.x, sc.y, sc.x ) * sIntensity;\n\tcResult = cTextureScreen.rgb + clamp( nIntensity, 0.0,1.0 ) * ( cResult - cTextureScreen.rgb );\n\tif( grayscale ) {\n\t\tcResult = vec3( cResult.r * 0.3 + cResult.g * 0.59 + cResult.b * 0.11 );\n\t}\n\tgl_FragColor = vec4( cResult, cTextureScreen.a );\n}"};
d.bleachbypass={attributes:{vertexPosition:e.POSITION,vertexUV0:e.TEXCOORD0},uniforms:{viewMatrix:c.VIEW_MATRIX,projectionMatrix:c.PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,tDiffuse:c.DIFFUSE_MAP,opacity:1},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 vUv;\nvoid main() {\nvUv = vertexUV0;\ngl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );\n}",
fshader:"precision mediump float;\nuniform float opacity;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\nvec4 base = texture2D( tDiffuse, vUv );\nvec3 lumCoeff = vec3( 0.25, 0.65, 0.1 );\nfloat lum = dot( lumCoeff, base.rgb );\nvec3 blend = vec3( lum );\nfloat L = min( 1.0, max( 0.0, 10.0 * ( lum - 0.45 ) ) );\nvec3 result1 = 2.0 * base.rgb * blend;\nvec3 result2 = 1.0 - 2.0 * ( 1.0 - blend ) * ( 1.0 - base.rgb );\nvec3 newColor = mix( result1, result2, L );\nfloat A2 = opacity * base.a;\nvec3 mixRGB = A2 * newColor.rgb;\nmixRGB += ( ( 1.0 - A2 ) * base.rgb );\ngl_FragColor = vec4( mixRGB, base.a );\n}"};
d.horizontalTiltShift={attributes:{vertexPosition:e.POSITION,vertexUV0:e.TEXCOORD0},uniforms:{viewMatrix:c.VIEW_MATRIX,projectionMatrix:c.PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,tDiffuse:c.DIFFUSE_MAP,h:0.0078125,r:0.5},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 vUv;\nvoid main() {\nvUv = vertexUV0;\ngl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );\n}",
fshader:"precision mediump float;\nuniform sampler2D tDiffuse;\nuniform float h;\nuniform float r;\nvarying vec2 vUv;\nvoid main() {\nvec4 sum = vec4( 0.0 );\nfloat hh = h * abs( r - vUv.y );\nsum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * hh, vUv.y ) ) * 0.051;\nsum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * hh, vUv.y ) ) * 0.0918;\nsum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * hh, vUv.y ) ) * 0.12245;\nsum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * hh, vUv.y ) ) * 0.1531;\nsum += texture2D( tDiffuse, vec2( vUv.x,            vUv.y ) ) * 0.1633;\nsum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * hh, vUv.y ) ) * 0.1531;\nsum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * hh, vUv.y ) ) * 0.12245;\nsum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * hh, vUv.y ) ) * 0.0918;\nsum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * hh, vUv.y ) ) * 0.051;\ngl_FragColor = sum;\n}"};
d.colorify={attributes:{vertexPosition:e.POSITION,vertexUV0:e.TEXCOORD0},uniforms:{viewMatrix:c.VIEW_MATRIX,projectionMatrix:c.PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,tDiffuse:c.DIFFUSE_MAP,color:[1,1,1]},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 vUv;\nvoid main() {\nvUv = vertexUV0;\ngl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );\n}",
fshader:"precision mediump float;\nuniform vec3 color;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\nvec4 texel = texture2D( tDiffuse, vUv );\nvec3 luma = vec3( 0.299, 0.587, 0.114 );\nfloat v = dot( texel.xyz, luma );\ngl_FragColor = vec4( v * color, texel.w );\n}"};d.normalmap={attributes:{vertexPosition:e.POSITION,vertexUV0:e.TEXCOORD0},uniforms:{viewMatrix:c.VIEW_MATRIX,projectionMatrix:c.PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,heightMap:c.DIFFUSE_MAP,resolution:[512,512],
height:0.05},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 vUv;\nvoid main() {\nvUv = vertexUV0;\ngl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );\n}",fshader:"precision mediump float;\nuniform float height;\nuniform vec2 resolution;\nuniform sampler2D heightMap;\nvarying vec2 vUv;\nvoid main() {\nfloat val = texture2D( heightMap, vUv ).x;\nfloat valU = texture2D( heightMap, vUv + vec2( 1.0 / resolution.x, 0.0 ) ).x;\nfloat valV = texture2D( heightMap, vUv + vec2( 0.0, 1.0 / resolution.y ) ).x;\ngl_FragColor = vec4( ( 0.5 * normalize( vec3( val - valU, val - valV, height  ) ) + 0.5 ), 1.0 );\n}"};
d.ssao={attributes:{vertexPosition:e.POSITION,vertexUV0:e.TEXCOORD0},uniforms:{viewMatrix:c.VIEW_MATRIX,projectionMatrix:c.PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,tDiffuse:c.DIFFUSE_MAP,tDepth:c.DEPTH_MAP,size:[512,512],cameraNear:c.MAIN_NEAR_PLANE,cameraFar:c.MAIN_FAR_PLANE,fogNear:c.MAIN_NEAR_PLANE,fogFar:c.MAIN_FAR_PLANE,fogEnabled:0,onlyAO:1,aoClamp:0.3,lumInfluence:0},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 vUv;\nvoid main() {\nvUv = vertexUV0;\ngl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );\n}",
fshader:"precision mediump float;\nuniform float cameraNear;\nuniform float cameraFar;\nuniform float fogNear;\nuniform float fogFar;\nuniform bool fogEnabled;\nuniform bool onlyAO;\nuniform vec2 size;\nuniform float aoClamp;\nuniform float lumInfluence;\nuniform sampler2D tDiffuse;\nuniform sampler2D tDepth;\nvarying vec2 vUv;\n#define DL 2.399963229728653\n#define EULER 2.718281828459045\nfloat width = size.x;\nfloat height = size.y;\nfloat cameraFarPlusNear = cameraFar + cameraNear;\nfloat cameraFarMinusNear = cameraFar - cameraNear;\nfloat cameraCoef = 2.0 * cameraNear;\nconst int samples = 16;\nconst float radius = 4.0;\nconst bool useNoise = false;\nconst float noiseAmount = 0.0003;\nconst float diffArea = 0.4;\nconst float gDisplace = 0.4;\nconst vec3 onlyAOColor = vec3( 1.0, 1.0, 1.0 );\nfloat unpackDepth( const in vec4 rgba_depth ) {\nconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\nfloat depth = dot( rgba_depth, bit_shift );\nreturn depth;\n}\nvec2 rand( const vec2 coord ) {\nvec2 noise;\nif ( useNoise ) {\nfloat nx = dot ( coord, vec2( 12.9898, 78.233 ) );\nfloat ny = dot ( coord, vec2( 12.9898, 78.233 ) * 2.0 );\nnoise = clamp( fract ( 43758.5453 * sin( vec2( nx, ny ) ) ), 0.0, 1.0 );\n} else {\nfloat ff = fract( 1.0 - coord.s * ( width / 2.0 ) );\nfloat gg = fract( coord.t * ( height / 2.0 ) );\nnoise = vec2( 0.25, 0.75 ) * vec2( ff ) + vec2( 0.75, 0.25 ) * gg;\n}\nreturn ( noise * 2.0  - 1.0 ) * noiseAmount;\n}\nfloat doFog() {\nfloat zdepth = unpackDepth( texture2D( tDepth, vUv ) );\nfloat depth = -cameraFar * cameraNear / ( zdepth * cameraFarMinusNear - cameraFar );\nreturn smoothstep( fogNear, fogFar, depth );\n}\nfloat readDepth( const in vec2 coord ) {\nreturn cameraCoef / ( cameraFarPlusNear - unpackDepth( texture2D( tDepth, coord ) ) * cameraFarMinusNear );\n}\nfloat compareDepths( const in float depth1, const in float depth2, inout int far ) {\nfloat garea = 2.0;\nfloat diff = ( depth1 - depth2 ) * 100.0;\nif ( diff < gDisplace ) {\ngarea = diffArea;\n} else {\nfar = 1;\n}\nfloat dd = diff - gDisplace;\nfloat gauss = pow( EULER, -2.0 * dd * dd / ( garea * garea ) );\nreturn gauss;\n}\nfloat calcAO( float depth, float dw, float dh ) {\nfloat dd = radius - depth * radius;\nvec2 vv = vec2( dw, dh );\nvec2 coord1 = vUv + dd * vv;\nvec2 coord2 = vUv - dd * vv;\nfloat temp1 = 0.0;\nfloat temp2 = 0.0;\nint far = 0;\ntemp1 = compareDepths( depth, readDepth( coord1 ), far );\nif ( far > 0 ) {\ntemp2 = compareDepths( readDepth( coord2 ), depth, far );\ntemp1 += ( 1.0 - temp1 ) * temp2;\n}\nreturn temp1;\n}\nvoid main() {\nvec2 noise = rand( vUv );\nfloat depth = readDepth( vUv );\nfloat tt = clamp( depth, aoClamp, 1.0 );\nfloat w = ( 1.0 / width )  / tt + ( noise.x * ( 1.0 - noise.x ) );\nfloat h = ( 1.0 / height ) / tt + ( noise.y * ( 1.0 - noise.y ) );\nfloat pw;\nfloat ph;\nfloat ao;\nfloat dz = 1.0 / float( samples );\nfloat z = 1.0 - dz / 2.0;\nfloat l = 0.0;\nfor ( int i = 0; i <= samples; i ++ ) {\nfloat r = sqrt( 1.0 - z );\npw = cos( l ) * r;\nph = sin( l ) * r;\nao += calcAO( depth, pw * w, ph * h );\nz = z - dz;\nl = l + DL;\n}\nao /= float( samples );\nao = 1.0 - ao;\nif ( fogEnabled ) {\nao = mix( ao, 1.0, doFog() );\n}\nvec3 color = texture2D( tDiffuse, vUv ).rgb;\nvec3 lumcoeff = vec3( 0.299, 0.587, 0.114 );\nfloat lum = dot( color.rgb, lumcoeff );\nvec3 luminance = vec3( lum );\nvec3 final = vec3( color * mix( vec3( ao ), vec3( 1.0 ), luminance * lumInfluence ) );\nif ( onlyAO ) {\nfinal = onlyAOColor * vec3( mix( vec3( ao ), vec3( 1.0 ), luminance * lumInfluence ) );\n}\ngl_FragColor = vec4( final, 1.0 );\n}"};
d.skinning={defines:{JOINT_COUNT:56,WEIGHTS:4},attributes:{vertexPosition:e.POSITION,vertexUV0:e.TEXCOORD0,vertexWeights:e.WEIGHTS,vertexJointIDs:e.JOINTIDS},uniforms:{viewProjectionMatrix:c.VIEW_PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,diffuseMap:c.DIFFUSE_MAP,jointPalette:function(a){var a=a.meshData,b=a.currentPose;if(b){var b=b._matrixPalette,c=a.paletteMap.length*16,d=a.store;if(!d)d=new Float32Array(c),a.store=d;for(var f=0;f<a.paletteMap.length;f++)for(var c=b[a.paletteMap[f]],e=0;e<4;e++)for(var n=
0;n<4;n++)d[f*16+e*4+n]=c.data[n*4+e];return d}}},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nattribute vec4 vertexWeights;\nattribute vec4 vertexJointIDs;\nuniform mat4 viewProjectionMatrix;\nuniform mat4 worldMatrix;\nuniform mat4 jointPalette[JOINT_COUNT];\nvarying vec2 texCoord0;\nvoid main(void) {\n\tmat4 mat = mat4(0.0);\n\tmat += jointPalette[int(vertexJointIDs.x)] * vertexWeights.x;\n\tmat += jointPalette[int(vertexJointIDs.y)] * vertexWeights.y;\n\tmat += jointPalette[int(vertexJointIDs.z)] * vertexWeights.z;\n\tmat += jointPalette[int(vertexJointIDs.w)] * vertexWeights.w;\n\ttexCoord0 = vertexUV0;\n\tgl_Position = viewProjectionMatrix * worldMatrix * mat * vec4(vertexPosition, 1.0);\n}",
fshader:"precision mediump float;\nuniform sampler2D diffuseMap;\nvarying vec2 texCoord0;\nvoid main(void)\n{\n\tgl_FragColor = texture2D(diffuseMap, texCoord0);\n}"};d.rgbshift={attributes:{vertexPosition:e.POSITION,vertexUV0:e.TEXCOORD0},uniforms:{viewMatrix:c.VIEW_MATRIX,projectionMatrix:c.PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,tDiffuse:c.DIFFUSE_MAP,amount:0.0050,angle:0},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 vUv;\nvoid main() {\nvUv = vertexUV0;\ngl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );\n}",
fshader:"precision mediump float;\nuniform sampler2D tDiffuse;\nuniform float amount;\nuniform float angle;\nvarying vec2 vUv;\nvoid main() {\nvec2 offset = amount * vec2( cos(angle), sin(angle));\nvec4 cr = texture2D(tDiffuse, vUv + offset);\nvec4 cga = texture2D(tDiffuse, vUv);\nvec4 cb = texture2D(tDiffuse, vUv - offset);\ngl_FragColor = vec4(cr.r, cga.g, cb.b, cga.a);\n}"};d.brightnesscontrast={attributes:{vertexPosition:e.POSITION,vertexUV0:e.TEXCOORD0},uniforms:{viewMatrix:c.VIEW_MATRIX,projectionMatrix:c.PROJECTION_MATRIX,
worldMatrix:c.WORLD_MATRIX,tDiffuse:c.DIFFUSE_MAP,brightness:0,contrast:0},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 vUv;\nvoid main() {\nvUv = vertexUV0;\ngl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );\n}",fshader:"precision mediump float;\nuniform sampler2D tDiffuse;\nuniform float brightness;\nuniform float contrast;\nvarying vec2 vUv;\nvoid main() {\ngl_FragColor = texture2D( tDiffuse, vUv );\ngl_FragColor.rgb += brightness;\nif (contrast > 0.0) {\ngl_FragColor.rgb = (gl_FragColor.rgb - 0.5) / (1.0 - contrast) + 0.5;\n} else {\ngl_FragColor.rgb = (gl_FragColor.rgb - 0.5) * (1.0 + contrast) + 0.5;\n}\n}"};
d.luminosity={attributes:{vertexPosition:e.POSITION,vertexUV0:e.TEXCOORD0},uniforms:{viewMatrix:c.VIEW_MATRIX,projectionMatrix:c.PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,tDiffuse:c.DIFFUSE_MAP},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 vUv;\nvoid main() {\nvUv = vertexUV0;\ngl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );\n}",fshader:"precision mediump float;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\nvec4 texel = texture2D( tDiffuse, vUv );\nvec3 luma = vec3( 0.299, 0.587, 0.114 );\nfloat v = dot( texel.xyz, luma );\ngl_FragColor = vec4( v, v, v, texel.w );\n}"};
d.point={attributes:{vertexPosition:e.POSITION,vertexColor:e.COLOR},uniforms:{viewProjectionMatrix:c.VIEW_PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,pointSize:2},vshader:"attribute vec3 vertexPosition;\nattribute vec4 vertexColor;\nuniform mat4 viewProjectionMatrix;\nuniform mat4 worldMatrix;\nuniform float pointSize;\nvarying vec4 color;\nvoid main(void) {\n\tcolor = vertexColor;\n\tgl_Position = viewProjectionMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n\tgl_PointSize = pointSize;\n}",fshader:"precision mediump float;\nvarying vec4 color;\nvoid main(void)\n{\n\tgl_FragColor = color;\n}"};
d.toon={attributes:{vertexPosition:e.POSITION,vertexNormal:e.NORMAL},uniforms:{viewMatrix:c.VIEW_MATRIX,projectionMatrix:c.PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,cameraPosition:c.CAMERA,lightPosition:c.LIGHT0,HighlightColour:[0.9,0.8,0.7,1],MidColour:[0.65,0.55,0.45,1],ShadowColour:[0.4,0.3,0.2,1],HighlightSize:0.2,ShadowSize:0.01,OutlineWidth:0.15},vshader:"attribute vec3 vertexPosition;\nattribute vec3 vertexNormal;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nuniform vec3 cameraPosition;\nuniform vec3 lightPosition;\nvarying vec3 N;\nvarying vec3 V;\nvarying vec3 L;\nvoid main()\n{\n\tvec4 worldPos = worldMatrix * vec4(vertexPosition, 1.0);\n\tN = (worldMatrix * vec4(vertexNormal, 0.0)).xyz;\n\tL = lightPosition - worldPos.xyz;\n\tV = cameraPosition - worldPos.xyz;\n\tgl_Position = projectionMatrix * viewMatrix * worldPos;\n}",
fshader:"precision mediump float;\nuniform vec4 HighlightColour;\nuniform vec4 MidColour;\nuniform vec4 ShadowColour;\nuniform float HighlightSize;\nuniform float ShadowSize;\nuniform float OutlineWidth;\nvarying vec3 N;\nvarying vec3 L;\nvarying vec3 V;\nvoid main()\n{\n\tvec3 n = normalize(N);\n\tvec3 l = normalize(L);\n\tvec3 v = normalize(V);\n    float lambert = dot(l,n);\n    vec4 colour = MidColour;\n    if (lambert > 1.0 - HighlightSize) colour = HighlightColour;\n    if (lambert < ShadowSize) colour = ShadowColour;\n    if (dot(n,v) < OutlineWidth) colour = vec4(0.0,0.0,0.0,1.0);\n    gl_FragColor = colour;\n}"};
d.differenceOfGaussians={attributes:{vertexPosition:e.POSITION,vertexUV0:e.TEXCOORD0},uniforms:{viewMatrix:c.VIEW_MATRIX,projectionMatrix:c.PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,gaussBlurredImage1:"BLUR1",gaussBlurredImage2:"BLUR2",originalImage:"ORIGINAL",threshold:0.01},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 texCoord0;\nvoid main(void) {\n\ttexCoord0 = vertexUV0;\n\tgl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n}",
fshader:"precision mediump float;\nuniform sampler2D gaussBlurredImage1;\nuniform sampler2D gaussBlurredImage2;\nuniform sampler2D originalImage;\nuniform float threshold;\nvarying vec2 texCoord0;\nvoid main(void)\n{\n\tvec4 blur1 = texture2D(gaussBlurredImage1, texCoord0);\n\tvec4 blur2 = texture2D(gaussBlurredImage2, texCoord0);\n\tvec4 originalColor = texture2D(originalImage, texCoord0);\n\tvec3 col = clamp(blur1.rgb - blur2.rgb, 0.0, 1.0);\n\tfloat value = (col.r + col.g + col.b) / 3.0;\n\tvalue = step(threshold, value);\n\tvec3 outputColor = mix(originalColor.rgb, vec3(value), value);\n\tgl_FragColor = vec4(outputColor, 1.0);\n}"};
d.downsample={attributes:{vertexPosition:e.POSITION,vertexUV0:e.TEXCOORD0},uniforms:{viewMatrix:c.VIEW_MATRIX,projectionMatrix:c.PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,tDiffuse:c.DIFFUSE_MAP},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 vUv;\nvoid main() {\nvUv = vertexUV0;\ngl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );\n}",fshader:"precision mediump float;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\ngl_FragColor = texture2D( tDiffuse, vUv );\n}"};
d.boxfilter={attributes:{vertexPosition:e.POSITION,vertexUV0:e.TEXCOORD0},uniforms:{viewMatrix:c.VIEW_MATRIX,projectionMatrix:c.PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,tDiffuse:c.DIFFUSE_MAP,viewport:[128,128]},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 vUv;\nvoid main() {\nvUv = vertexUV0;\ngl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );\n}",
fshader:"precision mediump float;\nuniform sampler2D tDiffuse;\nuniform vec2 viewport;\nvarying vec2 vUv;\nvoid main() {\nvec3 result = vec3(0.0);\nfor(int x=-1; x<=1; x++) {\n\tfor(int y=-1; y<=1; y++) {\n\t\tresult += texture2D(tDiffuse, vUv + vec2(x, y) / viewport).rgb;\n\t}\n}\ngl_FragColor = vec4(result / vec3(9.0), 1.0);\n}"};d.lightDepth={attributes:{vertexPosition:e.POSITION},uniforms:{viewMatrix:c.VIEW_MATRIX,projectionMatrix:c.PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,cameraFar:c.LIGHT_FAR_PLANE},
vshader:"attribute vec3 vertexPosition;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec3 worldPosition;\nvoid main(void) {\n\tvec4 viewpos = viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n\tworldPosition = viewpos.xyz;\n\tgl_Position = projectionMatrix * viewpos;\n}",fshader:"precision mediump float;\nuniform mat4 viewMatrix;\nuniform float cameraFar;\nvarying vec3 worldPosition;\nvoid main(void)\n{\n\tfloat depth = clamp(length(worldPosition) / cameraFar, 0.0, 1.0);\n\tgl_FragColor = vec4(depth, depth * depth, 0.0, 1.0);\n}"};
d.packDepth={attributes:{vertexPosition:e.POSITION},uniforms:{viewMatrix:c.VIEW_MATRIX,projectionMatrix:c.PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,farPlane:c.FAR_PLANE},vshader:"attribute vec3 vertexPosition;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec4 vPosition;\nvoid main(void) {\n\tvPosition = viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n\tgl_Position = projectionMatrix * vPosition;\n}",fshader:["precision mediump float;\nuniform float farPlane;",
b.methods.packDepth,"varying vec4 vPosition;\nvoid main(void)\n{\n\tfloat linearDepth = min(length(vPosition), farPlane) / farPlane;\n\tgl_FragColor = packDepth(linearDepth);\n}"].join("\n")};return d});
define("goo/entities/EventHandler",[],function(){function e(){}e.listeners=[];e.dispatch=function(){if(arguments.length===0)throw Error("Event needs to specify a callback as first argument");for(var c=arguments[0],b=Array.prototype.slice.call(arguments,1),a=0;a<e.listeners.length;a++){var f=e.listeners[a];f[c]&&f[c].apply(null,b)}};e.addListener=function(c){e.listeners.indexOf(c)===-1&&e.listeners.push(c)};e.removeListener=function(c){c=e.listeners.indexOf(c);c!==-1&&e.listeners.splice(c,1)};return e});
define("goo/addons/water/FlatWaterRenderer","goo/renderer/MeshData,goo/renderer/Shader,goo/renderer/Camera,goo/math/Plane,goo/renderer/pass/RenderTarget,goo/math/Vector3,goo/math/Vector4,goo/renderer/Material,goo/renderer/TextureCreator,goo/renderer/shaders/ShaderLib,goo/entities/EventHandler,goo/renderer/shaders/ShaderFragment".split(","),function(e,c,b,a,f,d,g,j,k,i,h,l){function n(c){c=c||{};this.useRefraction=c.useRefraction!==void 0?c.useRefraction:!0;this.waterCamera=new b(45,1,0.1,2E3);this.renderList=
[];this.waterPlane=new a;var e=Math.floor(window.innerWidth/(c.divider||2)),i=Math.floor(window.innerHeight/(c.divider||2));this.reflectionTarget=new f(e,i);if(this.useRefraction)this.refractionTarget=new f(e,i),this.depthTarget=new f(e,i);e=j.createMaterial(o,"WaterMaterial");e.shader.defines.REFRACTION=this.useRefraction;e.cullState.enabled=!1;c=c.normalsUrl||"../resources/water/waternormals3.png";e.setTexture("NORMAL_MAP",(new k).loadTexture2D(c));e.setTexture("REFLECTION_MAP",this.reflectionTarget);
this.useRefraction&&(e.setTexture("REFRACTION_MAP",this.refractionTarget),e.setTexture("DEPTH_MAP",this.depthTarget));this.waterMaterial=e;this.followCam=!0;this.calcVect=new d;this.camReflectDir=new d;this.camReflectUp=new d;this.camReflectLeft=new d;this.camLocation=new d;this.camReflectPos=new d;this.offset=new d;this.clipPlane=new g;this.waterEntity=null;this.depthMaterial=j.createMaterial(p,"depth")}n.prototype.process=function(a,b,c,d,f){var g=this.waterPlane;this.waterCamera.copy(d);g.constant=
this.waterEntity.transformComponent.transform.translation.y;var e=d.translation.y>g.constant;this.waterEntity.skip=!0;if(e){if(this.useRefraction)c.process(this.waterCamera,b,this.renderList),this.clipPlane.setd(g.normal.x,-g.normal.y,g.normal.z,g.constant),this.waterCamera.setToObliqueMatrix(this.clipPlane),a.overrideMaterial=this.depthMaterial,a.render(this.renderList,this.waterCamera,f,this.depthTarget,!0),a.overrideMaterial=null,a.render(this.renderList,this.waterCamera,f,this.refractionTarget,
!0);var i=this.calcVect,k=this.camReflectDir,j=this.camReflectUp,h=this.camReflectLeft,l=this.camLocation,n=this.camReflectPos;l.set(d.translation);var o=g.pseudoDistance(l);i.set(g.normal).mul(o*2);n.set(l.sub(i));l.set(d.translation).add(d._direction);o=g.pseudoDistance(l);i.set(g.normal).mul(o*2);k.set(l.sub(i)).sub(n).normalize();l.set(d.translation).add(d._up);o=g.pseudoDistance(l);i.set(g.normal).mul(o*2);j.set(l.sub(i)).sub(n).normalize();h.set(j).cross(k).normalize();this.waterCamera.translation.set(n);
this.waterCamera._direction.set(k);this.waterCamera._up.set(j);this.waterCamera._left.set(h);this.waterCamera.normalize();this.waterCamera.update();if(this.skybox&&this.followCam)i=this.skybox.transformComponent.worldTransform,i.translation.setv(n),i.update()}this.waterMaterial.shader.uniforms.abovewater=e;c.process(this.waterCamera,b,this.renderList);a.setRenderTarget(this.reflectionTarget);a.clear();if(this.skybox)if(this.skybox instanceof Array){this.clipPlane.setd(g.normal.x,g.normal.y,g.normal.z,
g.constant);this.waterCamera.setToObliqueMatrix(this.clipPlane,10);for(b=0;b<this.skybox.length;b++)a.render(this.skybox[b],this.waterCamera,f,this.reflectionTarget,!1),this.skybox[b].skip=!0}else a.render(this.skybox,this.waterCamera,f,this.reflectionTarget,!1),this.skybox.skip=!0;this.clipPlane.setd(g.normal.x,g.normal.y,g.normal.z,g.constant);this.waterCamera.setToObliqueMatrix(this.clipPlane);a.render(this.renderList,this.waterCamera,f,this.reflectionTarget,!1);this.waterEntity.skip=!1;if(this.skybox)if(this.skybox instanceof
Array)for(b=0;b<this.skybox.length;b++)this.skybox[b].skip=!1;else this.skybox.skip=!1;if(e&&this.skybox&&this.followCam)a=d.translation,i=this.skybox.transformComponent.worldTransform,i.translation.setv(a).addv(this.offset),i.update(),this.waterCamera._updatePMatrix=!0};n.prototype.setSkyBox=function(a){this.skybox=a;if(a.meshRendererComponent)this.skybox.meshRendererComponent.materials[0].depthState.enabled=!1,this.skybox.meshRendererComponent.materials[0].renderQueue=0,this.skybox.meshRendererComponent.cullMode=
"Never"};n.prototype.setWaterEntity=function(a){this.waterEntity=a;this.waterEntity.meshRendererComponent.materials[0]=this.waterMaterial};var o={defines:{REFRACTION:!1},attributes:{vertexPosition:e.POSITION,vertexNormal:e.NORMAL},uniforms:{viewMatrix:c.VIEW_MATRIX,projectionMatrix:c.PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,cameraPosition:c.CAMERA,normalMap:"NORMAL_MAP",reflection:"REFLECTION_MAP",refraction:"REFRACTION_MAP",depthmap:"DEPTH_MAP",vertexTangent:[1,0,0,1],waterColor:[0.0625,0.0625,
0.0625],abovewater:!0,fogColor:[1,1,1],sunDirection:[0.66,0.66,0.33],sunColor:[1,1,0.5],sunShininess:100,sunSpecPower:4,fogStart:0,fogScale:2E3,timeMultiplier:1,time:c.TIME,distortionMultiplier:0.025,fresnelPow:2,normalMultiplier:3,fresnelMultiplier:1,waterScale:5,doFog:!0,resolution:c.RESOLUTION},vshader:"attribute vec3 vertexPosition;\nattribute vec3 vertexNormal;\nuniform vec4 vertexTangent;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nuniform vec3 cameraPosition;\nuniform float waterScale;\nvarying vec2 texCoord0;\nvarying vec3 eyeVec;\nvarying vec4 viewCoords;\nvarying vec3 worldPos;\nvoid main(void) {\n\tworldPos = (worldMatrix * vec4(vertexPosition, 1.0)).xyz;\n\ttexCoord0 = worldPos.xz * waterScale;\n\tmat3 normalMatrix = mat3(worldMatrix);\n\tvec3 n = normalize(normalMatrix * vec3(vertexNormal.x, vertexNormal.y, -vertexNormal.z));\n\tvec3 t = normalize(normalMatrix * vertexTangent.xyz);\n\tvec3 b = cross(n, t) * vertexTangent.w;\n\tmat3 rotMat = mat3(t, b, n);\n\tvec3 eyeDir = worldPos - cameraPosition;\n\teyeVec = eyeDir * rotMat;\n\tviewCoords = projectionMatrix * viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n\tgl_Position = viewCoords;\n}",
fshader:["uniform sampler2D normalMap;\nuniform sampler2D reflection;\n#ifdef REFRACTION\nuniform sampler2D refraction;\nuniform sampler2D depthmap;\n#endif\nuniform vec3 waterColor;\nuniform bool abovewater;\nuniform vec3 fogColor;\nuniform float fogStart;\nuniform float fogScale;\nuniform float time;\nuniform float timeMultiplier;\nuniform float distortionMultiplier;\nuniform float fresnelPow;\nuniform vec3 sunDirection;\nuniform vec3 sunColor;\nuniform float sunShininess;\nuniform float sunSpecPower;\nuniform float normalMultiplier;\nuniform float fresnelMultiplier;\nuniform bool doFog;\nuniform vec2 resolution;\nvarying vec2 texCoord0;\nvarying vec3 eyeVec;\nvarying vec4 viewCoords;\nvarying vec3 worldPos;\nvec4 combineTurbulence(in vec2 coords) {\n\tfloat t = time * timeMultiplier;\n\tvec4 coarse1 = texture2D(normalMap, coords * vec2(0.0012, 0.001) + vec2(0.019 * t, 0.021 * t));\n\tvec4 coarse2 = texture2D(normalMap, coords * vec2(0.001, 0.0011) + vec2(-0.017 * t, 0.016 * t));\n\tvec4 detail1 = texture2D(normalMap, coords * vec2(0.008) + vec2(0.06 * t, 0.03 * t));\n\tvec4 detail2 = texture2D(normalMap, coords * vec2(0.006) + vec2(0.05 * t, -0.04 * t));\n\treturn (detail1 * 0.25 + detail2 * 0.25 + coarse1 * 0.75 + coarse2 * 1.0) / 2.25 - 0.48;\n}\n#ifdef REFRACTION",
l.methods.unpackDepth,"#endif\nvoid main(void)\n{\n\tfloat fogDist = clamp((viewCoords.z-fogStart)/fogScale,0.0,1.0);\n\tvec2 normCoords = texCoord0;\n\tvec4 noise = combineTurbulence(normCoords);\n\tvec3 normalVector = normalize(noise.xyz * vec3(normalMultiplier, normalMultiplier, 1.0));\n\tvec3 localView = normalize(eyeVec);\n\tfloat fresnel = dot(normalize(normalVector * vec3(fresnelMultiplier, fresnelMultiplier, 1.0)), localView);\n\tif ( abovewater == false ) {\n\t\tfresnel = -fresnel;\n\t}\n\tfresnel *= 1.0 - fogDist;\n\tfloat fresnelTerm = 1.0 - fresnel;\n\tfresnelTerm = pow(fresnelTerm, fresnelPow);\n\tfresnelTerm = clamp(fresnelTerm, 0.0, 1.0);\n\tfresnelTerm = fresnelTerm * 0.95 + 0.05;\n\tvec2 projCoord = viewCoords.xy / viewCoords.q;\n\tprojCoord = (projCoord + 1.0) * 0.5;\n\tprojCoord.y -= 1.0 / resolution.y;\n#ifdef REFRACTION\n\tfloat depthUnpack = unpackDepth(texture2D(depthmap, projCoord));\n\tif (depthUnpack > 0.5) {depthUnpack = 0.0;}\n\tfloat depth2 = clamp(depthUnpack * 400.0, 0.0, 1.0);\n\tvec2 projCoordRefr = vec2(projCoord);\n\tprojCoordRefr += (normalVector.xy * distortionMultiplier) * (depth2);\n\tprojCoordRefr = clamp(projCoordRefr, 0.001, 0.999);\n\tdepthUnpack = unpackDepth(texture2D(depthmap, projCoordRefr));\n\tfloat depth = clamp(depthUnpack * 40.0, 0.8, 1.0);\n#endif\n\tprojCoord += (normalVector.xy * distortionMultiplier);\n\tprojCoord = clamp(projCoord, 0.001, 0.999);\n\tif ( abovewater == true ) {\n\t\tprojCoord.x = 1.0 - projCoord.x;\n\t}\n\tvec4 waterColorX = vec4(waterColor, 1.0);\n\tvec4 reflectionColor = texture2D(reflection, projCoord);\n\tif ( abovewater == false ) {\n\t\treflectionColor *= vec4(0.8,0.9,1.0,1.0);\n\t\tvec4 endColor = mix(reflectionColor,waterColorX,fresnelTerm);\n\t\tgl_FragColor = mix(endColor,waterColorX,fogDist);\n\t}\n\telse {\n\t\tvec3 sunSpecReflection = normalize(reflect(-sunDirection, normalVector));\n\t\tfloat sunSpecDirection = max(0.0, dot(localView, sunSpecReflection));\n\t\tvec3 specular = pow(sunSpecDirection, sunShininess) * sunSpecPower * sunColor;\n\t\tvec4 endColor = waterColorX;\n#ifdef REFRACTION\n\t\tvec4 refractionColor = texture2D(refraction, projCoordRefr) * vec4(0.6);\n\t\tendColor = mix(refractionColor, waterColorX, depth);\n#endif\n\t\tendColor = mix(endColor, reflectionColor, fresnelTerm);\n\t\tif (doFog) {\n\t\t\tgl_FragColor = (vec4(specular, 1.0) + mix(endColor,reflectionColor,fogDist)) * (1.0-fogDist) + vec4(fogColor, 1.0) * fogDist;\n\t\t} else {\n\t\t\tgl_FragColor = vec4(specular, 1.0) + mix(endColor,reflectionColor,fogDist);\n\t\t}\n\t}\n}"].join("\n")},
p={attributes:{vertexPosition:e.POSITION},uniforms:{viewProjectionMatrix:c.VIEW_PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,farPlane:c.FAR_PLANE},vshader:"attribute vec3 vertexPosition;\nuniform mat4 viewProjectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec4 vPosition;\nvoid main(void) {\n\tvPosition = worldMatrix * vec4(vertexPosition, 1.0);\n\tgl_Position = viewProjectionMatrix * vPosition;\n}",fshader:["uniform float farPlane;",l.methods.packDepth,"varying vec4 vPosition;\nvoid main(void)\n{\n\tfloat linearDepth = abs(vPosition.y) / farPlane;\n\tgl_FragColor = packDepth(linearDepth);\n}"].join("\n")};
return n});
define("goo/shapes/Cylinder",["goo/renderer/MeshData","goo/util/Enum","goo/math/Vector3","goo/math/MathUtils"],function(e,c,b,a){function f(a,b,c){this.radialSamples=a!==void 0?a:8;this.radius=b!==void 0?b:0.5;this.textureMode=c!==void 0?c:f.TextureModes.Polar;this.viewInside=!1;a=e.defaultMap([e.POSITION,e.NORMAL,e.TEXCOORD0]);e.call(this,a,2*(this.radialSamples+1)+2,12*this.radialSamples);this.rebuild()}function d(a,b,c){a[c*3+0]=a[b*3+0];a[c*3+1]=a[b*3+1];a[c*3+2]=a[b*3+2]}f.prototype=Object.create(e.prototype);
f.prototype.rebuild=function(){for(var c=this.getAttributeBuffer(e.POSITION),j=this.getAttributeBuffer(e.NORMAL),k=this.getAttributeBuffer(e.TEXCOORD0),i=this.getIndexBuffer(),h=1/this.radialSamples,l=2/3,n=[],o=[],p=0;p<this.radialSamples;p++){var m=a.TWO_PI*h*p;o[p]=Math.cos(m);n[p]=Math.sin(m)}n[this.radialSamples]=n[0];o[this.radialSamples]=o[0];for(var m=0,s=new b,q=new b,t=new b,u=1;u<3;u++){var v=a.HALF_PI*(-1+l*u),r=Math.sin(v),p=this.radius*r,w=q.set(0,0,0);w.z=u-1.5;for(var y=Math.sqrt(Math.abs(this.radius*
this.radius-p*p)),x,A=m,p=0;p<this.radialSamples;p++){var z=p*h;x=t.set(o[p],n[p],0);b.mul(x,y,s);c[m*3+0]=w.x+s.x;c[m*3+1]=w.y+s.y;c[m*3+2]=w.z+s.z;x=s.set(c[m*3+0],c[m*3+1],c[m*3+2]);x.normalize();this.viewInside?(j[m*3+0]=-x.x,j[m*3+1]=-x.y,j[m*3+2]=-x.z):(j[m*3+0]=x.x,j[m*3+1]=x.y,j[m*3+2]=x.z);this.textureMode===f.TextureModes.Linear?(k[m*2+0]=z,k[m*2+1]=0.5*(r+1)):this.textureMode===f.TextureModes.Projected?(k[m*2+0]=z,k[m*2+1]=a.HALF_PI+Math.asin(r)/Math.PI):this.textureMode===f.TextureModes.Polar&&
(z=(a.HALF_PI-Math.abs(v))/Math.PI,x=z*n[p]+0.5,k[m*2+0]=z*o[p]+0.5,k[m*2+1]=x);m++}d(c,A,m);d(j,A,m);this.textureMode===f.TextureModes.Linear?(k[m*2+0]=1,k[m*2+1]=0.5*(r+1)):this.textureMode===f.TextureModes.Projected?(k[m*2+0]=1,k[m*2+1]=a.INV_PI*(a.HALF_PI+Math.asin(r))):this.textureMode===f.TextureModes.Polar&&(z=(a.HALF_PI-Math.abs(v))/Math.PI,k[m*2+0]=z+0.5,k[m*2+1]=0.5);m++}c[m*3+0]=0;c[m*3+1]=0;c[m*3+2]=-0.5;this.viewInside?(j[m*3+0]=0,j[m*3+1]=0,j[m*3+2]=1):(j[m*3+0]=0,j[m*3+1]=0,j[m*3+2]=
-1);this.textureMode===f.TextureModes.Polar?(k[m*2+0]=0.5,k[m*2+1]=0.5):(k[m*2+0]=0.5,k[m*2+1]=0);m++;c[m*3+0]=0;c[m*3+1]=0;c[m*3+2]=0.5;this.viewInside?(j[m*3+0]=0,j[m*3+1]=0,j[m*3+2]=-1):(j[m*3+0]=0,j[m*3+1]=0,j[m*3+2]=1);this.textureMode===f.TextureModes.Polar?(k[m*2+0]=0.5,k[m*2+1]=0.5):(k[m*2+0]=0.5,k[m*2+1]=1);j=m=c=0;k=j+1;m+=this.radialSamples+1;h=m;l=h+1;for(m=0;m<this.radialSamples;m++)this.viewInside?(i[c++]=j++,i[c++]=h,i[c++]=k,i[c++]=k++,i[c++]=h++,i[c++]=l++):(i[c++]=j++,i[c++]=k,i[c++]=
h,i[c++]=k++,i[c++]=l++,i[c++]=h++);for(m=0;m<this.radialSamples;m++)this.viewInside?(i[c++]=m,i[c++]=m+1,i[c++]=this.vertexCount-2):(i[c++]=m,i[c++]=this.vertexCount-2,i[c++]=m+1);j=this.radialSamples+1;for(m=0;m<this.radialSamples;m++)this.viewInside?(i[c++]=m+j,i[c++]=this.vertexCount-1,i[c++]=m+1+j):(i[c++]=m+j,i[c++]=m+1+j,i[c++]=this.vertexCount-1);return this};f.TextureModes=new c("Linear","Projected","Polar");return f});
define("goo/shapes/Torus",["goo/renderer/MeshData","goo/math/Vector3","goo/math/MathUtils"],function(e,c,b){function a(a,b,c,f){this._circleSamples=a!==void 0?a:8;this._radialSamples=b!==void 0?b:8;this._tubeRadius=c!==void 0?c:1;this._centerRadius=f!==void 0?f:2;this.viewInside=!1;a=e.defaultMap([e.POSITION,e.NORMAL,e.TEXCOORD0]);e.call(this,a,(this._circleSamples+1)*(this._radialSamples+1),6*this._circleSamples*this._radialSamples);this.rebuild()}function f(a,b,c){a[c*3+0]=a[b*3+0];a[c*3+1]=a[b*
3+1];a[c*3+2]=a[b*3+2]}a.prototype=Object.create(e.prototype);a.prototype.rebuild=function(){for(var a=this.getAttributeBuffer(e.POSITION),g=this.getAttributeBuffer(e.NORMAL),j=this.getAttributeBuffer(e.TEXCOORD0),k=this.getIndexBuffer(),i=1/this._circleSamples,h=1/this._radialSamples,l=0,n=new c,o=new c,p=new c,m=0;m<this._circleSamples;m++){var s=m*i,q=b.TWO_PI*s,t=Math.cos(q),q=Math.sin(q);n.set(t,q,0);c.mul(n,this._centerRadius,o);t=l;for(q=0;q<this._radialSamples;q++){var u=q*h,v=b.TWO_PI*u,
r=Math.cos(v),v=Math.sin(v);p.copy(n).mul(r);p.z+=v;p.normalize();this.viewInside?(g[l*3+0]=-p.x,g[l*3+1]=-p.y,g[l*3+2]=-p.z):(g[l*3+0]=p.x,g[l*3+1]=p.y,g[l*3+2]=p.z);p.mul(this._tubeRadius).add(o);a[l*3+0]=p.x;a[l*3+1]=p.y;a[l*3+2]=p.z;j[l*2+0]=u;j[l*2+1]=s;l++}f(a,t,l);f(g,t,l);j[l*2+0]=1;j[l*2+1]=s;l++}for(m=0;m<=this._radialSamples;m++,l++)f(a,m,l),f(g,m,l),i=j,h=m,n=l,i[n*2+0]=i[h*2+0],i[n*2+1]=i[h*2+1],j[l*2+1]=1;for(m=g=a=0;m<this._circleSamples;m++){j=g;i=j+1;g+=this._radialSamples+1;h=g;
n=h+1;for(l=0;l<this._radialSamples;l++)this.viewInside?(k[a++]=j++,k[a++]=i,k[a++]=h,k[a++]=i++,k[a++]=n++,k[a++]=h++):(k[a++]=j++,k[a++]=h,k[a++]=i,k[a++]=i++,k[a++]=h++,k[a++]=n++)}return this};return a});
define("goo/shapes/ShapeCreator",["goo/shapes/Box","goo/shapes/Quad","goo/shapes/Sphere","goo/shapes/Cylinder","goo/shapes/Torus"],function(e,c,b,a,f){function d(){}d.createQuad=function(a,b,d,f){return new c(a,b,d,f)};d.createBox=function(a,b,c,d,f){return new e(a,b,c,d,f)};d.createSphere=function(a,c,d,f){return new b(a,c,d,f)};d.createCylinder=function(b,c,d){return new a(b,c,d)};d.createTorus=function(a,b,c,d){return new f(a,b,c,d)};return d});
define("goo/renderer/pass/FullscreenUtil",["goo/shapes/ShapeCreator","goo/renderer/Camera","goo/math/Vector3"],function(e,c,b){function a(){}var f=new c;f.projectionMode=c.Parallel;f.setFrustum(-1,1,-1,1,1,-1);f._left.copy(b.UNIT_X).invert();f._up.copy(b.UNIT_Y);f._direction.copy(b.UNIT_Z);f.onFrameChange();a.camera=f;a.quad=e.createQuad(2,2);return a});
define("goo/renderer/pass/FullscreenPass",["goo/renderer/Material","goo/renderer/pass/FullscreenUtil","goo/renderer/shaders/ShaderLib"],function(e,c,b){function a(a){this.material=e.createMaterial(a||b.simple);this.useReadBuffer=!0;this.renderToScreen=!1;this.renderable={meshData:c.quad,materials:[this.material]};this.enabled=!0;this.clear=!1;this.needsSwap=!0}a.prototype.render=function(a,b,e){this.useReadBuffer&&this.material.setTexture("DIFFUSE_MAP",e);this.renderToScreen?a.render(this.renderable,
c.camera,[],null,this.clear):a.render(this.renderable,c.camera,[],b,this.clear)};return a});
define("goo/addons/water/ProjectedGridWaterRenderer","goo/renderer/MeshData,goo/renderer/Shader,goo/renderer/Camera,goo/math/Plane,goo/renderer/pass/RenderTarget,goo/renderer/pass/FullscreenPass,goo/math/Vector3,goo/renderer/Material,goo/renderer/TextureCreator,goo/renderer/shaders/ShaderLib,goo/renderer/shaders/ShaderFragment".split(","),function(e,c,b,a,f,d,g,j,k,i,h){function l(c){this.waterCamera=new b(45,1,0.1,2E3);this.renderList=[];this.waterPlane=new a;var c=c||{},h=window.innerWidth/(c.divider||
4),l=window.innerHeight/(c.divider||4);this.renderTarget=new f(h,l);h=window.innerWidth/(c.divider||1);l=window.innerHeight/(c.divider||1);this.heightTarget=new f(h,l,{type:"Float"});this.normalTarget=new f(h,l,{});this.fullscreenPass=new d(i.normalmap);this.fullscreenPass.material.shader.uniforms.resolution=[h,l];c=this.waterMaterial=j.createMaterial(n,"WaterMaterial");c.cullState.enabled=!1;c.setTexture("NORMAL_MAP",(new k).loadTexture2D("../resources/water/waternormals3.png"));c.setTexture("REFLECTION_MAP",
this.renderTarget);c.setTexture("BUMP_MAP",this.heightTarget);c.setTexture("NORMAL_MAP_COARSE",this.normalTarget);c=this.materialWire=j.createMaterial(i.simple,"mat");c.wireframe=!0;c.wireframeColor=[0,0,0];this.calcVect=new g;this.camReflectDir=new g;this.camReflectUp=new g;this.camReflectLeft=new g;this.camLocation=new g;this.camReflectPos=new g;this.waterEntity=null;c=this.projData=new e(e.defaultMap([e.POSITION]),4,6);c.getAttributeBuffer(e.POSITION).set([0,0,0,1,0,0,1,1,0,0,1,0]);c.getIndexBuffer().set([1,
3,0,2,3,1]);h=j.createMaterial(o,"mat");this.projRenderable={meshData:c,materials:[h]}}l.prototype.updateHelper=function(a,b,c,d){var f=this.projData.getAttributeBuffer(e.POSITION);f[0]=a.x/a.w;f[1]=0;f[2]=a.z/a.w;f[3]=b.x/b.w;f[4]=0;f[5]=b.z/b.w;f[6]=c.x/c.w;f[7]=0;f[8]=c.z/c.w;f[9]=d.x/d.w;f[10]=0;f[11]=d.z/d.w;this.projData.setVertexDataUpdated()};l.prototype.process=function(a,b,c,d,f){var e=this.waterEntity.meshDataComponent.meshData;e.update(d);this.waterMaterial.shader.uniforms.intersectBottomLeft=
[e.intersectBottomLeft.x,e.intersectBottomLeft.y,e.intersectBottomLeft.z,e.intersectBottomLeft.w];this.waterMaterial.shader.uniforms.intersectBottomRight=[e.intersectBottomRight.x,e.intersectBottomRight.y,e.intersectBottomRight.z,e.intersectBottomRight.w];this.waterMaterial.shader.uniforms.intersectTopLeft=[e.intersectTopLeft.x,e.intersectTopLeft.y,e.intersectTopLeft.z,e.intersectTopLeft.w];this.waterMaterial.shader.uniforms.intersectTopRight=[e.intersectTopRight.x,e.intersectTopRight.y,e.intersectTopRight.z,
e.intersectTopRight.w];this.updateHelper(e.intersectBottomLeft,e.intersectBottomRight,e.intersectTopRight,e.intersectTopLeft);a.render(this.projRenderable,d,f,this.heightTarget,!0);this.fullscreenPass.render(a,this.normalTarget,this.heightTarget,0);var g=this.waterPlane;this.waterCamera.copy(d);g.constant=this.waterEntity.transformComponent.transform.translation.y;if(e=d.translation.y>g.constant){var i=this.calcVect,h=this.camReflectDir,k=this.camReflectUp,j=this.camReflectLeft,l=this.camLocation,
n=this.camReflectPos;l.set(d.translation);var o=g.pseudoDistance(l);i.set(g.normal).mul(o*2);n.set(l.sub(i));l.set(d.translation).add(d._direction);o=g.pseudoDistance(l);i.set(g.normal).mul(o*2);h.set(l.sub(i)).sub(n).normalize();l.set(d.translation).add(d._up);o=g.pseudoDistance(l);i.set(g.normal).mul(o*2);k.set(l.sub(i)).sub(n).normalize();j.set(k).cross(h).normalize();this.waterCamera.translation.set(n);this.waterCamera._direction.set(h);this.waterCamera._up.set(k);this.waterCamera._left.set(j);
this.waterCamera.normalize();this.waterCamera.update();if(this.skybox)g=this.skybox.transformComponent.worldTransform,g.translation.setv(n),g.update()}this.waterMaterial.shader.uniforms.abovewater=e;this.waterEntity.skip=!0;this.renderList.length=0;c.process(this.waterCamera,b,this.renderList);a.render(this.renderList,this.waterCamera,f,this.renderTarget,!0);this.waterEntity.skip=!1;if(e&&this.skybox)a=d.translation,g=this.skybox.transformComponent.worldTransform,g.translation.setv(a),g.update()};
l.prototype.setSkyBox=function(a){this.skybox=a};l.prototype.setWaterEntity=function(a){this.waterEntity=a;this.waterEntity.meshRendererComponent.cullMode="Never";this.waterEntity.meshRendererComponent.materials[0]=this.waterMaterial;a=this.waterEntity.meshDataComponent.meshData;this.waterMaterial.shader.uniforms.density=[a.densityX,a.densityY]};var n={attributes:{vertexUV0:e.TEXCOORD0},uniforms:{viewMatrix:c.VIEW_MATRIX,projectionMatrix:c.PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,cameraPosition:c.CAMERA,
normalMap:"NORMAL_MAP",reflection:"REFLECTION_MAP",bump:"BUMP_MAP",normalMapCoarse:"NORMAL_MAP_COARSE",vertexNormal:[0,-1,0],vertexTangent:[1,0,0,1],waterColor:[15,15,15],abovewater:!0,fogColor:[1,1,1,1],sunDirection:[0.66,-0.1,0.66],coarseStrength:0.25,detailStrength:2,fogStart:0,camNear:c.NEAR_PLANE,camFar:c.FAR_PLANE,time:c.TIME,intersectBottomLeft:[0,0,0,0],intersectTopLeft:[0,0,0,0],intersectTopRight:[0,0,0,0],intersectBottomRight:[0,0,0,0],grid:!1,heightMultiplier:50,density:[1,1]},vshader:"attribute vec2 vertexUV0;\nuniform vec3 vertexNormal;\nuniform vec4 vertexTangent;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nuniform vec3 cameraPosition;\nuniform float time;\nuniform vec3 sunDirection;\nuniform float coarseStrength;\nuniform float heightMultiplier;\nuniform sampler2D bump;\nuniform vec4 intersectBottomLeft;\nuniform vec4 intersectTopLeft;\nuniform vec4 intersectTopRight;\nuniform vec4 intersectBottomRight;\nvarying vec2 texCoord0;\nvarying vec2 texCoord1;\nvarying vec3 eyeVec;\nvarying vec3 sunDir;\nvarying vec4 viewCoords;\nvarying vec3 worldPos;\nvarying vec3 normal;\nvoid main(void) {\n\tvec4 pointTop = mix(intersectTopLeft, intersectTopRight, vertexUV0.x);\n\tvec4 pointBottom = mix(intersectBottomLeft, intersectBottomRight, vertexUV0.x);\n\tvec4 pointFinal = mix(pointTop, pointBottom, 1.0 - vertexUV0.y);\n\tpointFinal.xz /= pointFinal.w;\n\tpointFinal.y = 0.0;\n\tvec4 screenpos = projectionMatrix * viewMatrix * worldMatrix * vec4(pointFinal.xyz, 1.0);\n\tvec2 projCoord = screenpos.xy / screenpos.q;\n\tprojCoord = (projCoord + 1.0) * 0.5;\n\tfloat height = texture2D(bump, projCoord).x;\n\tpointFinal.y = height * heightMultiplier;\n\ttexCoord1 = vertexUV0;\n\tvec4 pos = worldMatrix * vec4(pointFinal.xyz, 1.0);\n\tworldPos = pos.xyz;\n\ttexCoord0 = worldPos.xz * 2.0;\n\tmat3 normalMatrix = mat3(worldMatrix);\n vec3 n = normalize(normalMatrix * vertexNormal);\n\tvec3 t = normalize(normalMatrix * vertexTangent.xyz);\n\tvec3 b = cross(n, t) * vertexTangent.w;\n\tmat3 rotMat = mat3(t, b, n);\n\tvec3 eyeDir = worldPos - cameraPosition;\n\teyeVec = eyeDir * rotMat;\n\tsunDir = sunDirection * rotMat;\n\tviewCoords = projectionMatrix * viewMatrix * pos;\n\tgl_Position = viewCoords;\n}",
fshader:"uniform sampler2D normalMap;\nuniform sampler2D reflection;\nuniform sampler2D normalMapCoarse;\nuniform vec3 waterColor;\nuniform bool abovewater;\nuniform vec4 fogColor;\nuniform float time;\nuniform bool grid;\nuniform vec2 density;\nuniform float camNear;\nuniform float camFar;\nuniform float fogStart;\nuniform float coarseStrength;\nuniform float detailStrength;\nvarying vec2 texCoord0;\nvarying vec2 texCoord1;\nvarying vec3 eyeVec;\nvarying vec3 sunDir;\nvarying vec4 viewCoords;\nvarying vec3 worldPos;\nvarying vec3 normal;\nconst vec3 sunColor = vec3(1.0, 0.96, 0.96);\nvec4 getNoise(vec2 uv) {\n    vec2 uv0 = (uv/123.0)+vec2(time/17.0, time/29.0);\n    vec2 uv1 = uv/127.0-vec2(time/-19.0, time/31.0);\n    vec2 uv2 = uv/vec2(897.0, 983.0)+vec2(time/51.0, time/47.0);\n    vec2 uv3 = uv/vec2(991.0, 877.0)-vec2(time/59.0, time/-63.0);\n    vec4 noise = (texture2D(normalMap, uv0)) +\n                 (texture2D(normalMap, uv1)) +\n                 (texture2D(normalMap, uv2)*3.0) +\n                 (texture2D(normalMap, uv3)*3.0);\n    return noise/4.0-1.0;\n}\nvoid sunLight(const vec3 surfaceNormal, const vec3 eyeDirection, float shiny, float spec, float diffuse,\n              inout vec3 diffuseColor, inout vec3 specularColor){\n    vec3 reflection = normalize(reflect(-sunDir, surfaceNormal));\n    float direction = max(0.0, dot(eyeDirection, reflection));\n    specularColor += pow(direction, shiny)*sunColor*spec;\n    diffuseColor += max(dot(sunDir, surfaceNormal),0.0)*sunColor*diffuse;\n}\nvoid main(void)\n{\n\tvec2 projCoord = viewCoords.xy / viewCoords.q;\n\tprojCoord = (projCoord + 1.0) * 0.5;\n\tfloat fs = camFar * fogStart;\n\tfloat fogDist = clamp(max(viewCoords.z - fs, 0.0)/(camFar - camNear - fs), 0.0, 1.0);\n\tvec3 coarseNormal = texture2D(normalMapCoarse, projCoord).xyz * 2.0 - 1.0;\n\tvec2 normCoords = texCoord0;\n\tvec4 noise = getNoise(normCoords);\n\tvec3 normalVector = normalize(noise.xyz * vec3(1.8 * detailStrength, 1.8 * detailStrength, 1.0) + coarseNormal.xyz * vec3(1.8 * coarseStrength, 1.8 * coarseStrength, 1.0));\n\tvec3 localView = normalize(eyeVec);\n\tfloat fresnel = dot(normalize(normalVector*vec3(1.0, 1.0, 1.0)), localView);\n\tif ( abovewater == false ) {\n\t\tfresnel = -fresnel;\n\t}\n\tfloat fresnelTerm = 1.0 - fresnel;\n\tfresnelTerm *= fresnelTerm;\n\tfresnelTerm *= fresnelTerm;\n\tfresnelTerm = fresnelTerm * 0.95 + 0.05;\n\tif ( abovewater == true ) {\n\t\tprojCoord.x = 1.0 - projCoord.x;\n\t}\n\tprojCoord += (normalVector.xy * 0.05);\n\tprojCoord = clamp(projCoord, 0.001, 0.999);\n vec4 waterColorX = vec4(waterColor / 255.0, 1.0);\n\tvec4 reflectionColor = texture2D(reflection, projCoord);\n\tif ( abovewater == false ) {\n\t\treflectionColor *= vec4(0.8,0.9,1.0,1.0);\n\t\tvec4 endColor = mix(reflectionColor,waterColorX,fresnelTerm);\n\t\tgl_FragColor = mix(endColor,waterColorX,fogDist);\n\t}\n\telse {\n\t\tvec3 diffuse = vec3(0.0);\n\t\tvec3 specular = vec3(0.0);\n\t    sunLight(normalVector, localView, 100.0, 2.0, 0.4, diffuse, specular);\n\t\tvec4 endColor = mix(waterColorX,reflectionColor,fresnelTerm);\n\t\tgl_FragColor = mix(vec4(diffuse*0.0 + specular, 1.0) + mix(endColor,reflectionColor,fogDist), fogColor, fogDist);\n\t}\n\tif (grid) {\n\t\tvec2 low = abs(fract(texCoord1*density)-0.5);\n\t\tfloat dist = 1.0 - step(min(low.x, low.y), 0.05);\n\t\tgl_FragColor *= vec4(dist);\n\t}\n}"},
o={attributes:{vertexPosition:e.POSITION},uniforms:{viewMatrix:c.VIEW_MATRIX,projectionMatrix:c.PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,time:c.TIME},vshader:"attribute vec3 vertexPosition;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec4 worldPos;\nvarying vec4 viewCoords;\nvoid main(void) {\n\tworldPos = worldMatrix * vec4(vertexPosition, 1.0);\n\tviewCoords = viewMatrix * worldPos;\n\tgl_Position = projectionMatrix * viewMatrix * worldPos;\n}",
fshader:["precision mediump float;\nuniform float time;\nvarying vec4 worldPos;\nvarying vec4 viewCoords;",h.noise3d,"vec4 getNoise(sampler2D map, vec2 uv) {\n    vec2 uv0 = (uv/223.0)+vec2(time/17.0, time/29.0);\n    vec2 uv1 = uv/327.0-vec2(time/-19.0, time/31.0);\n    vec2 uv2 = uv/vec2(697.0, 983.0)+vec2(time/151.0, time/147.0);\n    vec2 uv3 = uv/vec2(791.0, 877.0)-vec2(time/259.0, time/263.0);\n    vec4 noise = (texture2D(map, uv0)*0.0) +\n                 (texture2D(map, uv1)*0.0) +\n                 (texture2D(map, uv2)*0.0) +\n                 (texture2D(map, uv3)*10.0);\n    return noise/5.0-1.0;\n}\nvoid main(void)\n{\n\tfloat fogDist = clamp(-viewCoords.z / 1000.0, 0.0, 1.0);\n\tgl_FragColor = vec4((snoise(vec3(worldPos.xz * 0.008, time * 0.4))+snoise(vec3(worldPos.xz * 0.02, time * 0.8))*0.5)/10.0);\n}"].join("\n")};
return l});define("goo/animation/state/AbstractFiniteState",[],function(){function e(){this._globalStartTime=0;this._lastOwner=null}e.prototype.resetClips=function(c,b){this._globalStartTime=isNaN(b)?c.getCurrentGlobalTime():b};return e});
define("goo/animation/state/SteadyState",["goo/animation/state/AbstractFiniteState"],function(e){function c(b){e.call(this);this._name=b;this._transitions={};this._sourceTree=this._endTransition=null}c.prototype=Object.create(e.prototype);c.prototype.doTransition=function(b,a){var c=this._transitions[b];return c?c.doTransition(this,a):null};c.prototype.update=function(b,a){if(!this._sourceTree.setTime(b,a._manager)){var c=this._lastOwner;if(this._endTransition!==null){var d=this._endTransition.doTransition(this,
a);d&&(d.resetClips(a.getManager()),d.update(b,a));this!==d&&c.replaceState(this,d)}}};c.prototype.postUpdate=function(b){if(!this._sourceTree.isActive(b._manager))b=this._lastOwner,this._endTransition===null&&b.replaceState(this,null)};c.prototype.getCurrentSourceData=function(b){return this._sourceTree.getSourceData(b)};c.prototype.resetClips=function(b,a){e.prototype.resetClips.call(this,b,a);this._sourceTree.resetClips(b,this._globalStartTime)};return c});
define("goo/animation/layer/AnimationLayer",["goo/animation/state/SteadyState"],function(e){function c(b){this._name=b;this._steadyStates={};this._layerBlender=this._manager=this._currentState=null;this._transitions={}}c.BASE_LAYER_NAME="-BASE_LAYER-";c.prototype.doTransition=function(b){var a=this._currentState;if(a instanceof e){var c=a.doTransition(b,this);c||((b=this._transitions[b])||(b=this._transitions["*"]),b&&(c=b.doTransition(a,this)));if(c&&c!==a)return this.setCurrentState(c,!1),!0}else if(!a&&
((b=this._transitions[b])||(b=this._transitions["*"]),b))return this.setCurrentState(b.doTransition(a,this),!0),!0;return!1};c.prototype.setCurrentState=function(b,a){if(this._currentState=b)b._lastOwner=this,a&&b.resetClips(this._manager)};c.prototype.setCurrentStateByName=function(b,a){if(b){var c=this._steadyStates[b];if(c)return this.setCurrentState(c,a),!0;else console.warn("unable to find SteadyState named: "+b)}return!1};c.prototype.getCurrentSourceData=function(){return this._layerBlender!==
null?this._layerBlender.getBlendedSourceData(this._manager):this._currentState!==null?this._currentState.getCurrentSourceData(this._manager):null};c.prototype.updateLayerBlending=function(b){if(this._layerBlender)this._layerBlender._layerA=b,this._layerBlender._layerB=this};c.prototype.clearCurrentState=function(){this.setCurrentState(null,!1)};c.prototype.replaceState=function(b,a){this._currentState===b&&this.setCurrentState(a,!1)};return c});
define("goo/animation/clip/AnimationClipInstance",[],function(){function e(){this._active=!0;this._loopCount=0;this._timeScale=1;this._prevUnscaledClockTime=this._prevClockTime=this._startTime=0;this._clipStateObjects={};this._animationListeners=[]}e.prototype.setTimeScale=function(c,b){if(this._active&&this._timeScale!==c)if(this._timeScale!==0&&c!==0){var a=b.globalTime,f=a-this._startTime;f*=this._timeScale;f/=c;this._startTime=a-f}else if(this._timeScale===0)a=b.globalTime,this._startTime=a-this._prevUnscaledClockTime;
this._timeScale=c};e.prototype.getApplyTo=function(c){var b=c._channelName,a=this._clipStateObjects[b];a||(a=c.createStateDataObject(),this._clipStateObjects[b]=a);return a};e.prototype.fireAnimationFinished=function(){for(var c=0,b=this._animationListeners.length;c<b;c++)this._animationListeners[c].animationFinished(this)};return e});
define("goo/animation/AnimationManager",["goo/animation/layer/AnimationLayer","goo/animation/clip/AnimationClipInstance"],function(e,c){function b(a){this.globalTime=0;this._layers=[];this._applier=null;this._clipInstances={};this._updateRate=1/60;this._lastUpdate=0;var b=new e(e.BASE_LAYER_NAME);b._manager=this;this._layers.push(b);this._applyToPoses=[];a&&this._applyToPoses.push(a);this._valuesStore={}}b.prototype.update=function(a){this.globalTime+=a;a=this.globalTime;if(this._updateRate!==0){if(a-
this._lastUpdate<this._updateRate)return;this._lastUpdate=a-(a-this._lastUpdate)%this._updateRate}for(var b=0,c=this._layers.length;b<c;b++){var e=this._layers[b],j=e._currentState;j&&j.update(a,e)}b=0;for(c=this._applyToPoses.length;b<c;b++)this._applier.applyTo(this._applyToPoses[b],this);this._entityManager&&this._applier.apply(this._entityManager,this);b=0;for(c=this._layers.length;b<c;b++)e=this._layers[b],(j=e._currentState)&&j.postUpdate(e)};b.prototype.getClipInstance=function(a){var b=this._clipInstances[a];
if(!b)b=new c,b._startTime=this.globalTime,this._clipInstances[a]=b;return b};b.prototype.getCurrentSourceData=function(){for(var a=0,b=this._layers.length-1;a<b;a++)this._layers[a+1].updateLayerBlending(this._layers[a]);return this._layers[this._layers.length-1].getCurrentSourceData()};b.prototype.getCurrentGlobalTime=function(){return this.globalTime};b.prototype.resetClipInstance=function(a,b){var c=this.getClipInstance(a);if(c)c._startTime=b,c._active=!0};b.prototype.getBaseAnimationLayer=function(){return this._layers[0]};
b.prototype.findAnimationLayer=function(a){for(var b=0,c=this._layers.length;b<c;b++){var e=this._layers[b];if(a===e._name)return e}return null};b.prototype.addAnimationLayer=function(a){this._layers.push(a);a._manager=this;return this._layers.length-1};return b});define("goo/animation/Joint",["goo/math/Transform"],function(e){function c(b){this._name=b;this._parentIndex=this._index=0;this._inverseBindPose=new e}c.NO_PARENT=-32768;return c});
define("goo/animation/Skeleton",["goo/animation/Joint"],function(e){function c(b,a){this._name=b;this._joints=a}c.prototype.copy=function(){for(var b=this._name,a=this._joints,f=[],d=0,g=a.length;d<g;d++){var j=a[d],k=new e(j._name);k._index=j._index;k._parentIndex=j._parentIndex;k._inverseBindPose.copy(j._inverseBindPose);k._inverseBindPose.update();f[d]=k}return new c(b,f)};return c});
define("goo/animation/SkeletonPose",["goo/math/Transform","goo/animation/Joint","goo/math/Matrix4x4"],function(e,c,b){function a(a){this._skeleton=a;this._localTransforms=[];this._globalTransforms=[];this._matrixPalette=[];this._poseListeners=[];for(var a=this._skeleton._joints.length,c=0;c<a;c++)this._localTransforms[c]=new e;for(c=0;c<a;c++)this._globalTransforms[c]=new e;for(c=0;c<a;c++)this._matrixPalette[c]=new b;this.setToBindPose()}a.prototype.setToBindPose=function(){for(var a=new e,b=0;b<
this._localTransforms.length;b++){this._localTransforms[b].copy(this._skeleton._joints[b]._inverseBindPose);this._localTransforms[b].invert(this._localTransforms[b]);var g=this._skeleton._joints[b]._parentIndex;g!==c.NO_PARENT&&(a.multiply(this._skeleton._joints[g]._inverseBindPose,this._localTransforms[b]),this._localTransforms[b].copy(a))}this.updateTransforms()};a.prototype.updateTransforms=function(){for(var a=this._skeleton._joints.length,d=0;d<a;d++){var e=d,j=this._skeleton._joints[e]._parentIndex;
j!==c.NO_PARENT?this._globalTransforms[e].multiply(this._globalTransforms[j],this._localTransforms[e]):this._globalTransforms[e].copy(this._localTransforms[e]);b.combine(this._globalTransforms[e].matrix,this._skeleton._joints[e]._inverseBindPose.matrix,this._matrixPalette[e]);this._matrixPalette[e].transpose()}this.firePoseUpdated()};a.prototype.firePoseUpdated=function(){for(var a=this._poseListeners.length;--a>=0;)this._poseListeners[a].poseUpdated(this)};return a});
define("goo/animation/blendtree/AbstractTwoPartSource",[],function(){return function(e,c,b){this._sourceA=e?e:null;this._sourceB=c?c:null;this._blendKey=b?b:null}});
define("goo/animation/clip/TransformData",["goo/math/Quaternion","goo/math/Vector3"],function(e,c){function b(a){this._rotation=(new e).copy(a?a._rotation:e.IDENTITY);this._scale=(new c).copy(a?a._scale:c.ONE);this._translation=(new c).copy(a?a._translation:c.ZERO)}b.prototype.applyTo=function(a){a.setIdentity();a.rotation.copyQuaternion(this._rotation);a.scale.data.set(this._scale.data);a.translation.data.set(this._translation.data);a.update()};b.prototype.set=function(a){this._rotation.copy(a._rotation);
this._scale.copy(a._scale);this._translation.copy(a._translation)};b.prototype.blend=function(a,c,d){var d=d?d:new b,g=0,j=0,k=0,i=0,h=0,l=0,n,o;o=1-c;n=this._translation;i+=n.x*o;h+=n.y*o;l+=n.z*o;n=this._scale;g+=n.x*o;j+=n.y*o;k+=n.z*o;o=c;n=a._translation;i+=n.x*o;h+=n.y*o;l+=n.z*o;n=a._scale;g+=n.x*o;j+=n.y*o;k+=n.z*o;d._scale.set(g,j,k);d._translation.set(i,h,l);e.slerp(this._rotation,a._rotation,o,d._rotation);return d};return b});
define("goo/animation/blendtree/BinaryLERPSource",["goo/math/MathUtils","goo/animation/clip/TransformData","goo/animation/blendtree/AbstractTwoPartSource"],function(e,c,b){function a(a,c,e){b.call(this,a,c,e)}a.prototype=Object.create(b.prototype);a.prototype.getSourceData=function(b){var c=this._sourceA?this._sourceA.getSourceData(b):null,e=this._sourceB?this._sourceB.getSourceData(b):null;return a.combineSourceData(c,e,b._valuesStore[this._blendKey])};a.prototype.setTime=function(a,b){var c=!1;
this._sourceA&&(c=c||this._sourceA.setTime(a,b));this._sourceB&&(c=c||this._sourceB.setTime(a,b));return c};a.prototype.resetClips=function(a,b){this._sourceA&&this._sourceA.resetClips(a,b);this._sourceB&&this._sourceB.resetClips(a,b)};a.prototype.isActive=function(a){var b=!1;this._sourceA&&(b=b||this._sourceA.isActive(a));this._sourceB&&(b=b||this._sourceB.isActive(a));return b};a.combineSourceData=function(b,d,e,j){if(d){if(!b)return d}else return b;var j=j?j:{},k;for(k in b){var i=b[k],h=d[k];
isNaN(i)?j[k]=i instanceof c?h?i.blend(h,e,j[k]):i:i:a.blendFloatValues(j,k,e,i,h)}for(k in d)j[k]||(j[k]=d[k]);return j};a.blendFloatValues=function(a,b,c,j,k){a[b]=isNaN(k)?j:e.lerp(c,j[0],k[0])};return a});
define("goo/animation/blendtree/ClipSource",["goo/math/MathUtils"],function(e){function c(b,a){this._clip=b;a.getClipInstance(b)}c.prototype.setTime=function(b,a){var c=a.getClipInstance(this._clip),d;if(c._active){c._timeScale!==0?(c._prevUnscaledClockTime=b-c._startTime,d=c._timeScale*c._prevUnscaledClockTime,c._prevClockTime=d):d=c._prevClockTime;var g=this._clip._maxTime;if(g===-1)return!1;if(g!==0&&(c._loopCount===-1||c._loopCount>1&&g*c._loopCount>=Math.abs(d)?d<0?d=g+d%g:d%=g:d<0&&(d=g+d),
d>g||d<0))d=e.clamp(d,0,g),c.fireAnimationFinished(),c._active=!1;this._clip.update(d,c)}return c._active};c.prototype.resetClips=function(b,a){b.resetClipInstance(this._clip,a)};c.prototype.isActive=function(b){return b.getClipInstance(this._clip)._active&&this._clip._maxTime!==-1};c.prototype.getSourceData=function(b){return b.getClipInstance(this._clip)._clipStateObjects};return c});
define("goo/animation/clip/AbstractAnimationChannel",[],function(){function e(c,b){this._channelName=c;this._times=b instanceof Array&&b.length?b.slice(0):[]}e.prototype.getSampleCount=function(){return this._times.length};e.prototype.getMaxTime=function(){return this._times.length?this._times[this._times.length-1]:0};e.prototype.updateSample=function(c,b){if(this._times.length){var a=this._times.length-1;if(c<0||this._times.length===1)this.setCurrentSample(0,0,b);else if(c>=this._times[a])this.setCurrentSample(a,
0,b);else{for(var f=a=0;f<this._times.length-1;f++)this._times[f]<c&&(a=f);this.setCurrentSample(a,(c-this._times[a])/(this._times[a+1]-this._times[a]),b)}}};return e});
define("goo/animation/clip/TransformChannel",["goo/animation/clip/AbstractAnimationChannel","goo/animation/clip/TransformData","goo/math/Quaternion","goo/math/Vector3"],function(e,c,b,a){function f(c,f,j,k,i){e.call(this,c,f);if(j.length/4!==f.length||k.length/3!==f.length||i.length/3!==f.length)throw Error("All provided arrays must be the same length (accounting for type)! Channel: "+c);this._rotations=j.slice(0);this._translations=k.slice(0);this._scales=i.slice(0);this.tmpVec=new a;this.tmpQuat=
new b;this.tmpQuat2=new b}f.prototype=Object.create(e.prototype);f.prototype.createStateDataObject=function(){return new c};f.prototype.setCurrentSample=function(a,c,f){var e=a*4,i=a*3,h=(a+1)*4,a=(a+1)*3;c===0?(f._rotation.data[0]=this._rotations[e+0],f._rotation.data[1]=this._rotations[e+1],f._rotation.data[2]=this._rotations[e+2],f._rotation.data[3]=this._rotations[e+3],f._translation.data[0]=this._translations[i+0],f._translation.data[1]=this._translations[i+1],f._translation.data[2]=this._translations[i+
2],f._scale.data[0]=this._scales[i+0],f._scale.data[1]=this._scales[i+1],f._scale.data[2]=this._scales[i+2]):c===1?(f._rotation.data[0]=this._rotations[h+0],f._rotation.data[1]=this._rotations[h+1],f._rotation.data[2]=this._rotations[h+2],f._rotation.data[3]=this._rotations[h+3],f._translation.data[0]=this._translations[a+0],f._translation.data[1]=this._translations[a+1],f._translation.data[2]=this._translations[a+2],f._scale.data[0]=this._scales[a+0],f._scale.data[1]=this._scales[a+1],f._scale.data[2]=
this._scales[a+2]):(f._rotation.data[0]=this._rotations[e+0],f._rotation.data[1]=this._rotations[e+1],f._rotation.data[2]=this._rotations[e+2],f._rotation.data[3]=this._rotations[e+3],this.tmpQuat.data[0]=this._rotations[h+0],this.tmpQuat.data[1]=this._rotations[h+1],this.tmpQuat.data[2]=this._rotations[h+2],this.tmpQuat.data[3]=this._rotations[h+3],f._rotation.equals(this.tmpQuat)||(b.slerp(f._rotation,this.tmpQuat,c,this.tmpQuat2),f._rotation.setv(this.tmpQuat2)),f._translation.data[0]=this._translations[i+
0],f._translation.data[1]=this._translations[i+1],f._translation.data[2]=this._translations[i+2],this.tmpVec.data[0]=this._translations[a+0],this.tmpVec.data[1]=this._translations[a+1],this.tmpVec.data[2]=this._translations[a+2],f._translation.equals(this.tmpVec)||f._translation.lerp(this.tmpVec,c),f._scale.data[0]=this._scales[i+0],f._scale.data[1]=this._scales[i+1],f._scale.data[2]=this._scales[i+2],this.tmpVec.data[0]=this._scales[a+0],this.tmpVec.data[1]=this._scales[a+1],this.tmpVec.data[2]=
this._scales[a+2],f._scale.equals(this.tmpVec)||f._scale.lerp(this.tmpVec,c))};f.prototype.getTransformData=function(a,b){var f=b?b:new c;f.setRotation(this._rotations[a]);f.setScale(this._scales[a]);f.setTranslation(this._translations[a]);return f};return f});
define("goo/animation/clip/JointData",["goo/animation/clip/TransformData"],function(e){function c(b){e.call(this,b);this._jointIndex=b?b._jointIndex:0}c.prototype=Object.create(e.prototype);c.prototype.set=function(b){e.prototype.set.call(this,b);this._jointIndex=b._jointIndex};c.prototype.blend=function(b,a,f){if(f){if(f instanceof c)f._jointIndex=this._jointIndex}else f=new c,f._jointIndex=this._jointIndex;return e.prototype.blend.call(this,b,a,f)};return c});
define("goo/animation/clip/JointChannel",["goo/animation/clip/TransformChannel","goo/animation/clip/JointData"],function(e,c){function b(a,c,d,g,j,k){e.call(this,b.JOINT_CHANNEL_NAME+c,d,g,j,k);this._jointName=a;this._jointIndex=c}b.prototype=Object.create(e.prototype);b.JOINT_CHANNEL_NAME="_jnt";b.prototype.createStateDataObject=function(){return new c};b.prototype.setCurrentSample=function(a,b,c){e.prototype.setCurrentSample.call(this,a,b,c);c._jointIndex=this._jointIndex};b.prototype.getJointData=
function(a,b){var d=b?b:new c;e.prototype.getTransformData.call(this,a,d);d._jointIndex=this._jointIndex;return d};return b});
define("goo/animation/blendtree/ExclusiveClipSource",["goo/animation/clip/JointChannel","goo/animation/blendtree/ClipSource"],function(e,c){function b(a,b){c.call(this,a,b);this._disabledChannels={}}b.prototype=Object.create(c.prototype);b.prototype.clearDisabled=function(){this._disabledChannels={}};b.prototype.addDisabledChannels=function(){if(arguments.length===1&&typeof arguments[0]==="object")for(var a=0;a<arguments[0].length;a++)this._disabledChannels[arguments[0][a]]=!0;else for(a=0;a<arguments.length;a++)this._disabledChannels[arguments[a]]=
!0};b.prototype.addDisabledJoints=function(){if(arguments.length===1&&typeof arguments[0]==="object")for(var a=0;a<arguments[0].length;a++){var b=e.JOINT_CHANNEL_NAME+arguments[0][a];this._disabledChannels[b]=!0}else for(a=0;a<arguments.length;a++)b=e.JOINT_CHANNEL_NAME+arguments[a],this._disabledChannels[b]=!0};b.prototype.getSourceData=function(a){var a=c.prototype.getSourceData.call(this,a),b={},d;for(d in a)this._disabledChannels[d]||(b[d]=a[d]);return b};return b});
define("goo/animation/blendtree/FrozenClipSource",[],function(){function e(c,b){this._source=c;this._time=b}e.prototype.getSourceData=function(c){return this._source.getSourceData(c)};e.prototype.resetClips=function(c){this._source.resetClips(c,0)};e.prototype.setTime=function(c,b){this._source.setTime(this._time,b);return!0};e.prototype.isActive=function(){return!0};return e});
define("goo/animation/blendtree/InclusiveClipSource",["goo/animation/clip/JointChannel","goo/animation/blendtree/ClipSource"],function(e,c){function b(a,b){c.call(this,a,b);this._enabledChannels={}}b.prototype=Object.create(c.prototype);b.prototype.clearEnabled=function(){this._enabledChannels={}};b.prototype.addEnabledChannels=function(){if(arguments.length===1&&typeof arguments[0]==="object")for(var a=0;a<arguments[0].length;a++)this._enabledChannels[arguments[0][a]]=!0;else for(a=0;a<arguments.length;a++)this._enabledChannels[arguments[a]]=
!0};b.prototype.addEnabledJoints=function(){if(arguments.length===1&&typeof arguments[0]==="object")for(var a=0;a<arguments[0].length;a++){var b=e.JOINT_CHANNEL_NAME+arguments[0][a];this._enabledChannels[b]=!0}else for(a=0;a<arguments.length;a++)b=e.JOINT_CHANNEL_NAME+arguments[a],this._enabledChannels[b]=!0};b.prototype.getSourceData=function(a){var a=c.prototype.getSourceData.call(this,a),b={},d;for(d in this._enabledChannels)this._enabledChannels[d]&&(b[d]=a[d]);return b};return b});
define("goo/animation/blendtree/ManagedTransformSource",["goo/animation/clip/JointChannel","goo/animation/clip/JointData"],function(e,c){function b(a){this._sourceName=a?a:null;this._data={}}b.prototype.resetClips=function(){};b.prototype.setTime=function(){return!0};b.prototype.isActive=function(){return!0};b.prototype.setJointTransformData=function(a,b){var d=e.JOINT_CHANNEL_NAME+a;this._data[d]?this._data[d].set(b):this._data[d]=new c(b)};b.prototype.setJointTranslation=function(a,b){var d=e.JOINT_CHANNEL_NAME+
a;if(this._data[d])this._data[d]._translation.set(b);else{var g=new c;g._jointIndex=a;g._translation.set(b);this._data[d]=g}};b.prototype.setJointScale=function(a,b){var d=e.JOINT_CHANNEL_NAME+a;if(this._data[d])this._data[d]._scale.set(b);else{var g=new c;g._jointIndex=a;g._scale.set(b);this._data[d]=g}};b.prototype.setJointRotation=function(a,b){var d=e.JOINT_CHANNEL_NAME+a;if(this._data[d])this._data[d]._rotation.set(b);else{var g=new c;g._jointIndex=a;g._rotation.set(b);this._data[d]=g}};b.prototype.initJointsByName=
function(a,b,d){for(var g=0,j=d.length;g<j;g++){var k=a._skeleton.findJointByName(d[g]),i=new c;i._jointIndex=k;this.setJointTransformData(k,b.findChannelByName(e.JOINT_CHANNEL_NAME+k).getJointData(0,i))}};b.prototype.initJointsById=function(a,b){for(var d=0,g=b.length;d<g;d++){var j=b[d],k=new c;k._jointIndex=j;this.setJointTransformData(j,a.findChannelByName(e.JOINT_CHANNEL_NAME+j).getJointData(0,k))}};return b});
define("goo/animation/clip/TriggerData",[],function(){function e(){this._currentTriggers=[];this._currentIndex=-1;this._armed=!1}e.prototype.getCurrentTrigger=function(){return this._currentTriggers.length===0?null:this._currentTriggers[this._currentTriggers.size()-1]};e.prototype.arm=function(c,b){if(b===null||b.length===0)this._currentTriggers.length=0,this._armed=!1;else if(c!==this._currentIndex){for(var a=this._currentTriggers.length=0,f=b.length;a<f;a++)this._currentTriggers.push(b[a]);this._armed=
!0}this._currentIndex=c};return e});
define("goo/animation/blendtree/SimpleAnimationApplier",["goo/animation/clip/JointData","goo/animation/clip/TransformData","goo/animation/clip/TriggerData"],function(e,c,b){function a(){this._triggerCallbacks={}}a.prototype.apply=function(a,b){if(a){var g=b.getCurrentSourceData();if(g)for(var j in g){var k=g[j];if(k instanceof c&&!(k instanceof e)){var i=a.getEntityByName(j);i&&i.transformComponent&&k.applyTo(i.transformComponent.transform)}}}};a.prototype.applyTo=function(a,c){var g=c.getCurrentSourceData();
if(g){for(var j in g){var k=g[j];if(k instanceof e)k._jointIndex>=0&&k.applyTo(a._localTransforms[k._jointIndex]);else if(k instanceof b&&k.isArmed()){for(var i=0,h=k._currentTriggers.length;i<h;i++)for(var l=this._triggerCallbacks[k._currentTriggers[i]],n=0,o=l.length;n<o;n++)l[n](a,c);k.setArmed(!1)}}a.updateTransforms()}};return a});
define("goo/animation/clip/AnimationClip",[],function(){function e(c,b){this._name=c;this._channels=b||[];this._maxTime=-1;this.updateMaxTimeIndex()}e.prototype.update=function(c,b){for(var a=0,f=this._channels.length;a<f;++a){var d=this._channels[a],e=b.getApplyTo(d);d.updateSample(c,e)}};e.prototype.addChannel=function(c){this._channels.push(c);this.updateMaxTimeIndex()};e.prototype.removeChannel=function(c){c=this._channels.indexOf(c);return c>=0?(this._channels.splice(c,1),this.updateMaxTimeIndex(),
!0):!1};e.prototype.findChannelByName=function(c){for(var b=0,a=this._channels.length;b<a;++b){var f=this._channels[b];if(c===f._channelName)return f}return null};e.prototype.updateMaxTimeIndex=function(){this._maxTime=-1;for(var c,b=0;b<this._channels.length;b++)if(c=this._channels[b].getMaxTime(),c>this._maxTime)this._maxTime=c};e.prototype.toString=function(){return this._name+this._channels.length};return e});
define("goo/animation/clip/TriggerChannel",["goo/animation/clip/AbstractAnimationChannel","goo/animation/clip/TriggerData"],function(e,c){function b(a,b,c){e.call(this,a,b);this._keys=c?c.slice(0):null}b.prototype=Object.create(e.prototype);b.prototype.createStateDataObject=function(){return new c};b.prototype.setCurrentSample=function(a,b,c){a=b!==1?a:a+1;c.arm(a,[this._keys[a]])};return b});
define("goo/animation/clip/GuaranteedTriggerChannel",["goo/animation/clip/TriggerChannel"],function(e){function c(b,a,c){e.call(this,b,a,c)}c.prototype=Object.create(e.prototype);c.prototype.setCurrentSample=function(b,a,c){var d=c.getCurrentIndex(),b=a!==1?b:b+1;if(d===b)c.arm(b,this._keys[b]);else{a=[];for(d+=1;d<=b;d++)this._keys[d]||a.push(this._keys[d]);c.arm(b,a)}};return c});
define("goo/animation/clip/InterpolatedFloatChannel",["goo/animation/clip/AbstractAnimationChannel","goo/math/MathUtils"],function(e,c){function b(a,b,c){e.call(this,a,b);this._values=c?c.slice(0):null}b.prototype=Object.create(e.prototype);b.prototype.createStateDataObject=function(){return[0]};b.prototype.setCurrentSample=function(a,b,d){d[0]=c.lerp(b,this._values[a],this._values[a+1])};return b});
define("goo/animation/layer/LayerLERPBlender",["goo/animation/blendtree/BinaryLERPSource"],function(e){function c(){this._layerB=this._layerA=this._blendKey=null}c.prototype.getBlendedSourceData=function(b){var a=this._layerA.getCurrentSourceData(),c=this._layerB._currentState?this._layerB._currentState.getCurrentSourceData(b):null;return e.combineSourceData(a,c,b._valuesStore[this._blendKey])};return c});
define("goo/animation/state/AbstractTransitionState",["goo/animation/state/AbstractFiniteState"],function(e){function c(b){e.call(this);this._targetState=b;this._endWindow=this._startWindow=-1}c.prototype=Object.create(e.prototype);c.prototype.doTransition=function(b,a){return!a._currentState?null:this.isInTimeWindow(a._manager.getCurrentGlobalTime()-a._currentState._globalStartTime)?this.getTransitionState(b,a):null};c.prototype.isInTimeWindow=function(b){return this._startWindow<=0?this._endWindow<=
0?!0:b<=this._endWindow:this._endWindow<=0?b>=this._startWindow:this._startWindow<=this._endWindow?this._startWindow<=b&&b<=this._endWindow:b>=this._startWindow||b<=this._endWindow};c.prototype.getTransitionState=function(){return null};return c});define("goo/animation/state/StateBlendType",["goo/util/Enum"],function(e){return new e("Linear","SCurve3","SCurve5")});
define("goo/animation/state/AbstractTwoStateLerpTransition",["goo/animation/state/AbstractTransitionState","goo/animation/state/StateBlendType","goo/animation/blendtree/BinaryLERPSource","goo/math/MathUtils"],function(e,c,b,a){function f(a,b,c){e.call(this,a);this._fadeTime=b;this._type=c;this._start=this._percent=0;this._sourceData=this._stateB=this._stateA=null}f.prototype=Object.create(e.prototype);f.prototype.setStateA=function(a){if(a===this)throw Error("Can not set state A to self.");this._stateA=
a;if(this._stateA!==null)this._stateA._lastOwner=this;if(this._sourceData)this._sourceData={}};f.prototype.setStateB=function(a){if(a===this)throw Error("Can not set state B to self.");this._stateB=a;if(this._stateB!==null)this._stateB._lastOwner=this;if(this._sourceData)this._sourceData={}};f.prototype.update=function(b){b-=this._start;if(b>this._fadeTime)this._lastOwner.replaceState(this,this._stateB);else switch(b/=this._fadeTime,this._blendType){case c.SCurve3:this._percent=a.scurve3(b);break;
case c.SCurve5:this._percent=a.scurve5(b);break;case c.Linear:this._percent=b;break;default:this._percent=b}};f.prototype.getCurrentSourceData=function(a){var c=this._stateA?this._stateA.getCurrentSourceData(a):null,a=this._stateB?this._stateB.getCurrentSourceData(a):null;if(!this._sourceData)this._sourceData={};return b.combineSourceData(c,a,this._percent,this._sourceData)};f.prototype.getCurrentSourceData=function(a){var c=this._stateA?this._stateA.getCurrentSourceData(a):null,a=this._stateB?this._stateB.getCurrentSourceData(a):
null;if(!this._sourceData)this._sourceData={};return b.combineSourceData(c,a,this._percent,this._sourceData)};f.prototype.replaceState=function(a,b){if(b!==null)if(this._stateA===a)this._stateA=b;else if(this._stateB===a)this._stateB=b};return f});
define("goo/animation/state/FadeTransitionState",["goo/animation/state/AbstractTwoStateLerpTransition"],function(e){function c(b,a,c){e.call(this,b,a,c)}c.prototype=Object.create(e.prototype);c.prototype.update=function(b,a){e.prototype.update.call(this,b,a);this._stateA!==null&&this._stateA.update(b,a);this._stateB!==null&&this._stateB.update(b,a)};c.prototype.getTransitionState=function(b,a){this._start=a._manager.getCurrentGlobalTime();this.setStateA(b);this.setStateB(a._steadyStates[this._targetState]);
if(!this._stateB)return null;this._stateB.resetClips(a._manager,this._start);return this};c.prototype.postUpdate=function(b){this._stateA!==null&&this._stateA.postUpdate(b);this._stateB!==null&&this._stateB.postUpdate(b)};return c});
define("goo/animation/state/FrozenTransitionState",["goo/animation/state/AbstractTwoStateLerpTransition"],function(e){function c(b,a,c){e.call(this,b,a,c)}c.prototype=Object.create(e.prototype);c.prototype.update=function(b,a){e.prototype.update.call(this,b,a);this._stateB!==null&&this._stateB.update(b,a)};c.prototype.getTransitionState=function(b,a){this._start=a._manager.getCurrentGlobalTime();this.setStateA(b);this.setStateB(a._steadyStates[this._targetState]);if(!this._stateB)return null;this._stateB.resetClips(a._manager,
this._start);return this};c.prototype.postUpdate=function(b){this._stateB!==null&&this._stateB.postUpdate(b)};return c});define("goo/animation/state/IgnoreTransitionState",["goo/animation/state/AbstractTransitionState"],function(e){function c(){e.call(this,null)}c.prototype=Object.create(e.prototype);c.prototype.update=function(){};c.prototype.getTransitionState=function(b){return b};c.prototype.getCurrentSourceData=function(){return null};c.prototype.postUpdate=function(){};return c});
define("goo/animation/state/ImmediateTransitionState",["goo/animation/state/AbstractTransitionState"],function(e){function c(b){e.call(this,b)}c.prototype=Object.create(e.prototype);c.prototype.getTransitionState=function(b,a){var c=a._steadyStates[this._targetState];if(!c)return null;c.resetClips(a._manager);return c};c.prototype.update=function(){};c.prototype.getCurrentSourceData=function(){return{}};c.prototype.postUpdate=function(){};return c});
define("goo/animation/state/SyncFadeTransitionState",["goo/animation/state/FadeTransitionState"],function(e){function c(b,a,c){e.call(this,b,a,c)}c.prototype=Object.create(e.prototype);c.prototype.getTransitionState=function(b,a){this._start=a._manager.getCurrentGlobalTime();this.setStateA(b);this.setStateB(a._steadyStates[this._targetState]);if(!this._stateB)return null;this._stateB.resetClips(a._manager,this._stateA._globalStartTime);return this};return c});
define("goo/animation/state/loader/OutputStore",[],function(){function e(){this._attachments=[];this._usedClipSources={}}e.prototype.findAttachmentPoint=function(c){for(var b=0,a=this._attachments.length;b<a;b++){var f=this._attachments[b];if(c===f.getName())return f}return null};return e});
define("goo/entities/components/CSSTransformComponent",["goo/entities/components/Component"],function(e){function c(b,a){e.call(this);this.type="CSSTransformComponent";this.domElement=b;this.scale=1;this.faceCamera=typeof a==="undefined"?!1:a}c.prototype=Object.create(e.prototype);return c});
define("goo/entities/EntityUtils",["goo/entities/components/TransformComponent","goo/entities/components/MeshDataComponent","goo/entities/components/MeshRendererComponent","goo/entities/components/CSSTransformComponent"],function(e,c,b,a){function f(){}function d(a,f,k){for(var i=a.createEntity(f.name),h=0;h<f._components.length;h++){var l=f._components[h];if(l instanceof e)i.transformComponent.transform.copy(l.transform);else if(l instanceof c){var n=new c(l.meshData);n.modelBound=new l.modelBound.constructor;
i.setComponent(n)}else if(l instanceof b){for(var o=new b,n=0;n<l.materials.length;n++)o.materials.push(l.materials[n]);i.setComponent(o)}else i.setComponent(l);for(n=0;n<f.transformComponent.children.length;n++)l=d(a,f.transformComponent.children[n].entity,k),i.transformComponent.attachChild(l.transformComponent)}k.callback&&k.callback(i);return i}f.clone=function(a,b,c){console.log("Cloning",c);c=c||{};c.shareData=c.shareData||!0;c.shareMaterial=c.shareMaterial||!0;c.cloneHierarchy=c.cloneHierarchy||
!0;console.log("Share material?",c.shareMaterial);return d(a,b,c)};f.traverse=function(a,b,c){c=c!==void 0?c:0;b(a,c);for(var d=0;d<a.transformComponent.children.length;d++)f.traverse(a.transformComponent.children[d].entity,b,c+1)};f.updateWorldTransform=function(a){a.updateWorldTransform();for(var b=0;b<a.children.length;b++)f.updateWorldTransform(a.children[b])};f.createTypicalEntity=function(a,d,f,e){a=a.createEntity(e);d=new c(d);a.setComponent(d);d=new b;a.setComponent(d);f!==void 0&&d.materials.push(f);
return a};f.createDOMEntity=function(b,c){var d=b.createEntity();d.setComponent(new a(c));return d};return f});
define("goo/entities/systems/TransformSystem",["goo/entities/systems/System"],function(e){function c(){e.call(this,"TransformSystem",["TransformComponent"])}c.prototype=Object.create(e.prototype);c.prototype.process=function(b){var a,c;for(a=0;a<b.length;a++)c=b[a].transformComponent,c._updated=!1,c._dirty&&c.updateTransform();for(a=0;a<b.length;a++)c=b[a].transformComponent,c._dirty&&this.updateWorldTransform(c)};c.prototype.updateWorldTransform=function(b){b.updateWorldTransform();for(var a=0;a<
b.children.length;a++)this.updateWorldTransform(b.children[a])};return c});define("goo/renderer/SimplePartitioner",["goo/renderer/Camera"],function(e){function c(){}c.prototype.added=function(){};c.prototype.removed=function(){};c.prototype.process=function(b,a,c){for(var d=0,g=0;g<a.length;g++){var j=a[g];if(!j.skip)j.meshRendererComponent.cullMode==="Never"?(c[d++]=j,j.isVisible=!0):b.contains(j.meshRendererComponent.worldBound)!==e.Outside?(c[d++]=j,j.isVisible=!0):j.isVisible=!1}c.length=d};return c});
define("goo/entities/systems/RenderSystem",["goo/entities/systems/System","goo/entities/EventHandler","goo/renderer/SimplePartitioner"],function(e,c,b){function a(){e.call(this,"RenderSystem",["MeshRendererComponent","MeshDataComponent"]);this.entities=[];this.renderList=[];this.partitioner=new b;this.preRenderers=[];this.composers=[];this.doRender=!0;this.camera=null;this.lights=[];this.currentTpf=0;var a=this;c.addListener({setCurrentCamera:function(b){a.camera=b},setLights:function(b){a.lights=
b}})}a.prototype=Object.create(e.prototype);a.prototype.inserted=function(a){this.partitioner&&this.partitioner.added(a)};a.prototype.deleted=function(a){this.partitioner&&this.partitioner.removed(a)};a.prototype.process=function(a,b){this.entities=a;this.currentTpf=b};a.prototype.render=function(a){a.checkResize(this.camera);if(this.doRender&&this.camera){for(var b=0;b<this.preRenderers.length;b++)this.preRenderers[b].process(a,this.entities,this.partitioner,this.camera,this.lights);this.partitioner.process(this.camera,
this.entities,this.renderList);if(this.composers.length>0)for(b=0;b<this.composers.length;b++)this.composers[b].render(a,this.currentTpf,this.camera,this.lights);else a.render(this.renderList,this.camera,this.lights)}};return a});
define("goo/renderer/RendererRecord",[],function(){function e(){this.currentBuffer={ArrayBuffer:{buffer:null,valid:!1},ElementArrayBuffer:{buffer:null,valid:!1}};this.currentFrameBuffer=null;this.clippingTestEnabled=this.clippingTestValid=!1;this.clips=[];this.enabledTextures=0;this.texturesValid=!1;this.currentTextureArraysUnit=0;this.textureRecord=[];this.usedProgram=null;this.boundAttributes=[];this.depthRecord={};this.cullRecord={};this.blendRecord={};this.offsetRecord={};this.lineRecord={};this.pointRecord=
{}}e.prototype.invalidateBuffer=function(c){this.currentBuffer[c].buffer=null;this.currentBuffer[c].valid=!1};return e});
define("goo/renderer/shadow/ShadowHandler","goo/math/Vector3,goo/renderer/pass/FullscreenPass,goo/renderer/Camera,goo/renderer/Material,goo/renderer/shaders/ShaderLib,goo/renderer/pass/RenderTarget,goo/math/Vector4".split(","),function(e,c,b,a,f,d,g){function j(){this.shadowY=this.shadowX=512;this.nearZ=1;this.farZ=1E3;this.lightCam=new b(55,1,this.nearZ,this.farZ);this.currentState="Perspective";this.depthMaterial=a.createMaterial(f.lightDepth,"depthMaterial");this.depthMaterial.cullState.cullFace=
"Front";this.shadowTarget=new d(this.shadowX,this.shadowY,{type:"Float"});this.shadowTargetDown=new d(this.shadowX/2,this.shadowY/2,{type:"Float"});this.shadowTargetDown2=new d(this.shadowX/4,this.shadowY/4,{type:"Float"});this.shadowResult=this.shadowBlurred=new d(this.shadowX/4,this.shadowY/4,{type:"Float"});this.fullscreenPass=new c;this.downsample=a.createShader(f.downsample,"downsample");this.boxfilter=a.createShader(f.boxfilter,"boxfilter");this.boxfilter.uniforms.viewport=[this.shadowX/4,this.shadowY/
4];this.oldClearColor=new g(0,0,0,0);this.shadowClearColor=new g(1,1,1,1)}j.prototype.checkShadowRendering=function(a,c,d,f){for(d=a.shadowCount=0;d<f.length;d++){var g=f[d];if(g.shadowCaster){var j=this.lightCam;j.translation.copy(g.translation);g.shadowSettings.projection==="Perspective"&&j.lookAt(e.ZERO,e.UNIT_Y);if(this.currentState!==g.shadowSettings.projection)if(this.currentState=g.shadowSettings.projection,g.shadowSettings.projection==="Perspective")j.setFrustumPerspective(g.shadowSettings.fov,
1,g.shadowSettings.near,g.shadowSettings.far);else if(g.shadowSettings.projection==="Parallel"){var p=g.shadowSettings.size;j.setFrustum(g.shadowSettings.near,g.shadowSettings.far,-p,p,p,-p);j.projectionMode=b.Parallel;j.update()}j.onFrameChange();this.oldClearColor.copy(a.clearColor);a.setClearColor(this.shadowClearColor.r,this.shadowClearColor.g,this.shadowClearColor.b,this.shadowClearColor.a);a.overrideMaterial=this.depthMaterial;a.render(c,j,[],this.shadowTarget,!0,!0);a.overrideMaterial=null;
switch(g.shadowSettings.type){case "Blur":this.fullscreenPass.material.shader=this.downsample;this.fullscreenPass.render(a,this.shadowTargetDown,this.shadowTarget,0);this.fullscreenPass.render(a,this.shadowTargetDown2,this.shadowTargetDown,0);this.fullscreenPass.material.shader=this.boxfilter;this.fullscreenPass.render(a,this.shadowBlurred,this.shadowTargetDown2,0);this.shadowResult=this.shadowBlurred;break;case "None":this.shadowResult=this.shadowTarget;break;default:this.shadowResult=this.shadowBlurred}a.setClearColor(this.oldClearColor.r,
this.oldClearColor.g,this.oldClearColor.b,this.oldClearColor.a);a.shadowCount++}}};return j});
define("goo/renderer/Renderer","goo/renderer/RendererRecord,goo/renderer/Util,goo/renderer/TextureCreator,goo/renderer/pass/RenderTarget,goo/math/Vector4,goo/entities/Entity,goo/renderer/Texture,goo/loaders/dds/DdsLoader,goo/loaders/dds/DdsUtils,goo/renderer/MeshData,goo/renderer/Material,goo/math/Transform,goo/renderer/RenderQueue,goo/renderer/shaders/ShaderLib,goo/renderer/shadow/ShadowHandler".split(","),function(e,c,b,a,f,d,g,j,k,i,h,l,n,o,p){function m(a){var a=a||{},b=a.canvas;if(b===void 0)b=
document.createElement("canvas"),b.width=500,b.height=500;this.domElement=b;this._alpha=a.alpha!==void 0?a.alpha:!1;this._premultipliedAlpha=a.premultipliedAlpha!==void 0?a.premultipliedAlpha:!0;this._antialias=a.antialias!==void 0?a.antialias:!1;this._stencil=a.stencil!==void 0?a.stencil:!1;this._preserveDrawingBuffer=a.preserveDrawingBuffer!==void 0?a.preserveDrawingBuffer:!1;this._onError=a.onError;var c={alpha:this._alpha,premultipliedAlpha:this._premultipliedAlpha,antialias:this._antialias,stencil:this._stencil,
preserveDrawingBuffer:this._preserveDrawingBuffer};this.context=null;try{if(this.context=b.getContext("experimental-webgl",c),!this.context)this.context=b.getContext("webgl",c)}catch(d){}if(!this.context)throw{name:"GooWebGLError",message:"WebGL is not supported! (Could not create WebGL context)"};if(a.debug){var g=new XMLHttpRequest;g.open("GET","/../lib/webgl-debug.js",!1);g.onreadystatechange=function(){g.readyState===4&&g.status>=200&&g.status<=299&&window.eval.call(window,g.responseText)};g.send(null);
typeof window.WebGLDebugUtils==="undefined"?console.warn("You need to include webgl-debug.js in your script definition to run in debug mode."):(console.log("Running in webgl debug mode."),a.validate?(console.log('Running with "undefined arguments" validation.'),this.context=window.WebGLDebugUtils.makeDebugContext(this.context,this.onDebugError.bind(this),s)):this.context=window.WebGLDebugUtils.makeDebugContext(this.context,this.onDebugError.bind(this)))}this.rendererRecord=new e;this.glExtensionCompressedTextureS3TC=
j.SUPPORTS_DDS=k.isSupported(this.context);this.glExtensionTextureFloat=this.context.getExtension("OES_texture_float");this.glExtensionTextureFloatLinear=this.context.getExtension("OES_texture_float_linear");this.glExtensionStandardDerivatives=this.context.getExtension("OES_standard_derivatives");this.glExtensionTextureFilterAnisotropic=this.context.getExtension("EXT_texture_filter_anisotropic")||this.context.getExtension("MOZ_EXT_texture_filter_anisotropic")||this.context.getExtension("WEBKIT_EXT_texture_filter_anisotropic");
this.glExtensionDepthTexture=this.context.getExtension("WEBGL_depth_texture")||this.context.getExtension("WEBKIT_WEBGL_depth_texture")||this.context.getExtension("MOZ_WEBGL_depth_texture");this.glExtensionTextureFloat||console.log("Float textures not supported.");this.glExtensionTextureFloatLinear||console.log("Float textures with linear filtering not supported.");this.glExtensionStandardDerivatives||console.log("Standard derivatives not supported.");this.glExtensionTextureFilterAnisotropic||console.log("Anisotropic texture filtering not supported.");
this.glExtensionCompressedTextureS3TC||console.log("S3TC compressed textures not supported.");this.glExtensionDepthTexture||console.log("Depth textures not supported.");if(this.context.getShaderPrecisionFormat===void 0)this.context.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}};this.capabilities={maxTexSize:this.context.getParameter(q.MAX_TEXTURE_SIZE),maxCubeSize:this.context.getParameter(q.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderbufferSize:this.context.getParameter(q.MAX_RENDERBUFFER_SIZE),
vertexUnits:this.context.getParameter(q.MAX_VERTEX_TEXTURE_IMAGE_UNITS),fragmentUnits:this.context.getParameter(q.MAX_TEXTURE_IMAGE_UNITS),combinedUnits:this.context.getParameter(q.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexAttributes:this.context.getParameter(q.MAX_VERTEX_ATTRIBS),maxVertexShader:this.context.getParameter(q.MAX_VERTEX_UNIFORM_VECTORS),maxFragmentShader:this.context.getParameter(q.MAX_FRAGMENT_UNIFORM_VECTORS),maxVaryingVectors:this.context.getParameter(q.MAX_VARYING_VECTORS),vertexShaderHighpFloat:this.context.getShaderPrecisionFormat(this.context.VERTEX_SHADER,
this.context.HIGH_FLOAT),vertexShaderMediumpFloat:this.context.getShaderPrecisionFormat(this.context.VERTEX_SHADER,this.context.MEDIUM_FLOAT),vertexShaderLowpFloat:this.context.getShaderPrecisionFormat(this.context.VERTEX_SHADER,this.context.LOW_FLOAT),fragmentShaderHighpFloat:this.context.getShaderPrecisionFormat(this.context.FRAGMENT_SHADER,this.context.HIGH_FLOAT),fragmentShaderMediumpFloat:this.context.getShaderPrecisionFormat(this.context.FRAGMENT_SHADER,this.context.MEDIUM_FLOAT),fragmentShaderLowpFloat:this.context.getShaderPrecisionFormat(this.context.FRAGMENT_SHADER,
this.context.LOW_FLOAT),vertexShaderHighpInt:this.context.getShaderPrecisionFormat(this.context.VERTEX_SHADER,this.context.HIGH_INT),vertexShaderMediumpInt:this.context.getShaderPrecisionFormat(this.context.VERTEX_SHADER,this.context.MEDIUM_INT),vertexShaderLowpInt:this.context.getShaderPrecisionFormat(this.context.VERTEX_SHADER,this.context.LOW_INT),fragmentShaderHighpInt:this.context.getShaderPrecisionFormat(this.context.FRAGMENT_SHADER,this.context.HIGH_INT),fragmentShaderMediumpInt:this.context.getShaderPrecisionFormat(this.context.FRAGMENT_SHADER,
this.context.MEDIUM_INT),fragmentShaderLowpInt:this.context.getShaderPrecisionFormat(this.context.FRAGMENT_SHADER,this.context.LOW_INT)};this.shaderPrecision=a.shaderPrecision||"highp";this.shaderPrecision=this.shaderPrecision==="highp"&&this.capabilities.vertexShaderHighpFloat.precision>0&&this.capabilities.fragmentShaderHighpFloat.precision>0?"highp":this.shaderPrecision!=="lowp"&&this.capabilities.vertexShaderMediumpFloat.precision>0&&this.capabilities.fragmentShaderMediumpFloat.precision>0?"mediump":
"lowp";console.log("Shader precision: "+this.shaderPrecision);this.downScale=a.downScale||1;this.clearColor=new f;this.setClearColor(0.3,0.3,0.3,1);this.context.clearDepth(1);this.context.clearStencil(0);this.context.stencilMask(0);this.context.enable(q.DEPTH_TEST);this.context.depthFunc(q.LEQUAL);this.currentHeight=this.currentWidth=this.viewportHeight=this.viewportWidth=this.viewportY=this.viewportX=0;this.overrideMaterial=null;this.renderQueue=new n;this.info={calls:0,vertices:0,indices:0,reset:function(){this.indices=
this.vertices=this.calls=0},toString:function(){return"Calls: "+this.calls+" Vertices: "+this.vertices+" Indices: "+this.indices}};this.shadowCount=0;this.shadowHandler=null}function s(a,b){for(var c=0;c<b.length;++c)b[c]===void 0&&console.error("undefined passed to gl."+a+"("+window.WebGLDebugUtils.glFunctionArgsToString(a,b)+")")}var q=window.WebGLRenderingContext;m.prototype.onDebugError=function(a,b,c){for(var a="WebGL error "+window.WebGLDebugUtils.glEnumToString(a)+" in "+b+"(",d=0;d<c.length;++d)a+=
(d===0?"":", ")+window.WebGLDebugUtils.glFunctionArgToString(b,d,c[d]);a+=")";console.error(a);this._onError&&this._onError(a)};m.mainCamera=null;m.prototype.checkResize=function(a){var b=this.domElement.offsetWidth/this.downScale,c=this.domElement.offsetHeight/this.downScale;(b!==this.domElement.width||c!==this.domElement.height)&&this.setSize(b,c);b=this.domElement.width/this.domElement.height;if(a&&a.aspect!==b)a.aspect=b,a.setFrustumPerspective(),a.onFrameChange()};m.prototype.setSize=function(a,
b){this.domElement.width=a;this.domElement.height=b;this.setViewport(0,0,a,b)};m.prototype.setViewport=function(a,b,c,d){this.viewportX=a!==void 0?a:0;this.viewportY=b!==void 0?b:0;this.viewportWidth=c!==void 0?c:this.domElement.width;this.viewportHeight=d!==void 0?d:this.domElement.height;this.context.viewport(this.viewportX,this.viewportY,this.viewportWidth,this.viewportHeight)};m.prototype.setClearColor=function(a,b,c,d){this.clearColor.set(a,b,c,d);this.context.clearColor(a,b,c,d)};m.prototype.bindData=
function(a){var b=a.glBuffer;if(b!==null){if(this.setBoundBuffer(b,a.target),a._dataNeedsRefresh)this.context.bufferSubData(this.getGLBufferTarget(a.target),0,a.data),a._dataNeedsRefresh=!1}else b=this.context.createBuffer(),a.glBuffer=b,this.rendererRecord.invalidateBuffer(a.target),this.setBoundBuffer(b,a.target),this.context.bufferData(this.getGLBufferTarget(a.target),a.data,this.getGLBufferUsage(a._dataUsage))};m.prototype.render=function(a,b,c,d,f,e){if(b){if(m.mainCamera===null)m.mainCamera=
b;if(!e)if(this.shadowHandler)this.shadowHandler.checkShadowRendering(this,a,b,c);else for(e=0;e<c.length;e++)if(c[e].shadowCaster){this.shadowHandler=new p;break}this.setRenderTarget(d);f===void 0||f===null||f===!0?this.clear():typeof f==="object"&&this.clear(f.color,f.depth,f.stencil);c={camera:b,mainCamera:m.mainCamera,lights:c,lightCamera:this.shadowHandler?this.shadowHandler.lightCam:null,renderer:this};if(Array.isArray(a)){this.renderQueue.sort(a,b);for(e=0;e<a.length;e++)this.fillRenderInfo(a[e],
c),this.renderMesh(c)}else this.fillRenderInfo(a,c),this.renderMesh(c)}};m.prototype.fillRenderInfo=function(a,b){a instanceof d?(b.meshData=a.meshDataComponent.meshData,b.materials=a.meshRendererComponent.materials,b.transform=a.particleComponent?l.IDENTITY:a.transformComponent.worldTransform):(b.meshData=a.meshData,b.materials=a.materials,b.transform=a.transform)};m.prototype.renderMesh=function(a){var r;var b=a.meshData;if(!(b.vertexData===null||b.vertexData!==null&&b.vertexData.data.byteLength===
0||b.indexData!==null&&b.indexData.data.byteLength===0)){this.bindData(b.vertexData);var c=a.materials;this.overrideMaterial!==null&&(c=this.overrideMaterial instanceof Array?this.overrideMaterial:[this.overrideMaterial]);for(var d=!1,f=b,e=0;e<c.length;e++){var g=c[e];if(g.shader){g.errorOnce=!1;this.shadowCount>0?g.setTexture("SHADOW_MAP",this.shadowHandler.shadowResult):g.getTexture("SHADOW_MAP")&&g.removeTexture("SHADOW_MAP");if(g.wireframe&&!d){if(!b.wireframeData)b.wireframeData=this.buildWireframeData(b);
b=b.wireframeData;this.bindData(b.vertexData);if(!g.wireframeMaterial)g.wireframeMaterial=h.createMaterial(o.simpleColored,"Wireframe");g.wireframeMaterial.uniforms.color=g.wireframeColor||[1,1,1];g=g.wireframeMaterial;d=!0}else!g.wireframe&&d&&(b=f,this.bindData(b.vertexData),d=!1);a.material=g;var i=g.shader;if(i.processors||i.defines){if(i.processors)for(var k=0;k<i.processors.length;k++)i.processors[k](i,a);for(var j=Object.keys(i.defines),l=j.length,m=[],k=0;k<l;k++){var n=j[k];m.push(n+"_"+
i.defines[n])}m.sort();k=m.join("_")+"_"+i.name;j=this.rendererRecord.shaderCache=this.rendererRecord.shaderCache||{};if(j[k]){if(i=j[k],i!==g.shader){for(n in g.shader.uniforms)i.uniforms[n]=g.shader.uniforms[n];g.shader=i}}else r=g.shader=i.clone(),i=r,j[k]=i,console.log("Shader not in cache, adding:",k,i.name)}i.apply(a,this);this.updateDepthTest(g);this.updateCulling(g);this.updateBlending(g);this.updateOffset(g);this.updateTextures(g);this.updateLineAndPointSettings(g);b.getIndexBuffer()!==null?
(this.bindData(b.getIndexData()),b.getIndexLengths()!==null?this.drawElementsVBO(b.getIndexBuffer(),b.getIndexModes(),b.getIndexLengths()):this.drawElementsVBO(b.getIndexBuffer(),b.getIndexModes(),[b.getIndexBuffer().length])):b.getIndexLengths()!==null?this.drawArraysVBO(b.getIndexModes(),b.getIndexLengths()):this.drawArraysVBO(b.getIndexModes(),[b.vertexCount]);this.info.calls++;this.info.vertices+=b.vertexCount;this.info.indices+=b.indexCount}else if(!g.errorOnce)console.warn("No shader set on material: "+
g.name),g.errorOnce=!0}}};m.prototype.readPixels=function(a,b,c,d,f){this.context.readPixels(a,b,c,d,q.RGBA,q.UNSIGNED_BYTE,f)};m.prototype.drawElementsVBO=function(a,b,c){for(var d=0,f=0,e=this.getGLArrayType(a),a=this.getGLByteSize(a),g=0;g<c.length;g++){var i=c[g];this.context.drawElements(this.getGLIndexMode(b[f]),i,e,d*a);d+=i;f<b.length-1&&f++}};m.prototype.drawArraysVBO=function(a,b){for(var c=0,d=0,f=0;f<b.length;f++){var e=b[f];this.context.drawArrays(this.getGLIndexMode(a[d]),c,e);c+=e;
d<a.length-1&&d++}};m.prototype.buildWireframeData=function(a){var b=i.defaultMap([i.POSITION]),b=new i(b,a.vertexCount,0);b.indexModes[0]="Lines";var c=a.getIndexBuffer(),d=[],f=0;a.updatePrimitiveCounts();for(var e=0;e<a.getSectionCount();e++)for(var g=a.indexModes[e],h=a.getPrimitiveCount(e),k=0;k<h;k++)switch(g){case "Triangles":case "TriangleFan":case "TriangleStrip":var j=c[a.getVertexIndex(k,0,e)],l=c[a.getVertexIndex(k,1,e)],m=c[a.getVertexIndex(k,2,e)];d[f+0]=j;d[f+1]=l;d[f+2]=l;d[f+3]=m;
d[f+4]=m;d[f+5]=j;f+=6;break;case "Lines":case "LineStrip":j=c[a.getVertexIndex(k,0,e)];l=c[a.getVertexIndex(k,1,e)];d[f+0]=j;d[f+1]=l;f+=2;break;case "LineLoop":j=c[a.getVertexIndex(k,0,e)],l=c[a.getVertexIndex(k,1,e)],k===h-1&&(l=c[a.getVertexIndex(0,0,e)]),d[f+0]=j,d[f+1]=l,f+=2}f>0&&(b.rebuildIndexData(f),b.getAttributeBuffer(i.POSITION).set(a.getAttributeBuffer(i.POSITION)),b.getIndexBuffer().set(d));return b};m.prototype.updateLineAndPointSettings=function(a){var b=this.rendererRecord.lineRecord,
a=a.lineWidth||1;if(b.lineWidth!==a)this.context.lineWidth(a),b.lineWidth=a};m.prototype.updateDepthTest=function(a){var b=this.rendererRecord.depthRecord,a=a.depthState;if(b.enabled!==a.enabled)a.enabled?this.context.enable(q.DEPTH_TEST):this.context.disable(q.DEPTH_TEST),b.enabled=a.enabled;if(b.write!==a.write)a.write?this.context.depthMask(!0):this.context.depthMask(!1),b.write=a.write};m.prototype.updateCulling=function(a){var b=this.rendererRecord.cullRecord,c=a.cullState.cullFace,d=a.cullState.frontFace,
a=a.cullState.enabled;if(b.enabled!==a)a?this.context.enable(q.CULL_FACE):this.context.disable(q.CULL_FACE),b.enabled=a;if(b.cullFace!==c)this.context.cullFace(c==="Front"?q.FRONT:c==="Back"?q.BACK:q.FRONT_AND_BACK),b.cullFace=c;if(b.frontFace!==d){switch(d){case "CCW":this.context.frontFace(q.CCW);break;case "CW":this.context.frontFace(q.CW)}b.frontFace=d}};m.prototype.updateTextures=function(d){for(var f=this.context,e=d.shader.textureSlots,g=0;g<e.length;g++){var i=e[g],h=d.getTexture(i.mapping);
if(h===void 0||h===null||h instanceof a===!1&&(h.image===void 0||h.checkDataReady()===!1))if(i.format==="sampler2D")h=b.DEFAULT_TEXTURE_2D;else if(i.format==="samplerCube")h=b.DEFAULT_TEXTURE_CUBE;i=this.rendererRecord.textureRecord[g];i===void 0&&(i=this.rendererRecord.textureRecord[g]={});h.glTexture===null?(h.glTexture=f.createTexture(),this.updateTexture(f,h,g,i)):h instanceof a===!1&&h.checkNeedsUpdate()?(this.updateTexture(f,h,g,i),h.needsUpdate=!1):this.bindTexture(f,h,g,i);i=h.image!==void 0?
h.image:h;i=c.isPowerOfTwo(i.width)&&c.isPowerOfTwo(i.height);this.updateTextureParameters(h,i)}};m.prototype.updateTextureParameters=function(a,b){var c=this.context,d=a.textureRecord;if(d===void 0)d={},a.textureRecord=d;if(d.magFilter!==a.magFilter){var f=this.getGLType(a.variant);c.texParameteri(f,q.TEXTURE_MAG_FILTER,this.getGLMagFilter(a.magFilter));d.magFilter=a.magFilter}var e=b?a.minFilter:this.getFilterFallback(a.minFilter);if(d.minFilter!==e)f=this.getGLType(a.variant),c.texParameteri(f,
q.TEXTURE_MIN_FILTER,this.getGLMinFilter(e)),d.minFilter=e;e=b?a.wrapS:"EdgeClamp";if(d.wrapS!==e){var f=this.getGLType(a.variant),g=this.getGLWrap(e,c);c.texParameteri(f,q.TEXTURE_WRAP_S,g);d.wrapS=e}e=b?a.wrapT:"EdgeClamp";if(d.wrapT!==e)f=this.getGLType(a.variant),g=this.getGLWrap(e,c),c.texParameteri(f,q.TEXTURE_WRAP_T,g),d.wrapT=e};m.prototype.bindTexture=function(a,b,c,d){if(d.boundTexture===void 0||b.glTexture!==void 0&&d.boundTexture!==b.glTexture)a.activeTexture(q.TEXTURE0+c),a.bindTexture(this.getGLType(b.variant),
b.glTexture),d.boundTexture=b.glTexture};m.prototype.getGLType=function(a){switch(a){case "2D":return q.TEXTURE_2D;case "CUBE":return q.TEXTURE_CUBE_MAP}throw"invalid texture type: "+a;};m.prototype.loadCompressedTexture=function(a,b,c,d){var f=c.image.mipmapSizes,e=0,g=0,i=c.image.width,h=c.image.height,j=k.getDdsExtension(a),l=j.COMPRESSED_RGBA_S3TC_DXT5_EXT;if(c.format==="PrecompressedDXT1")l=j.COMPRESSED_RGB_S3TC_DXT1_EXT;else if(c.format==="PrecompressedDXT1A")l=j.COMPRESSED_RGBA_S3TC_DXT1_EXT;
else if(c.format==="PrecompressedDXT3")l=j.COMPRESSED_RGBA_S3TC_DXT3_EXT;else if(c.format==="PrecompressedDXT5")l=j.COMPRESSED_RGBA_S3TC_DXT5_EXT;else throw Error("Unhandled compression format: "+d.getDataFormat().name());if(typeof f==="undefined"||f===null)d instanceof Uint8Array?a.compressedTexImage2D(b,0,l,i,h,0,d):a.compressedTexImage2D(b,0,l,i,h,0,new Uint8Array(d.buffer,d.byteOffset,d.byteLength));else{c.generateMipmaps=!1;for(j=0;j<f.length;j++)g=f[j],a.compressedTexImage2D(b,j,l,i,h,0,new Uint8Array(d.buffer,
d.byteOffset+e,g)),i=~~(i/2)>1?~~(i/2):1,h=~~(h/2)>1?~~(h/2):1,e+=g;d=1+Math.ceil(Math.log(Math.max(c.image.height,c.image.width))/Math.log(2));e=f[f.length-1];if(f.length<d)for(j=f.length;j<d;j++)e=~~((i+3)/4)*~~((h+3)/4)*c.image.bpp*2,a.compressedTexImage2D(b,j,l,i,h,0,new Uint8Array(e)),i=~~(i/2)>1?~~(i/2):1,h=~~(h/2)>1?~~(h/2):1}};m.prototype.updateTexture=function(a,b,c,d){this.bindTexture(a,b,c,d);a.pixelStorei(q.UNPACK_ALIGNMENT,1);a.pixelStorei(q.UNPACK_FLIP_Y_WEBGL,b.flipY);c=b.image;if(b.variant===
"2D")if(c){if(b.generateMipmaps||c.width>this.capabilities.maxTexSize||c.height>this.capabilities.maxTexSize)this.checkRescale(b,c,c.width,c.height,this.capabilities.maxTexSize),c=b.image;c.isData===!0?c.isCompressed?this.loadCompressedTexture(a,q.TEXTURE_2D,b,c.data):a.texImage2D(q.TEXTURE_2D,0,this.getGLInternalFormat(b.format),c.width,c.height,b.hasBorder?1:0,this.getGLInternalFormat(b.format),this.getGLPixelDataType(b.type),c.data):a.texImage2D(q.TEXTURE_2D,0,this.getGLInternalFormat(b.format),
this.getGLInternalFormat(b.format),this.getGLPixelDataType(b.type),c);b.generateMipmaps&&!c.isCompressed&&a.generateMipmap(q.TEXTURE_2D)}else a.texImage2D(q.TEXTURE_2D,0,this.getGLInternalFormat(b.format),b.width,b.height,0,this.getGLInternalFormat(b.format),this.getGLPixelDataType(b.type),null);else if(b.variant==="CUBE"){if(c&&(b.generateMipmaps||c.width>this.capabilities.maxCubeSize||c.height>this.capabilities.maxCubeSize)){for(d=0;d<g.CUBE_FACES.length;d++)this.checkRescale(b,c.data[d],c.width,
c.height,this.capabilities.maxCubeSize);c=b.image}for(d=0;d<g.CUBE_FACES.length;d++){var f=g.CUBE_FACES[d];c?c.isData===!0?c.isCompressed?this.loadCompressedTexture(a,this.getGLCubeMapFace(f),b,c.data[d]):a.texImage2D(this.getGLCubeMapFace(f),0,this.getGLInternalFormat(b.format),c.width,c.height,b.hasBorder?1:0,this.getGLInternalFormat(b.format),this.getGLPixelDataType(b.type),c.data[d]):a.texImage2D(this.getGLCubeMapFace(f),0,this.getGLInternalFormat(b.format),this.getGLInternalFormat(b.format),
this.getGLPixelDataType(b.type),c.data[d]):a.texImage2D(this.getGLCubeMapFace(f),0,this.getGLInternalFormat(b.format),b.width,b.height,0,this.getGLInternalFormat(b.format),this.getGLPixelDataType(b.type),null)}c&&b.generateMipmaps&&!c.isCompressed&&a.generateMipmap(q.TEXTURE_CUBE_MAP)}};m.prototype.checkRescale=function(a,b,d,f,e){var g=c.nearestPowerOfTwo(d),i=c.nearestPowerOfTwo(f),g=Math.min(g,e),i=Math.min(i,e);if(d!==g||f!==i)e=document.createElement("canvas"),e.width=g,e.height=i,e.getContext("2d").drawImage(b,
0,0,d,f,0,0,g,i),document.body.appendChild(e),e.dataReady=!0,a.image=e,e.parentNode.removeChild(e)};m.prototype.getGLWrap=function(a){switch(a){case "Repeat":return q.REPEAT;case "MirroredRepeat":return q.MIRRORED_REPEAT;case "EdgeClamp":return q.CLAMP_TO_EDGE}throw"invalid WrapMode type: "+a;};m.prototype.getGLInternalFormat=function(a){switch(a){case "RGBA":return q.RGBA;case "RGB":return q.RGB;case "Alpha":return q.ALPHA;case "Luminance":return q.LUMINANCE;case "LuminanceAlpha":return q.LUMINANCE_ALPHA;
default:throw"Unsupported format: "+a;}};m.prototype.getGLPixelDataType=function(a){switch(a){case "UnsignedByte":return q.UNSIGNED_BYTE;case "UnsignedShort565":return q.UNSIGNED_SHORT_5_6_5;case "UnsignedShort4444":return q.UNSIGNED_SHORT_4_4_4_4;case "UnsignedShort5551":return q.UNSIGNED_SHORT_5_5_5_1;case "Float":return q.FLOAT;default:throw"Unsupported type: "+a;}};m.prototype.getFilterFallback=function(a){switch(a){case "NearestNeighborNoMipMaps":case "NearestNeighborNearestMipMap":case "NearestNeighborLinearMipMap":return"NearestNeighborNoMipMaps";
case "BilinearNoMipMaps":case "Trilinear":case "BilinearNearestMipMap":return"BilinearNoMipMaps";default:return"NearestNeighborNoMipMaps"}};m.prototype.getGLMagFilter=function(a){switch(a){case "Bilinear":return q.LINEAR;case "NearestNeighbor":return q.NEAREST}throw"invalid MagnificationFilter type: "+a;};m.prototype.getGLMinFilter=function(a){switch(a){case "BilinearNoMipMaps":return q.LINEAR;case "Trilinear":return q.LINEAR_MIPMAP_LINEAR;case "BilinearNearestMipMap":return q.LINEAR_MIPMAP_NEAREST;
case "NearestNeighborNoMipMaps":return q.NEAREST;case "NearestNeighborNearestMipMap":return q.NEAREST_MIPMAP_NEAREST;case "NearestNeighborLinearMipMap":return q.NEAREST_MIPMAP_LINEAR}throw"invalid MinificationFilter type: "+a;};m.prototype.getGLBufferTarget=function(a){return a==="ElementArrayBuffer"?q.ELEMENT_ARRAY_BUFFER:q.ARRAY_BUFFER};m.prototype.getGLArrayType=function(a){if(a instanceof Uint8Array)return q.UNSIGNED_BYTE;else if(a instanceof Uint16Array)return q.UNSIGNED_SHORT;else if(a instanceof
Uint32Array)return q.UNSIGNED_INT;else if(a instanceof Int8Array)return q.UNSIGNED_BYTE;else if(a instanceof Int16Array)return q.UNSIGNED_SHORT;else if(a instanceof Int32Array)return q.UNSIGNED_INT;return null};m.prototype.getGLByteSize=function(a){if(!(a instanceof Uint8Array))if(a instanceof Uint16Array)return 2;else if(a instanceof Uint32Array)return 4;else if(!(a instanceof Int8Array))if(a instanceof Int16Array)return 2;else if(a instanceof Int32Array)return 4;return 1};m.prototype.getGLCubeMapFace=
function(a){switch(a){case "PositiveX":return q.TEXTURE_CUBE_MAP_POSITIVE_X;case "NegativeX":return q.TEXTURE_CUBE_MAP_NEGATIVE_X;case "PositiveY":return q.TEXTURE_CUBE_MAP_POSITIVE_Y;case "NegativeY":return q.TEXTURE_CUBE_MAP_NEGATIVE_Y;case "PositiveZ":return q.TEXTURE_CUBE_MAP_POSITIVE_Z;case "NegativeZ":return q.TEXTURE_CUBE_MAP_NEGATIVE_Z}throw"Invalid cubemap face: "+a;};m.prototype.getGLBufferUsage=function(a){var b=q.STATIC_DRAW;switch(a){case "StaticDraw":b=q.STATIC_DRAW;break;case "DynamicDraw":b=
q.DYNAMIC_DRAW;break;case "StreamDraw":b=q.STREAM_DRAW}return b};m.prototype.getGLIndexMode=function(a){var b=q.TRIANGLES;switch(a){case "Triangles":b=q.TRIANGLES;break;case "TriangleStrip":b=q.TRIANGLE_STRIP;break;case "TriangleFan":b=q.TRIANGLE_FAN;break;case "Lines":b=q.LINES;break;case "LineStrip":b=q.LINE_STRIP;break;case "LineLoop":b=q.LINE_LOOP;break;case "Points":b=q.POINTS}return b};m.prototype.updateBlending=function(a){var b=this.rendererRecord.blendRecord,c=this.context,d=a.blendState.blending;
if(d!==b.blending)d==="NoBlending"?c.disable(q.BLEND):d==="AdditiveBlending"?(c.enable(q.BLEND),c.blendEquation(q.FUNC_ADD),c.blendFunc(q.SRC_ALPHA,q.ONE)):d==="SubtractiveBlending"?(c.enable(q.BLEND),c.blendEquation(q.FUNC_ADD),c.blendFunc(q.ZERO,q.ONE_MINUS_SRC_COLOR)):d==="MultiplyBlending"?(c.enable(q.BLEND),c.blendEquation(q.FUNC_ADD),c.blendFunc(q.DST_COLOR,q.ONE_MINUS_SRC_ALPHA)):d==="AlphaBlending"?(c.enable(q.BLEND),c.blendEquation(q.FUNC_ADD),c.blendFunc(q.SRC_ALPHA,q.ONE_MINUS_SRC_ALPHA)):
d==="CustomBlending"?c.enable(q.BLEND):(c.enable(q.BLEND),c.blendEquationSeparate(q.FUNC_ADD,q.FUNC_ADD),c.blendFuncSeparate(q.SRC_ALPHA,q.ONE_MINUS_SRC_ALPHA,q.ONE,q.ONE_MINUS_SRC_ALPHA)),b.blending=d;if(d==="CustomBlending"){var d=a.blendState.blendEquation,f=a.blendState.blendSrc,a=a.blendState.blendDst;if(d!==b.blendEquation)c.blendEquation(this.getGLBlendParam(d)),b.blendEquation=d;if(f!==b.blendSrc||a!==b.blendDst)c.blendFunc(this.getGLBlendParam(f),this.getGLBlendParam(a)),b.blendSrc=f,b.blendDst=
a}else b.blendEquation=null,b.blendSrc=null,b.blendDst=null};m.prototype.updateOffset=function(a){var b=this.rendererRecord.offsetRecord,c=this.context,d=a.offsetState.enabled,f=a.offsetState.factor,a=a.offsetState.units;if(b.enabled!==d)d?c.enable(q.POLYGON_OFFSET_FILL):c.disable(q.POLYGON_OFFSET_FILL),b.enabled=d;if(d&&(b.factor!==f||b.units!==a))c.polygonOffset(f,a),b.factor=f,b.units=a};m.prototype.setBoundBuffer=function(a,b){var c=this.rendererRecord.currentBuffer[b];if(!c.valid||c.buffer!==
a)this.context.bindBuffer(this.getGLBufferTarget(b),a),c.buffer=a,c.valid=!0};m.prototype.bindVertexAttribute=function(a,b){this.context.vertexAttribPointer(a,b.count,this.getGLDataType(b.type),b.normalized,b.stride,b.offset)};m.prototype.getGLDataType=function(a){switch(a){case "Float":case "HalfFloat":case "Double":return q.FLOAT;case "Byte":return q.BYTE;case "UnsignedByte":return q.UNSIGNED_BYTE;case "Short":return q.SHORT;case "UnsignedShort":return q.UNSIGNED_SHORT;case "Int":return q.INT;case "UnsignedInt":return q.UNSIGNED_INT;
default:throw"Unknown datatype: "+a;}};m.prototype.getGLBlendParam=function(a){switch(a){case "AddEquation":return q.FUNC_ADD;case "SubtractEquation":return q.FUNC_SUBTRACT;case "ReverseSubtractEquation":return q.FUNC_REVERSE_SUBTRACT;case "ZeroFactor":return q.ZERO;case "OneFactor":return q.ONE;case "SrcColorFactor":return q.SRC_COLOR;case "OneMinusSrcColorFactor":return q.ONE_MINUS_SRC_COLOR;case "SrcAlphaFactor":return q.SRC_ALPHA;case "OneMinusSrcAlphaFactor":return q.ONE_MINUS_SRC_ALPHA;case "DstAlphaFactor":return q.DST_ALPHA;
case "OneMinusDstAlphaFactor":return q.ONE_MINUS_DST_ALPHA;case "DstColorFactor":return q.DST_COLOR;case "OneMinusDstColorFactor":return q.ONE_MINUS_DST_COLOR;case "SrcAlphaSaturateFactor":return q.SRC_ALPHA_SATURATE;default:throw"Unknown blend param: "+a;}};m.prototype.clear=function(a,b,c){var d=0;if(a===void 0||a)d|=q.COLOR_BUFFER_BIT;if(b===void 0||b)d|=q.DEPTH_BUFFER_BIT;if(c===void 0||c)d|=q.STENCIL_BUFFER_BIT;this.context.clear(d)};m.prototype.flush=function(){this.context.flush()};m.prototype.finish=
function(){this.context.finish()};m.prototype.setupFrameBuffer=function(a,b,c){this.context.bindFramebuffer(q.FRAMEBUFFER,a);this.context.framebufferTexture2D(q.FRAMEBUFFER,q.COLOR_ATTACHMENT0,c,b.glTexture,0)};m.prototype.setupRenderBuffer=function(a,b){this.context.bindRenderbuffer(q.RENDERBUFFER,a);b.depthBuffer&&!b.stencilBuffer?(this.context.renderbufferStorage(q.RENDERBUFFER,q.DEPTH_COMPONENT16,b.width,b.height),this.context.framebufferRenderbuffer(q.FRAMEBUFFER,q.DEPTH_ATTACHMENT,q.RENDERBUFFER,
a)):b.depthBuffer&&b.stencilBuffer?(this.context.renderbufferStorage(q.RENDERBUFFER,q.DEPTH_STENCIL,b.width,b.height),this.context.framebufferRenderbuffer(q.FRAMEBUFFER,q.DEPTH_STENCIL_ATTACHMENT,q.RENDERBUFFER,a)):this.context.renderbufferStorage(q.RENDERBUFFER,q.RGBA4,b.width,b.height)};m.prototype.setRenderTarget=function(a){if(a&&!a._glFrameBuffer){if(a.depthBuffer===void 0)a.depthBuffer=!0;if(a.stencilBuffer===void 0)a.stencilBuffer=!0;a.glTexture=this.context.createTexture();var b=c.isPowerOfTwo(a.width)&&
c.isPowerOfTwo(a.height),d=this.getGLInternalFormat(a.format),f=this.getGLDataType(a.type);a._glFrameBuffer=this.context.createFramebuffer();a._glRenderBuffer=this.context.createRenderbuffer();this.context.bindTexture(q.TEXTURE_2D,a.glTexture);this.updateTextureParameters(a,b);this.context.texImage2D(q.TEXTURE_2D,0,d,a.width,a.height,0,d,f,null);this.setupFrameBuffer(a._glFrameBuffer,a,q.TEXTURE_2D);this.setupRenderBuffer(a._glRenderBuffer,a);a.generateMipmaps&&b&&this.context.generateMipmap(q.TEXTURE_2D);
this.context.bindTexture(q.TEXTURE_2D,null);this.context.bindRenderbuffer(q.RENDERBUFFER,null);this.context.bindFramebuffer(q.FRAMEBUFFER,null)}var e;a?(b=a._glFrameBuffer,d=a.width,a=a.height,e=f=0):(b=null,d=this.viewportWidth,a=this.viewportHeight,f=this.viewportX,e=this.viewportY);if(b!==this.rendererRecord.currentFrameBuffer)this.context.bindFramebuffer(q.FRAMEBUFFER,b),this.context.viewport(f,e,d,a),this.rendererRecord.currentFrameBuffer=b;this.currentWidth=d;this.currentHeight=a};m.prototype.updateRenderTargetMipmap=
function(a){this.context.bindTexture(q.TEXTURE_2D,a.glTexture);this.context.generateMipmap(q.TEXTURE_2D);this.context.bindTexture(q.TEXTURE_2D,null)};m.prototype._deallocateMeshData=function(){};m.prototype._deallocateTexture=function(){};m.prototype._deallocateRenderTarget=function(){};m.prototype._deallocateShader=function(){};return m});
define("goo/entities/systems/BoundingUpdateSystem",["goo/entities/systems/System"],function(e){function c(){e.call(this,"BoundingUpdateSystem",["TransformComponent","MeshRendererComponent","MeshDataComponent"])}c.prototype=Object.create(e.prototype);c.prototype.process=function(b){for(var a=0;a<b.length;a++){var c=b[a],d=c.meshDataComponent,e=c.transformComponent,c=c.meshRendererComponent;d.autoCompute?(d.computeBoundFromPoints(),c.updateBounds(d.modelBound,e.worldTransform)):e._updated&&c.updateBounds(d.modelBound,
e.worldTransform)}};return c});define("goo/entities/systems/ScriptSystem",["goo/entities/systems/System"],function(e){function c(){e.call(this,"ScriptSystem",["ScriptComponent"])}c.prototype=Object.create(e.prototype);c.prototype.process=function(b,a){for(var c=0;c<b.length;c++)b[c].scriptComponent.run(b[c],a)};return c});
define("goo/entities/systems/LightingSystem",["goo/entities/systems/System","goo/entities/EventHandler"],function(e,c){function b(){e.call(this,"LightingSystem",["LightComponent","TransformComponent"]);this.lights=[]}b.prototype=Object.create(e.prototype);b.prototype.addedComponent=function(a,b){b.type==="LightComponent"&&this.lights.indexOf(b.light)===-1&&(this.lights.push(b.light),c.dispatch("setLights",this.lights))};b.prototype.removedComponent=function(a,b){if(b.type==="LightComponent"){var d=
this.lights.indexOf(b.light);d!==-1&&(this.lights.splice(d,1),c.dispatch("setLights",this.lights))}};b.prototype.process=function(a){for(var b=0;b<a.length;b++){var c=a[b],e=c.transformComponent,c=c.lightComponent;e._updated&&c.updateLight(e.worldTransform)}};return b});
define("goo/entities/managers/LightManager",["goo/entities/EventHandler"],function(e){function c(){this.type="LightManager";this.lights=[]}c.prototype.addedComponent=function(b,a){a.type==="LightComponent"&&this.lights.indexOf(a.light)===-1&&(this.lights.push(a.light),e.dispatch("setLights",this.lights))};c.prototype.removedComponent=function(b,a){if(a.type==="LightComponent"){var c=this.lights.indexOf(a.light);c!==-1&&(this.lights.splice(c,1),e.dispatch("setLights",this.lights))}};return c});
define("goo/entities/systems/CameraSystem",["goo/entities/systems/System","goo/entities/EventHandler","goo/renderer/Renderer"],function(e,c,b){function a(){e.call(this,"CameraSystem",["TransformComponent","CameraComponent"]);this.mainCamera=null}a.prototype=Object.create(e.prototype);a.prototype.findMainCamera=function(){for(var a=null,d=0;d<this._activeEntities.length;d++){var e=this._activeEntities[d].cameraComponent;if(!a||e.isMain)a=e.camera}c.dispatch("setCurrentCamera",a);b.mainCamera=a};a.prototype.inserted=
function(){this.findMainCamera()};a.prototype.deleted=function(){this.findMainCamera()};a.prototype.process=function(a){for(var b=0;b<a.length;b++){var c=a[b],e=c.transformComponent,c=c.cameraComponent;e._updated&&c.updateCamera(e.worldTransform)}};return a});
define("goo/entities/systems/ParticlesSystem",["goo/entities/systems/System"],function(e){function c(){e.call(this,"ParticlesSystem",["TransformComponent","MeshRendererComponent","MeshDataComponent","ParticleComponent"]);this.passive=!1}c.prototype=Object.create(e.prototype);c.prototype.process=function(b,a){if(!(a>1))for(var c=0,d=b.length;c<d;c++){var e=b[c],j=e.particleComponent;if(j.enabled)try{this.updateParticles(e,j,a)}catch(k){console.log(k.stack)}}};c.prototype.updateParticles=function(b,
a,c){for(var d=0,e=-1,j,k=!1,i=!1;d<a.particleCount;){for(;j===void 0;)if(e++,a.emitters.length>e){j=a.emitters[e];if(j.influences.length)for(var h=0,l=j.influences.length;h<l;h++)j.influences[h].prepare(b,j);if(j.enabled){if(j.totalParticlesToSpawn!==0)j.particlesWaitingToRelease+=j.releaseRatePerSecond*c,j.particlesWaitingToRelease=Math.max(j.particlesWaitingToRelease,0),i=!0;j.particlesWaitingToRelease<1&&(j=void 0)}else j=void 0}else j=null;var n=a.particles[d];if(n.alive&&n.emitter&&n.emitter.influences.length){h=
0;for(l=n.emitter.influences.length;h<l;h++)n.emitter.influences[h].enabled&&n.emitter.influences[h].apply(c,n,d)}n.alive&&(n.update(c,b),i=k=!0);if(!n.alive&&j&&(j.particlesWaitingToRelease--,j.totalParticlesToSpawn>=1&&j.totalParticlesToSpawn--,n.respawnParticle(j),j.getEmissionPoint(n,b),j.getEmissionVelocity(n,b),j.particlesWaitingToRelease<1||j.totalParticlesToSpawn===0))j=void 0;d++}if(k)a.meshData.vertexData._dataNeedsRefresh=!0,b.meshDataComponent.autoCompute=!0;if(!i)a.enabled=!1};return c});
define("goo/util/Stats",[],function(){return function(){var e=Date.now(),c=e,b=e,a=0,f=Infinity,d=0,g=0,j=Infinity,k=0,i=0,h=0,l=document.createElement("div");l.id="stats";l.addEventListener("mousedown",function(a){a.preventDefault();v(++h%2)},!1);l.style.cssText="width:80px;cursor:pointer;z-index:1000;-webkit-touch-callout: none;-webkit-user-select: none;-khtml-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;";var n=document.createElement("div");n.id="fps";n.style.cssText=
"padding:0 0 3px 3px;text-align:left;background-color:#002";l.appendChild(n);var o=document.createElement("div");o.id="fpsText";o.style.cssText="color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:8px;font-weight:bold;line-height:13px";o.innerHTML="FPS";n.appendChild(o);var p=document.createElement("div");p.id="fpsGraph";p.style.cssText="position:relative;width:74px;height:30px;background-color:#0ff";for(n.appendChild(p);p.children.length<74;){var m=document.createElement("span");m.style.cssText=
"width:1px;height:30px;float:left;background-color:#113";p.appendChild(m)}var s=document.createElement("div");s.id="ms";s.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;display:none";l.appendChild(s);var q=document.createElement("div");q.id="msText";q.style.cssText="color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:8px;font-weight:bold;line-height:13px";q.innerHTML="MS";s.appendChild(q);var t=document.createElement("div");t.id="msGraph";t.style.cssText="position:relative;width:74px;height:30px;background-color:#0f0";
for(s.appendChild(t);t.children.length<74;)m=document.createElement("span"),m.style.cssText="width:1px;height:30px;float:left;background-color:#131",t.appendChild(m);m=document.createElement("div");m.id="info";m.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#200";l.appendChild(m);var u=document.createElement("div");u.id="infoText";u.style.cssText="color:#f66;font-family:Helvetica,Arial,sans-serif;font-size:8px;font-weight:bold;line-height:13px";u.innerHTML="INFO";m.appendChild(u);
var v=function(a){h=a;switch(h){case 0:n.style.display="block";s.style.display="none";break;case 1:n.style.display="none",s.style.display="block"}};this.domElement=l;this.setMode=v;this.begin=function(){e=Date.now()};this.end=function(h){var l=Date.now();if(l>b+100){a=l-e;f=Math.min(f,a);d=Math.max(d,a);q.textContent=a+" MS ("+f+"-"+d+")";var m=Math.min(30,30-a/200*30);t.appendChild(t.firstChild).style.height=m+"px";b=l;if(h)u.innerHTML="Calls: "+h.calls+"<br>Vertices: "+h.vertices+"<br>Indices: "+
h.indices}i++;if(l>c+1E3)g=Math.round(i*1E3/(l-c)),j=Math.min(j,g),k=Math.max(k,g),o.textContent=g+" FPS ("+j+"-"+k+")",h=Math.min(30,30-g/(Math.min(500,k)+10)*30),p.appendChild(p.firstChild).style.height=h+"px",c=l,i=0;return l};this.update=function(a){e=this.end(a)}}});
define("goo/entities/systems/CSSTransformSystem",["goo/entities/systems/System","goo/renderer/Renderer","goo/math/Matrix4x4","goo/math/MathUtils","goo/math/Vector3"],function(e,c,b,a,f){function d(a){e.call(this,"CSSTransformSystem",["TransformComponent","CSSTransformComponent"]);this.renderer=a;this.viewDom=document.querySelector("#view");this.containerDom=document.querySelector("#cam1");this.containerDom2=document.querySelector("#cam2");this.tmpMatrix=new b;this.tmpMatrix2=new b;this.tmpVector=
new f}d.prototype=Object.create(e.prototype);var g=function(a){return Math.abs(a)<1.0E-6?0:a},j=["","-webkit-","-moz-","-ms-","-o-"],k=function(a,b,c){for(var d=0;d<j.length;d++)a.style[j[d]+b]=c},i=function(a){a=a.data;return"matrix3d("+g(a[0])+","+g(-a[1])+","+g(a[2])+","+g(a[3])+","+g(a[4])+","+g(-a[5])+","+g(a[6])+","+g(a[7])+","+g(a[8])+","+g(-a[9])+","+g(a[10])+","+g(a[11])+","+g(a[12])+","+g(-a[13])+","+g(a[14])+","+g(a[15])+")"};d.prototype.process=function(b){if(b.length!==0){var d=c.mainCamera,
e=0.5/Math.tan(a.DEG_TO_RAD*d.fov*0.5)*this.renderer.domElement.offsetHeight;k(this.viewDom,"perspective",e+"px");this.tmpMatrix.copy(d.getViewInverseMatrix());this.tmpMatrix2.copy(this.tmpMatrix);this.tmpMatrix.invert();this.tmpMatrix.setTranslation(new f(0,0,e));var g=i(this.tmpMatrix);k(this.containerDom,"transform",g);this.tmpMatrix2.e03=-this.tmpMatrix2.e03;this.tmpMatrix2.e23=-this.tmpMatrix2.e23;this.tmpMatrix2.setRotationFromVector(new f(0,0,0));g=i(this.tmpMatrix2);k(this.containerDom2,"transform",
g);for(e=0;e<b.length;e++){var g=b[e],j=g.getComponent("CSSTransformComponent"),m=j.domElement,s=j.scale,s=[s,-s,s].join(",");j.faceCamera?(g.transformComponent.worldTransform.matrix.getTranslation(this.tmpVector),this.tmpMatrix.copy(d.getViewInverseMatrix()),this.tmpMatrix.setTranslation(this.tmpVector)):this.tmpMatrix.copy(g.transformComponent.worldTransform.matrix);g="translate3d(-50%,-50%,0) "+i(this.tmpMatrix)+"scale3d("+s+")";k(m,"transform",g);m.parentNode!==this.containerDom2&&this.containerDom2.appendChild(m)}}};
return d});define("goo/entities/systems/AnimationSystem",["goo/entities/systems/System"],function(e){function c(){e.call(this,"AnimationSystem",["AnimationComponent"])}c.prototype=Object.create(e.prototype);c.prototype.process=function(b,a){for(var c=0;c<b.length;c++)b[c].animationComponent.update(a)};return c});
define("goo/util/GameUtils",[],function(){function e(){}e.supported={fullscreen:!0,pointerLock:!0};e.toggleFullScreen=function(){document.fullscreenElement?document.cancelFullScreen&&document.cancelFullScreen():document.documentElement.requestFullScreen&&document.documentElement.requestFullScreen()};e.togglePointerLock=function(){document.pointerLockElement?document.exitPointerLock&&document.exitPointerLock():document.documentElement.requestPointerLock&&document.documentElement.requestPointerLock()};
e.initAllShims=function(c){this.initAnimationShims();this.initFullscreenShims(c);this.initPointerLockShims(c)};e.initAnimationShims=function(){for(var c=0,b=["ms","moz","webkit","o"],a=0;a<b.length&&!window.requestAnimationFrame;++a)window.requestAnimationFrame=window[b[a]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[a]+"CancelAnimationFrame"]||window[b[a]+"CancelRequestAnimationFrame"];if(window.requestAnimationFrame===void 0)window.requestAnimationFrame=function(a){var b=Date.now(),
e=Math.max(0,16-(b-c)),j=window.setTimeout(function(){a(b+e)},e);c=b+e;return j};if(window.cancelAnimationFrame===void 0)window.cancelAnimationFrame=function(a){clearTimeout(a)}};e.initFullscreenShims=function(c){function b(){var a=document.createEvent("CustomEvent");a.initCustomEvent("fullscreenchange",!0,!1,null);document.dispatchEvent(a)}function a(){var a=document.createEvent("CustomEvent");a.initCustomEvent("fullscreenerror",!0,!1,null);document.dispatchEvent(a)}var c=c||window,f=(c.HTMLElement||
c.Element).prototype;if(!document.hasOwnProperty("fullscreenEnabled")){var d=function(){if("webkitIsFullScreen"in document)return function(){return document.webkitFullscreenEnabled};if("mozFullScreenEnabled"in document)return function(){return document.mozFullScreenEnabled};e.supported.fullscreen=!1;return function(){return!1}}();Object.defineProperty(document,"fullscreenEnabled",{enumerable:!0,configurable:!1,writeable:!1,get:d})}document.hasOwnProperty("fullscreenElement")||(d=function(){for(var a=
["webkitCurrentFullScreenElement","webkitFullscreenElement","mozFullScreenElement"],b=function(b){return function(){return document[a[b]]}},c=0;c<a.length;c++)if(a[c]in document)return b(c);return function(){return null}}(),Object.defineProperty(document,"fullscreenElement",{enumerable:!0,configurable:!1,writeable:!1,get:d}));document.addEventListener("webkitfullscreenchange",b,!1);document.addEventListener("mozfullscreenchange",b,!1);document.addEventListener("webkitfullscreenerror",a,!1);document.addEventListener("mozfullscreenerror",
a,!1);if(!f.requestFullScreen)f.requestFullScreen=function(){return f.webkitRequestFullScreen?function(){this.webkitRequestFullScreen(c.Element.ALLOW_KEYBOARD_INPUT)}:f.mozRequestFullScreen?function(){this.mozRequestFullScreen()}:function(){}}();if(!document.cancelFullScreen)document.cancelFullScreen=function(){return document.webkitCancelFullScreen||document.mozCancelFullScreen||function(){}}()};e.initPointerLockShims=function(c){function b(){var a=document.createEvent("CustomEvent");a.initCustomEvent("pointerlockchange",
!0,!1,null);document.dispatchEvent(a)}function a(){var a=document.createEvent("CustomEvent");a.initCustomEvent("pointerlockerror",!0,!1,null);document.dispatchEvent(a)}var c=c||window,f=(c.HTMLElement||c.Element).prototype,c=c.MouseEvent.prototype;"movementX"in c||Object.defineProperty(c,"movementX",{enumerable:!0,configurable:!1,writeable:!1,get:function(){return this.webkitMovementX||this.mozMovementX||0}});"movementY"in c||Object.defineProperty(c,"movementY",{enumerable:!0,configurable:!1,writeable:!1,
get:function(){return this.webkitMovementY||this.mozMovementY||0}});if(!navigator.pointer)navigator.pointer=navigator.webkitPointer||navigator.mozPointer;document.addEventListener("webkitpointerlockchange",b,!1);document.addEventListener("webkitpointerlocklost",b,!1);document.addEventListener("mozpointerlockchange",b,!1);document.addEventListener("mozpointerlocklost",b,!1);document.addEventListener("webkitpointerlockerror",a,!1);document.addEventListener("mozpointerlockerror",a,!1);document.hasOwnProperty("pointerLockElement")||
(c=function(){return"webkitPointerLockElement"in document?function(){return document.webkitPointerLockElement}:"mozPointerLockElement"in document?function(){return document.mozPointerLockElement}:function(){return null}}(),Object.defineProperty(document,"pointerLockElement",{enumerable:!0,configurable:!1,writeable:!1,get:c}));if(!f.requestPointerLock)f.requestPointerLock=function(){if(f.webkitRequestPointerLock)return function(){this.webkitRequestPointerLock()};if(f.mozRequestPointerLock)return function(){this.mozRequestPointerLock()};
if(navigator.pointer)return function(){navigator.pointer.lock(this,b,a)};e.supported.pointerLock=!1;return function(){}}();if(!document.exitPointerLock)document.exitPointerLock=function(){return document.webkitExitPointerLock||document.mozExitPointerLock||function(){navigator.pointer&&navigator.pointer.unlock()}}()};return e});
define("goo/util/Logo",[],function(){function e(){}e.blue="#2A3276";e.white="#FFFFFF";var c={color:e.blue,shadow:!1};e.getLogo=function(b){var b=b||{},a;for(a in c)b[a]===void 0&&(b[a]=c[a]);a=document.createElementNS("http://www.w3.org/2000/svg","svg");a.setAttribute("version","1.1");a.setAttribute("xmlns","http://www.w3.org/2000/svg");a.setAttribute("x","0px");a.setAttribute("y","0px");a.setAttribute("viewBox","0 0 396.603 277.343");a.setAttribute("enable-background","new 0 0 396.603 277.343");
a.setAttribute("xml:space","preserve");b.width&&a.setAttribute("width",b.width);b.height&&a.setAttribute("height",b.height);var f=document.createElementNS("http://www.w3.org/2000/svg","g");a.appendChild(f);var d=document.createElementNS("http://www.w3.org/2000/svg","filter");d.setAttribute("id","insetShadow");var e=document.createElementNS("http://www.w3.org/2000/svg","feGaussianBlur");e.setAttribute("in","SourceAlpha");e.setAttribute("stdDeviation","0");var j=document.createElementNS("http://www.w3.org/2000/svg",
"feOffset");j.setAttribute("dx","0");j.setAttribute("dy","-5");j.setAttribute("result","offsetblur");var k=document.createElementNS("http://www.w3.org/2000/svg","feComponentTransfer"),i=document.createElementNS("http://www.w3.org/2000/svg","feFuncA");i.setAttribute("type","linear");i.setAttribute("slope","0.5");k.appendChild(i);var i=document.createElementNS("http://www.w3.org/2000/svg","feMerge"),h=document.createElementNS("http://www.w3.org/2000/svg","feMergeNode"),l=document.createElementNS("http://www.w3.org/2000/svg",
"feMergeNode");l.setAttribute("in","SourceGraphic");i.appendChild(h);i.appendChild(l);d.appendChild(e);d.appendChild(j);d.appendChild(k);d.appendChild(i);f.appendChild(d);e=document.createElementNS("http://www.w3.org/2000/svg","path");e.setAttribute("d","M303.337,46.286c-13.578,0-25.784,5.744-34.396,14.998c-9.86,10.59-26.319,10.59-36.172,0c-8.605-9.254-20.818-14.998-34.402-14.998c-25.936,0-46.971,21.034-46.971,46.978c0,25.936,21.035,46.972,46.971,46.972c13.584,0,25.797-5.744,34.402-14.998c9.853-10.598,26.325-10.598,36.172,0c8.612,9.254,20.818,14.998,34.396,14.998c25.941,0,46.977-21.036,46.977-46.972C350.313,67.32,329.278,46.286,303.337,46.286z M198.296,116.39c-12.785,0-23.146-10.359-23.146-23.144s10.361-23.151,23.146-23.151c12.795,0,23.156,10.367,23.156,23.151S211.091,116.39,198.296,116.39z M303.337,116.407c-12.785,0-23.146-10.36-23.146-23.144c0-12.784,10.36-23.151,23.146-23.151c12.795,0,23.156,10.367,23.156,23.151C326.493,106.047,316.132,116.407,303.337,116.407z M156.18,138.347c-14.087-3.23-22.316-17.482-18.068-31.305c3.704-12.072,2.568-25.511-4.22-37.256C120.927,47.323,92.22,39.63,69.766,52.587C47.317,65.552,39.624,94.26,52.581,116.713c6.795,11.761,17.853,19.462,30.17,22.282c14.084,3.235,22.314,17.497,18.074,31.317c-3.711,12.08-2.582,25.504,4.213,37.264c12.965,22.455,41.666,30.148,64.127,17.178c22.447-12.945,30.148-41.658,17.185-64.111C179.554,148.881,168.497,141.181,156.18,138.347z M104.802,113.287c-11.064,6.387-25.219,2.599-31.604-8.474c-6.397-11.07-2.604-25.225,8.474-31.609c11.057-6.398,25.22-2.598,31.611,8.46C119.673,92.741,115.872,106.897,104.802,113.287z M145.687,207.256c-12.785,0-23.145-10.361-23.145-23.145s10.359-23.15,23.145-23.15c12.797,0,23.156,10.367,23.156,23.15S158.483,207.256,145.687,207.256z");
e.setAttribute("fill",b.color);b.shadow&&(f.appendChild(d),e.setAttribute("style","filter:url(#insetShadow)"));f.appendChild(e);return(new XMLSerializer).serializeToString(a)};return e});
define("goo/entities/GooRunner","goo/entities/World,goo/entities/systems/TransformSystem,goo/entities/systems/RenderSystem,goo/renderer/Renderer,goo/renderer/Material,goo/renderer/Util,goo/renderer/shaders/ShaderLib,goo/entities/systems/BoundingUpdateSystem,goo/entities/systems/ScriptSystem,goo/entities/systems/LightingSystem,goo/entities/managers/LightManager,goo/entities/systems/CameraSystem,goo/entities/systems/ParticlesSystem,goo/util/Stats,goo/entities/systems/CSSTransformSystem,goo/entities/systems/AnimationSystem,goo/util/GameUtils,goo/util/Logo".split(","),function(e,
c,b,a,f,d,g,j,k,i,h,l,n,o,p,m,s,q){function t(d){d=d||{};this.world=new e;this.renderer=new a(d);this.world.setSystem(new k);this.world.setSystem(new c);this.world.setSystem(new l);this.world.setSystem(new p(this.renderer));this.world.setSystem(new n);this.world.setSystem(new j);this.world.setSystem(new i);this.world.setSystem(new m);this.renderSystem=new b;this.world.setSystem(this.renderSystem);this.doRender=this.doProcess=!0;s.initAllShims();this.tpfSmoothingCount=d.tpfSmoothingCount!==void 0?
d.tpfSmoothingCount:10;if(d.showStats)this.stats=new o,this.stats.domElement.style.position="absolute",this.stats.domElement.style.left="10px",this.stats.domElement.style.top="10px",document.body.appendChild(this.stats.domElement);if(d.logo===void 0||d.logo){var f=this._buildLogo(d.logo);document.body.appendChild(f)}this.callbacks=[];this.callbacksPreProcess=[];this.callbacksPreRender=[];this._takeSnapshots=[];var g=this;this.start=-1;this.run=function(a){try{g._updateFrame(a)}catch(b){b instanceof
Error?console.error(b.stack):console.error(b)}};this.animationId=-1;d.manuallyStartGameLoop||this.startGameLoop(this.run);this._addDebugKeys()}var u=[],v=0;t.prototype._updateFrame=function(a){if(this.start<0)this.start=a;var b=(a-this.start)/1E3;if(b<0)this.world.time=0,this.world.tpf=0,e.time=0;else if(b>0.5)this.start=a;else{b=Math.max(Math.min(b,0.5),1.0E-4);u[v]=b;v=(v+1)%this.tpfSmoothingCount;for(var c=b=0;c<u.length;c++)b+=u[c];b/=u.length;this.world.tpf=b;this.world.time+=this.world.tpf;
e.time=this.world.time;this.start=a;for(c=0;c<this.callbacksPreProcess.length;c++)this.callbacksPreProcess[c](this.world.tpf);this.doProcess&&this.world.process();for(c=0;c<this.callbacksPreRender.length;c++)this.callbacksPreRender[c](this.world.tpf);this.renderer.info.reset();this.doRender&&this.renderSystem.render(this.renderer);for(c=0;c<this.callbacks.length;c++)this.callbacks[c](this.world.tpf);this.stats&&this.stats.update(this.renderer.info);if(this._takeSnapshots.length){try{for(var d=this.renderer.domElement.toDataURL(),
c=this._takeSnapshots.length-1;c>=0;c--)this._takeSnapshots[c](d)}catch(f){console.error("Failed to take snapshot",f.message)}this._takeSnapshots=[]}}this.animationId=window.requestAnimationFrame(this.run)};t.prototype._buildLogo=function(a){var b=document.createElement("div"),c=q.getLogo({width:"70px",height:"50px",color:q.blue});b.innerHTML='<a style="text-decoration: none;" href="http://www.gooengine.com" target="_blank"><span style="color: #EEE; font-family: Helvetica, sans-serif; font-size: 11px; display: inline-block; margin-top: 14px; margin-right: -3px; vertical-align: top;">Powered by</span>'+
c+"</a>";b.style.position="absolute";b.style.zIndex="2000";a==="topright"?(b.style.top="10px",b.style.right="10px"):a==="topleft"?(b.style.top="10px",b.style.left="10px"):a==="bottomright"?(b.style.bottom="10px",b.style.right="10px"):a==="bottomleft"?(b.style.bottom="10px",b.style.left="10px"):(b.style.top="10px",b.style.right="10px");b.id="goologo";b.style.webkitTouchCallout="none";b.style.webkitUserSelect="none";b.style.khtmlUserSelect="none";b.style.mozUserSelect="none";b.style.msUserSelect="none";
b.style.userSelect="none";b.ondragstart=function(){return!1};return b};t.prototype._addDebugKeys=function(){var a=!1;document.addEventListener("keyup",function(b){b.which===16&&(a=!1)},!1);document.addEventListener("keydown",function(b){if(b.which===16)a=!0;else if(b.which===32&&a)s.toggleFullScreen();else if(b.which===13&&a)s.togglePointerLock();else if(b.which===49&&a)this.renderer.overrideMaterial=null;else if(b.which===50&&a)this.renderer.overrideMaterial=f.createMaterial(d.clone(g.showNormals),
"OverrideMaterial1");else if(b.which===51&&a)this.renderer.overrideMaterial=f.createMaterial(d.clone(g.simpleLit),"OverrideMaterial2");else if(b.which===52&&a)b=f.createMaterial(d.clone(g.simple),"OverrideMaterial4"),b.wireframe=!0,b.wireframeColor=[0,0,0],this.renderer.overrideMaterial=b;else if(b.which===53&&a){var c=f.createMaterial(d.clone(g.simple),"OverrideMaterial3"),b=f.createMaterial(d.clone(g.simple),"OverrideMaterial4");b.wireframe=!0;b.wireframeColor=[0,0,0];this.renderer.overrideMaterial=
[c,b]}else if(b.which===54&&a)c=f.createMaterial(d.clone(g.simpleLit),"OverrideMaterial2"),b=f.createMaterial(d.clone(g.simple),"OverrideMaterial4"),b.wireframe=!0,b.wireframeColor=[0,0,0],this.renderer.overrideMaterial=[c,b]}.bind(this),!1)};t.prototype.startGameLoop=function(){this.start=-1;this.animationId=window.requestAnimationFrame(this.run)};t.prototype.stopGameLoop=function(){window.cancelAnimationFrame(this.animationId)};t.prototype.takeSnapshot=function(a){this._takeSnapshots.push(a)};return t});
define("goo/entities/components/AnimationComponent",["goo/animation/AnimationManager","goo/entities/components/Component"],function(e,c){function b(a){this.type="AnimationComponent";this.animationManager=a}b.prototype=Object.create(c.prototype);b.prototype.update=function(a){this.animationManager&&this.animationManager.update(a)};return b});
define("goo/entities/components/CameraComponent",["goo/entities/components/Component","goo/math/Vector3"],function(e,c){function b(a){this.type="CameraComponent";this.camera=a;this.leftVec=new c(-1,0,0);this.upVec=new c(0,1,0);this.dirVec=new c(0,0,-1)}b.prototype=Object.create(e.prototype);b.prototype.setUpVector=function(a){a===0?(this.leftVec.setd(0,-1,0),this.upVec.setd(1,0,0),this.dirVec.setd(0,0,-1)):a===2?(this.leftVec.setd(-1,0,0),this.upVec.setd(0,0,1),this.dirVec.setd(0,-1,0)):(this.leftVec.setd(-1,
0,0),this.upVec.setd(0,1,0),this.dirVec.setd(0,0,-1))};b.prototype.updateCamera=function(a){this.camera._left.setv(this.leftVec);a.matrix.applyPostVector(this.camera._left);this.camera._up.setv(this.upVec);a.matrix.applyPostVector(this.camera._up);this.camera._direction.setv(this.dirVec);a.matrix.applyPostVector(this.camera._direction);a.matrix.getTranslation(this.camera.translation);this.camera.update()};return b});
define("goo/entities/components/LightComponent",["goo/entities/components/Component"],function(e){function c(b){this.type="LightComponent";this.light=b}c.prototype=Object.create(e.prototype);c.prototype.updateLight=function(b){this.light.update(b)};return c});
define("goo/particles/ParticleUtils",["goo/math/Vector3"],function(e){function c(){}c.getRandomVelocityOffY=function(b,a,f,d,e){a+=Math.random()*(f-a);f=Math.PI*2*Math.random();b.x=Math.cos(f)*Math.sin(a);b.y=Math.cos(a);b.z=Math.sin(f)*Math.sin(a);e&&c.applyEntityTransformVector(b,e);b.mul(d);return b};c.randomPointInCube=function(b,a,c,d,e){b.x=Math.random()*2*a-a+(e?e.x:0);b.y=Math.random()*2*c-c+(e?e.y:0);b.z=Math.random()*2*d-d+(e?e.z:0);return b};c.createConstantForce=function(b){var a=new e(b);
return{enabled:!0,prepare:function(){},apply:function(b,c){c.velocity.x+=a.x*b;c.velocity.y+=a.y*b;c.velocity.z+=a.z*b}}};c.applyEntityTransformPoint=function(b,a){return!a.transformComponent||!a.transformComponent.worldTransform?b:a.transformComponent.worldTransform.applyForward(b,b)};c.applyEntityTransformVector=function(b,a){return!a.transformComponent||!a.transformComponent.worldTransform?b:a.transformComponent.worldTransform.applyForwardVector(b,b)};c.applyTimeline=function(b,a){for(var c=b.age,
d=b.lifeSpan,e=0,j=0,k=0,i=0,h=d,l=d,n=d,o=d,p=0,m=0,s=null,q=null,t=null,u=null,v=null,r=null,w=null,y=null,x=null,m=0,A=a.length;m<A;m++){var z=a[m];p+=(z.timeOffset?z.timeOffset:0)*d;r===null&&(p>c?z.color!==void 0&&(h=p,r=z):z.color!==void 0&&(e=p,s=z));w===null&&(p>c?z.mass!==void 0&&(l=p,w=z):z.mass!==void 0&&(j=p,q=z));p<=c&&z.uvIndex!==void 0&&(v=z);y===null&&(p>c?z.size!==void 0&&(n=p,y=z):z.size!==void 0&&(k=p,t=z));x===null&&(p>c?z.spin!==void 0&&(o=p,x=z):z.spin!==void 0&&(i=p,u=z))}m=
(c-e)/(h-e);d=s!==null?s.color:[1,1,1,1];r=r!==null?r.color:d;b.color.data[0]=(1-m)*d[0]+m*r[0];b.color.data[1]=(1-m)*d[1]+m*r[1];b.color.data[2]=(1-m)*d[2]+m*r[2];b.color.data[3]=(1-m)*d[3]+m*r[3];m=(c-j)/(l-j);d=q!==null?q.mass:1;r=w!==null?w.mass:d;b.mass=(1-m)*d+m*r;b.uvIndex=v!==null?v.uvIndex:0;m=(c-k)/(n-k);d=t!==null?t.size:1;r=y!==null?y.size:d;b.size=(1-m)*d+m*r;m=(c-i)/(o-i);d=u!==null?u.spin:0;r=x!==null?x.spin:d;b.spin=(1-m)*d+m*r};return c});
define("goo/particles/Particle",["goo/particles/ParticleUtils","goo/math/Vector","goo/math/Vector3","goo/math/Vector4","goo/renderer/MeshData"],function(e,c,b,a,f){function d(c,d){this.alive=!1;this.position=new b;this.velocity=new b;this.lifeSpan=0;this.parent=c;this.age=0;this.index=d;this.color=new a(1,0,0,1);this.spin=this.size=0;this.mass=1;this.emitter=null;this.uvIndex=0;this.lastUVIndex=-1;this.bbX=new b;this.bbY=new b;this.lastColor=new a}var g=new b;d.prototype.respawnParticle=function(a){this.emitter=
a;this.lifeSpan=a.nextParticleLifeSpan();this.alive=!0;this.age=0};d.prototype.update=function(a,d){if(this.alive)if(this.age+=a,this.age>this.lifeSpan)this.kill();else{this.position.add_d(this.velocity.x*a,this.velocity.y*a,this.velocity.z*a);e.applyTimeline(this,this.emitter&&this.emitter.timeline?this.emitter.timeline:this.parent.timeline);if(!c.equals(this.lastColor,this.color)){var i=this.parent.meshData.getAttributeBuffer(f.COLOR);i.set(this.color.data,this.index*16+0);i.set(this.color.data,
this.index*16+4);i.set(this.color.data,this.index*16+8);i.set(this.color.data,this.index*16+12);this.lastColor.setv(this.color)}this.emitter&&this.emitter.getParticleBillboardVectors(this,d);if(this.spin===0)this.bbX.muld(this.size,this.size,this.size),this.bbY.muld(this.size,this.size,this.size);else{var i=Math.cos(this.spin)*this.size,h=Math.sin(this.spin)*this.size,l=this.bbY.x,n=this.bbY.y,o=this.bbY.z;this.bbY.setv(this.bbX);this.bbX.muld(i,i,i).add_d(l*h,n*h,o*h);this.bbY.muld(-h,-h,-h).add_d(l*
i,n*i,o*i)}i=this.parent.meshData.getAttributeBuffer(f.POSITION);b.subv(this.position,this.bbX,g).subv(this.bbY);i.set(g.data,this.index*12+0);b.subv(this.position,this.bbX,g).addv(this.bbY);i.set(g.data,this.index*12+3);b.addv(this.position,this.bbX,g).addv(this.bbY);i.set(g.data,this.index*12+6);b.addv(this.position,this.bbX,g).subv(this.bbY);i.set(g.data,this.index*12+9);if(this.lastUVIndex!==this.uvIndex)i=this.parent.meshData.getAttributeBuffer(f.TEXCOORD0),h=this.uvIndex%this.parent.uRange/
this.parent.uRange,l=1-Math.floor(this.uvIndex/this.parent.vRange)/this.parent.vRange,n=1/this.parent.uRange,o=1/this.parent.vRange,i.set([h+n,l-o],this.index*8+0),i.set([h+n,l],this.index*8+2),i.set([h,l],this.index*8+4),i.set([h,l-o],this.index*8+6),this.lastUVIndex=this.uvIndex}};d.prototype.kill=function(){this.alive=!1;var a=this.parent.meshData.getAttributeBuffer(f.POSITION),b=a.subarray(this.index*12,this.index*12+3);a.set(b,this.index*12+3);a.set(b,this.index*12+6);a.set(b,this.index*12+9)};
return d});
define("goo/particles/ParticleEmitter",["goo/particles/ParticleUtils","goo/renderer/Renderer"],function(e,c){function b(a){a=a||{};this.totalParticlesToSpawn=!isNaN(a.totalParticlesToSpawn)?a.totalParticlesToSpawn:-1;this.maxLifetime=!isNaN(a.maxLifetime)?a.maxLifetime:3;this.minLifetime=!isNaN(a.minLifetime)?a.minLifetime:2;this.timeline=a.timeline?a.timeline:void 0;this.influences=a.influences?a.influences:[];this.getEmissionPoint=a.getEmissionPoint?a.getEmissionPoint:function(a,b){var c=a.position;
c.setd(0,0,0);return e.applyEntityTransformPoint(c,b)};this.getEmissionVelocity=a.getEmissionVelocity?a.getEmissionVelocity:function(a,b){var c=a.velocity;c.setd(0,1,0);return e.applyEntityTransformVector(c,b)};this.getParticleBillboardVectors=a.getParticleBillboardVectors?a.getParticleBillboardVectors:b.CAMERA_BILLBOARD_FUNC;this.releaseRatePerSecond=!isNaN(a.releaseRatePerSecond)?a.releaseRatePerSecond:10;this.particlesWaitingToRelease=0;this.enabled=a.enabled!==void 0?a.enabled===!0:!0}b.CAMERA_BILLBOARD_FUNC=
function(a){var b=c.mainCamera;a.bbX.setv(b._left);a.bbY.setv(b._up)};b.prototype.nextParticleLifeSpan=function(){return this.minLifetime+(this.maxLifetime-this.minLifetime)*Math.random()};return b});
define("goo/entities/components/ParticleComponent",["goo/entities/components/Component","goo/particles/Particle","goo/particles/ParticleEmitter","goo/renderer/MeshData"],function(e,c,b,a){function f(a){this.type="ParticleComponent";e.call(this);a=a||{};this.emitters=[];if(a.emitters)for(var c=0,f=a.emitters.length;c<f;c++)this.emitters.push(new b(a.emitters[c]));this.timeline=a.timeline?a.timeline:[];this.uRange=isNaN(a.uRange)?1:a.uRange;this.vRange=isNaN(a.vRange)?1:a.vRange;this.recreateParticles(isNaN(a.particleCount)?
100:a.particleCount);this.enabled=!0}f.prototype=Object.create(e.prototype);f.prototype.generateMeshData=function(){var b=a.defaultMap([a.POSITION,a.COLOR,a.TEXCOORD0]);this.meshData=new a(b,this.particleCount*4,this.particleCount*6);for(var b=this.meshData.getAttributeBuffer(a.TEXCOORD0),c=this.meshData.getIndexBuffer(),f=0,e=this.particleCount;f<e;f++)b.set([1,0],f*8+0),b.set([1,1],f*8+2),b.set([0,1],f*8+4),b.set([0,0],f*8+6),c.set([f*4+0,f*4+3,f*4+1,f*4+1,f*4+3,f*4+2],f*6)};f.prototype.recreateParticles=
function(a){this.particleCount=a;this.particles=[];for(a=0;a<this.particleCount;a++)this.particles[a]=new c(this,a);this.generateMeshData()};return f});
define("goo/entities/components/ScriptComponent",["goo/entities/components/Component"],function(e){function c(b){this.type="ScriptComponent";this.scripts=b instanceof Array?b:b?[b]:[]}c.prototype=Object.create(e.prototype);c.prototype.run=function(b,a){for(var c,d=0,e=this.scripts.length;d<e;d++)(c=this.scripts[d])&&c.run&&(c.enabled===void 0||c.enabled)&&c.run(b,a)};return c});
define("goo/entities/managers/DebugManager",[],function(){function e(){this.type="DebugManager";this._entities={}}e.prototype.added=function(c){this._entities[c.id]=c};e.prototype.removed=function(c){delete this._entities[c.id]};e.prototype.getEntities=function(){var c=[],b;for(b in this._entities)c.push(this._entities[b]);return c};return e});
define("goo/entities/systems/PickingSystem",["goo/entities/systems/System"],function(e){function c(b){e.call(this,"PickingSystem",["MeshRendererComponent","TransformComponent"]);this.passive=!0;this.onPick=this.pickRay=null;b=b||{};this.setPickLogic(b.pickLogic||null)}c.prototype=Object.create(e.prototype);c.prototype.setPickLogic=function(b){(this.pickLogic=b)&&this.interests.indexOf("MeshDataComponent")===-1&&this.interests.push("MeshDataComponent")};c.prototype.inserted=function(b){b.meshRendererComponent.isPickable&&
this.pickLogic&&this.pickLogic.added(b)};c.prototype.deleted=function(b){this.pickLogic&&this.pickLogic.removed(b)};c.prototype.process=function(b){if(this.pickRay&&this.onPick){for(var a=[],c=0;c<b.length;c++){var d=b[c],e=d.meshRendererComponent;e.isPickable&&(this.pickLogic?(this.pickLogic.isConstructed(d)||this.pickLogic.added(d),(e=this.pickLogic.getPickResult(this.pickRay,d))&&e.distances&&e.distances.length&&a.push({entity:d,intersection:e})):e.worldBound&&(e=e.worldBound.intersectsRayWhere(this.pickRay))&&
e.distances.length&&a.push({entity:d,intersection:e}))}a.sort(function(a,b){return a.intersection.distances[0]-b.intersection.distances[0]});this.onPick(a)}};return c});
define("goo/loaders/JsonUtils","goo/renderer/BufferUtils,goo/math/Transform,goo/math/Matrix3x3,goo/math/Matrix4x4,goo/math/Vector3,goo/math/Quaternion,goo/animation/blendtree/ClipSource,goo/animation/layer/AnimationLayer,goo/animation/state/SteadyState,goo/animation/state/FadeTransitionState,goo/animation/state/FrozenTransitionState,goo/animation/state/IgnoreTransitionState,goo/animation/state/ImmediateTransitionState,goo/animation/state/SyncFadeTransitionState,goo/animation/state/StateBlendType,goo/animation/blendtree/BinaryLERPSource,goo/animation/blendtree/ExclusiveClipSource,goo/animation/blendtree/FrozenClipSource,goo/animation/blendtree/InclusiveClipSource,goo/animation/blendtree/ManagedTransformSource,goo/animation/layer/LayerLERPBlender".split(","),function(e,
c,b,a,f,d,g,j,k,i,h,l,n,o,p,m,s,q,t,u,v){function r(){}r.fillAttributeBufferFromCompressedString=function(a,b,c,d,f){var b=b.getAttributeBuffer(c),c=d.length,e=a.length/d.length,g,i,h,k,j;for(j=0;j<c;j++)if(d[j]===0)return;for(j=0;j<c;j++)for(k=g=0;k<e;k++)i=a.charCodeAt(k+j*e),h=k*c+j,g+=r.unzip(i),b[h]=(g+f[j])*d[j]};r.fillAttributeBuffer=function(a,b,c){b=b.getAttributeBuffer(c);for(c=0;c<a.length;c++)b[c]=a[c]};r.getIntBuffer=function(a,b){var c=e.createIndexBuffer(a.length,b);c.set(a);return c};
r.rewrap=function(a){a%=61404;a<0&&(a+=61404);return a};r.getIntBufferFromCompressedString=function(a,b){for(var c=0,d=e.createIndexBuffer(a.length,b),f=0;f<a.length;++f){var g=a.charCodeAt(f),c=g=c+r.unzip(g);d[f]=this.rewrap(g)}return d};r.unzip=function(a){a>=57344&&(a-=2048);a-=35;return a>>1^-(a&1)};r.parseTransform=function(a){var b=new c;b.translation=r.parseVector3(a.Translation);b.scale=r.parseVector3(a.Scale);b.rotation=r.parseMatrix3(a.Rotation);return b};r.parseTransformQuat=function(a){var b=
new c;b.translation=r.parseVector3(a.Translation);b.scale=r.parseVector3(a.Scale);b.rotation=r.parseQuaternion(a.Rotation).toRotationMatrix();return b};r.parseTransformEuler=function(a){var b=new c;b.translation=r.parseVector3(a.Translation);b.scale=r.parseVector3(a.Scale);a=r.parseVector3(a.Rotation);b.setRotationXYZ(a.x,a.y,a.z);return b};r.parseTransformMatrix=function(a){var b=new c;b.matrix=r.parseMatrix4(a.Matrix);return b};r.parseMatrix3=function(a){var c=new b;c.e00=a[0];c.e01=a[1];c.e02=
a[2];c.e10=a[3];c.e11=a[4];c.e12=a[5];c.e20=a[6];c.e21=a[7];c.e22=a[8];return c};r.parseMatrix4=function(b){var c=new a;c.e00=b[0];c.e01=b[1];c.e02=b[2];c.e03=b[3];c.e10=b[4];c.e11=b[5];c.e12=b[6];c.e13=b[7];c.e20=b[8];c.e21=b[9];c.e22=b[10];c.e23=b[11];c.e30=b[12];c.e31=b[13];c.e32=b[14];c.e33=b[15];return c};r.parseQuaternion=function(a){var b=new d;b.x=a[0];b.y=a[1];b.z=a[2];b.w=a[3];return b};r.parseVector3=function(a){return new f(a[0],a[1],a[2])};r.parseAnimationLayers=function(a,b,c,d,f){var f=
f.Layers,e;for(e in f){var g;"DEFAULT"===e?g=a.getBaseAnimationLayer():(g=new j(e),a.addAnimationLayer(g));var i=f[e];r.parseLayerProperties(a,g,i);if(i.States)for(var h=i.States,k=0,l=h.length;k<l;k++)r.parseSteadyState(h[k],c,d,a,g);if(i.Transitions){var i=i.Transitions,m;for(m in i)g._transitions[m]=r.parseTransitionState(i[m],c,d,a)}}if(b!==null)b.onSuccess(d)};r.parseSteadyState=function(a,b,c,d,f){var e=new k(a.Name?a.Name:"unknown");if(a.Clip){var i=a.Clip,h=b[i.Name],j=new g(h,d);e._sourceTree=
j;c._usedClipSources[j._clip._name]=j;r.populateClipSource(j,h,i,d)}else if(a.Tree)e._sourceTree=r.parseTreeSource(a.Tree,b,c,d);if(a.EndTransition)e._endTransition=r.parseTransitionState(a.EndTransition,b,c,d);if(a.Transitions){var i=a.Transitions,l;for(l in i)e._transitions[l]=r.parseTransitionState(i[l],b,c,d)}a.Default&&f.setCurrentState(e,!0);f._steadyStates[e._name]=e};r.parseTransitionState=function(a){var b=a[2];if("fade"===b)b=new i(a[3],a[4],p[a[5]]);else if("syncfade"===b)b=new o(a[3],
a[4],p[a[5]]);else if("frozen"===b)b=new h(a[3],a[4],p[a[5]]);else if("immediate"===b)b=new n(a[3]);else if("ignore"===b)b=new l;else return null;isNaN(a[0])||b.setStartWindow(a[0]);isNaN(a[1])||b.setEndWindow(a[1]);return b};r.parseTreeSource=function(a,b,c,d){if(a.Clip){var a=a.Clip,b=b[a.Name],f=new g(b,d);c._usedClipSources[f._clip._name]=f;r.populateClipSource(f,b,a,d);return f}else if(a.InclusiveClip){a=a.InclusiveClip;b=b[a.Name];f=new t(b,d);c._usedClipSources[f._clip._name]=f;r.populateClipSource(f,
b,a,d);a.Channels&&f.addEnabledChannels(a.Channels);if(a.JointNames){var d=d.getSkeletonPose(0).getSkeleton(),b=a.JointNames,e;for(e in b)f.addEnabledJoints(d.findJointByName(e))}a.Joints&&f.addEnabledJoints(a.Joints);return f}else if(a.ExclusiveClip)return a=a.ExclusiveClip,b=b[a.Name],f=new s(b,d),c._usedClipSources[f._clip._name]=f,r.populateClipSource(f,b,a,d),a.Channels&&f.addDisabledChannels(a.Channels),a.Joints&&f.addDisabledJoints(a.Joints),f;else if(a.Lerp){a=a.Lerp;f=r.parseTreeSource(a.ChildA,
b,c,d);e=r.parseTreeSource(a.ChildB,b,c,d);f=new m(f,e);if(a.BlendKey)f._blendKey=a.BlendKey,d._valuesStore[f._blendKey]=isNaN(a.BlendWeight)?0:a.BlendWeight;return f}else if(a.Managed){a=a.Managed;f=new u;if(a.InitFromClip)a=a.InitFromClip,f._sourceName=a.Clip,b=b[f._sourceName],a.JointNames&&f.initJointsByName(d._applyToPoses[0],b,a.JointNames),a.JointIds&&f.initJointsById(b,a.JointIds);return f}else if(a.Frozen)return a=a.Frozen,d=r.parseTreeSource(a.Child,b,c,d),new q(d,isNaN(a.Time)?0:a.Time);
console.warn("no known source type found.");return null};r.populateClipSource=function(a,b,c,d){if(c.TimeScale!==void 0)d.getClipInstance(b)._timeScale=isNaN(c.TimeScale)?1:c.TimeScale;if(c.LoopCount!==void 0)d.getClipInstance(b)._loopCount=isNaN(c.LoopCount)?1:c.LoopCount;if(c.Active!==void 0)d.getClipInstance(b)._active=c.Active===!0};r.parseLayerProperties=function(a,b,c){if(c.BlendType){var d=null;if("lerp"===c.BlendType)d=new v,b._layerBlender=d;if(d!==null&&c.BlendKey)d._blendKey=c.BlendKey,
a._valuesStore[d._blendKey]=isNaN(c.BlendWeight)?0:c.BlendWeight}};r.parseChannelTimes=function(a,b){var c=a.Times;if(c)if(b){var d=a.TimeOffsetScale;return r.parseFloatArrayFromCompressedString(c,[d[1]],[d[0]])}else return c;return null};r.parseFloatLERPValues=function(a,b){var c=a.IFCValues;if(c)if(b){var d=a.IFCOffsetScale;return r.parseFloatArrayFromCompressedString(c,[d[1]],[d[0]])}else return c;return null};r.parseRotationSamples=function(a,b,c){return(a=a.RotationSamples)?c?(b=1-(b+1>>1),c=
1/-b,r.parseFloatArrayFromCompressedString(a,[c,c,c,c],[b,b,b,b])):r.parseQuaternionSamples(a):null};r.parseTranslationSamples=function(a,b,c){var d=a.UniformTranslation;if(d){d===void 0&&console.log("asdf");for(var a=d[0],c=d[1],d=d[2],f=[],e=0;e<b;e++)f[e*3+0]=a,f[e*3+1]=c,f[e*3+2]=d;return f}return(b=a.TranslationSamples)?c?(a=a.TranslationOffsetScale,c=a[3],r.parseFloatArrayFromCompressedString(b,[c,c,c],[a[0],a[1],a[2]])):r.parseVector3Samples(b):null};r.parseScaleSamples=function(a,b,c){var d=
a.UniformScale;if(d){for(var a=d,c=a[0],d=a[1],a=a[2],f=[],e=0;e<b;e++)f[e*3+0]=c,f[e*3+1]=d,f[e*3+2]=a;return f}return(b=a.ScaleSamples)?c?(a=a.ScaleOffsetScale,c=a[0],d=a[1],f=a[2],a=a[3],r.parseFloatArrayFromCompressedString(b,[a,a,a],[c,d,f])):r.parseVector3Samples(b):null};r.parseQuaternionSamples=function(a){if(!a)return null;for(var b=[],c=new d,f=0,e=a.length;f<e;f++){var g=a[f];if(g==="*")b[f*4+0]=c.x,b[f*4+1]=c.y,b[f*4+2]=c.z,b[f*4+3]=c.w;else if(g instanceof Array&&g.length===4)c.set(g[0],
g[1],g[2],g[3]),b[f*4+0]=c.x,b[f*4+1]=c.y,b[f*4+2]=c.z,b[f*4+3]=c.w}return b};r.parseVector3Samples=function(a){if(!a)return null;for(var b=[],c=new f,d=0,e=a.length;d<e;d++){var g=a[d];if(g==="*")b[d*3+0]=c.x,b[d*3+1]=c.y,b[d*3+2]=c.z;else if(g instanceof Array&&g.length===3)c.set(g[0],g[1],g[2]),b[d*3+0]=c.x,b[d*3+1]=c.y,b[d*3+2]=c.z}return b};r.parseFloatArrayFromCompressedString=function(a,b,c){var d=[],f=b.length,e=a.length/b.length,g,i,h,k,j;for(j=0;j<f;j++)for(k=g=0;k<e;k++)i=a.charCodeAt(k+
j*e),h=k*f+j,g+=r.unzip(i),d[h]=(g+c[j])*b[j];return d};return r});
define("goo/loaders/AnimationLoader","goo/util/rsvp,goo/renderer/MeshData,goo/renderer/Shader,goo/renderer/TextureCreator,goo/renderer/Material,goo/loaders/Loader,goo/animation/state/loader/OutputStore,goo/animation/AnimationManager,goo/animation/blendtree/SimpleAnimationApplier,goo/loaders/JsonUtils,goo/animation/clip/AnimationClip,goo/animation/clip/JointChannel,goo/animation/clip/TransformChannel,goo/animation/clip/InterpolatedFloatChannel,goo/animation/state/SteadyState,goo/animation/blendtree/ClipSource".split(","),function(e,
c,b,a,f,d,g,j,k,i,h,l,n,o,p,m){function s(a){if(typeof a==="undefined"||a===null)throw Error("AnimationTreeLoader(): Argument `parameters` was undefined/null");if(typeof a.loader==="undefined"||!(a.loader instanceof d)||a.loader===null)throw Error("AnimationTreeLoader(): Argument `parameters.loader` was invalid/undefined/null");this._loader=a.loader;this._cache={}}s.prototype.load=function(a,b,c){if(this._cache[a]&&this._cache[a][b._skeleton._name])return this._cache[a][b._skeleton.name];var d=new j(b);
d._applier=new k;var f=s.prototype._loadAnimation.bind(this),e=s.prototype._parseAnimation.bind(this,c),c=s.prototype._setupDefaultAnimation.bind(this,d,c),f=f(a).then(e).then(c);this._cache[a]||(this._cache[a]={});return this._cache[a][b._skeleton._name]=f};s.prototype._loadAnimation=function(a){return this._loader.load(a)};s.prototype._parseAnimation=function(a,b){typeof b==="string"&&(b=JSON.parse(b));var c,d,f=new h(a);(c=b.UseCompression||!1)&&(d=b.CompressedRange||32767);if(b.Channels)for(var e=
b.Channels,g=0,k=e.length;g<k;g++){var j=e[g],m=j.Type,a=j.Name,p=i.parseChannelTimes(j,c);if("Joint"===m)var m=j.JointName,s=j.JointIndex,C=i.parseRotationSamples(j,d,c),F=i.parseTranslationSamples(j,p.length,c),j=i.parseScaleSamples(j,p.length,c),p=new l(m,s,p,C,F,j);else if("Transform"===m)C=i.parseRotationSamples(j,d,c),F=i.parseTranslationSamples(j,p.length,c),j=i.parseScaleSamples(j,p.length,c),p=new n(a,p,C,F,j);else if("FloatLERP"===m)p=new o(a,p,i.parseFloatLERPValues(j,c));else{console.warn("Unhandled channel type: "+
m);continue}f.addChannel(p)}return f};s.prototype._setupDefaultAnimation=function(a,b,c){var d=new p(b),f=new m(c,a);d._sourceTree=f;a._layers[0]._steadyStates[d._name]=d;a.getClipInstance(c)._loopCount=-1;a.getClipInstance(c)._timeScale=1;a._layers[0].setCurrentStateByName(b,!0);return a};return s});
define("goo/loaders/AnimationTreeLoader","goo/util/rsvp,goo/renderer/MeshData,goo/renderer/Shader,goo/renderer/TextureCreator,goo/renderer/Material,goo/loaders/Loader,goo/animation/state/loader/OutputStore,goo/animation/AnimationManager,goo/animation/blendtree/SimpleAnimationApplier,goo/loaders/JsonUtils,goo/animation/clip/AnimationClip,goo/animation/clip/JointChannel,goo/animation/clip/TransformChannel,goo/animation/clip/InterpolatedFloatChannel,goo/loaders/AnimationLoader".split(","),function(e,
c,b,a,f,d,g,j,k,i,h,l,n,o,p){function m(a){if(typeof a==="undefined"||a===null)throw Error("AnimationTreeLoader(): Argument `parameters` was undefined/null");if(typeof a.loader==="undefined"||!(a.loader instanceof d)||a.loader===null)throw Error("AnimationTreeLoader(): Argument `parameters.loader` was invalid/undefined/null");this._loader=a.loader;this._cache={};this._animationLoader=new p(a)}m.prototype.load=function(a,b,c){if(this._cache[a]&&this._cache[a][b._skeleton._name])return this._cache[a][b._skeleton._name];
var d=new j(b);d._applier=new k;var f=a.match(/.*\//),f=f.length===1?f[0]:"",e=m.prototype._loadTree.bind(this),i=m.prototype._parseTree.bind(this),f=m.prototype._loadAndParseAnimations.bind(this,f),h=m.prototype._parseAnimationLayers.bind(this),c=m.prototype._setupDefaultAnimation.bind(this,c),l,e=e(a).then(function(a){return l=a}).then(i).then(f).then(function(a){var b=new g;return h(d,a,b,l)}).then(c);this._cache[a]||(this._cache[a]={});return this._cache[a][b._skeleton._name]=e};m.prototype._loadTree=
function(a){return this._loader.load(a)};m.prototype._parseTree=function(a){typeof a==="string"&&(a=JSON.parse(a));return!a.Clips||!a.Layers?!1:a.Clips};m.prototype._loadAndParseAnimations=function(a,b){function c(a){i[a._name]=a}for(var d=p.prototype._loadAnimation.bind(this),f,g=[],i={},h=0,k=b.length;h<k;h++)f=p.prototype._parseAnimation.bind(this,b[h].Name),g.push(d(a+b[h].URL).then(f).then(c));return e.all(g).then(function(){return i})};m.prototype._parseAnimationLayers=function(a,b,c,d){var f=
new e.Promise;typeof d==="string"&&(d=JSON.parse(d));i.parseAnimationLayers(a,{onSuccess:function(){f.resolve(a)},onError:function(a){f.reject(a)}},b,c,d);return f};m.prototype._setupDefaultAnimation=function(a,b){a&&b.getBaseAnimationLayer().setCurrentStateByName(a,!0);return b};return m});
define("goo/loaders/BundleLoader",["goo/loaders/Loader","goo/util/rsvp","goo/renderer/Util"],function(e,c,b){function a(a){e.call(this,a);this._bundle={}}a.prototype=Object.create(e.prototype);a.prototype.addBundle=function(a){for(var b in a)a.hasOwnProperty(b)&&(this._bundle[b]=a[b])};a.prototype.load=function(a,d,g){if(this._bundle[a]){var g=new c.Promise,a=b.clone(this._bundle[a]),j=g.then(function(a){return typeof d==="function"?d(a):a});g.resolve(a);return j}return e.prototype.load.call(this,
a,d,g)};a.prototype.loadBundle=function(b){var c=a.prototype._parse.bind(this);return e.prototype.load.call(this,b,c)};a.prototype._parse=function(a){return this._bundle=JSON.parse(a)};return a});
define("goo/loaders/handlers/ConfigHandler",[],function(){return function(){function e(c,b,a,f){this.world=c;this.getConfig=b;this.updateObject=a;this.options=f}e.prototype.update=function(){};e.handlerClasses={};e.getHandler=function(c){return this.handlerClasses[c]};e._register=function(c){this._type=c;return e.handlerClasses[c]=this};return e}()});
define("goo/util/PromiseUtil",["goo/util/rsvp"],function(e){return{createDummyPromise:function(c,b){var a;a=new e.Promise;b!=null?a.reject(b):a.resolve(c);return a}}});
define("goo/loaders/handlers/ComponentHandler",["goo/util/rsvp","goo/util/PromiseUtil"],function(){return function(){function e(c,b,a,f){this.world=c;this.getConfig=b;this.updateObject=a;this.options=f}e.prototype._prepare=function(){};e.prototype._create=function(){throw Error("ComponentHandler._create is abstract, use ComponentHandler.getHandler(type)");};e.prototype.update=function(c,b){var a;this._prepare(b);(a=c!=null?c[""+this.constructor._type+"Component"]:void 0)||(a=this._create(c,b));return a};
e.prototype.remove=function(c){return c!=null?c.clearComponent(""+this.constructor._type+"Component"):void 0};e.handlerClasses={};e.getHandler=function(c){var b;return(b=this.handlerClasses)!=null?b[c]:void 0};e._register=function(c){this._type=c;return e.handlerClasses[c]=this};return e}()});define("goo/util/StringUtil",[],function(){return{endsWith:function(e,c){return e.indexOf(c,e.length-c.length)!==-1}}});
define("goo/util/ObjectUtil",[],function(){var e={},c=Array.prototype,b=Object.prototype,a={},f=c.slice,d=b.toString,g=b.hasOwnProperty,b=Array.isArray,j=Object.keys,k=c.forEach;e.has=function(a,b){return g.call(a,b)};e.defaults=function(a){i(f.call(arguments,1),function(b){if(b)for(var c in b)if(typeof a[c]==="undefined"||a[c]===null)a[c]=b[c]});return a};e.extend=function(a){i(f.call(arguments,1),function(b){if(b)for(var c in b)a[c]=b[c]});return a};e.isObject=function(a){return a===Object(a)};
e.clone=function(a){return!e.isObject(a)?a:e.isArray(a)?a.slice():e.extend({},a)};e.keys=j||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[],c;for(c in a)e.has(a,c)&&(b[b.length]=c);return b};e.isArray=b||function(a){return d.call(a)==="[object Array]"};var i=e.each=e.forEach=function(b,c,d){if(!(typeof b==="undefined"||b===null))if(k&&b.forEach===k)b.forEach(c,d);else if(b.length===+b.length)for(var f=0,g=b.length;f<g;f++){if(c.call(d,b[f],f,b)===a)break}else for(f in b)if(e.has(b,
f)&&c.call(d,b[f],f,b)===a)break};return e});var __hasProp={}.hasOwnProperty,__extends=function(e,c){function b(){this.constructor=e}for(var a in c)__hasProp.call(c,a)&&(e[a]=c[a]);b.prototype=c.prototype;e.prototype=new b;e.__super__=c.prototype;return e};
define("goo/loaders/handlers/CameraComponentHandler","goo/loaders/handlers/ComponentHandler,goo/entities/components/CameraComponent,goo/renderer/Camera,goo/util/rsvp,goo/util/PromiseUtil,goo/util/ObjectUtil".split(","),function(e,c,b,a,f,d){return function(a){function e(){return e.__super__.constructor.apply(this,arguments)}__extends(e,a);e._register("camera");e.prototype._prepare=function(a){return d.defaults(a,{fov:45,near:1,far:1E4})};e.prototype._create=function(a){var d;d=new b(45,1,1,1E3);d=
new c(d);a.setComponent(d);return d};e.prototype.update=function(a,b){var c;c=e.__super__.update.call(this,a,b);c.camera.setFrustumPerspective(b.fov,void 0,b.near,b.far);return f.createDummyPromise(c)};e.prototype.remove=function(a){var b;a!=null&&(b=a.cameraComponent)!=null&&b.camera&&this.world.removeEntity(a.cameraComponent.camera);return e.__super__.remove.call(this,a)};return e}(e)});__hasProp={}.hasOwnProperty;
__extends=function(e,c){function b(){this.constructor=e}for(var a in c)__hasProp.call(c,a)&&(e[a]=c[a]);b.prototype=c.prototype;e.prototype=new b;e.__super__=c.prototype;return e};
define("goo/loaders/handlers/EntityHandler","goo/loaders/handlers/ConfigHandler,goo/loaders/handlers/ComponentHandler,goo/entities/Entity,goo/util/rsvp,goo/util/PromiseUtil,goo/util/ObjectUtil".split(","),function(e,c,b,a,f,d){return function(b){function e(){return e.__super__.constructor.apply(this,arguments)}__extends(e,b);e._register("entity");e.prototype._prepare=function(){};e.prototype._create=function(a){var b;b=this.world.createEntity(a);b.ref=a;return b};e.prototype.update=function(b,e){var g,
j,n,o,p,m,s;p=this.world.entityManager.getEntityByName(b)||this._create(b);m=[];s=e.components;for(j in s)if(g=s[j],o=c.getHandler(j)){if(this._componentHandlers==null)this._componentHandlers={};(n=this._componentHandlers[j])?d.extend(n,{world:this._world,getConfig:this.getConfig,updateObject:this.updateObject,options:d.clone(this.options)}):n=this._componentHandlers[j]=new o(this.world,this.getConfig,this.updateObject,this.options);g=n.update(p,g);g!=null&&g.then?m.push(g):console.error("Handler for "+
j+" did not return promise")}else console.warn("No componentHandler for "+j);return m.length?a.all(m).then(function(){return p}):(console.error("No promises in "+b+" ",e),f.createDummyPromise(p))};e.prototype.remove=function(a){return this.world.removeEntity(this.world.entityManager.getEntityByName(a))};return e}(e)});__hasProp={}.hasOwnProperty;
__extends=function(e,c){function b(){this.constructor=e}for(var a in c)__hasProp.call(c,a)&&(e[a]=c[a]);b.prototype=c.prototype;e.prototype=new b;e.__super__=c.prototype;return e};
define("goo/loaders/handlers/LightComponentHandler","goo/loaders/handlers/ComponentHandler,goo/entities/components/LightComponent,goo/renderer/light/PointLight,goo/math/Vector,goo/util/rsvp,goo/util/PromiseUtil,goo/util/ObjectUtil".split(","),function(e,c,b,a,f,d,g){return function(f){function e(){return e.__super__.constructor.apply(this,arguments)}__extends(e,f);e._register("light");e.prototype._prepare=function(a){g.defaults(a,{direction:[0,0,0],color:[1,1,1,1],attenuate:!0,shadowCaster:!1});if(a.shadowCaster)return g.defaults(a.shadowSettings,
{type:"Blur"})};e.prototype._create=function(a){var d;d=new c(new b);a.setComponent(d);return d};e.prototype.update=function(b,c){var f,j,o,p;f=e.__super__.update.call(this,b,c);o=f.light;for(j in c)p=c[j],o.hasOwnProperty(j)&&(o[j]instanceof a?o[j].set(p):o[j]=g.clone(p));return d.createDummyPromise(f)};return e}(e)});__hasProp={}.hasOwnProperty;
__extends=function(e,c){function b(){this.constructor=e}for(var a in c)__hasProp.call(c,a)&&(e[a]=c[a]);b.prototype=c.prototype;e.prototype=new b;e.__super__=c.prototype;return e};
define("goo/loaders/handlers/MaterialHandler","goo/loaders/handlers/ConfigHandler,goo/renderer/Material,goo/renderer/Util,goo/renderer/shaders/ShaderLib,goo/util/rsvp,goo/util/PromiseUtil,goo/util/ObjectUtil".split(","),function(e,c,b,a,f,d,g){return function(e){function k(a,b,c,d){this.world=a;this.getConfig=b;this.updateObject=c;this.options=d;this._objects={}}__extends(k,e);k._register("material");k.prototype._prepare=function(a){var b;if(a.blendState==null)a.blendState={};g.defaults(a.blendState,
{blending:"NoBlending",blendEquation:"AddEquation",blendSrc:"SrcAlphaFactor",blendDst:"OneMinusSrcAlphaFactor"});if(a.cullState==null)a.cullState={};g.defaults(a.cullState,{enabled:!0,cullFace:"Back",frontFace:"CCW"});if(a.depthState==null)a.depthState={};g.defaults(a.depthState,{enabled:!0,write:!0});return(b=a.renderQueue)!=null?b:a.renderQueue=-1};k.prototype._create=function(a){if(this._objects==null)this._objects={};return this._objects[a]=new c(a)};k.prototype.update=function(a,c){var d,e,j=
this;this._prepare(c);(e=this._objects)!=null&&e[a]||this._create(a);d=this._objects[a];return this._getShaderObject(c.shaderRef,c.wireframe).then(function(e){var k,n,q,t;if(e){if(c.wireframe)d.wireframe=c.wireframe;if(c.wireframeColor)d.wireframeColor=b.clone(c.wireframeColor);d.blendState=b.clone(c.blendState);d.cullState=b.clone(c.cullState);d.depthState=b.clone(c.depthState);d.renderQueue=c.renderQueue===-1?null:c.renderQueue;d.shader=e;d.uniforms={};t=c.uniforms;for(k in t)e=t[k],d.uniforms[k]=
g.clone(e);n=[];t=c.texturesMapping;e=function(a,b){return n.push(j.getConfig(b).then(function(c){return j.updateObject(b,c,j.options).then(function(c){return{type:a,ref:b,texture:c}})}))};for(q in t)k=t[q],e(q,k);return n!=null&&n.length?f.all(n).then(function(a){var b,c,f;for(c=0,f=a.length;c<f;c++)b=a[c],d.setTexture(b.type,b.texture);return d}).then(null,function(a){return console.error("Error loading textures: "+a)}):d}else console.warn("Unknown shader",c.shaderRef,"- not updating material",
a)})};k.prototype.remove=function(a){return delete this._objects[a]};k.prototype._getShaderObject=function(b,e){var g,j,k=this;return e?(g=new f.Promise,j=c.createShader(a.simple),g.resolve(j),g):b!=null?this.getConfig(b).then(function(a){return k.updateObject(b,a,k.options)}):(g=c.createShader(a.texturedLit,"DefaultShader"),d.createDummyPromise(g))};return k}(e)});__hasProp={}.hasOwnProperty;
__extends=function(e,c){function b(){this.constructor=e}for(var a in c)__hasProp.call(c,a)&&(e[a]=c[a]);b.prototype=c.prototype;e.prototype=new b;e.__super__=c.prototype;return e};
define("goo/loaders/handlers/MeshDataComponentHandler","goo/loaders/handlers/ComponentHandler,goo/entities/components/MeshDataComponent,goo/renderer/bounds/BoundingBox,goo/util/rsvp,goo/util/PromiseUtil,goo/util/ObjectUtil".split(","),function(e,c,b,a,f,d){return function(a){function f(){return f.__super__.constructor.apply(this,arguments)}__extends(f,a);f._register("meshData");f.prototype._prepare=function(a){return d.defaults(a,{meshRef:null})};f.prototype._create=function(){};f.prototype.update=
function(a,d){var e,g=this;f.__super__.update.call(this,a,d);(e=d.meshRef)||console.error("No meshRef in meshDataComponent for "+a.ref);return this.getConfig(e).then(function(d){return g.updateObject(e,d).then(function(d){var f,e,g;g=new c(d);if(d.boundingBox)f=d.boundingBox.min,e=d.boundingBox.max,d=[e[0]-f[0],e[1]-f[1],e[2]-f[2]],e=[(e[0]+f[0])*0.5,(e[1]+f[1])*0.5,(e[2]+f[2])*0.5],f=new b,f.xExtent=d[0],f.yExtent=d[1],f.zExtent=d[2],f.center.seta(e),g.modelBound=f,g.autoCompute=!1;a.setComponent(g);
return g})})};return f}(e)});__hasProp={}.hasOwnProperty;__extends=function(e,c){function b(){this.constructor=e}for(var a in c)__hasProp.call(c,a)&&(e[a]=c[a]);b.prototype=c.prototype;e.prototype=new b;e.__super__=c.prototype;return e};
define("goo/loaders/handlers/MeshDataHandler",["goo/loaders/handlers/ConfigHandler","goo/renderer/MeshData","goo/loaders/JsonUtils","goo/util/PromiseUtil","goo/util/ObjectUtil"],function(e,c,b,a,f){return function(d){function e(){return e.__super__.constructor.apply(this,arguments)}__extends(e,d);e._register("mesh");e.prototype._create=function(a){var b;a.compression&&a.compression.compressed&&(b={compressedVertsRange:a.compression.compressedVertsRange||16383,compressedColorsRange:a.compression.compressedColorsRange||
255,compressedUnitVectorRange:a.compression.compressedUnitVectorRange||1023});a.type==="SkinnedMesh"?(a=this._parseMeshData(a.data||a,4,"SkinnedMesh",b),a.type=c.SKINMESH):(a=this._parseMeshData(a.data||a,0,"Mesh",b),a.type=c.MESH);return a};e.prototype.update=function(b,c){var d,f,e=this;d=this._create(c);return c.pose?(f=c.pose,this.getConfig(f).then(function(a){return e.updateObject(f,a).then(function(a){a=new SkeletonPose(a);a.setToBindPose();d.currentPose=a;return d})})):a.createDummyPromise(d)};
e.prototype.remove=function(){};e.prototype._parseMeshData=function(a,d,e,g){var l,n,o,p,m,s,q,t,u,v;t=a.vertexCount;if(t===0)return null;p=((n=a.indexLengths)!=null?n[0]:void 0)||((l=a.indices)!=null?l.length:void 0)||0;l={};if(a.vertices&&a.vertices.length>0)l.POSITION=c.createAttribute(3,"Float");if(a.normals&&a.normals.length>0)l.NORMAL=c.createAttribute(3,"Float");if(a.tangents&&a.tangents.length>0)l.TANGENT=c.createAttribute(4,"Float");if(a.colors&&a.colors.length>0)l.COLOR=c.createAttribute(4,
"Float");if(d>0&&a.weights)l.WEIGHTS=c.createAttribute(4,"Float");if(d>0&&a.joints)l.JOINTIDS=c.createAttribute(4,"Short");if(a.textureCoords&&a.textureCoords.length>0){v=a.textureCoords;for(n=u=0,v=v.length;u<v;n=++u)console.log("TEXCOORD "+n),l["TEXCOORD"+n]=c.createAttribute(2,"Float")}console.log("Parsing mesh data: "+f.keys(l).join(","));p=new c(l,t,p);if(a.vertices&&a.vertices.length>0)g!=null?(n=a.vertexOffsets,b.fillAttributeBufferFromCompressedString(a.vertices,p,c.POSITION,[a.vertexScale,
a.vertexScale,a.vertexScale],[n.xOffset,n.yOffset,n.zOffset])):b.fillAttributeBuffer(a.vertices,p,c.POSITION);d>0&&a.weights&&(g!=null?(n=1/g.compressedVertsRange,b.fillAttributeBufferFromCompressedString(a.weights,p,c.WEIGHTS,[n],[0])):b.fillAttributeBuffer(a.weights,p,c.WEIGHTS));if(((o=a.normals)!=null?o.length:void 0)>0)g!=null?(o=1-(g.compressedUnitVectorRange+1>>1),n=1/-o,b.fillAttributeBufferFromCompressedString(a.normals,p,c.NORMAL,[n,n,n],[o,o,o])):b.fillAttributeBuffer(a.normals,p,c.NORMAL);
if(((m=a.tangents)!=null?m.length:void 0)>0)g!=null?(o=1-(g.compressedUnitVectorRange+1>>1),n=1/-o,b.fillAttributeBufferFromCompressedString(a.tangents,p,c.TANGENT,[n,n,n,n],[o,o,o,o])):b.fillAttributeBuffer(a.tangents,p,c.TANGENT);if(((s=a.colors)!=null?s.length:void 0)>0)g!=null?(o=0,n=255/(g.compressedColorsRange+1),b.fillAttributeBufferFromCompressedString(a.colors,p,c.COLOR,[n,n,n,n],[o,o,o,o])):b.fillAttributeBuffer(a.colors,p,c.COLOR);if(((q=a.textureCoords)!=null?q.length:void 0)>0)if(s=a.textureCoords,
g!=null)for(n=q=0,o=s.length;q<o;n=++q)m=s[n],b.fillAttributeBufferFromCompressedString(m.UVs,p,"TEXCOORD"+n,m.UVScales,m.UVOffsets);else for(n=q=0,o=s.length;q<o;n=++q)m=s[n],b.fillAttributeBuffer(m,p,"TEXCOORD"+n);if(d>0&&a.joints)if(n=p.getAttributeBuffer(c.JOINTIDS),m=g?b.getIntBufferFromCompressedString(a.joints,32767):b.getIntBuffer(a.joints,32767),e==="SkinnedMesh"){q=[];s=0;for(o=l=0,u=m.length;l<u;o=++l)e=m[o],q[e]===void 0&&(q[e]=s++),n.set([q[e]],o);n=[];for(e=o=0,m=q.length;o<m;e=++o)s=
q[e],s!==null&&(n[s]=e);p.paletteMap=n;p.weightsPerVertex=d}else for(d=e=0,s=m.capacity();0<=s?e<s:e>s;d=0<=s?++e:--e)n.putCast(d,m.get(d));a.indices&&(g!=null?p.getIndexBuffer().set(b.getIntBufferFromCompressedString(a.indices,t)):p.getIndexBuffer().set(b.getIntBuffer(a.indices,t)));if(a.indexModes)p.indexModes=a.indexModes.slice(0);if(a.indexLengths)p.indexLengths=a.indexLengths.slice(0);if(a.boundingBox)p.boundingBox=a.boundingBox;return p};return e}(e)});__hasProp={}.hasOwnProperty;
__extends=function(e,c){function b(){this.constructor=e}for(var a in c)__hasProp.call(c,a)&&(e[a]=c[a]);b.prototype=c.prototype;e.prototype=new b;e.__super__=c.prototype;return e};
define("goo/loaders/handlers/MeshRendererComponentHandler",["goo/loaders/handlers/ComponentHandler","goo/entities/components/MeshRendererComponent","goo/util/rsvp","goo/util/PromiseUtil","goo/util/ObjectUtil"],function(e,c,b,a,f){return function(d){function e(){return e.__super__.constructor.apply(this,arguments)}__extends(e,d);e._register("meshRenderer");e.prototype._prepare=function(a){return f.defaults(a,{materialRefs:[],cullMode:"Dynamic",castShadows:!1,receiveShadows:!1})};e.prototype._create=
function(a){var b;b=new c;a.setComponent(b);return b};e.prototype.update=function(c,d){var i,h,l,n,o,p,m,s=this;i=e.__super__.update.call(this,c,d);l=d.materialRefs;if(!l||l.length===0)console.log("No material refs"),h=a.createDummyPromise([]);else{n=[];o=function(a){return n.push(s._getMaterial(a))};for(p=0,m=l.length;p<m;p++)h=l[p],o(h);h=b.all(n)}return h.then(function(a){var b;i.materials=a;for(b in d)a=d[b],b!=="materials"&&i.hasOwnProperty(b)&&(i[b]=f.clone(a));return i}).then(null,function(a){return console.error("Error handling materials "+
a)})};e.prototype._getMaterial=function(a){var b=this;console.log("GetMaterial "+a);return this.getConfig(a).then(function(c){return b.updateObject(a,c,b.options)})};return e}(e)});__hasProp={}.hasOwnProperty;__extends=function(e,c){function b(){this.constructor=e}for(var a in c)__hasProp.call(c,a)&&(e[a]=c[a]);b.prototype=c.prototype;e.prototype=new b;e.__super__=c.prototype;return e};
define("goo/loaders/handlers/SceneHandler",["goo/loaders/handlers/ConfigHandler","goo/util/rsvp","goo/util/PromiseUtil"],function(e,c){return function(b){function a(){return a.__super__.constructor.apply(this,arguments)}__extends(a,b);a._register("scene");a.prototype._prepare=function(){};a.prototype._create=function(){};a.prototype.update=function(a,b){var e,j,k,i,h,l,n=this;j=[];if((e=b.entityRefs)!=null&&e.length){l=b.entityRefs;k=function(a){return j.push(n.getConfig(a).then(function(b){return n.updateObject(a,
b,n.options)}))};for(i=0,h=l.length;i<h;i++)e=l[i],k(e);return c.all(j).then(function(a){var c,f,e,g;if(!((c=n.options.beforeAdd)!=null&&c.apply)||n.options.beforeAdd(b)){g=[];for(f=0,e=a.length;f<e;f++)c=a[f],console.log("Adding "+c.ref+" to world"),g.push(c.addToWorld());return g}}).then(null,function(a){return console.error("Error updating entities: "+a)})}else return console.warn("No entity refs in scene "+a),b};a.prototype.remove=function(){};return a}(e)});__hasProp={}.hasOwnProperty;
__extends=function(e,c){function b(){this.constructor=e}for(var a in c)__hasProp.call(c,a)&&(e[a]=c[a]);b.prototype=c.prototype;e.prototype=new b;e.__super__=c.prototype;return e};
define("goo/loaders/handlers/ShaderHandler","goo/loaders/handlers/ConfigHandler,goo/renderer/Material,goo/renderer/shaders/ShaderLib,goo/renderer/shaders/ShaderBuilder,goo/util/rsvp,goo/util/ObjectUtil".split(","),function(e,c,b,a,f,d){return function(b){function e(){return e.__super__.constructor.apply(this,arguments)}__extends(e,b);e._register("shader");e.prototype._create=function(){};e.prototype.update=function(b,e){var g,j,n,o,p;console.log("Updating shader "+b);if(e!=null&&e.attributes&&e!=
null&&e.uniforms){o={attributes:e.attributes,uniforms:e.uniforms};p=o.uniforms;for(n in p)if(j=p[n],typeof j==="string"&&(g=/^function\s?\(([^\)]*)\)\s*\{(.*)\}$/,j=j.match(g),(j!=null?j.length:void 0)===3))g=j[1].replace(" ","").split(","),j=j[2],o.uniforms[n]=new Function(g,j);if(e.processors){o.processors=[];j=e.processors;for(p=0,g=j.length;p<g;p++)n=j[p],o.processors.push(a[n].processor)}if(e.defines)o.defines=e.defines}else o=this._getDefaultShaderDefinition();n=[this.getConfig(e.vshaderRef),
this.getConfig(e.fshaderRef)];return f.all(n).then(function(a){var f,g,h;f=a[0];a=a[1];if(f)if(a)return d.extend(o,{attributes:(g=e.attributes)!=null?g:{},uniforms:(h=e.uniforms)!=null?h:{},vshader:f,fshader:a}),c.createShader(o,b);else console.warn("Fragment shader",e.fshaderRef,"in shader",b,"not found");else console.warn("Vertex shader",e.vshaderRef,"in shader",b,"not found")})};e.prototype.remove=function(){};return e}(e)});__hasProp={}.hasOwnProperty;
__extends=function(e,c){function b(){this.constructor=e}for(var a in c)__hasProp.call(c,a)&&(e[a]=c[a]);b.prototype=c.prototype;e.prototype=new b;e.__super__=c.prototype;return e};
define("goo/loaders/handlers/SkeletonHandler",["goo/loaders/handlers/ConfigHandler","goo/animation/Joint","goo/animation/Skeleton","goo/animation/SkeletonPose","goo/util/PromiseUtil"],function(e,c,b,a,f){return function(a){function e(){return e.__super__.constructor.apply(this,arguments)}__extends(e,a);e._register("skeleton");e.prototype._create=function(a){var d,f,e,g;console.debug("Creating skeleton");e=function(){var b,e,h,m;h=a.Joints;m=[];for(b=0,e=h.length;b<e;b++)f=h[b],d=new c(f.Name),d._index=
Math.round(f.Index),d._parentIndex=Math.round(f.ParentIndex),g=f.InverseBindPose.Matrix?JsonUtils.parseTransformMatrix:f.InverseBindPose.Rotation.length===4?JsonUtils.parseTransformQuat:jointObj.InverseBindPose.Rotation.length===3?JsonUtils.parseTransformEuler:JsonUtils.parseTransform,d._inverseBindPose.copy(g(f.InverseBindPose)),f.InverseBindPose.Matrix||d._inverseBindPose.update(),m.push(d);return m}();return new b(a.name,e)};e.prototype.update=function(a,b){var c;c=this._create(b);return f.createDummyPromise(c)};
e.prototype.remove=function(){};return e}(e)});__hasProp={}.hasOwnProperty;__extends=function(e,c){function b(){this.constructor=e}for(var a in c)__hasProp.call(c,a)&&(e[a]=c[a]);b.prototype=c.prototype;e.prototype=new b;e.__super__=c.prototype;return e};
define("goo/loaders/handlers/TextureHandler","goo/loaders/handlers/ConfigHandler,goo/renderer/TextureCreator,goo/renderer/Texture,goo/loaders/dds/DdsLoader,goo/loaders/tga/TgaLoader,goo/util/rsvp,goo/util/PromiseUtil,goo/renderer/Util,goo/util/ObjectUtil".split(","),function(e,c,b,a,f,d,g,j,k){return function(d){function e(a,b,c,d){this.world=a;this.getConfig=b;this.updateObject=c;this.options=d;this._objects={}}__extends(e,d);e._register("texture");e.loaders={dds:a,tga:f};e.prototype._create=function(a,
d){var f;k.defaults(d,{verticalFlip:!0});f=this._objects[a]=new b(j.clone(c.DEFAULT_TEXTURE_2D.image),d);f.image.dataReady=!1;return f};e.prototype.update=function(a,b){var c,d,f,i;(d=this._objects[a])||(d=this._create(a,b));console.log("Loading texture with url "+b.url);if(!b.url)return g.createDummyPromise(d);c=b.url;i=c.split(".").pop().toLowerCase();i in e.loaders?(f=new e.loaders[i],d.a=c,this.getConfig(c).then(function(a){f.load(a,d,b.verticalFlip,0,a.byteLength);return d})):this.getConfig(c).then(function(a){console.log("Adding texture "+
c+", data is "+typeof a);d.setImage(a);return d});return g.createDummyPromise(d)};e.prototype.remove=function(a){console.log("Deleting texture "+a);return delete this._objects[a]};return e}(e)});__hasProp={}.hasOwnProperty;__extends=function(e,c){function b(){this.constructor=e}for(var a in c)__hasProp.call(c,a)&&(e[a]=c[a]);b.prototype=c.prototype;e.prototype=new b;e.__super__=c.prototype;return e};
define("goo/loaders/handlers/TransformComponentHandler","goo/loaders/handlers/ComponentHandler,goo/entities/components/TransformComponent,goo/math/MathUtils,goo/util/rsvp,goo/util/PromiseUtil,goo/util/ObjectUtil".split(","),function(e,c,b,a,f,d){return function(a){function e(){return e.__super__.constructor.apply(this,arguments)}__extends(e,a);e._register("transform");e.prototype._prepare=function(a){return d.defaults(a,{translation:[0,0,0],rotation:[0,0,0],scale:[1,1,1]})};e.prototype._create=function(a){var b;
b=new c;return a.setComponent(b)};e.prototype.update=function(a,c){var d,g=this;d=e.__super__.update.call(this,a,c);d.transform.translation.set(c.translation);d.transform.setRotationXYZ(b.radFromDeg(c.rotation[0]),b.radFromDeg(c.rotation[1]),b.radFromDeg(c.rotation[2]));d.transform.scale.set(c.scale);c.parentRef!=null&&(console.log("Found a parentref, getting..."),this.getConfig(c.parentRef).then(function(a){return g.updateObject(c.parentRef,a,g.options).then(function(a){var b;return a!=null&&((b=
d.parentRef)!=null?b.entity:void 0)!==a?(console.log("Adding parent "+c.parentRef),a.transformComponent.attachChild(d)):a!=null?console.log("Parent is already set"):console.warn("Could not find parent with ref "+c.parentRef)})}));d.setUpdated();return f.createDummyPromise(d)};e.prototype.remove=function(a){a=a.transformComponent;a.transform.translation.set(0,0,0);a.transform.setRotationXYZ(0,0,0);a.transform.scale.set(1,1,1);return a.setUpdated()};return e}(e)});
var __hasProp={}.hasOwnProperty,__indexOf=[].indexOf||function(e){for(var c=0,b=this.length;c<b;c++)if(c in this&&this[c]===e)return c;return-1};
define("goo/loaders/DynamicLoader","goo/loaders/handlers/ConfigHandler,goo/loaders/handlers/ComponentHandler,goo/util/Ajax,goo/renderer/TextureCreator,goo/util/rsvp,goo/util/StringUtil,goo/util/PromiseUtil,goo/util/ObjectUtil,goo/loaders/handlers/CameraComponentHandler,goo/loaders/handlers/EntityHandler,goo/loaders/handlers/LightComponentHandler,goo/loaders/handlers/MaterialHandler,goo/loaders/handlers/MeshDataComponentHandler,goo/loaders/handlers/MeshDataHandler,goo/loaders/handlers/MeshRendererComponentHandler,goo/loaders/handlers/SceneHandler,goo/loaders/handlers/ShaderHandler,goo/loaders/handlers/SkeletonHandler,goo/loaders/handlers/TextureHandler,goo/loaders/handlers/TransformComponentHandler".split(","),function(e,
c,b,a,f,d,g,j){return function(){function a(c){j.defaults(c,{ajax:!0});var d;if(!(d=c.world))throw Error("World argument cannot be null");this._world=d;this._rootPath=c.rootPath;if(this._rootPath==null)throw Error("parameters.rootPath must be defined");this._rootPath.length>1&&this._rootPath.charAt(this._rootPath.length-1)!=="/"&&(this._rootPath+="/");this._configs={};if(c.ajax)this._ajax=new b}var c,h;c=/\.(shader|script|entity|material|scene|mesh|texture)$/;h=j.keys(e.getHandler("texture").loaders);
a.prototype.preloadCache=function(a,b){b==null&&(b=!1);return b?this._configs=a:j.extend(this._configs,a)};a.prototype.loadFromConfig=function(a,b,c){c==null&&(c={});if(b!=null)c.noCache?this._configs=b:j.extend(this._configs,b);if(this._configs[a]==null)throw Error(""+a+" not found in the supplied configs Available keys: \n"+j.keys(this._configs).join("\n"));return this.load(a,c)};a.prototype.loadFromBundle=function(a,b,c){var d=this;c==null&&(c={});return this._loader.load(b,function(f){f=JSON.parse(f);
c.noCache?d._configs=f:j.extend(d._configs,f);if(d._configs[a]==null)throw Error(""+a+" not found in bundle "+b+". Available keys: \n"+j.keys(d._configs).join("\n"));else console.debug(""+a+" was found in bundle "+b+": "+d._configs[a]+". Available keys: \n"+j.keys(d._configs).join("\n"));console.log("Loaded bundle");return d.load(a,c)})};a.prototype.load=function(a,b){b==null&&(b={});return this.update(a,null,b)};a.prototype.update=function(a,b,c){var d=this;c==null&&(c={});console.log("Loading/updating "+
a);b&&(this._configs[a]=b);this._objects={};return this._loadRef(a).then(function(b){var e,g,i,h,k,j;g=[];j=d._getRefsFromConfig(b);i=function(a){return g.push(d._loadRef(a).then(function(b){return d._handle(a,b,c)}))};for(h=0,k=j.length;h<k;h++)e=j[h],i(e);g.push(d._handle(a,b,c));return f.all(g)}).then(function(){return d._configs}).then(null,function(b){return console.error("Error updating "+a+" "+b)})};a.prototype.remove=function(a){delete this._objects[a];delete this._configs[a];return this._handle(a,
null)};a.prototype._handle=function(a,b,c){var d,f,i,h=this;if((d=this._objects[a])!=null&&d.then)return this._objects[a];else if(this._objects[a]&&!c.noCache)return g.createDummyPromise(this._objects[a]);else if(i=this._getTypeForRef(a),f=e.getHandler(i)){if(this._handlers==null)this._handlers={};(d=this._handlers[i])?j.extend(d,{world:this._world,getConfig:this._loadRef.bind(this),updateObject:this._handle.bind(this),options:j.clone(c)}):d=this._handlers[i]=new f(this._world,this._loadRef.bind(this),
this._handle.bind(this),c);console.log("Handling "+a);return b!=null?this._objects[a]=d.update(a,b).then(function(b){return h._objects[a]=b}):(d.remove(a),g.createDummyPromise(null))}else return console.warn("No handler for type "+i),g.createDummyPromise(null)};a.prototype._loadRef=function(a,d){var f,e,h=this;d==null&&(d=!1);return(f=this._configs[a])!=null&&f.then?this._configs[a]:this._configs[a]!=null&&!d?g.createDummyPromise(this._configs[a]):this._ajax?(e=this._rootPath+window.escape(a),this._isImageRef(a)?
this._configs[a]=this._ajax.loadImage(e).then(function(b){return h._configs[a]=b}):(f=this._isBinaryRef(a)?b.ARRAY_BUFFER:null,this._configs[a]=this._ajax.load(e,f).then(function(b){return c.test(a)?h._configs[a]=JSON.parse(b):h._configs[a]=b}))):g.createDummyPromise(null)};a.prototype._getRefsFromConfig=function(a){var b,c;c=[];b=function(a,f){var e,g,i;if(d.endsWith(a,"Refs"))return c=c.concat(f);else if(d.endsWith(a,"Ref"))return c.push(f);else if(f instanceof Object){g=[];for(e in f)__hasProp.call(f,
e)&&(i=f[e],g.push(b(e,i)));return g}};b("",a);return c};a.prototype._getTypeForRef=function(a){a=a.split(".").pop().toLowerCase();a==="ent"&&(a="entity");return a};a.prototype._isImageRef=function(a){a=this._getTypeForRef(a);return a==="png"||a==="jpg"||a==="jpeg"};a.prototype._isBinaryRef=function(a){a=this._getTypeForRef(a);return __indexOf.call(h,a)>=0};a.prototype.getCachedObjectForRef=function(a){return this._objects[a]};return a}()});
define("goo/loaders/ShaderLoader",["goo/util/rsvp","goo/renderer/MeshData","goo/renderer/Shader","goo/loaders/Loader","goo/renderer/shaders/ShaderBuilder"],function(e,c,b,a,f){function d(b){if(typeof b==="undefined"||b===null)throw Error("ShaderLoader(): Argument `parameters` was undefined/null");if(typeof b.loader==="undefined"||!(b.loader instanceof a)||b.loader===null)throw Error("ShaderLoader(): Argument `parameters.loader` was invalid/undefined/null");this._loader=b.loader;this._cache={};this._doCache=
b.cacheShader!==void 0?b.cacheShader:!0}d.prototype.load=function(a){if(this._cache[a]&&this._doCache)return this._cache[a];var b=this._parse.bind(this),c=this._loader.load(a,function(a){return b(a)});return this._cache[a]=c};d.prototype._parse=function(a){typeof a==="string"&&(a=JSON.parse(a));var c=[],d;if(a&&a.attributes&&a.uniforms){d={attributes:a.attributes,uniforms:a.uniforms};for(var i in d.uniforms)if(d.uniforms.hasOwnProperty(i)){var h=d.uniforms[i];if(typeof h==="string"&&(h=h.match(/^function\s?\(([^\)]+)\)\s*\{(.*)}$/))&&
h.length===3){var l=h[1].replace(" ","").split(",");d.uniforms[i]=new Function(l,h[2])}}if(a.defines)d.defines=a.defines;if(a.processors){d.processors=[];for(i=0;i<a.processors.length;i++)d.processors.push(f[a.processors[i]].processor)}}else d=this._getDefaultShaderDefinition();a&&a.vshaderRef&&a.fshaderRef&&(i=this._loader.load(a.vshaderRef).then(function(a){return d.vshader=a}),c.push(i),i=this._loader.load(a.fshaderRef).then(function(a){return d.fshader=a}),c.push(i));return c.length===0?(i=new e.Promise,
i.reject("Shader definition `"+a+"` does not seem to contain any shader data."),i):e.all(c).then(function(){return new b(a.name,d)})};d.prototype._getDefaultShaderDefinition=function(){return{attributes:{vertexPosition:c.POSITION,vertexNormal:c.NORMAL,vertexUV0:c.TEXCOORD0},uniforms:{viewMatrix:b.VIEW_MATRIX,projectionMatrix:b.PROJECTION_MATRIX,worldMatrix:b.WORLD_MATRIX,cameraPosition:b.CAMERA,lightPosition:b.LIGHT0,diffuseMap:b.DIFFUSE_MAP,materialAmbient:b.AMBIENT,materialDiffuse:b.DIFFUSE,materialSpecular:b.SPECULAR,
materialSpecularPower:b.SPECULAR_POWER}}};return d});
define("goo/loaders/MaterialLoader","goo/util/rsvp,goo/renderer/MeshData,goo/renderer/Shader,goo/renderer/TextureCreator,goo/renderer/Material,goo/loaders/Loader,goo/loaders/ShaderLoader,goo/renderer/shaders/ShaderLib".split(","),function(e,c,b,a,f,d,g,j){function k(a){if(typeof a==="undefined"||a===null)throw Error("MaterialLoader(): Argument `parameters` was undefined/null");if(typeof a.loader==="undefined"||!(a.loader instanceof d)||a.loader===null)throw Error("MaterialLoader(): Argument `parameters.loader` was invalid/undefined/null");
this._loader=a.loader;this._cache={};this._shaderLoader=new g(a);this._waitForTextures=a.waitForTextures!==void 0?a.waitForTextures:!0}k.prototype.load=function(a){if(this._cache[a])return this._cache[a];var b=this,c=this._loader.load(a,function(a){return b._parse(a)}).then(null,function(){return f.createMaterial(j.texturedLit,"DefaultShader")});return this._cache[a]=c};k.prototype._parse=function(b){function c(b,f){typeof f==="string"&&(f=JSON.parse(f));if(f.url){var g=new a({loader:d._loader});
if(d._waitForTextures){var i=new e.Promise;m[b]=g.loadTexture2D(f.url,null,function(){i.resolve()});return i}else m[b]=g.loadTexture2D(f.url)}else m[b]=null}typeof b==="string"&&(b=JSON.parse(b));var d=this,g=[],k,p={},m={},s=b.name||"DefaultMaterial";if(b){var q;(q=b.shaderRef)?q=this._shaderLoader.load(q).then(function(a){return k=a}):(q=new e.Promise,q.then(function(a){return k=a}),q.resolve(f.createShader(j.texturedLit,"DefaultShader")));g.push(q);if(b.uniforms)for(var t in b.uniforms)p[t]=b.uniforms[t];
if(b.texturesMapping&&Object.keys(b.texturesMapping).length)for(t in b.texturesMapping){q=b.texturesMapping[t];var u=c.bind(null,t);q=this._loader.load(q).then(u);g.push(q)}else if(b.textureRefs&&b.textureRefs.length){t=["DIFFUSE_MAP","NORMAL_MAP","SPECULAR_MAP"];for(var v=Math.min(b.textureRefs.length,t.length),r=0;r<v;r++)q=b.textureRefs[r],u=c.bind(null,t[r]),q=this._loader.load(q).then(u),g.push(q)}}return g.length===0?(q=new e.Promise,q.reject("Material definition `"+b+"` does not seem to contain a shader definition."),
q):e.all(g).then(function(){var a=new f(s);a.shader=k;a._textureMaps=m;a.materialState=void 0;a.uniforms=p;if(b){var c=function(a,b){if(b)for(var c in b)a[c]=b[c]};c(a.cullState,b.cullState);c(a.blendState,b.blendState);c(a.depthState,b.depthState);c(a.offsetState,b.offsetState);if(typeof b.renderQueue==="number"&&b.renderQueue>-1)a.renderQueue=b.renderQueue;if(typeof b.wireframe==="boolean")a.wireframe=b.wireframe}return a})};k.prototype._getDefaultMaterialState=function(){return{ambient:[0.1,0.1,
0.1,1],emissive:[0,0,0,0],diffuse:[1,1,1,1],specular:[0.8,0.8,0.8,1],shininess:16}};return k});
define("goo/loaders/SkeletonLoader",["goo/animation/Skeleton","goo/animation/SkeletonPose","goo/animation/Joint","goo/loaders/Loader","goo/loaders/JsonUtils"],function(e,c,b,a,f){function d(a){if(typeof a==="undefined"||a===null)throw Error("SkeletonLoader(): Argument `parameters` was undefined/null");if(typeof a.loader==="undefined"||a.loader===null)throw Error("SkeletonLoader(): Argument `parameters.loader` was invalid/undefined/null");this._loader=a.loader;this._cache={}}d.prototype.load=function(a){if(this._cache[a])return this._cache[a];
var b=d.prototype._loadSkeleton.bind(this),c=d.prototype._parseSkeleton.bind(this),f=d.prototype._createSkeletonPose.bind(this),b=b(a).then(c).then(f);return this._cache[a]=b};d.prototype._loadSkeleton=function(a){return this._loader.load(a)};d.prototype._parseSkeleton=function(a){typeof a==="string"&&(a=JSON.parse(a));for(var c=a.Name,a=a.Joints,d=[],i=0,h=a.length;i<h;i++){var l=a[i],n=new b(l.Name);n._index=Math.round(l.Index);n._parentIndex=Math.round(l.ParentIndex);l.InverseBindPose.Matrix?n._inverseBindPose.copy(f.parseTransformMatrix(l.InverseBindPose)):
(l.InverseBindPose.Rotation.length===4?n._inverseBindPose.copy(f.parseTransformQuat(l.InverseBindPose)):l.InverseBindPose.Rotation.length===3?n._inverseBindPose.copy(f.parseTransformEuler(l.InverseBindPose)):n._inverseBindPose.copy(f.parseTransform(l.InverseBindPose)),n._inverseBindPose.update());d[i]=n}return new e(c,d)};d.prototype._createSkeletonPose=function(a){a=new c(a);a.setToBindPose();return a};return d});
define("goo/loaders/MeshLoader",["goo/util/rsvp","goo/loaders/JsonUtils","goo/renderer/MeshData","goo/loaders/SkeletonLoader"],function(e,c,b,a){function f(b){if(typeof b==="undefined"||b===null)throw Error("MeshLoader(): Argument `parameters` was undefined/null");if(typeof b.loader==="undefined"||b.loader===null)throw Error("MeshLoader(): Argument `parameters.loader` was invalid/undefined/null");this._loader=b.loader;this._skeletonLoader=new a(b);this._cache={}}f.prototype.load=function(a){if(this._cache[a])return this._cache[a];
var b=this,c=this._loader.load(a,function(a){return b._parse(a)});return this._cache[a]=c};f.prototype._parse=function(a){typeof a==="string"&&(a=JSON.parse(a));var c=new e.Promise;try{if(Object.keys(a).length===0)return c.reject("Empty meshdata"),c;if(a.compression)this.useCompression=a.compression.compressed||!1,this.compressedVertsRange=a.compression.compressedVertsRange||16383,this.compressedColorsRange=a.compression.compressedColorsRange||255,this.compressedUnitVectorRange=a.compression.compressedUnitVectorRange||
1023;var f=a.type==="SkinnedMesh"?"SkinnedMesh":"Mesh",k;a.type==="SkinnedMesh"?(k=this._parseMeshData(a.data||a,4,f),k.type=b.SKINMESH):(k=this._parseMeshData(a.data||a,0,f),k.type=b.MESH);a.pose?c=this._skeletonLoader.load(a.pose).then(function(a){k.currentPose=a;return k}):c.resolve(k)}catch(i){c.reject(i)}return c};f.prototype._parseMeshData=function(a,f,e){var k=a.vertexCount;if(k===0)return null;var i=a.indexLengths?a.indexLengths[0]:a.indices?a.indices.length:0,h={};if(a.vertices&&a.vertices.length>
0)h.POSITION=b.createAttribute(3,"Float");if(a.normals&&a.normals.length>0)h.NORMAL=b.createAttribute(3,"Float");if(a.tangents&&a.tangents.length>0)h.TANGENT=b.createAttribute(4,"Float");if(a.colors&&a.colors.length>0)h.COLOR=b.createAttribute(4,"Float");if(f>0&&a.weights)h.WEIGHTS=b.createAttribute(4,"Float");if(f>0&&a.joints)h.JOINTIDS=b.createAttribute(4,"Short");if(a.textureCoords&&a.textureCoords.length>0)for(var l in a.textureCoords)h["TEXCOORD"+l]=b.createAttribute(2,"Float");i=new b(h,k,i);
if(a.vertices&&a.vertices.length>0)this.useCompression?(l=a.vertexOffsets,c.fillAttributeBufferFromCompressedString(a.vertices,i,b.POSITION,[a.vertexScale,a.vertexScale,a.vertexScale],[l.xOffset,l.yOffset,l.zOffset])):c.fillAttributeBuffer(a.vertices,i,b.POSITION);f>0&&a.weights&&(this.useCompression?(h=1/this.compressedVertsRange,c.fillAttributeBufferFromCompressedString(a.weights,i,b.WEIGHTS,[h],[0])):c.fillAttributeBuffer(a.weights,i,b.WEIGHTS));a.normals&&a.normals.length>0&&(this.useCompression?
(l=1-(this.compressedUnitVectorRange+1>>1),h=1/-l,c.fillAttributeBufferFromCompressedString(a.normals,i,b.NORMAL,[h,h,h],[l,l,l])):c.fillAttributeBuffer(a.normals,i,b.NORMAL));a.tangents&&a.tangents.length>0&&(this.useCompression?(l=1-(this.compressedUnitVectorRange+1>>1),h=1/-l,c.fillAttributeBufferFromCompressedString(a.tangents,i,b.TANGENT,[h,h,h,h],[l,l,l,l])):c.fillAttributeBuffer(a.tangents,i,b.TANGENT));a.colors&&a.colors.length>0&&(this.useCompression?(l=0,h=255/(this.compressedColorsRange+
1),c.fillAttributeBufferFromCompressedString(a.colors,i,b.COLOR,[h,h,h,h],[l,l,l,l])):c.fillAttributeBuffer(a.colors,i,b.COLOR));if(a.textureCoords&&a.textureCoords.length>0)if(h=a.textureCoords,this.useCompression)for(l=0;l<h.length;l++){var n=h[l];c.fillAttributeBufferFromCompressedString(n.UVs,i,"TEXCOORD"+l,n.UVScales,n.UVOffsets)}else for(l=0;l<h.length;l++)c.fillAttributeBuffer(h[l],i,"TEXCOORD"+l);if(f>0&&a.joints)if(h=i.getAttributeBuffer(b.JOINTIDS),n=this.useCompression?c.getIntBufferFromCompressedString(a.joints,
32767):c.getIntBuffer(a.joints,32767),e==="SkinnedMesh"){var e=[],o=0;l=0;for(var p=n.length;l<p;l++){var m=n[l];e[m]===void 0&&(e[m]=o++);h.set([e[m]],l)}l=[];for(m=0;m<e.length;m++)o=e[m],o!==void 0&&(l[o]=m);i.paletteMap=l;i.weightsPerVertex=f}else{l=0;for(p=n.capacity();l<p;l++)h.putCast(l,n.get(l))}a.indices&&(this.useCompression?i.getIndexBuffer().set(c.getIntBufferFromCompressedString(a.indices,k)):i.getIndexBuffer().set(c.getIntBuffer(a.indices,k)));if(a.indexModes)if(f=a.indexModes,f.length===
1)i.indexModes[0]=f[0];else{k=[];for(l=0;l<f.length;l++)k[l]=f[l];i.indexModes=k}if(a.indexLengths){f=a.indexLengths;k=[];for(l=0;l<f.length;l++)k[l]=f[l];i.indexLengths=k}if(a.boundingBox)i.boundingBox=a.boundingBox;return i};return f});
define("goo/loaders/EntityLoader","goo/entities/Entity,goo/renderer/Camera,goo/entities/components/CameraComponent,goo/entities/components/TransformComponent,goo/entities/components/MeshRendererComponent,goo/entities/components/MeshDataComponent,goo/renderer/MeshData,goo/math/Vector3,goo/math/MathUtils,goo/renderer/bounds/BoundingBox,goo/util/rsvp,goo/loaders/MaterialLoader,goo/loaders/MeshLoader,goo/loaders/Loader".split(","),function(e,c,b,a,f,d,g,j,k,i,h,l,n,o){function p(a){if(typeof a==="undefined"||
a===null)throw Error("EntityLoader(): Argument `parameters` was undefined/null");if(typeof a.loader==="undefined"||!(a.loader instanceof o)||a.loader===null)throw Error("EntityLoader(): Argument `parameters.loader` was invalid/undefined/null");if(typeof a.world==="undefined"||a.world===null)throw Error("EntityLoader(): Argument `parameters.world` was undefined/null");this._loader=a.loader;this._world=a.world;this._cache={};this._materialLoader=new l(a);this._meshLoader=new n(a)}p.prototype.load=function(a){if(this._cache[a])return this._cache[a];
var b=this._loader.load(a,function(b){return this._parse(b,a)}.bind(this));return this._cache[a]=b};p.prototype._parse=function(a,b){typeof a==="string"&&(a=JSON.parse(a));var c=[],d=[],f=this;if(a.components){var i;(i=a.components.transform)&&d.push(this._getTransformComponent(i));(i=a.components.camera)&&d.push(this._getCameraComponent(i));if(i=a.components.meshRenderer)i=this._getMeshRendererComponent(i).then(function(a){d.push(a);return a}),c.push(i);if(i=a.components.meshData)i=this._getMeshDataComponent(i).then(function(a){d.push(a);
return a}),c.push(i)}return d.length===0&&c.length===0?(i=new h.Promise,i.reject("Entity definition `"+a+"` does not seem to contain any components."),i):h.all(c).then(function(){var c=new e(f._world,a.name||b);c.ref=b;for(var i in d)d[i].type==="TransformComponent"&&c.clearComponent("transformComponent"),c.setComponent(d[i]);if(c.meshDataComponent&&c.meshDataComponent.meshData.type===g.SKINMESH&&c.meshRendererComponent&&c.meshRendererComponent.materials.length){var h=c.meshRendererComponent.materials,
k;i=0;for(var j=h.length;i<j;i++)if((k=h[i].shader.defines)&&k.JOINT_COUNT!==void 0&&k.WEIGHTS!==void 0)k.JOINT_COUNT=c.meshDataComponent.meshData.paletteMap.length,k.WEIGHTS=c.meshDataComponent.meshData.weightsPerVertex}return c})};p.prototype._getTransformComponent=function(b){var c=new a;c.transform.translation.set(b.translation);c.transform.scale.set(b.scale);c.transform.rotation.fromAngles(k.radFromDeg(b.rotation[0]),k.radFromDeg(b.rotation[1]),k.radFromDeg(b.rotation[2]));(b=b.parentRef)&&this.load(b).then(function(a){a.transformComponent.attachChild(c);
return a});return c};p.prototype._getCameraComponent=function(a){a=new c(a.fov||45,a.aspect||1,a.near||1,a.far||100);return new b(a)};p.prototype._getMeshRendererComponent=function(a){var b=[],c=this._materialLoader,d;for(d in a)if(d==="materialRefs")for(var e in a[d]){var g=c.load(a[d][e]);b.push(g)}return h.all(b).then(function(b){var c=new f,d;for(d in a)c.hasOwnProperty(d)&&d!=="materials"&&(c[d]=a[d]);for(var e in b)c.materials.push(b[e]);return c})};p.prototype._getMeshDataComponent=function(a){var b=
[],c=this._meshLoader,f;for(f in a)if(f==="meshRef"){var e=c.load(a[f]);b.push(e)}return h.all(b).then(function(a){var b=new d(a[0]);if(a[0].boundingBox){var c=a[0].boundingBox.min,f=a[0].boundingBox.max,a=[f[0]-c[0],f[1]-c[1],f[2]-c[2]],c=[(f[0]+c[0])*0.5,(f[1]+c[1])*0.5,(f[2]+c[2])*0.5],f=new i;f.xExtent=a[0];f.yExtent=a[1];f.zExtent=a[2];f.center.seta(c);b.modelBound=f;b.autoCompute=!1}return b})};return p});
define("goo/util/URLTools",[],function(){function e(){}e.getDirectory=function(c){var b=/.*\//.exec(c);return!b?c+"/":b[0]};return e});
define("goo/loaders/JSONImporter","goo/renderer/MeshData,goo/loaders/JsonUtils,goo/entities/components/MeshDataComponent,goo/entities/components/MeshRendererComponent,goo/renderer/Material,goo/renderer/TextureCreator,goo/animation/Joint,goo/animation/Skeleton,goo/animation/SkeletonPose,goo/animation/clip/AnimationClip,goo/animation/clip/JointChannel,goo/animation/clip/TransformChannel,goo/animation/clip/InterpolatedFloatChannel,goo/animation/state/loader/OutputStore,goo/util/URLTools,goo/util/SimpleResourceUtil,goo/renderer/shaders/ShaderLib,goo/renderer/Shader".split(","),function(e,
c,b,a,f,d,g,j,k,i,h,l,n,o,p,m,s,q){function t(a){this.world=a;this.materials={};this.skeletonMap={};this.poseMap={};this.slotUnitMap={diffuse:q.DIFFUSE_MAP,normal:q.NORMAL_MAP,ao:q.AO_MAP,occlusion:"OCCLUSION_MAP",specular:q.SPECULAR_MAP};this.loadedEntities=[];this.baseTextureDir=""}function u(){this.materialName="not set";this.technique=this.profile=null;this.textureReferences={};this.textureFileNames={};this.textureMinificationFilters={};this.textureFlipSettings={};this.usesTransparency=!1;this.materialState=
{};this.connectedMeshes=[]}t.prototype.load=function(a,b,c,d){var f=new XMLHttpRequest;if(typeof b==="undefined"||b===null)b=p.getDirectory(a);f.open("GET",a,!0);var e=this;f.onreadystatechange=function(){if(f.readyState===4)if(f.status>=200&&f.status<=299){var a=e.parse(f.responseText,b,d);c.onSuccess(a)}else c.onError(f.statusText)};f.send()};t.prototype.parse=function(a,b,c){this.baseTextureDir=b||"";this.loadedEntities=[];this.shaderExtractor=c;a=JSON.parse(a);if(this.useCompression=a.UseCompression||
!1)this.compressedVertsRange=a.CompressedVertsRange||16383,this.compressedColorsRange=a.CompressedColorsRange||255,this.compressedUnitVectorRange=a.CompressedUnitVectorRange||1023;this._parseMaterials(a.Materials);a.Skeletons&&this.parseSkeletons(a.Skeletons);a.SkeletonPoses&&this.parseSkeletonPoses(a.SkeletonPoses);this._parseSpatial(a.Scene);delete this.shaderExtractor;return this.loadedEntities};t.prototype._parseSpatial=function(d){var f=d.Type,g=d.Name===null?"null":d.Name,i=this.world.createEntity();
i.name=g;this.loadedEntities.push(i);if(f==="Node"){if(d.Children)for(var h in d.Children)f=this._parseSpatial(d.Children[h]),f!==null&&i.transformComponent.attachChild(f.transformComponent)}else if(f==="Mesh"){h=this._parseMeshData(d.MeshData,0,i,f);if(h===null)return null;h.type=e.MESH;i.setComponent(new b(h));f=new a;i.setComponent(f);this._parseMaterial(d,i)}else if(f==="SkinnedMesh"){h=this._parseMeshData(d.MeshData,4,i,f);if(h===null)return null;h.type=e.SKINMESH;i.setComponent(new b(h));f=
new a;i.setComponent(f);this._parseMaterial(d,i);if(d.Pose)h.currentPose=this.poseMap[d.Pose]}else return;d=c.parseTransform(d.Transform);i.transformComponent.transform=d;return i};t.prototype.parseSkeletons=function(a){for(var b=0,d=a.length;b<d;b++){for(var f=a[b],e=f.ref,i=f.Name,f=f.Joints,h=[],k=0,l=f.length;k<l;k++){var m=f[k],n=new g(m.Name);n._index=Math.round(m.Index);n._parentIndex=Math.round(m.ParentIndex);n._inverseBindPose.copy(c.parseTransform(m.InverseBindPose));n._inverseBindPose.update();
h[k]=n}i=new j(i,h);this.skeletonMap[e]=i}};t.prototype.parseSkeletonPoses=function(a){for(var b=0,c=a.length;b<c;b++){var d=a[b],f=d.ref,d=new k(this.skeletonMap[d.Skeleton]);d.setToBindPose();this.poseMap[f]=d}};t.prototype._parseMeshData=function(a,b,d,f){var g=a.VertexCount;if(g===0)return null;var d=a.IndexLengths?a.IndexLengths[0]:a.Indices?a.Indices.length:0,i={};if(a.Vertices)i.POSITION=e.createAttribute(3,"Float");if(a.Normals)i.NORMAL=e.createAttribute(3,"Float");if(a.Tangents)i.TANGENT=
e.createAttribute(4,"Float");if(a.Colors)i.COLOR=e.createAttribute(4,"Float");if(b>0&&a.Weights)i.WEIGHTS=e.createAttribute(4,"Float");if(b>0&&a.Joints)i.JOINTIDS=e.createAttribute(4,"Short");if(a.TextureCoords)for(var h in a.TextureCoords)i["TEXCOORD"+h]=e.createAttribute(2,"Float");d=new e(i,g,d);if(a.Vertices)this.useCompression?(h=a.VertexOffsets,c.fillAttributeBufferFromCompressedString(a.Vertices,d,e.POSITION,[a.VertexScale,a.VertexScale,a.VertexScale],[h.xOffset,h.yOffset,h.zOffset])):c.fillAttributeBuffer(a.Vertices,
d,e.POSITION);a.Weights&&(this.useCompression?(i=1/this.compressedVertsRange,c.fillAttributeBufferFromCompressedString(a.Weights,d,e.WEIGHTS,[i],[0])):c.fillAttributeBuffer(a.Weights,d,e.WEIGHTS));a.Normals&&(this.useCompression?(h=1-(this.compressedUnitVectorRange+1>>1),i=1/-h,c.fillAttributeBufferFromCompressedString(a.Normals,d,e.NORMAL,[i,i,i],[h,h,h])):c.fillAttributeBuffer(a.Normals,d,e.NORMAL));a.Tangents&&(this.useCompression?(h=1-(this.compressedUnitVectorRange+1>>1),i=1/-h,c.fillAttributeBufferFromCompressedString(a.Tangents,
d,e.TANGENT,[i,i,i,i],[h,h,h,h])):c.fillAttributeBuffer(a.Tangents,d,e.TANGENT));a.Colors&&(this.useCompression?(h=0,i=255/(this.compressedColorsRange+1),c.fillAttributeBufferFromCompressedString(a.Colors,d,e.COLOR,[i,i,i,i],[h,h,h,h])):c.fillAttributeBuffer(a.Colors,d,e.COLOR));if(a.TextureCoords)if(i=a.TextureCoords,this.useCompression)for(h=0;h<i.length;h++){var k=i[h];c.fillAttributeBufferFromCompressedString(k.UVs,d,"TEXCOORD"+h,k.UVScales,k.UVOffsets)}else for(h=0;h<i.length;h++)c.fillAttributeBuffer(i[h],
d,"TEXCOORD"+h);if(a.Joints)if(i=d.getAttributeBuffer(e.JOINTIDS),k=this.useCompression?c.getIntBufferFromCompressedString(a.Joints,32767):c.getIntBuffer(a.Joints,32767),f==="SkinnedMesh"){var f=[],j=0;h=0;for(var l=k.length;h<l;h++){var m=k[h];f[m]===void 0&&(f[m]=j++);i.set([f[m]],h)}h=[];for(m=0;m<f.length;m++)j=f[m],j!==void 0&&(h[j]=m);d.paletteMap=h;d.weightsPerVertex=b}else{h=0;for(l=k.capacity();h<l;h++)i.putCast(h,k.get(h))}a.Indices&&(this.useCompression?d.getIndexBuffer().set(c.getIntBufferFromCompressedString(a.Indices,
g)):d.getIndexBuffer().set(c.getIntBuffer(a.Indices,g)));if(a.IndexModes)if(b=a.IndexModes,b.length===1)d.indexModes[0]=b[0];else{g=[];for(h=0;h<b.length;h++)g[h]=b[h];d.indexModes=g}if(a.IndexLengths){a=a.IndexLengths;b=[];for(h=0;h<a.length;h++)b[h]=a[h];d.indexLengths=b}return d};t.prototype._parseMaterials=function(a){if(a)for(var b=0,c=a.length;b<c;b++){var d=a[b];if(d!==null){var f=new u;f.materialName=d.MaterialName;f.profile=d.Profile;f.technique=d.Technique;f.usesTransparency=d.UsesTransparency;
f.materialState=this._parseMaterialstate(d);if(d.TextureEntries)for(var d=d.TextureEntries,e=0,g=d.length;e<g;e++){var i=d[e],h=i.Slot,k=i.TextureReference||null,j=i.TextureSource||null,l=i.MinificationFilter||null,m="Trilinear";if(l!==null)try{m="minificationFilterStr"}catch(n){console.warn("Bad texture minification filter: "+l)}i=i.Flip!==void 0?i.Flip:!0;f.textureReferences[h]=k;f.textureFileNames[h]=j;f.textureMinificationFilters[h]=m;f.textureFlipSettings[h]=i}this.materials[f.materialName]=
f}}};t.prototype._parseMaterial=function(a,b){if(a.Material){var c=this.materials[a.Material];if(c!==void 0){var e=b.meshRendererComponent,g=b.meshDataComponent.meshData.attributeMap,i=null;if(this.shaderExtractor)if(g=this.shaderExtractor(g,c),g instanceof f)i=g;else if(g instanceof q)i=new f(c.materialName),i.shader=g;else throw Error("The extractor should return a Material or a Shader");else i=f.createMaterial(g.NORMAL&&g.TANGENT&&g.TEXCOORD0&&g.TEXCOORD1&&g.TEXCOORD2&&c.textureFileNames.diffuse&&
c.textureFileNames.normal&&c.textureFileNames.ao?s.texturedNormalAOLit:g.NORMAL&&g.TEXCOORD0&&c.textureFileNames.diffuse?s.texturedLit:g.TEXCOORD0&&c.textureFileNames.diffuse?s.textured:s.simple,c.materialName);e.materials[0]=i;i.materialState=c.materialState;for(var h in this.slotUnitMap)c.textureFileNames[h]!==void 0&&(e=c.textureFileNames[h],e=(new d).loadTexture2D(this.baseTextureDir+e),i.setTexture(this.slotUnitMap[h],e))}}};t.prototype._parseMaterialstate=function(a){var b={};b.ambient=this._parseColor(a.AmbientColor);
b.diffuse=this._parseColor(a.DiffuseColor);b.emissive=this._parseColor(a.EmissiveColor);b.specular=this._parseColor(a.SpecularColor);b.shininess=a.Shininess;return b};t.prototype._parseColor=function(a){return(a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})*$/i.exec(a))?[parseInt(a[1],16)/255,parseInt(a[2],16)/255,parseInt(a[3],16)/255,a[4]!==void 0?parseInt(a[4],16)/255:1]:null};t.prototype.importAnimationTree=function(a,b,c){return this.importAnimationTreeFromJSON(a,JSON.parse(b),c)};t.prototype.importAnimationTreeFromJSON=
function(a,b,d){var f=new o;if(!b.Clips||!b.Layers){if(d)d.onSuccess(f)}else{for(var e=b.Clips,g=[],i=[],h=0,k=e.length;h<k;h++){var j=e[h];g.push(j.Name);i.push(j.URL)}m.loadTextAssets(i,g,{onSuccess:function(e){for(var i={},h=0,k=g.length;h<k;h++){var j=(new t).importAnimation(e[g[h]],g[h]);i[j._name]=j}c.parseAnimationLayers(a,d,i,f,b)},onError:function(a){console.warn("failed loading tree clips: "+a);if(d)d.onError(a)}})}};t.prototype.importAnimation=function(a,b){var d=new i(b),f=JSON.parse(a);
if(this.useCompression=f.UseCompression||!1)this.compressedAnimRange=f.CompressedRange||32767;if(f.Channels)for(var f=f.Channels,e=0,g=f.length;e<g;e++){var k=f[e],j=k.Type,m=k.Name,o=c.parseChannelTimes(k,this.useCompression);if("Joint"===j)var m=k.JointName,p=k.JointIndex,j=c.parseRotationSamples(k,this.compressedAnimRange,this.useCompression),q=c.parseTranslationSamples(k,o.length,this.useCompression),k=c.parseScaleSamples(k,o.length,this.useCompression),o=new h(m,p,o,j,q,k);else if("Transform"===
j)j=c.parseRotationSamples(k,this.compressedAnimRange,this.useCompression),q=c.parseTranslationSamples(k,o.length,this.useCompression),k=c.parseScaleSamples(k,o.length,this.useCompression),o=new l(m,o,j,q,k);else if("FloatLERP"===j)o=new n(m,o,c.parseFloatLERPValues(k,this.useCompression));else{console.warn("Unhandled channel type: "+j);continue}d.addChannel(o)}return d};return t});
define("goo/loaders/SceneLoader",["goo/loaders/Loader","goo/loaders/EntityLoader","goo/util/rsvp"],function(e,c,b){function a(a){if(typeof a==="undefined"||a===null)throw Error("SceneLoader(): Argument `parameters` was undefined/null");if(typeof a.loader==="undefined"||!(a.loader instanceof e)||a.loader===null)throw Error("SceneLoader(): Argument `parameters.loader` was invalid/undefined/null");if(typeof a.world==="undefined"||a.world===null)throw Error("SceneLoader(): Argument `parameters.world` was undefined/null");
this._parameters=a;this._loader=a.loader;this._world=a.world;this._cacheShader=a.cacheShader}a.prototype.load=function(a){var b=this;return this._loader.load(a,function(c){return b._parse(c,a)})};a.prototype._parse=function(a){typeof a==="string"&&(a=JSON.parse(a));var d=[];if(a&&a.entityRefs&&a.entityRefs.length)for(var e=new c(this._parameters),j=0;j<a.entityRefs.length;++j)d.push(e.load(a.entityRefs[j]));this.globals=a.globals;return b.all(d).then(function(a){return a})};a.prototype._buildWorld=
function(a){for(var b=0;b<a.length;++b)a[b].addToWorld();this._world.process();return this._world};return a});
define("goo/loaders/ScriptLoader",["goo/util/rsvp","goo/loaders/Loader"],function(e,c){function b(a){if(typeof a==="undefined"||a===null)throw Error("ScriptLoader(): Argument `parameters` was undefined/null");if(typeof a.loader==="undefined"||!(a.loader instanceof c)||a.loader===null)throw Error("ScriptLoader(): Argument `parameters.loader` was invalid/undefined/null");this._loader=a.loader;this._cache={}}b.prototype.load=function(a,b){if(this._cache[a])return this._cache[a].then(function(a){return new a(b)});
var c=this._parse.bind(this),e=this._loader.load(a,function(a){return c(a)});this._cache[a]=e;return e.then(function(a){return new a(b)})};b.prototype._parse=function(a){typeof a==="string"&&(a=JSON.parse(a));return this._loadScript(a.jsRef)};b.prototype._loadScript=function(a){var b=new e.Promise;require([this._loader.rootPath+a],function(a){b.resolve(a)});return b};return b});
define("goo/math/Matrix2x2",["goo/math/MathUtils","goo/math/Matrix"],function(e,c){function b(){c.call(this,2,2);arguments.length===0?this.setIdentity():this.set(arguments)}b.prototype=Object.create(c.prototype);b.prototype.setupAliases([["e00"],["e10"],["e01"],["e11"]]);b.IDENTITY=new b(1,0,0,1);b.add=function(a,c,d){d||(d=new b);c instanceof b?(d.e00=a.e00+c.e00,d.e10=a.e10+c.e10,d.e01=a.e01+c.e01,d.e11=a.e11+c.e11):(d.e00=a.e00+c,d.e10=a.e10+c,d.e01=a.e01+c,d.e11=a.e11+c);return d};b.prototype.add=
function(a){return b.add(this,a,this)};b.sub=function(a,c,d){d||(d=new b);c instanceof b?(d.e00=a.e00-c.e00,d.e10=a.e10-c.e10,d.e01=a.e01-c.e01,d.e11=a.e11-c.e11):(d.e00=a.e00-c,d.e10=a.e10-c,d.e01=a.e01-c,d.e11=a.e11-c);return d};b.prototype.sub=function(a){return b.sub(this,a,this)};b.mul=function(a,c,d){d||(d=new b);c instanceof b?(d.e00=a.e00*c.e00,d.e10=a.e10*c.e10,d.e01=a.e01*c.e01,d.e11=a.e11*c.e11):(d.e00=a.e00*c,d.e10=a.e10*c,d.e01=a.e01*c,d.e11=a.e11*c);return d};b.prototype.mul=function(a){return b.mul(this,
a,this)};b.div=function(a,c,d){d||(d=new b);c instanceof b?(d.e00=a.e00/c.e00,d.e10=a.e10/c.e10,d.e01=a.e01/c.e01,d.e11=a.e11/c.e11):(c=1/c,d.e00=a.e00*c,d.e10=a.e10*c,d.e01=a.e01*c,d.e11=a.e11*c);return d};b.prototype.div=function(a){return b.div(this,a,this)};b.combine=function(a,f,d){d||(d=new b);if(d===a||d===f)return c.copy(b.combine(a,f),d);d.e00=a.e00*f.e00+a.e01*f.e10;d.e10=a.e10*f.e00+a.e11*f.e10;d.e01=a.e00*f.e01+a.e01*f.e11;d.e11=a.e10*f.e01+a.e11*f.e11;return d};b.prototype.combine=function(a){return b.combine(this,
a,this)};b.transpose=function(a,f){f||(f=new b);if(f===a)return c.copy(b.transpose(a),f);f.e00=a.e00;f.e10=a.e01;f.e01=a.e10;f.e11=a.e11;return f};b.prototype.transpose=function(){return b.transpose(this,this)};b.invert=function(a,f){f||(f=new b);if(f===a)return c.copy(b.invert(a),f);var d=a.determinant();if(Math.abs(d)<e.EPSILON)throw{name:"Singular Matrix",message:"The matrix is singular and cannot be inverted."};d=1/d;f.e00=a.e11*d;f.e10=0-a.e10*d;f.e01=0-a.e01*d;f.e11=a.e00*d;return f};b.prototype.invert=
function(){return b.invert(this,this)};b.prototype.isOrthogonal=function(){return Math.abs(this.e00*this.e01+this.e10*this.e11)>e.EPSILON?!1:!0};b.prototype.isNormal=function(){var a;a=this.e00*this.e00+this.e10*this.e10;if(Math.abs(a-1)>e.EPSILON)return!1;a=this.e01*this.e01+this.e11*this.e11;return Math.abs(a-1)>e.EPSILON?!1:!0};b.prototype.isOrthonormal=function(){return this.isOrthogonal()&&this.isNormal()};b.prototype.determinant=function(){return this.e00*this.e11-this.e01*this.e10};b.prototype.setIdentity=
function(){this.set(b.IDENTITY);return this};return b});
define("goo/math/Versor",["goo/math/Matrix3x3","goo/math/Matrix4x4","goo/math/Vector"],function(e,c,b){function a(){b.call(this,4);this.set(arguments.length!==0?arguments:[0,0,0,1])}a.prototype=Object.create(b.prototype);a.prototype.setupAliases([["x"],["y"],["z"],["w"]]);a.IDENTITY=new a(0,0,0,1);a.combine=function(c,d,e){e||(e=new a);if(e===c||e===d)return b.copy(a.combine(c,d),e);e.data[0]=c.data[3]*d.data[0]+d.data[3]*c.data[0]+d.data[2]*c.data[1]-d.data[1]*c.data[2];e.data[1]=c.data[3]*d.data[1]+
d.data[3]*c.data[1]+d.data[0]*c.data[2]-d.data[2]*c.data[0];e.data[2]=c.data[3]*d.data[2]+d.data[3]*c.data[2]+d.data[1]*c.data[0]-d.data[0]*c.data[1];e.data[3]=c.data[3]*d.data[3]-(c.data[0]*d.data[0]+c.data[1]*d.data[1]+c.data[2]*d.data[2]);return e};a.prototype.combine=function(b){return a.combine(this,b,this)};a.invert=function(b,c){c||(c=new a);c.data[0]=0-b.data[0];c.data[1]=0-b.data[1];c.data[2]=0-b.data[2];c.data[3]=b.data[3];return c};a.prototype.invert=function(){return a.invert(this,this)};
a.fromAngleAxis=function(b,c,e){var j=Math.sin(b*0.5),b=Math.cos(b*0.5);e||(e=new a);c.normalize();e.data[0]=c.data[0]*j;e.data[1]=c.data[1]*j;e.data[2]=c.data[2]*j;e.data[3]=b;return e};a.prototype.fromAngleAxis=function(b,c){return a.fromAngleAxis(b,c,this)};a.fromAngleNormalAxis=function(b,c,e){var j=Math.sin(b*0.5),b=Math.cos(b*0.5);e||(e=new a);e.data[0]=c.data[0]*j;e.data[1]=c.data[1]*j;e.data[2]=c.data[2]*j;e.data[3]=b;return e};a.prototype.fromAngleNormalAxis=function(b,c){return a.fromAngleNormalAxis(b,
c,this)};a.toMatrix3x3=function(a,b){b||(b=new e);var c=2*a.data[0]*a.data[0],j=2*a.data[1]*a.data[1],k=2*a.data[2]*a.data[2],i=2*a.data[0]*a.data[1],h=2*a.data[0]*a.data[2],l=2*a.data[1]*a.data[2],n=2*a.data[0]*a.data[3],o=2*a.data[1]*a.data[3],p=2*a.data[2]*a.data[3];b.e00=1-(j+k);b.e10=i+p;b.e20=h-o;b.e01=i-p;b.e11=1-(c+k);b.e21=l+n;b.e02=h+o;b.e12=l-n;b.e22=1-(c+j);return b};a.prototype.toMatrix3x3=function(b){return a.toMatrix3x3(this,b)};a.toMatrix4x4=function(a,b){b||(b=new c);var e=2*a.data[0]*
a.data[0],j=2*a.data[1]*a.data[1],k=2*a.data[2]*a.data[2],i=2*a.data[0]*a.data[1],h=2*a.data[0]*a.data[2],l=2*a.data[1]*a.data[2],n=2*a.data[0]*a.data[3],o=2*a.data[1]*a.data[3],p=2*a.data[2]*a.data[3];b.e00=1-(j+k);b.e10=i+p;b.e20=h-o;b.e30=0;b.e01=i-p;b.e11=1-(e+k);b.e21=l+n;b.e31=0;b.e02=h+o;b.e12=l-n;b.e22=1-(e+j);b.e32=0;b.e03=0;b.e13=0;b.e23=0;b.e33=1;return b};a.prototype.toMatrix4x4=function(b){return a.toMatrix4x4(this,b)};return a});
define("goo/math/Transformation",["goo/math/Matrix4x4","goo/math/Vector","goo/math/Vector3","goo/math/Versor"],function(e,c,b,a){function f(c,f,j){this.translation=c||new b(0,0,0);this.rotation=f||new a(1,0,0,0);this.scale=j||new b(1,1,1);this.parentFromChild=new e;this.childFromParent=new e;this.doUpdate=!0}f.prototype.parentFromChildNormal=function(a,f){this.doUpdate&&this.update();f||(f=new b);if(f===a)return c.copy(this.parentFromChildNormal(a),f);f.x=this.childFromParent.e00*a.x+this.childFromParent.e10*
a.y+this.childFromParent.e20*a.z;f.y=this.childFromParent.e01*a.x+this.childFromParent.e11*a.y+this.childFromParent.e21*a.z;f.z=this.childFromParent.e02*a.x+this.childFromParent.e12*a.y+this.childFromParent.e22*a.z;return f};f.prototype.childFromParentNormal=function(a,f){this.doUpdate&&this.update();f||(f=new b);if(f===a)return c.copy(this.childFromParentNormal(a),f);f.x=this.parentFromChild.e00*a.x+this.parentFromChild.e10*a.y+this.parentFromChild.e20*a.z;f.y=this.parentFromChild.e01*a.x+this.parentFromChild.e11*
a.y+this.parentFromChild.e21*a.z;f.z=this.parentFromChild.e02*a.x+this.parentFromChild.e12*a.y+this.parentFromChild.e22*a.z;return f};f.prototype.parentFromChildVector=function(a,f){this.doUpdate&&this.update();f||(f=new b);if(f===a)return c.copy(this.parentFromChildVector(a),f);f.x=this.parentFromChild.e00*a.x+this.parentFromChild.e01*a.y+this.parentFromChild.e02*a.z;f.y=this.parentFromChild.e10*a.x+this.parentFromChild.e11*a.y+this.parentFromChild.e12*a.z;f.z=this.parentFromChild.e20*a.x+this.parentFromChild.e21*
a.y+this.parentFromChild.e22*a.z;return f};f.prototype.childFromParentVector=function(a,f){this.doUpdate&&this.update();f||(f=new b);if(f===a)return c.copy(this.childFromParentVector(a),f);f.x=this.childFromParent.e00*a.x+this.childFromParent.e01*a.y+this.childFromParent.e02*a.z;f.y=this.childFromParent.e10*a.x+this.childFromParent.e11*a.y+this.childFromParent.e12*a.z;f.z=this.childFromParent.e20*a.x+this.childFromParent.e21*a.y+this.childFromParent.e22*a.z;return f};f.prototype.parentFromChildVertex=
function(a,f){this.doUpdate&&this.update();f||(f=new b);if(f===a)return c.copy(this.parentFromChildVertex(a),f);f.x=this.parentFromChild.e00*a.x+this.parentFromChild.e01*a.y+this.parentFromChild.e02*a.z+this.parentFromChild.e03;f.y=this.parentFromChild.e10*a.x+this.parentFromChild.e11*a.y+this.parentFromChild.e12*a.z+this.parentFromChild.e13;f.z=this.parentFromChild.e20*a.x+this.parentFromChild.e21*a.y+this.parentFromChild.e22*a.z+this.parentFromChild.e23;return f};f.prototype.childFromParentVertex=
function(a,f){this.doUpdate&&this.update();f||(f=new b);if(f===a)return c.copy(this.childFromParentVertex(a),f);f.x=this.childFromParent.e00*a.x+this.childFromParent.e01*a.y+this.childFromParent.e02*a.z+this.childFromParent.e03;f.y=this.childFromParent.e10*a.x+this.childFromParent.e11*a.y+this.childFromParent.e12*a.z+this.childFromParent.e13;f.z=this.childFromParent.e20*a.x+this.childFromParent.e21*a.y+this.childFromParent.e22*a.z+this.childFromParent.e23;return f};f.prototype.update=function(){if(this.doUpdate){var a=
this.rotation.toMatrix3x3();this.parentFromChild.e00=a.e00*this.scale.x;this.parentFromChild.e10=a.e10*this.scale.x;this.parentFromChild.e20=a.e20*this.scale.x;this.parentFromChild.e30=0;this.parentFromChild.e01=a.e01*this.scale.y;this.parentFromChild.e11=a.e11*this.scale.y;this.parentFromChild.e21=a.e21*this.scale.y;this.parentFromChild.e31=0;this.parentFromChild.e02=a.e02*this.scale.z;this.parentFromChild.e12=a.e12*this.scale.z;this.parentFromChild.e22=a.e22*this.scale.z;this.parentFromChild.e32=
0;this.parentFromChild.e03=this.translation.x;this.parentFromChild.e13=this.translation.y;this.parentFromChild.e23=this.translation.z;this.parentFromChild.e33=1;this.childFromParent.e00=a.e00/this.scale.x;this.childFromParent.e10=a.e01/this.scale.y;this.childFromParent.e20=a.e02/this.scale.z;this.childFromParent.e30=0;this.childFromParent.e01=a.e10/this.scale.x;this.childFromParent.e11=a.e11/this.scale.y;this.childFromParent.e21=a.e12/this.scale.z;this.childFromParent.e31=0;this.childFromParent.e02=
a.e20/this.scale.x;this.childFromParent.e12=a.e21/this.scale.y;this.childFromParent.e22=a.e22/this.scale.z;this.childFromParent.e32=0;this.childFromParent.e03=0-(a.e00*this.translation.x+a.e10*this.translation.y+a.e20*this.translation.z)/this.scale.x;this.childFromParent.e13=0-(a.e01*this.translation.x+a.e11*this.translation.y+a.e21*this.translation.z)/this.scale.y;this.childFromParent.e23=0-(a.e02*this.translation.x+a.e12*this.translation.y+a.e22*this.translation.z)/this.scale.z;this.childFromParent.e33=
1;this.doUpdate=!1;return this}};return f});
define("goo/noise/Noise",["goo/math/MathUtils"],function(e){function c(){}c.shifter=[37,91,12,128,216,96,51,153,39,231,223,180,160,157,135,179,74,50,205,151,4,213,196,58,212,120,53,45,10,195,137,159,103,144,109,170,202,48,121,13,245,68,232,28,210,174,197,80,107,206,156,116,155,240,162,79,41,59,147,117,0,242,118,164,129,101,98,126,214,105,89,26,130,254,85,199,8,165,76,75,187,166,64,143,217,149,78,7,172,230,87,119,42,247,84,139,16,141,134,86,154,71,253,60,99,235,168,30,34,55,113,140,191,69,31,106,40,
82,73,33,81,14,234,131,255,88,169,136,248,148,220,138,219,102,44,127,36,200,95,208,54,152,47,20,23,15,52,123,177,224,122,171,215,173,211,188,190,133,244,167,236,35,63,145,221,104,65,24,70,100,56,150,49,77,110,228,112,209,198,1,237,185,250,225,93,201,124,108,218,72,243,21,22,6,114,38,125,29,66,249,222,111,241,11,186,61,176,183,17,163,229,161,57,238,227,132,67,83,207,226,46,189,115,193,194,233,182,192,18,27,25,2,3,252,97,62,184,239,175,92,246,142,251,204,203,32,146,90,19,9,178,158,181,94,43,5];c.split=
function(b){var a=Math.floor(b),b=e.scurve5(b-a);return{i0:a+0,i1:a+1,f0:1-b,f1:0+b}};c.fractal1d=function(b,a,c,d,e,j){for(var k=0,i=1,h=0,l=0;l<c;l++)k+=i*j.evaluate1d(b,a),h+=i,i*=d,b*=e;return k/h};c.fractal2d=function(b,a,c,d,e,j,k){for(var i=0,h=1,l=0,n=0;n<d;n++)i+=h*k.evaluate2d(b,a,c),l+=h,h*=e,b*=j,a*=j;return i/l};c.fractal3d=function(b,a,c,d,e,j,k,i){for(var h=0,l=1,n=0,o=0;o<e;o++)h+=l*i.evaluate3d(b,a,c,d),n+=l,l*=j,b*=k,a*=k,c*=k;return h/n};c.fractal4d=function(b,a,c,d,e,j,k,i,h){for(var l=
0,n=1,o=0,p=0;p<j;p++)l+=n*h.evaluate4d(b,a,c,d,e),o+=n,n*=k,b*=i,a*=i,c*=i,d*=i;return l/o};return c});
define("goo/noise/ValueNoise",["goo/noise/Noise"],function(e){function c(){e.call(this)}c.prototype=Object.create(e.prototype);c.sources=[0,1/15,2/15,0.2,4/15,5/15,0.4,7/15,8/15,0.6,10/15,11/15,0.8,13/15,14/15,1];c.evaluate1d=function(b,a){var f=e.split(b/a),d=e.shifter[f.i1&255]&15,g=0;g+=f.f0*c.sources[e.shifter[f.i0&255]&15];g+=f.f1*c.sources[d];return g};c.evaluate2d=function(b,a,f){var b=e.split(b/f),a=e.split(a/f),f=e.shifter[e.shifter[a.i0&255]+b.i1&255]&15,d=e.shifter[e.shifter[a.i1&255]+
b.i0&255]&15,g=e.shifter[e.shifter[a.i1&255]+b.i1&255]&15,j=0;j+=a.f0*b.f0*c.sources[e.shifter[e.shifter[a.i0&255]+b.i0&255]&15];j+=a.f0*b.f1*c.sources[f];j+=a.f1*b.f0*c.sources[d];j+=a.f1*b.f1*c.sources[g];return j};c.evaluate3d=function(b,a,f,d){var b=e.split(b/d),a=e.split(a/d),f=e.split(f/d),d=e.shifter[e.shifter[e.shifter[f.i0&255]+a.i0&255]+b.i1&255]&15,g=e.shifter[e.shifter[e.shifter[f.i0&255]+a.i1&255]+b.i0&255]&15,j=e.shifter[e.shifter[e.shifter[f.i0&255]+a.i1&255]+b.i1&255]&15,k=e.shifter[e.shifter[e.shifter[f.i1&
255]+a.i0&255]+b.i0&255]&15,i=e.shifter[e.shifter[e.shifter[f.i1&255]+a.i0&255]+b.i1&255]&15,h=e.shifter[e.shifter[e.shifter[f.i1&255]+a.i1&255]+b.i0&255]&15,l=e.shifter[e.shifter[e.shifter[f.i1&255]+a.i1&255]+b.i1&255]&15,n=0;n+=f.f0*a.f0*b.f0*c.sources[e.shifter[e.shifter[e.shifter[f.i0&255]+a.i0&255]+b.i0&255]&15];n+=f.f0*a.f0*b.f1*c.sources[d];n+=f.f0*a.f1*b.f0*c.sources[g];n+=f.f0*a.f1*b.f1*c.sources[j];n+=f.f1*a.f0*b.f0*c.sources[k];n+=f.f1*a.f0*b.f1*c.sources[i];n+=f.f1*a.f1*b.f0*c.sources[h];
n+=f.f1*a.f1*b.f1*c.sources[l];return n};c.evaluate4d=function(b,a,f,d,g){var b=e.split(b/g),a=e.split(a/g),f=e.split(f/g),d=e.split(d/g),g=e.shifter[e.shifter[e.shifter[e.shifter[d.i0&255]+f.i0&255]+a.i0&255]+b.i1&255]&15,j=e.shifter[e.shifter[e.shifter[e.shifter[d.i0&255]+f.i0&255]+a.i1&255]+b.i0&255]&15,k=e.shifter[e.shifter[e.shifter[e.shifter[d.i0&255]+f.i0&255]+a.i1&255]+b.i1&255]&15,i=e.shifter[e.shifter[e.shifter[e.shifter[d.i0&255]+f.i1&255]+a.i0&255]+b.i0&255]&15,h=e.shifter[e.shifter[e.shifter[e.shifter[d.i0&
255]+f.i1&255]+a.i0&255]+b.i1&255]&15,l=e.shifter[e.shifter[e.shifter[e.shifter[d.i0&255]+f.i1&255]+a.i1&255]+b.i0&255]&15,n=e.shifter[e.shifter[e.shifter[e.shifter[d.i0&255]+f.i1&255]+a.i1&255]+b.i1&255]&15,o=e.shifter[e.shifter[e.shifter[e.shifter[d.i1&255]+f.i0&255]+a.i0&255]+b.i0&255]&15,p=e.shifter[e.shifter[e.shifter[e.shifter[d.i1&255]+f.i0&255]+a.i0&255]+b.i1&255]&15,m=e.shifter[e.shifter[e.shifter[e.shifter[d.i1&255]+f.i0&255]+a.i1&255]+b.i0&255]&15,s=e.shifter[e.shifter[e.shifter[e.shifter[d.i1&
255]+f.i0&255]+a.i1&255]+b.i1&255]&15,q=e.shifter[e.shifter[e.shifter[e.shifter[d.i1&255]+f.i1&255]+a.i0&255]+b.i0&255]&15,t=e.shifter[e.shifter[e.shifter[e.shifter[d.i1&255]+f.i1&255]+a.i0&255]+b.i1&255]&15,u=e.shifter[e.shifter[e.shifter[e.shifter[d.i1&255]+f.i1&255]+a.i1&255]+b.i0&255]&15,v=e.shifter[e.shifter[e.shifter[e.shifter[d.i1&255]+f.i1&255]+a.i1&255]+b.i1&255]&15,r=0;r+=d.f0*f.f0*a.f0*b.f0*c.sources[e.shifter[e.shifter[e.shifter[e.shifter[d.i0&255]+f.i0&255]+a.i0&255]+b.i0&255]&15];r+=
d.f0*f.f0*a.f0*b.f1*c.sources[g];r+=d.f0*f.f0*a.f1*b.f0*c.sources[j];r+=d.f0*f.f0*a.f1*b.f1*c.sources[k];r+=d.f0*f.f1*a.f0*b.f0*c.sources[i];r+=d.f0*f.f1*a.f0*b.f1*c.sources[h];r+=d.f0*f.f1*a.f1*b.f0*c.sources[l];r+=d.f0*f.f1*a.f1*b.f1*c.sources[n];r+=d.f1*f.f0*a.f0*b.f0*c.sources[o];r+=d.f1*f.f0*a.f0*b.f1*c.sources[p];r+=d.f1*f.f0*a.f1*b.f0*c.sources[m];r+=d.f1*f.f0*a.f1*b.f1*c.sources[s];r+=d.f1*f.f1*a.f0*b.f0*c.sources[q];r+=d.f1*f.f1*a.f0*b.f1*c.sources[t];r+=d.f1*f.f1*a.f1*b.f0*c.sources[u];
r+=d.f1*f.f1*a.f1*b.f1*c.sources[v];return r};return c});define("goo/particles/ParticleInfluence",[],function(){return function(e){e=e||{};this.prepare=e.prepare?e.prepare:function(){};this.apply=e.apply?e.apply:function(){};this.enabled=e.enabled!==void 0?e.enabled===!0:!0}});
define("goo/picking/BoundingTree",["goo/renderer/bounds/BoundingBox","goo/renderer/bounds/BoundingSphere","goo/math/Vector3"],function(e,c,b){function a(b){this.worldBound=this.localBound=this.rightTree=this.leftTree=null;this.boundType=b?b:a.BOUNDTYPE_BOX}a.BOUNDTYPE_SPHERE="sphere";a.BOUNDTYPE_BOX="box";a.MAX_PRIMITIVES_PER_LEAF=16;a.prototype.construct=function(a){if(!a.meshRendererComponent||!a.meshDataComponent||!a.transformComponent)console.warn("Entity missing required components for boundingtree construction: ",
a);else{var b=a.meshDataComponent.meshData;b.updatePrimitiveCounts();if(b.getSectionCount()===1){this.primitiveIndices=[];for(var c=0,b=b.getPrimitiveCount(0);c<b;c++)this.primitiveIndices.push(c);this.createTree(a,0,0,this.primitiveIndices.length)}else this.split(a,0,b.getSectionCount())}};a.prototype.createTree=function(b,c,e,j){var k=b.meshDataComponent.meshData;this.section=c;this.start=e;this.end=j;if(this.primitiveIndices&&(this.createBounds(),this.localBound.computeFromPrimitives(k,c,this.primitiveIndices,
e,j),!(j-e+1<=a.MAX_PRIMITIVES_PER_LEAF))){if(!this.leftTree)this.leftTree=new a(this.boundType);this.leftTree.primitiveIndices=this.primitiveIndices;this.leftTree.createTree(b,c,e,Math.floor((e+j)/2));if(!this.rightTree)this.rightTree=new a(this.boundType);this.rightTree.primitiveIndices=this.primitiveIndices;this.rightTree.createTree(b,c,Math.floor((e+j)/2),j)}};a.prototype.split=function(b,c,e){var j=e-c,k=Math.floor(j/2);if(k===1){var i=c;this.leftTree=new a(this.boundType);this.leftTree.primitiveIndices=
[];for(var h=0;h<this.leftTree.primitiveIndices.length;h++)this.leftTree.primitiveIndices.push(h);this.leftTree.createTree(b,i,0,this.leftTree.primitiveIndices.length)}else this.leftTree=new a(this.boundType),this.leftTree.split(b,c,c+k);if(j-k===1){i=c+1;this.rightTree=new a(this.boundType);this.rightTree._primitiveIndices=[];for(h=0;h<this.rightTree.primitiveIndices.length;h++)this.rightTree.primitiveIndices.push(h);this.rightTree.createTree(b,i,0,this.rightTree.primitiveIndices.length)}else this.rightTree=
new a(this.boundType),this.rightTree.split(b,c+k,e);this.localBound=this.leftTree.localBound.clone(this.localBound);this.localBound.merge(this.rightTree.localBound);this.worldBound=this.localBound.clone(this.worldBound)};a.prototype.createBounds=function(){switch(this.boundType){case a.BOUNDTYPE_BOX:this.localBound=new e;this.worldBound=new e;break;case a.BOUNDTYPE_SPHERE:this.localBound=new c,this.worldBound=new c}};a.prototype.findPick=function(a,c,e){e||(e={});var j=c.transformComponent.worldTransform;
this.localBound.transform(j,this.worldBound);if(!this.worldBound.intersectsRay(a))return e;this.leftTree&&this.leftTree.findPick(a,c,e);if(this.rightTree)this.rightTree.findPick(a,c,e);else if(!this.leftTree)for(var c=c.meshDataComponent.meshData,k=null,i=this.start;i<this.end;i++){for(var k=c.getPrimitiveVertices(this.primitiveIndices[i],this.section,k),h=0;h<k.length;h++)j.matrix.applyPostPoint(k[h]);h=new b;if(a.intersects(k,!1,h))e.distances=e.distances||[],e.distances.push(a.origin.distance(h)),
e.points=e.points||[],e.points.push(h)}return e};return a});
define("goo/picking/PrimitivePickLogic",["goo/picking/BoundingTree"],function(e){function c(){}c.prototype.getPickResult=function(b,a){var c=a.meshDataComponent.meshData.__boundingTree;return!c?null:c.findPick(b,a,{})};c.prototype.added=function(b){this.isConstructed(b)||this.rebuild(b)};c.prototype.removed=function(b){b.meshDataComponent.meshData.__boundingTree=null};c.prototype.isConstructed=function(b){return!!b.meshDataComponent.meshData.__boundingTree};c.prototype.rebuild=function(b){b.meshDataComponent.meshData.__boundingTree=
new e;b.meshDataComponent.meshData.__boundingTree.construct(b)};return c});
define("goo/renderer/pass/BlurPass",["goo/renderer/Material","goo/renderer/pass/FullscreenUtil","goo/renderer/pass/RenderTarget","goo/renderer/Util","goo/renderer/shaders/ShaderLib"],function(e,c,b,a,f){function d(g){g=g||{};this.target=g.target!==void 0?g.target:null;var j=g.strength!==void 0?g.strength:1,k=g.kernelSize!==void 0?g.kernelSize:25,i=g.sigma!==void 0?g.sigma:4,h=g.sizeX!==void 0?g.sizeX:256,g=g.sizeY!==void 0?g.sizeY:256;this.renderTargetX=new b(h,g);this.renderTargetY=new b(h,g);this.renderable=
{meshData:c.quad,materials:[]};this.copyShader=a.clone(f.copyPure);this.copyShader.uniforms.opacity=j;this.copyMaterial=e.createMaterial(this.copyShader);this.convolutionShader=a.clone(f.convolution);this.convolutionShader.defines={KERNEL_SIZE_FLOAT:k.toFixed(1),KERNEL_SIZE_INT:k.toFixed(0)};this.convolutionShader.uniforms.uImageIncrement=d.blurX;this.convolutionShader.uniforms.cKernel=this.convolutionShader.buildKernel(i);this.convolutionMaterial=e.createMaterial(this.convolutionShader);this.enabled=
!0;this.needsSwap=this.clear=!1}d.prototype.render=function(a,b,f){this.renderable.materials[0]=this.convolutionMaterial;this.convolutionMaterial.setTexture("DIFFUSE_MAP",f);this.convolutionShader.uniforms.uImageIncrement=d.blurX;a.render(this.renderable,c.camera,[],this.renderTargetX,!0);this.convolutionMaterial.setTexture("DIFFUSE_MAP",this.renderTargetX);this.convolutionShader.uniforms.uImageIncrement=d.blurY;a.render(this.renderable,c.camera,[],this.renderTargetY,!0);this.renderable.materials[0]=
this.copyMaterial;this.copyMaterial.setTexture("DIFFUSE_MAP",this.renderTargetY);this.target!==null?a.render(this.renderable,c.camera,[],this.target,this.clear):a.render(this.renderable,c.camera,[],f,this.clear)};d.blurX=[0.001953125,0];d.blurY=[0,0.001953125];return d});define("goo/renderer/pass/BloomPass",["goo/renderer/pass/BlurPass"],function(e){function c(b){e.call(this,b);this.copyMaterial.blendState.blending="AdditiveBlending"}c.prototype=Object.create(e.prototype);return c});
define("goo/renderer/pass/Composer",["goo/renderer/pass/RenderTarget","goo/renderer/pass/FullscreenPass","goo/renderer/shaders/ShaderLib"],function(e,c,b){function a(a){this.renderTarget1=a;if(this.renderTarget1===void 0)this.renderTarget1=new e(window.innerWidth||1,window.innerHeight||1);this.renderTarget2=this.renderTarget1.clone();this.writeBuffer=this.renderTarget1;this.readBuffer=this.renderTarget2;this.passes=[];this.copyPass=new c(b.copy)}a.prototype.swapBuffers=function(){var a=this.readBuffer;
this.readBuffer=this.writeBuffer;this.writeBuffer=a};a.prototype.addPass=function(a){this.passes.push(a)};a.prototype.render=function(a,b,c,e){this.writeBuffer=this.renderTarget1;this.readBuffer=this.renderTarget2;var k,i,h=this.passes.length;for(i=0;i<h;i++)k=this.passes[i],k.enabled&&(k.render(a,this.writeBuffer,this.readBuffer,b,!1,c,e),k.needsSwap&&this.swapBuffers())};return a});
define("goo/renderer/pass/RenderPass",["goo/renderer/Renderer","goo/math/Vector4"],function(e,c){function b(a){this.renderList=a;this.clearColor=new c(0,0,0,0);this.oldClearColor=new c;this.renderToScreen=!1;this.overrideMaterial=null;this.clear=this.enabled=!0;this.needsSwap=!1}b.prototype.render=function(a,b,c,g,j,k,i){k=k||e.mainCamera;i=i||[];this.clearColor&&(this.oldClearColor.setv(a.clearColor),a.setClearColor(this.clearColor.r,this.clearColor.g,this.clearColor.b,this.clearColor.a));a.overrideMaterial=
this.overrideMaterial;this.renderToScreen?a.render(this.renderList,k,i):a.render(this.renderList,k,i,c,this.clear);a.overrideMaterial=null;this.clearColor&&a.setClearColor(this.oldClearColor.r,this.oldClearColor.g,this.oldClearColor.b,this.oldClearColor.a)};return b});
define("goo/renderer/pass/DepthPass","goo/renderer/Material,goo/renderer/pass/RenderTarget,goo/renderer/MeshData,goo/renderer/Shader,goo/renderer/shaders/ShaderFragment,goo/renderer/pass/RenderPass,goo/renderer/pass/FullscreenPass,goo/renderer/pass/BlurPass".split(","),function(e,c,b,a,f,d,g,j){function k(a,b){this.depthPass=new d(a);this.depthPass.overrideMaterial=e.createMaterial(i);this.blurTarget=new c(256,256);this.blurPass=new j({target:this.blurTarget});this.outPass=new g(b||h);this.outPass.useReadBuffer=
!1;this.depthTarget=new c(window.innerWidth||1,window.innerHeight||1);this.enabled=!0;this.clear=!1;this.needsSwap=!0}k.prototype.render=function(b,c,d,f){this.depthPass.render(b,null,this.depthTarget,f);this.blurPass.render(b,c,d,f);this.outPass.material.setTexture(a.DEPTH_MAP,this.depthTarget);this.outPass.material.setTexture(a.DIFFUSE_MAP,d);this.outPass.material.setTexture("BLUR_MAP",this.blurTarget);this.outPass.render(b,c,d,f)};var i={attributes:{vertexPosition:b.POSITION},uniforms:{viewMatrix:a.VIEW_MATRIX,
projectionMatrix:a.PROJECTION_MATRIX,worldMatrix:a.WORLD_MATRIX,farPlane:a.FAR_PLANE},vshader:"attribute vec3 vertexPosition;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec4 vPosition;\nvoid main(void) {\n\tvPosition = viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n\tgl_Position = projectionMatrix * vPosition;\n}",fshader:["precision mediump float;\nuniform float farPlane;",f.methods.packDepth,"varying vec4 vPosition;\nvoid main(void)\n{\n\tfloat linearDepth = min(length(vPosition), farPlane) / farPlane;\n\tgl_FragColor = packDepth(linearDepth);\n}"].join("\n")},
h={attributes:{vertexPosition:b.POSITION,vertexUV0:b.TEXCOORD0},uniforms:{viewMatrix:a.VIEW_MATRIX,projectionMatrix:a.PROJECTION_MATRIX,worldMatrix:a.WORLD_MATRIX,depthMap:a.DEPTH_MAP,diffuseMap:a.DIFFUSE_MAP},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 texCoord0;\nvoid main(void) {\n\ttexCoord0 = vertexUV0;\n\tgl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n}",
fshader:["precision mediump float;\nuniform sampler2D depthMap;\nuniform sampler2D diffuseMap;\nvarying vec2 texCoord0;",f.methods.unpackDepth,"void main(void)\n{\n\tvec4 depthCol = texture2D(depthMap, texCoord0);\n\tvec4 diffuseCol = texture2D(diffuseMap, texCoord0);\n\tfloat depth = unpackDepth(depthCol);\n\tgl_FragColor = diffuseCol * vec4(depth);\n}"].join("\n")};return k});
define("goo/renderer/pass/DoGPass",["goo/renderer/Material","goo/renderer/pass/FullscreenUtil","goo/renderer/pass/RenderTarget","goo/renderer/Util","goo/renderer/shaders/ShaderLib"],function(e,c,b,a,f){function d(d){d=d||{};this.target=d.target!==void 0?d.target:null;var j=d.width!==void 0?d.width:512,k=d.height!==void 0?d.height:512,i=d.sigma!==void 0?d.sigma:0.6,d=d.threshold!==void 0?d.threshold:0.0050;i>2.5&&(i=2.5);this.renderTargetX=new b(j,k);this.gaussian1=new b(j,k);this.gaussian2=new b(j,
k);this.renderable={meshData:c.quad,materials:[]};this.convolutionShader1=a.clone(f.convolution);this.convolutionShader2=a.clone(f.convolution);this.differenceShader=a.clone(f.differenceOfGaussians);this.differenceShader.uniforms.threshold=d;this.differenceMaterial=e.createMaterial(this.differenceShader);var d=this.convolutionShader1.buildKernel(i),i=this.convolutionShader2.buildKernel(1.6*i),h=d.length;this.convolutionShader1.defines={KERNEL_SIZE_FLOAT:h.toFixed(1),KERNEL_SIZE_INT:h.toFixed(0)};
h=i.length;this.convolutionShader2.defines={KERNEL_SIZE_FLOAT:h.toFixed(1),KERNEL_SIZE_INT:h.toFixed(0)};this.convolutionShader1.uniforms.cKernel=d;this.convolutionShader2.uniforms.cKernel=i;this.blurX=[0.5/j,0];this.blurY=[0,0.5/k];this.convolutionMaterial1=e.createMaterial(this.convolutionShader1);this.convolutionMaterial2=e.createMaterial(this.convolutionShader2);this.enabled=!0;this.needsSwap=this.clear=!1}d.prototype.render=function(a,b,d){this.renderable.materials[0]=this.convolutionMaterial1;
this.convolutionMaterial1.setTexture("DIFFUSE_MAP",d);this.convolutionShader1.uniforms.uImageIncrement=this.blurX;a.render(this.renderable,c.camera,[],this.renderTargetX,!0);this.convolutionMaterial1.setTexture("DIFFUSE_MAP",this.renderTargetX);this.convolutionShader1.uniforms.uImageIncrement=this.blurY;a.render(this.renderable,c.camera,[],this.gaussian1,!0);this.renderable.materials[0]=this.convolutionMaterial2;this.convolutionMaterial2.setTexture("DIFFUSE_MAP",d);this.convolutionShader2.uniforms.uImageIncrement=
this.blurX;a.render(this.renderable,c.camera,[],this.renderTargetX,!0);this.convolutionMaterial2.setTexture("DIFFUSE_MAP",this.renderTargetX);this.convolutionShader2.uniforms.uImageIncrement=this.blurY;a.render(this.renderable,c.camera,[],this.gaussian2,!0);this.renderable.materials[0]=this.differenceMaterial;this.differenceMaterial.setTexture("BLUR1",this.gaussian1);this.differenceMaterial.setTexture("BLUR2",this.gaussian2);this.differenceMaterial.setTexture("ORIGINAL",d);this.target!==null?a.render(this.renderable,
c.camera,[],this.target,this.clear):a.render(this.renderable,c.camera,[],d,this.clear)};return d});
define("goo/renderer/pass/NesPass",["goo/renderer/TextureCreator","goo/renderer/Material","goo/renderer/pass/FullscreenUtil","goo/renderer/shaders/ShaderLib"],function(e,c,b,a){function f(a){this.material=c.createMaterial(d);this.renderToScreen=!1;this.renderable={meshData:b.quad,materials:[this.material]};this.mapping=(new e).loadTexture2D(a);this.mapping.minFilter="NearestNeighborNoMipMaps";this.mapping.magFilter="NearestNeighbor";this.mapping.generateMipmaps=!1;this.enabled=!0;this.clear=!1;this.needsSwap=
!0}f.prototype.render=function(a,c,d){this.material.setTexture("DIFFUSE_MAP",d);this.material.setTexture("COLOR_MAPPING",this.mapping);this.renderToScreen?a.render(this.renderable,b.camera,[],null,this.clear):a.render(this.renderable,b.camera,[],c,this.clear)};var d={attributes:a.copy.attributes,uniforms:{diffuse:"DIFFUSE_MAP",mapping:"COLOR_MAPPING",$link:a.copy.uniforms},vshader:a.copy.vshader,fshader:"precision mediump float;\nuniform sampler2D diffuse;\nuniform sampler2D mapping;\nvarying vec2 texCoord0;\nvoid main() {\n\tvec4 texCol = texture2D( diffuse, texCoord0 );\n\tfloat r = floor(texCol.r * 31.0);\n\tfloat g = floor(texCol.g * 31.0);\n\tfloat b = floor(texCol.b * 31.0);\n\tvec4 texPalette = texture2D( mapping, vec2((r * 32.0 + g)/1024.0, b / 32.0) );\n\tgl_FragColor = vec4( texPalette.rgb, 1.0 );\n}"};
return f});
define("goo/renderer/pass/SSAOPass","goo/renderer/Material,goo/renderer/pass/RenderTarget,goo/renderer/Util,goo/renderer/MeshData,goo/renderer/Shader,goo/renderer/shaders/ShaderFragment,goo/renderer/pass/RenderPass,goo/renderer/pass/FullscreenPass,goo/renderer/pass/BlurPass,goo/renderer/shaders/ShaderLib".split(","),function(e,c,b,a,f,d,g,j,k,i){function h(a){this.depthPass=new g(a);this.depthPass.clearColor.set(1,1,1,1);this.depthPass.overrideMaterial=e.createMaterial(l);var a=window.innerWidth/4,
d=window.innerHeight/4,f=b.clone(i.ssao);f.uniforms.size=[a,d];this.outPass=new j(f);this.outPass.useReadBuffer=!1;this.blurPass=new k({sizeX:a,sizeY:d});this.depthTarget=new c(a,d,{magFilter:"NearestNeighbor",minFilter:"NearestNeighborNoMipMaps"});this.enabled=!0;this.clear=!1;this.needsSwap=!0}h.prototype.render=function(a,b,c,d){this.depthPass.render(a,null,this.depthTarget,d);this.outPass.material.setTexture(f.DIFFUSE_MAP,c);this.outPass.material.setTexture(f.DEPTH_MAP,this.depthTarget);this.outPass.render(a,
b,c,d)};var l={attributes:{vertexPosition:a.POSITION},uniforms:{viewMatrix:f.VIEW_MATRIX,projectionMatrix:f.PROJECTION_MATRIX,worldMatrix:f.WORLD_MATRIX},vshader:"attribute vec3 vertexPosition;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvoid main(void) {\n\tgl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n}",fshader:["precision mediump float;",d.methods.packDepth,"void main(void) {\n\tgl_FragColor = packDepth(gl_FragCoord.z);\n}"].join("\n")};
return h});
define("goo/scripts/BasicControlScript",["goo/math/Vector3","goo/math/Matrix3x3"],function(e,c){function b(a){this.domElement=a===void 0?document:a.domElement||a;this.name="BasicControlScript";this.movementSpeed=10;this.rollSpeed=2;this.movementSpeedMultiplier=1;this.mouseStatus=0;this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0};this.moveVector=new e(0,0,0);this.rotationVector=new e(0,0,0);this.multiplier=new e(1,1,1);this.rotationMatrix=
new c;this.tmpVec=new e;this.handleEvent=function(a){if(typeof this[a.type]==="function")this[a.type](a)};this.keydown=function(a){if(!a.altKey){switch(a.keyCode){case 16:this.movementSpeedMultiplier=0.1;break;case 87:this.moveState.forward=1;break;case 83:this.moveState.back=1;break;case 65:this.moveState.left=1;break;case 68:this.moveState.right=1;break;case 82:this.moveState.up=1;break;case 70:this.moveState.down=1;break;case 38:this.moveState.pitchUp=1;break;case 40:this.moveState.pitchDown=1;
break;case 37:this.moveState.yawLeft=1;break;case 39:this.moveState.yawRight=1;break;case 81:this.moveState.rollLeft=1;break;case 69:this.moveState.rollRight=1}this.updateMovementVector();this.updateRotationVector()}};this.keyup=function(a){switch(a.keyCode){case 16:this.movementSpeedMultiplier=1;break;case 87:this.moveState.forward=0;break;case 83:this.moveState.back=0;break;case 65:this.moveState.left=0;break;case 68:this.moveState.right=0;break;case 82:this.moveState.up=0;break;case 70:this.moveState.down=
0;break;case 38:this.moveState.pitchUp=0;break;case 40:this.moveState.pitchDown=0;break;case 37:this.moveState.yawLeft=0;break;case 39:this.moveState.yawRight=0;break;case 81:this.moveState.rollLeft=0;break;case 69:this.moveState.rollRight=0}this.updateMovementVector();this.updateRotationVector()};var b,d;this.mousedown=function(a){this.domElement!==document&&this.domElement.focus();a.preventDefault();a=a.touches&&a.touches.length===1?a.touches[0]:a;this.mouseDownX=a.pageX;this.mouseDownY=a.pageY;
this.mouseStatus=1;b=this.mousemove.bind(this);d=this.mouseup.bind(this);document.addEventListener("mousemove",b,!1);document.addEventListener("mouseup",d,!1);document.addEventListener("touchmove",b,!1);document.addEventListener("touchend",d,!1)};this.mousemove=function(a){if(this.mouseStatus>0)a=a.touches&&a.touches.length===1?a.touches[0]:a,this.moveState.yawLeft=a.pageX-this.mouseDownX,this.moveState.pitchDown=a.pageY-this.mouseDownY,this.updateRotationVector(),this.mouseDownX=a.pageX,this.mouseDownY=
a.pageY};this.mouseup=function(a){if(this.mouseStatus)a.preventDefault(),this.mouseStatus=0,this.moveState.yawLeft=this.moveState.pitchDown=0,this.updateRotationVector(),document.removeEventListener("mousemove",b),document.removeEventListener("mouseup",d),document.removeEventListener("touchmove",b),document.removeEventListener("touchend",d)};this.updateMovementVector=function(){var a=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right;
this.moveVector.y=-this.moveState.down+this.moveState.up;this.moveVector.z=-a+this.moveState.back};this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp;this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft;this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft};this.getContainerDimensions=function(){return this.domElement!==document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,
this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}};a=this.mousedown.bind(this);this.domElement.addEventListener("mousedown",a,!1);this.domElement.addEventListener("touchstart",a,!1);this.domElement.addEventListener("keydown",this.keydown.bind(this),!1);this.domElement.addEventListener("keyup",this.keyup.bind(this),!1);this.updateMovementVector();this.updateRotationVector()}b.prototype.externals=function(){return[{variable:"movementSpeed",type:"number"},{variable:"rollSpeed",
type:"number"}]};b.prototype.run=function(a){var b=a.transformComponent,c=b.transform,g=a._world.tpf,a=g*this.movementSpeed*this.movementSpeedMultiplier,g=g*this.rollSpeed*this.movementSpeedMultiplier;if(!this.moveVector.equals(e.ZERO)||!this.rotationVector.equals(e.ZERO)||this.mouseStatus>0){c.translation.x+=this.moveVector.x*a;c.translation.y+=this.moveVector.y*a;c.translation.z+=this.moveVector.z*a;this.tmpVec.x+=-this.rotationVector.x*g*this.multiplier.x;this.tmpVec.y+=this.rotationVector.y*g*
this.multiplier.y;this.tmpVec.z+=this.rotationVector.z*g*this.multiplier.z;c.rotation.fromAngles(this.tmpVec.x,this.tmpVec.y,this.tmpVec.z);if(this.mouseStatus>0)this.moveState.yawLeft=0,this.moveState.pitchDown=0,this.updateRotationVector();b.setUpdated()}};return b});
define("goo/scripts/MouseLookControlScript",["goo/math/Vector3","goo/math/Matrix3x3"],function(e,c){function b(a){a=a||{};this.name="MouseLookControlScript";this.domElement=a.domElement||document;this.turnSpeedHorizontal=!isNaN(a.turnSpeedHorizontal)?a.turnSpeed:0.01;this.turnSpeedVertical=!isNaN(a.turnSpeedVertical)?a.turnSpeed:0.01;this.dragOnly=a.dragOnly!==void 0?a.dragOnly===!0:!0;this.dragButton=!isNaN(a.dragButton)?a.dragButton:-1;this.worldUpVector=a.worldUpVector||new e(0,1,0);this.localLeftVector=
a.localLeftVector||new e(-1,0,0);this.onRun=a.onRun;this.calcVector=new e;this.calcMat1=new c;this.calcMat2=new c;this.resetMouseState();this.setupMouseControls()}b.prototype.resetMouseState=function(){this.mouseState={buttonDown:!1,lastX:NaN,lastY:NaN,dX:0,dY:0}};b.prototype.updateButtonState=function(a,b){this.domElement!==document&&this.domElement.focus();if(this.dragOnly&&(this.dragButton===-1||this.dragButton===a.button))this.mouseState.buttonDown=b,a.preventDefault()};b.prototype.updateDeltas=
function(a){isNaN(this.mouseState.lastX)||isNaN(this.mouseState.lastY)?(this.mouseState.dX=0,this.mouseState.dY=0):(this.mouseState.dX=a.clientX-this.mouseState.lastX,this.mouseState.dY=a.clientY-this.mouseState.lastY);this.mouseState.lastX=a.clientX;this.mouseState.lastY=a.clientY};var a,f,d,g=function(a){this.resetMouseState();this.updateButtonState(a,!0);f=j.bind(this);d=k.bind(this);document.addEventListener("mousemove",f,!1);document.addEventListener("mouseup",d,!1)},j=function(a){this.updateDeltas(a)},
k=function(a){this.updateButtonState(a,!1);document.removeEventListener("mousemove",f);document.removeEventListener("mouseup",d)};b.prototype.setupMouseControls=function(){a=g.bind(this);this.domElement.addEventListener("mousedown",a,!1)};b.prototype.run=function(a){if(a=a.transformComponent){var b=a.transform;if(!(this.dragOnly&&!this.mouseState.buttonDown||this.mouseState.dX===0&&this.mouseState.dY===0)){var d=this.turnSpeedHorizontal,f=this.turnSpeedVertical;this.mouseState.dX!==0&&(this.calcMat1.fromAngleNormalAxis(d*
-this.mouseState.dX,this.worldUpVector.x,this.worldUpVector.y,this.worldUpVector.z),c.combine(this.calcMat1,b.rotation,this.calcMat2),b.rotation.set(this.calcMat2));this.mouseState.dY!==0&&(this.calcMat1.fromAngleNormalAxis(f*this.mouseState.dY,this.localLeftVector.x,this.localLeftVector.y,this.localLeftVector.z),c.combine(b.rotation,this.calcMat1,this.calcMat2),b.rotation.set(this.calcMat2));a.setUpdated()}this.mouseState.dX=0;this.mouseState.dY=0}};return b});
define("goo/scripts/OrbitCamControlScript",["goo/math/Vector2","goo/math/Vector3","goo/math/MathUtils"],function(e,c,b){function a(a){var a=a||{},b;for(b in f)this[b]=typeof f[b]==="boolean"?a[b]!==void 0?a[b]===!0:f[b]:isNaN(f[b])?f[b]instanceof c?a[b]||(new c).copy(f[b]):a[b]||f[b]:!isNaN(a[b])?a[b]:f[b];this.name="OrbitCamControlScript";this.timeSamples=[0,0,0,0,0];this.xSamples=[0,0,0,0,0];this.ySamples=[0,0,0,0,0];this.sample=0;this.velocity=new e;this.targetSpherical=new c(this.spherical);this.cartesian=
new c;this.dirty=!0;this.mouseState={buttonDown:!1,lastX:NaN,lastY:NaN};this.setupMouseControls();this.domElement.oncontextmenu=function(){return!1}}var f={domElement:document,turnSpeedHorizontal:0.0050,turnSpeedVertical:0.0050,zoomSpeed:0.2,dragOnly:!0,dragButton:-1,worldUpVector:new c(0,1,0),baseDistance:15,minZoomDistance:1,maxZoomDistance:1E3,minAscent:-89.95*b.DEG_TO_RAD,maxAscent:89.95*b.DEG_TO_RAD,clampAzimuth:!1,minAzimuth:90*b.DEG_TO_RAD,maxAzimuth:270*b.DEG_TO_RAD,releaseVelocity:!0,invertedX:!1,
invertedY:!1,invertedWheel:!0,drag:5,maxSampleTimeMS:200,lookAtPoint:new c(0,0,0),spherical:new c(15,0,0),interpolationSpeed:7,onRun:null};a.prototype.updateButtonState=function(a,c){this.domElement!==document&&this.domElement.focus();if(this.dragOnly&&(this.dragButton===-1||this.dragButton===a))(this.mouseState.buttonDown=c)?(this.mouseState.lastX=NaN,this.mouseState.lastY=NaN,this.velocity.set(0,0),this.spherical.y=b.moduloPositive(this.spherical.y,b.TWO_PI),this.targetSpherical.copy(this.spherical)):
this.applyReleaseDrift()};a.prototype.updateDeltas=function(a,b){var c=0,f=0;!isNaN(this.mouseState.lastX)&&!isNaN(this.mouseState.lastY)&&(c=-(a-this.mouseState.lastX),f=b-this.mouseState.lastY);this.mouseState.lastX=a;this.mouseState.lastY=b;if(!(this.dragOnly&&!this.mouseState.buttonDown||c===0&&f===0)){this.timeSamples[this.sample]=Date.now();this.xSamples[this.sample]=c;this.ySamples[this.sample]=f;this.sample++;if(this.sample>this.timeSamples.length-1)this.sample=0;this.velocity.set(0,0);this.move(this.turnSpeedHorizontal*
c,this.turnSpeedVertical*f)}};a.prototype.move=function(a,c){var f=this.invertedX?-a:a,e=this.invertedY?-c:c;if(this.clampAzimuth){var i=this.targetSpherical,f=this.targetSpherical.y-f,h=this.minAzimuth,l=this.maxAzimuth,n=(h+l)/2+(l>h?Math.PI:0),o=b.moduloPositive(f-n,b.TWO_PI),p=b.moduloPositive(h-n,b.TWO_PI),n=b.moduloPositive(l-n,b.TWO_PI);f<0&&h>0?h-=b.TWO_PI:f>0&&h<0&&(h+=b.TWO_PI);f>b.TWO_PI&&l<b.TWO_PI&&(l+=b.TWO_PI);i.y=o<p?h:o>n?l:f}else this.targetSpherical.y-=f;this.targetSpherical.z=
b.clamp(this.targetSpherical.z+e,this.minAscent,this.maxAscent);this.dirty=!0};a.prototype.applyWheel=function(a){this.zoom(this.zoomSpeed*(this.invertedWheel?-1:1)*Math.max(-1,Math.min(1,a.wheelDelta||-a.detail)))};a.prototype.zoom=function(a){this.targetSpherical.x=b.clamp(this.targetSpherical.x+a*this.baseDistance,this.minZoomDistance,this.maxZoomDistance);this.dirty=!0};a.prototype.applyReleaseDrift=function(){for(var a=Date.now(),b=0,c=0,f=!1,e=0,h=this.timeSamples.length;e<h;e++)a-this.timeSamples[e]<
this.maxSampleTimeMS&&(b+=this.xSamples[e],c+=this.ySamples[e],f=!0);f?this.velocity.set(b*this.turnSpeedHorizontal/this.timeSamples.length,c*this.turnSpeedVertical/this.timeSamples.length):this.velocity.set(0,0)};a.prototype.setupMouseControls=function(){var a=this;this.domElement.addEventListener("mousedown",function(b){a.updateButtonState(b.button,!0)},!1);document.addEventListener("mouseup",function(b){a.updateButtonState(b.button,!1)},!1);document.addEventListener("mousemove",function(b){a.updateDeltas(b.clientX,
b.clientY)},!1);this.domElement.addEventListener("mousewheel",function(b){a.applyWheel(b)},!1);this.domElement.addEventListener("DOMMouseScroll",function(b){a.applyWheel(b)},!1);this.domElement.addEventListener("dragstart",function(a){a.preventDefault()},!1);if(typeof window.Hammer!=="undefined")window.Hammer(this.domElement,{transform_always_block:!0,transform_min_scale:1}).on("touch drag transform release",function(b){switch(b.type){case "transform":b=b.gesture.scale;b<1?a.zoom(a.zoomSpeed*1):b>
1&&a.zoom(a.zoomSpeed*-1);break;case "touch":a.updateButtonState(0,!0);break;case "release":a.updateButtonState(0,!1);break;case "drag":a.updateDeltas(b.gesture.center.pageX,b.gesture.center.pageY)}})};a.prototype.updateVelocity=function(a){this.velocity.lengthSquared()>1.0E-6?(this.move(this.velocity.x,this.velocity.y),this.velocity.mul(b.clamp(b.lerp(a,1,1-this.drag),0,1)),this.dirty=!0):this.velocity.set(0,0,0)};a.prototype.run=function(a){var c=a.transformComponent;if(c){var f=c.transform;this.releaseVelocity&&
this.updateVelocity(a._world.tpf);if(this.dirty){a=this.interpolationSpeed*a._world.tpf;this.spherical.y=b.lerp(a,this.spherical.y,this.targetSpherical.y);this.spherical.x=b.lerp(a,this.spherical.x,this.targetSpherical.x);this.spherical.z=b.lerp(a,this.spherical.z,this.targetSpherical.z);b.sphericalToCartesian(this.spherical.x,this.spherical.y,this.spherical.z,this.cartesian);f.translation.set(this.cartesian.add(this.lookAtPoint));f.translation.equals(this.lookAtPoint)||f.lookAt(this.lookAtPoint,
this.worldUpVector);if(this.spherical.distanceSquared(this.targetSpherical)<1.0E-6)this.dirty=!1,this.spherical.y=b.moduloPositive(this.spherical.y,b.TWO_PI),this.targetSpherical.copy(this.spherical);c.setUpdated()}}};return a});
define("goo/scripts/RotationControlScript",["goo/math/Matrix3x3"],function(e){function c(a){this.bindings={attach:b.bind(this),update:null,remove:null};this.element=a;this.name="RotationControlScript";this.states={dirty:!1,x:null,y:null,dx:null,dy:null};this.element.addEventListener("mousedown",this.bindings.attach,!1);this.element.addEventListener("touchstart",this.bindings.attach,!1)}var b=function(b){b=b.touches&&b.touches.length===1?b.touches[0]:b;this.states.dx=0;this.states.dy=0;this.states.x=
b.pageX;this.states.y=b.pageY;this.bindings.update=a.bind(this);this.bindings.remove=f.bind(this);document.addEventListener("mousemove",this.bindings.update,!1);document.addEventListener("touchmove",this.bindings.update,!1);document.addEventListener("mouseup",this.bindings.remove,!1);document.addEventListener("touchend",this.bindings.remove,!1)},a=function(a){a=a.touches&&a.touches.length===1?a.touches[0]:a;this.states.dirty=!0;this.states.dx+=a.pageX-this.states.x;this.states.dy+=a.pageY-this.states.y;
this.states.x=a.pageX;this.states.y=a.pageY},f=function(){document.removeEventListener("mousemove",this.bindings.update);document.removeEventListener("touchmove",this.bindings.update);document.removeEventListener("mouseup",this.bindings.remove);document.removeEventListener("touchend",this.bindings.remove)};c.prototype.run=function(a){if(this.states.dirty){var b=Math.PI*this.states.dy/this.element.clientHeight,c=Math.PI*this.states.dx/this.element.clientWidth,f=Math.cos(b),b=Math.sin(b),i=Math.cos(c),
c=Math.sin(c),f=new e(i,b*c,0-f*c,0,f,b,c,0-b*i,f*i);e.combine(f,a.transformComponent.transform.rotation,a.transformComponent.transform.rotation);a.transformComponent.setUpdated();this.states.dirty=!1;this.states.dx=0;this.states.dy=0}};return c});
define("goo/scripts/SplineInterpolator",["goo/math/Matrix4x4","goo/math/Vector4"],function(e,c){function b(a){a=a||{};this.controlPoint=0;this.controlPoints=a.controlPoints||[];this.elapsedTime=0;this.enabled=a.enabled||!0;this.firstIteration=!0;this.tolerance=a.tolerance||0.01;this.beforeFunction=a.beforeFunction||function(a){return a.transformComponent.transform.translation.clone().data};this.updateFunction=a.updateFunction||function(a,b){a.transformComponent.transform.translation.set(b);a.transformComponent.setUpdated()};
this.afterFunction=a.afterFunction||function(){}}b.CATMULL_ROM=new e(-0.5,1,-0.5,0,1.5,-2.5,0,1,-1.5,2,0.5,0,0.5,-0.5,0,0);b.UNIFORM_CUBIC=new e(-0.16667,0.5,-0.5,0.16667,0.5,-1,0,0.66667,-0.5,0.5,0.5,0.16667,0.16667,0,0,0);b.prototype.run=function(a,f){if(this.firstIteration){this.firstIteration=!1;try{this.controlPoints.unshift({time:0,value:this.beforeFunction(a)})}catch(d){this.enabled=!1;return}}for(var e=Math.min(Math.max(this.controlPoint-1,0),this.controlPoints.length-1),j=Math.min(Math.max(this.controlPoint+
0,0),this.controlPoints.length-1),k=Math.min(Math.max(this.controlPoint+1,0),this.controlPoints.length-1),i=Math.min(Math.max(this.controlPoint+2,0),this.controlPoints.length-1),h=this.controlPoints[k].time>this.controlPoints[j].time?(this.elapsedTime-this.controlPoints[j].time)/(this.controlPoints[k].time-this.controlPoints[j].time):0,h=b.CATMULL_ROM.applyPre(new c(h*h*h,h*h,h,1)),l=Array(this.controlPoints[0].value.length),n=0,o=0;o<l.length;o++)l[o]=0,l[o]+=this.controlPoints[e].value[o]*h[0],
l[o]+=this.controlPoints[j].value[o]*h[1],l[o]+=this.controlPoints[k].value[o]*h[2],l[o]+=this.controlPoints[i].value[o]*h[3],n+=Math.abs(this.controlPoints[this.controlPoints.length-1].value[o]-l[o]);try{this.updateFunction(a,l)}catch(p){this.enabled=!1;return}this.elapsedTime+=f;this.elapsedTime>=this.controlPoints[k].time&&this.controlPoint++;if(this.controlPoint>=this.controlPoints.length||n<this.tolerance){try{this.afterFunction(a)}catch(m){}this.enabled=!1}};return b});
define("goo/scripts/WASDControlScript",["goo/math/Vector","goo/math/Vector3"],function(e,c){function b(a){a=a||{};this.name="WASDControlScript";this.domElement=a.domElement||document;a.domElement&&this.domElement.setAttribute("tabindex",-1);this.walkSpeed=!isNaN(a.walkSpeed)?a.walkSpeed:100;this.crawlSpeed=!isNaN(a.crawlSpeed)?a.crawlSpeed:10;this.fwdVector=a.fwdVector||new c(0,0,-1);this.leftVector=a.leftVector||new c(-1,0,0);this.crawlKey=!isNaN(a.crawlKey)?a.crawlKey:16;this.forwardKey=!isNaN(a.forwardKey)?
a.forwardKey:87;this.backKey=!isNaN(a.backKey)?a.backKey:83;this.strafeLeftKey=!isNaN(a.strafeLeftKey)?a.strafeLeftKey:65;this.strafeRightKey=!isNaN(a.strafeRightKey)?a.strafeRightKey:68;this.onRun=a.onRun;this.moveState={strafeLeft:0,strafeRight:0,forward:0,back:0,crawling:!1};this.moveVector=new c(0,0,0);this.calcVector=new c;this.setupKeyControls()}b.prototype.updateMovementVector=function(){this.moveVector.x=this.moveState.strafeLeft-this.moveState.strafeRight;this.moveVector.z=this.moveState.forward-
this.moveState.back};b.prototype.updateKeys=function(a,b){if(!a.altKey){var c=!1;switch(a.keyCode){case this.crawlKey:this.moveState.crawling=b;break;case this.forwardKey:this.moveState.forward=b?1:0;c=!0;break;case this.backKey:this.moveState.back=b?1:0;c=!0;break;case this.strafeLeftKey:this.moveState.strafeLeft=b?1:0;c=!0;break;case this.strafeRightKey:this.moveState.strafeRight=b?1:0,c=!0}c&&this.updateMovementVector()}};b.prototype.setupKeyControls=function(){var a=this;this.domElement.addEventListener("keydown",
function(b){a.updateKeys(b,!0)},!1);this.domElement.addEventListener("keyup",function(b){a.updateKeys(b,!1)},!1)};b.prototype.run=function(a){var b=a.transformComponent;if(b){var d=b.transform;e.equals(this.moveVector,c.ZERO)||(this.calcVector.set(this.fwdVector.x*this.moveVector.z+this.leftVector.x*this.moveVector.x,this.fwdVector.y*this.moveVector.z+this.leftVector.y*this.moveVector.x,this.fwdVector.z*this.moveVector.z+this.leftVector.z*this.moveVector.x),this.calcVector.normalize(),this.calcVector.mul(a._world.tpf*
(this.moveState.crawling?this.crawlSpeed:this.walkSpeed)),d.rotation.applyPost(this.calcVector),d.translation.add(this.calcVector),b.setUpdated())}};return b});
define("goo/shapes/Disk",["goo/renderer/MeshData"],function(e){function c(b,a,c){this.nSegments=b||8;this.radius=a||1;this.pointiness=c||0;b=e.defaultMap([e.POSITION,e.NORMAL]);e.call(this,b,this.nSegments+1,this.nSegments+2);this.indexModes=["TriangleFan"];this.rebuild()}c.prototype=Object.create(e.prototype);c.prototype.rebuild=function(){var b=[],a=[],c=[];b.push(0,0,this.pointiness);a.push(0,0,1);c.push(0);for(var d=Math.atan2(this.radius,this.pointiness),g=Math.PI*2/this.nSegments,j=1,k=0;j<=
this.nSegments;j++,k+=g)b.push(Math.cos(k)*this.radius,Math.sin(k)*this.radius,0),a.push(Math.cos(k)*Math.cos(d),Math.sin(k)*Math.cos(d),Math.sin(d)),c.push(j);c.push(1);this.getAttributeBuffer(e.POSITION).set(b);this.getAttributeBuffer(e.NORMAL).set(a);this.getIndexBuffer().set(c);return this};return c});
define("goo/shapes/Surface",["goo/renderer/MeshData","goo/math/MathUtils"],function(e,c){function b(a,b,c){this.verts=a;this.vertsPerLine=b;this.verticallyClosed=!!c;a=e.defaultMap([e.POSITION,e.NORMAL]);b=this.verts.length/3;e.call(this,a,b,(b/this.vertsPerLine-1)*(this.vertsPerLine-1)*6);this.rebuild()}b.prototype=Object.create(e.prototype);b.prototype.rebuild=function(){this.getAttributeBuffer(e.POSITION).set(this.verts);for(var a=[],b=[],d=[],g=this.verts.length/3/this.vertsPerLine,j=0;j<g-1;j++){for(var k=
0;k<this.vertsPerLine-1;k++){var d=(j+0)*this.vertsPerLine+(k+0),i=(j+1)*this.vertsPerLine+(k+0),h=(j+0)*this.vertsPerLine+(k+1);a.push(d,i,h,h,i,(j+1)*this.vertsPerLine+(k+1));d=c.getTriangleNormals(this.verts[d*3+0],this.verts[d*3+1],this.verts[d*3+2],this.verts[i*3+0],this.verts[i*3+1],this.verts[i*3+2],this.verts[h*3+0],this.verts[h*3+1],this.verts[h*3+2]);b.push(d[0],d[1],d[2])}this.verticallyClosed&&(d=(j+0)*this.vertsPerLine+0,i=(j+1)*this.vertsPerLine+0,h=(j+0)*this.vertsPerLine+1,d=c.getTriangleNormals(this.verts[d*
3+0],this.verts[d*3+1],this.verts[d*3+2],this.verts[i*3+0],this.verts[i*3+1],this.verts[i*3+2],this.verts[h*3+0],this.verts[h*3+1],this.verts[h*3+2]));b.push(d[0],d[1],d[2])}j--;for(k=0;k<this.vertsPerLine-1;k++)d=(j+0)*this.vertsPerLine+(k+0),i=(j+1)*this.vertsPerLine+(k+0),h=(j+0)*this.vertsPerLine+(k+1),d=c.getTriangleNormals(this.verts[d*3+0],this.verts[d*3+1],this.verts[d*3+2],this.verts[i*3+0],this.verts[i*3+1],this.verts[i*3+2],this.verts[h*3+0],this.verts[h*3+1],this.verts[h*3+2]),b.push(d[0],
d[1],d[2]);b.push(d[0],d[1],d[2]);this.getAttributeBuffer(e.NORMAL).set(b);this.getIndexBuffer().set(a);return this};return b});
define("goo/shapes/PolyLine",["goo/renderer/MeshData","goo/shapes/Surface"],function(e,c){function b(a,b){this.verts=a;this.closed=!!b;var c=e.defaultMap([e.POSITION]);e.call(this,c,this.verts.length/3,this.verts.length/3);this.indexModes=this.closed?["LineLoop"]:["LineStrip"];this.rebuild()}b.prototype=Object.create(e.prototype);b.prototype.rebuild=function(){this.getAttributeBuffer(e.POSITION).set(this.verts);for(var a=[],b=this.verts.length/3,c=0;c<b;c++)a.push(c);this.getIndexBuffer().set(a);
return this};b.prototype.mul=function(a){if(a instanceof b){for(var f=a.verts.length/3,d=[],e=0;e<this.verts.length;e+=3)for(var j=0;j<a.verts.length;j+=3)d.push(this.verts[e+0]+a.verts[j+0],this.verts[e+1]+a.verts[j+1],this.verts[e+2]+a.verts[j+2]);return new c(d,f)}};b.prototype.lathe=function(a){for(var a=a||8,b=Math.PI*2/a,d=[],e=0;e<this.verts.length;e+=3)for(var j=0,k=0;j<=a;j++,k+=b)d.push(Math.cos(k)*this.verts[e+0],this.verts[e+1],Math.sin(k)*this.verts[e+0]);return new c(d,a+1,!0)};b.prototype.concat=
function(a,c){return!(a instanceof b)?void 0:new b(this.verts.concat(a.verts),c)};b.fromCubicBezier=function(a,c){if(a.length===12){for(var c=c||16,d=[],e=[],j=[],k=[],i=[],h=[],l=[],n=0;n<=c;n++){var o=n/c;e[0]=a[0]+(a[3]-a[0])*o;e[1]=a[1]+(a[4]-a[1])*o;e[2]=a[2]+(a[5]-a[2])*o;j[0]=a[3]+(a[6]-a[3])*o;j[1]=a[4]+(a[7]-a[4])*o;j[2]=a[5]+(a[8]-a[5])*o;k[0]=a[6]+(a[9]-a[6])*o;k[1]=a[7]+(a[10]-a[7])*o;k[2]=a[8]+(a[11]-a[8])*o;i[0]=e[0]+(j[0]-e[0])*o;i[1]=e[1]+(j[1]-e[1])*o;i[2]=e[2]+(j[2]-e[2])*o;h[0]=
j[0]+(k[0]-j[0])*o;h[1]=j[1]+(k[1]-j[1])*o;h[2]=j[2]+(k[2]-j[2])*o;l[0]=i[0]+(h[0]-i[0])*o;l[1]=i[1]+(h[1]-i[1])*o;l[2]=i[2]+(h[2]-i[2])*o;d.push(l[0],l[1],l[2])}return new b(d)}};b.fromCubicSpline=function(a,c,d){if(d){if(a.length%3!==0&&a.length/3%3!==0)return;d=a.length/3;d/=3;for(var e=b.fromCubicBezier(a.slice(0,12),c),j=1;j<d-1;j++)var k=b.fromCubicBezier(a.slice(j*9,j*9+12),c),e=e.concat(k);k=b.fromCubicBezier(a.slice(j*9,j*9+9).concat(a.slice(0,3)),c);e=e.concat(k)}else{if(a.length%3!==0&&
a.length/3%3!==1)return;d=a.length/3;d=(d-1)/3;e=b.fromCubicBezier(a.slice(0,12),c);for(j=1;j<d;j++)k=b.fromCubicBezier(a.slice(j*9,j*9+12),c),e=e.concat(k)}return e};return b});
define("goo/shapes/ProjectedGrid","goo/renderer/MeshData,goo/math/Vector2,goo/math/Vector3,goo/math/Vector4,goo/math/Matrix4x4,goo/renderer/Camera,goo/math/MathUtils".split(","),function(e,c,b,a,f,d,g){function j(g,i){this.densityX=g!==void 0?g:20;this.densityY=i!==void 0?i:20;this.projectorCamera=new d(45,1,0.1,2E3);this.mainCamera=new d(45,1,0.1,2E3);this.freezeProjector=!1;this.upperBound=20;this.origin=new a;this.direction=new a;this.source=new c;this.rangeMatrix=new f;this.intersectBottomLeft=
new a;this.intersectTopLeft=new a;this.intersectTopRight=new a;this.intersectBottomRight=new a;this.planeIntersection=new b;this.freezeProjector=!1;this.projectorMinHeight=50;this.intersections=[];for(var h=0;h<24;h++)this.intersections.push(new b);this.connections=[0,3,1,2,0,4,1,5,2,6,3,7,4,7,5,6];var h=this.densityX*this.densityY,j=(this.densityX-1)*(this.densityY-1)*6,n=e.defaultMap([e.POSITION,e.TEXCOORD0]);e.call(this,n,h,j);this.rebuild()}j.prototype=Object.create(e.prototype);j.prototype.update=
function(c){var d=this.upperBound,e=this.mainCamera;this.freezeProjector||e.copy(c);c=e.translation;c.y>0&&c.y<d+e.near?e.translation.setd(c.x,d+e.near,c.z):c.y<0&&c.y>-d-e.near&&e.translation.setd(c.x,-d-e.near,c.z);for(var j=e.calculateFrustumCorners(),n=0,o=new b,p=0;p<8;p++){var c=this.connections[p*2],m=this.connections[p*2+1];(j[c].y>d&&j[m].y<d||j[c].y<d&&j[m].y>d)&&this.getWorldIntersectionSimple(d,j[c],j[m],this.intersections[n++],o);(j[c].y>-d&&j[m].y<-d||j[c].y<-d&&j[m].y>-d)&&this.getWorldIntersectionSimple(-d,
j[c],j[m],this.intersections[n++],o)}for(p=0;p<8;p++)j[p].y<d&&j[p].y>-d&&this.intersections[n++].set(j[p]);if(n===0)return!1;d=this.projectorCamera;d.copy(e);if(d.translation.y>0&&d._direction.y>0||d.translation.y<0&&d._direction.y<0)d._direction.y=-d._direction.y,c=new b,c.setv(d._direction).cross(d._left).normalize(),d._up.setv(c);c=this.source;p=this.planeIntersection;c.set(0.5,0.5);this.getWorldIntersection(0,c,d.getViewProjectionInverseMatrix(),p);e=d.translation;e.y>0&&e.y<this.projectorMinHeight*
2?(j=(this.projectorMinHeight*2-e.y)/(this.projectorMinHeight*2),d.translation.setd(e.x,this.projectorMinHeight*2-this.projectorMinHeight*j,e.z)):e.y<0&&e.y>-this.projectorMinHeight*2&&(j=(-this.projectorMinHeight*2-e.y)/(-this.projectorMinHeight*2),d.translation.setd(e.x,-this.projectorMinHeight*2+this.projectorMinHeight*j,e.z));p.subv(d.translation);p.y=0;e=p.length();if(e>Math.abs(d.translation.y))p.normalize(),p.mul(Math.abs(d.translation.y));else if(e<g.EPSILON)p.addv(d._up),p.y=0,p.normalize(),
p.mul(0.1);p.addv(d.translation);p.y=0;d.lookAt(p,b.UNIT_Y);j=d.getViewProjectionMatrix();o=new a;e=this.intersections;for(p=0;p<n;p++)o.set(e[p].x,0,this.intersections[p].z,1),j.applyPost(o),e[p].set(o.x,o.y,0),e[p].div(o.w);for(var j=Number.MAX_VALUE,o=-Number.MAX_VALUE,m=Number.MAX_VALUE,s=-Number.MAX_VALUE,p=0;p<n;p++){if(e[p].x<j)j=e[p].x;if(e[p].x>o)o=e[p].x;if(e[p].y<m)m=e[p].y;if(e[p].y>s)s=e[p].y}n=this.rangeMatrix;n.setIdentity();n.e00=o-j;n.e11=s-m;n.e03=j;n.e13=m;d=d.getViewProjectionInverseMatrix();
f.combine(d,n,n);c.set(0.5,0.5);this.getWorldIntersectionHomogenous(0,c,n,this.intersectBottomLeft);c.set(0.5,1);this.getWorldIntersectionHomogenous(0,c,n,this.intersectTopLeft);c.set(1,1);this.getWorldIntersectionHomogenous(0,c,n,this.intersectTopRight);c.set(1,0.5);this.getWorldIntersectionHomogenous(0,c,n,this.intersectBottomRight);return!0};j.prototype.getWorldIntersectionHomogenous=function(a,b,c,d){this.calculateIntersection(a,b,c);d.setv(this.origin)};j.prototype.getWorldIntersection=function(a,
b,c,d){this.calculateIntersection(a,b,c);d.setd(this.origin.x,this.origin.y,this.origin.z).div(this.origin.w)};j.prototype.getWorldIntersectionSimple=function(a,b,c,d,f){b=d.setv(b);c=f.setv(c).sub(b);a=(a-b.y)/c.y;c.mul(a);b.addv(c);return a>=0&&a<=1};j.prototype.calculateIntersection=function(a,b,c){this.origin.setd(b.x*2-1,b.y*2-1,-1,1);this.direction.setd(b.x*2-1,b.y*2-1,1,1);c.applyPost(this.origin);c.applyPost(this.direction);this.direction.sub(this.origin);Math.abs(this.direction.y)>g.EPSILON?
this.direction.mul((a-this.origin.y)/this.direction.y):(this.direction.normalize(),this.direction.mul(this.mainCamera._frustumFar));this.origin.add(this.direction)};j.prototype.rebuild=function(){for(var a=this.getAttributeBuffer(e.POSITION),b=this.getAttributeBuffer(e.TEXCOORD0),c=this.getIndexBuffer(),d=this.densityX,f=this.densityY,g=0;g<d;g++)for(var j=0;j<f;j++)a[(g+j*d)*3+0]=g,a[(g+j*d)*3+1]=0,a[(g+j*d)*3+2]=j,b[(g+j*d)*2+0]=g/(d-1),b[(g+j*d)*2+1]=j/(f-1);for(b=a=0;b<d*(f-1);b++)b%(d*(Math.floor(b/
d)+1)-1)===0&&b!==0||(c[a++]=b,c[a++]=1+d+b,c[a++]=1+b,c[a++]=b,c[a++]=d+b,c[a++]=1+d+b);return this};return j});define("goo/shapes/RegularPolygon",["goo/renderer/MeshData","goo/shapes/PolyLine"],function(e,c){function b(a,b){this.nSegments=a||5;this.radius=b||1;for(var d=[],e=Math.PI*2/a,j=0,k=0;j<this.nSegments;j++,k+=e)d.push(Math.cos(k)*this.radius,Math.sin(k)*this.radius,0);c.call(this,d,!0);this.rebuild()}b.prototype=Object.create(c.prototype);return b});
define("goo/shapes/SimpleBox",["goo/renderer/MeshData"],function(e){function c(b,a,c){this.xExtent=b!==void 0?b*0.5:0.5;this.yExtent=a!==void 0?a*0.5:0.5;this.zExtent=c!==void 0?c*0.5:0.5;b=e.defaultMap([e.POSITION]);e.call(this,b,8,36);this.rebuild()}c.prototype=Object.create(e.prototype);c.prototype.rebuild=function(){var b=this.xExtent,a=this.yExtent,c=this.zExtent;this.getAttributeBuffer(e.POSITION).set([-b,-a,-c,b,-a,-c,b,a,-c,-b,a,-c,-b,-a,c,b,-a,c,b,a,c,-b,a,c]);this.getIndexBuffer().set([0,
1,2,2,3,0,7,6,5,5,4,7,0,3,7,7,4,0,1,2,6,6,5,1,3,2,6,6,7,3,0,1,5,5,4,0]);return this};return c});
define("goo/shapes/Triangle",["goo/renderer/MeshData","goo/math/MathUtils"],function(e,c){function b(a){this.verts=a;a=e.defaultMap([e.POSITION,e.NORMAL]);e.call(this,a,3,3);this.rebuild()}b.prototype=Object.create(e.prototype);b.prototype.rebuild=function(){this.getAttributeBuffer(e.POSITION).set(this.verts);var a=c.getTriangleNormals(this.verts[0],this.verts[1],this.verts[2],this.verts[3],this.verts[4],this.verts[5],this.verts[6],this.verts[7],this.verts[8]);this.getAttributeBuffer(e.NORMAL).set([a[0],
a[1],a[2],a[0],a[1],a[2],a[0],a[1],a[2]]);this.getIndexBuffer().set([0,1,2]);return this};return b});
define("goo/util/ColorUtil",["goo/math/Vector4"],function(e){function c(){}c.arrayToVector4=function(a,b){b=b||new e;b.seta(a);return b};c.hexToArray=function(a,b){b=b||[];a=Math.floor(a);b[0]=(a>>16&255)/255;b[1]=(a>>8&255)/255;b[2]=(a&255)/255;return b};c.arrayToHex=function(a){return a[0]*255<<16^a[1]*255<<8^a[2]*255<<0};c.arrayToHexString=function(a){return("000000"+c.arrayToHex(a).toString(16)).slice(-6)};var b=/^rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/i,a=/^rgb\(\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*\)$/i,
f=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i,d=/^\#([0-9a-f]{6})$/i,g=/^(\w+)$/i;c.cssToArray=function(e,k){k=k||[];if(b.test(e)){var i=b.exec(e);k[0]=Math.min(255,parseInt(i[1],10))/255;k[1]=Math.min(255,parseInt(i[2],10))/255;k[2]=Math.min(255,parseInt(i[3],10))/255;return k}if(a.test(e))return i=a.exec(e),k[0]=Math.min(100,parseInt(i[1],10))/100,k[1]=Math.min(100,parseInt(i[2],10))/100,k[2]=Math.min(100,parseInt(i[3],10))/100,k;if(d.test(e))return i=d.exec(e),this.hexToArray(parseInt(i[1],16),k);if(f.test(e))return i=
f.exec(e),this.hexToArray(parseInt(i[1]+i[1]+i[2]+i[2]+i[3]+i[3],16),k);if(g.test(e))return this.hexToArray(c.color[e],k);console.warn("No matching style found");k[0]=k[1]=k[2]=0;return k};c.HSLToArray=function(a,b,c,d){d=d||[];if(b===0)d[0]=d[1]=d[2]=c;else{var e=function(a,b,c){c<0&&(c+=1);c>1&&(c-=1);return c<1/6?a+(b-a)*6*c:c<0.5?b:c<2/3?a+(b-a)*6*(2/3-c):a},b=c<=0.5?c*(1+b):c+b-c*b,c=2*c-b;d[0]=e(c,b,a+1/3);d[1]=e(c,b,a);d[2]=e(c,b,a-1/3)}return d};c.arrayToHSL=function(a,b){var b=b||[],c=a[0],
d=a[1],e=a[2],f=Math.max(c,d,e),g=Math.min(c,d,e),p,m=(g+f)/2;if(g===f)g=p=0;else{var s=f-g,g=m<=0.5?s/(f+g):s/(2-f-g);switch(f){case c:p=(d-e)/s+(d<e?6:0);break;case d:p=(e-c)/s+2;break;case e:p=(c-d)/s+4}p/=6}b[0]=p;b[1]=g;b[2]=m;return b};c.HSBToArray=function(a,b,c,d){var d=d||[],e=0,f=0,g=0;if(b===0)e=f=g=c;else{var a=(a-Math.floor(a))*6,p=a-Math.floor(a),m=c*(1-b),s=c*(1-b*p),b=c*(1-b*(1-p));switch(a){case 0:e=c;f=b;g=m;break;case 1:e=s;f=c;g=m;break;case 2:e=m;f=c;g=b;break;case 3:e=m;f=s;
g=c;break;case 4:e=b;f=m;g=c;break;case 5:e=c,f=m,g=s}}d[0]=e;d[1]=f;d[2]=g;return d};c.arrayToHSB=function(a,b){var b=b||[],c=a[0],d=a[1],e=a[2],f,g=c>d?c:d;e>g&&(g=e);var p=c<d?c:d;e<p&&(p=e);f=g!==0?(g-p)/g:0;if(f===0)c=0;else{var m=(g-c)/(g-p),s=(g-d)/(g-p),e=(g-e)/(g-p),c=c===g?e-s:d===g?2+m-e:4+s-m;c/=6;c<0&&(c+=1)}b[0]=c;b[1]=f;b[2]=g/255;return b};c.arrayToCSS=function(a){return"rgb("+(a[0]*255|0)+","+(a[1]*255|0)+","+(a[2]*255|0)+")"};c.color={aliceblue:15792383,antiquewhite:16444375,aqua:65535,
aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,
darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,
indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,
maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,
papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,
white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};return c});
define("goo/util/ConsoleUtil",["goo/util/ObjectUtil"],function(e){var c,b,a,f;f=null;b=["debug","log","info","warn","error"];a=function(){};return c={setLogLevel:function(d){var g,j,k,i;f==null&&(f=e.clone(window.console));c.clearLogLevel();i=[];for(j=0,k=b.length;j<k;j++){g=b[j];if(g===d)break;i.push(window.console[g]=a)}return i},clearLogLevel:function(){var a,c,e,k;if(f){k=[];for(c=0,e=b.length;c<e;c++)a=b[c],k.push(window.console[a]=f[a]);return k}}}});
define("goo/util/DebugDraw",[],function(){function e(){}e.prototype.countDown=function(){};return e});
define("goo/util/Promise",[],function(){function e(){this._state="pending";this._resolved=[];this._rejected=[];this._always=[]}e.prototype.then=function(c,b){c&&c!==null&&this._resolved.push(c);b&&b!==null&&this._rejected.push(b);return this};e.prototype.done=function(c){this._state==="pending"?this.then(c):this._state==="resolved"&&c(this._data);return this};e.prototype.fail=function(c){this._state==="pending"?this.then(null,c):this._state==="rejected"&&c(this._data);return this};e.prototype.always=
function(c){typeof c!=="undefined"&&c!==null&&(this._state==="pending"?this._always.push(c):c(this._data));return this};return e});
define("goo/util/Deferred",["goo/util/Promise"],function(e){function c(b){this._promise=b||new e}c.prototype.promise=function(){return this._promise};c.prototype.resolve=function(b){if(this._promise._state==="pending")this._promise._data=b,this._promise._resolved.every(function(a){a(b);return!0}),this._promise._always.every(function(a){a(b);return!0}),this._promise._state="resolved";return this._promise};c.prototype.reject=function(b){if(this._promise._state==="pending")this._promise._data=b,this._promise._rejected.every(function(a){if(b instanceof
Error)throw b;a(b);return!0}),this._promise._always.every(function(a){a(b);return!0}),this._promise._state="rejected";return this._promise};c.prototype.then=function(b,a){return this._promise.then(b,a)};c.prototype.done=function(b){return this._promise.done(b)};c.prototype.fail=function(b){return this._promise.fail(b)};c.prototype.always=function(b){return this._promise.always(b)};c.when=function(){var b=Array.prototype.slice.call(arguments),a=b.length,e=a,d=new c,g=[],j=function(a,b){return function(c){b[a]=
c;--e<=0&&d.resolve(b)}};if(a>0){var a=function(a){d.reject(a)},k;for(k in b)b[k]&&Object.prototype.toString.call(b[k].constructor)==="[object Function]"?b[k].done(j(k,g)).fail(a):--e}e||d.resolve(g);return d.promise()};return c});
define("goo/util/FastBuilder",["goo/renderer/MeshData","goo/math/Vector3"],function(e,c){function b(a,b,c){if(a.vertexCount>=65536)throw Error("Maximum number of vertices for a mesh to add is 65535. Got: "+a.vertexCount);this.callback=c||{progress:function(){},done:function(){}};this.meshDatas=[];this.dataCounter=0;for(c=b;;){var j=Math.floor(65535/a.vertexCount),j=Math.min(j,b),k=a.vertexCount*j,i=a.indexCount*j,h={},l;for(l in a.attributeMap){var n=a.attributeMap[l];h[l]={count:n.count,type:n.type,
stride:n.stride,offset:n.offset,normalized:n.normalized}}k=new e(h,k,i);c-=j;this.meshDatas.push(k);if(c<=0)break}this.indexCounter=this.vertexCounter=0;this.callback.progress(0)}var a=new c;b.prototype.addMeshData=function(b,c){if(b.vertexCount>=65536)throw Error("Maximum number of vertices for a mesh to add is 65535. Got: "+b.vertexCount);else if(this.vertexCounter+b.vertexCount>=65536)this.dataCounter++,this.vertexData={},this.indexData=[],this.indexCounter=this.vertexCounter=0,this.callback.progress(this.dataCounter/
(this.meshDatas.length-1));var g=this.meshDatas[this.dataCounter],j=b.attributeMap,k;for(k in j){var i=this.vertexCounter*j[k].count,h=b.getAttributeBuffer(k),l=h.length,n=g.getAttributeBuffer(k);if(k===e.POSITION)for(var o=0;o<l;o+=3)a.setd(h[o+0],h[o+1],h[o+2]),c.matrix.applyPostPoint(a),n[i+o+0]=a.data[0],n[i+o+1]=a.data[1],n[i+o+2]=a.data[2];else if(k===e.NORMAL)for(o=0;o<l;o+=3)a.setd(h[o+0],h[o+1],h[o+2]),c.rotation.applyPost(a),n[i+o+0]=a.data[0],n[i+o+1]=a.data[1],n[i+o+2]=a.data[2];else if(k===
e.TANGENT)for(o=0;o<l;o+=3)a.setd(h[o+0],h[o+1],h[o+2]),c.rotation.applyPost(a),n[i+o+0]=a.data[0],n[i+o+1]=a.data[1],n[i+o+2]=a.data[2];else for(o=0;o<l;o++)n[i+o]=h[o]}j=b.getIndexBuffer();n=g.getIndexBuffer();o=0;for(g=b.indexCount;o<g;o++)n[this.indexCounter+o]=j[o]+this.vertexCounter;this.vertexCounter+=b.vertexCount;this.indexCounter+=b.indexCount};b.prototype.build=function(){this.callback.done();return this.meshDatas};return b});
define("goo/util/Grid","goo/entities/Entity,goo/entities/EntityUtils,goo/entities/components/MeshDataComponent,goo/entities/components/MeshRendererComponent,goo/renderer/MeshData,goo/renderer/Material,goo/renderer/Shader,goo/shapes/ShapeCreator,goo/renderer/shaders/ShaderLib,goo/renderer/Util".split(","),function(e,c,b,a,f,d,g,j,k,i){function h(e,f){f=f||{};this.topEntity=e.createEntity(this.name);f.floor&&this.topEntity.transformComponent.transform.rotation.rotateX(-Math.PI/2);if(f.surface){var g=
j.createQuad(f.width,f.height),g=c.createTypicalEntity(e,g),h=d.createMaterial(k.simpleLit);h.uniforms.materialDiffuse=f.surfaceColor||[1,1,1,1];h.depthState={writable:!1,enabled:!1};h.renderQueue=9;g.meshRendererComponent.materials.push(h);this.topEntity.transformComponent.attachChild(g.transformComponent)}this.gridShader=this._buildGridShader(f);if(!f.grids)f.grids=[];f.grids.length===0&&f.grids.push(i.clone(l));this.grids=f.grids;for(var s,q=0;q<f.grids.length;q++)h=f.grids[q],this._fillDefaults(h,
l),h._width=f.width||1,h._height=f.height||1,g=e.createEntity("grid_"+q),g.setComponent(new b(this._buildGrid(h))),s=new a,s.materials.push(this._buildGridMaterial(h,q)),g.setComponent(s),this.topEntity.transformComponent.attachChild(g.transformComponent)}var l={stepX:1,stepY:1,color:[0,0,0,1],width:1};h.prototype.addToWorld=function(){c.traverse(this.topEntity,function(a){a.addToWorld()})};h.prototype._collides=function(a,b,c){for(var c="step"+c,d=0;d<this.grids.length;d++){if(a===this.grids[d])break;
if(b%this.grids[d][c]===0)return!0}return!1};h.prototype._buildGrid=function(a){var b=Math.ceil(a._width/a.stepX),c=Math.ceil(a._height/a.stepY),d=a._width/2,e=a._height/2,g=[],h=[];a===this.grids[0]&&(g.push(-d,-e,0,-d,e,0,d,e,0,d,-e,0),h.push(0,1,1,2,2,3,3,0));for(var i,j=1;j<b;j++)i=a.stepX*j,this._collides(a,i,"X")||(i-=d,g.push(i,-e,0,i,e,0));for(j=1;j<c;j++)b=a.stepY*j,this._collides(a,b,"Y")||(b-=e,g.push(-d,b,0,d,b,0));for(j=h.length/2;j<g.length/3;j+=2)h.push(j,j+1);a=new f(f.defaultMap([f.POSITION]),
g.length,h.length);a.getAttributeBuffer(f.POSITION).set(g);a.getIndexBuffer().set(h);a.indexModes[0]="Lines";return a};h.prototype._buildGridMaterial=function(a,b){var c=new d("GridMaterial_"+b);if(this.gridShader)c.shader=this.gridShader;c.uniforms.color=a.color;c.lineWidth=a.width;c.depthState={enabled:!1,write:!1};c.renderQueue=10+b;return c};h.prototype._fillDefaults=function(a,b){for(var c in b)a[c]===void 0&&(a[c]=typeof b[c]==="array"||b[c]instanceof Object?i.clone(b[c]):b[c])};h.prototype._buildGridShader=
function(a){return d.createShader({attributes:{vertexPosition:f.POSITION},uniforms:{viewMatrix:g.VIEW_MATRIX,projectionMatrix:g.PROJECTION_MATRIX,worldMatrix:g.WORLD_MATRIX,color:[0,0,0,1],fogOn:a.fogOn||!1,fogColor:a.fogColor||[0,0,0,1],fogNear:g.MAIN_NEAR_PLANE,fogFar:a.fogFar||g.MAIN_FAR_PLANE},vshader:"attribute vec3 vertexPosition;\nuniform mat4 worldMatrix;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nvarying float depth;\nvoid main(void)\n{\nvec4 viewPosition = viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);\ndepth = viewPosition.z;\ngl_Position = projectionMatrix * viewPosition;\n}",
fshader:"precision mediump float;\nuniform vec4 fogColor;\nuniform vec4 color;\nuniform float fogNear;\nuniform float fogFar;\nuniform bool fogOn;\nvarying float depth;\nvoid main(void)\n{\nif (fogOn) {\nfloat lerpVal = clamp(depth / (-fogFar - fogNear), 0.0, 1.0);\nlerpVal = pow(lerpVal, 0.4);\ngl_FragColor = mix(color, fogColor, lerpVal);\n} else {\ngl_FragColor = color;\n}\n}"},"Grid Shader")};return h});
define("goo/util/MeshBuilder",["goo/renderer/MeshData","goo/math/Vector3","goo/entities/EntityUtils"],function(e,c,b){function a(){this.meshDatas=[];this.vertexData={};this.indexData=[];this.indexCounter=this.vertexCounter=0;this.indexLengths=[];this.indexModes=[]}a.prototype.addEntity=function(a){b.traverse(a,function(){a.transformComponent._dirty&&a.transformComponent.updateTransform()});b.traverse(a,function(){a.transformComponent._dirty&&b.updateWorldTransform(a.transformComponent)});b.traverse(a,
function(){a.meshDataComponent&&this.addMeshData(a.meshDataComponent.meshData,a.transformComponent.worldTransform)})};var f=new c;a.prototype.addMeshData=function(a,b){if(a.vertexCount>=65536)throw Error("Maximum number of vertices for a mesh to add is 65535. Got: "+a.vertexCount);else this.vertexCounter+a.vertexCount>=65536&&(console.log("Mesh size limit reached, creating new mesh"),this._generateMesh());var c=a.attributeMap,k;for(k in c){var i=c[k],h=this.vertexData[k];if(!h)this.vertexData[k]=
{},h=this.vertexData[k],h.array=[],h.map={count:i.count,type:i.type,stride:i.stride,offset:i.offset,normalized:i.normalized};var l=a.getAttributeBuffer(k),n=l.length,o=h.array;if(k===e.POSITION)for(h=0;h<n;h+=3)f.setd(l[h+0],l[h+1],l[h+2]),b.matrix.applyPostPoint(f),o[this.vertexCounter*i.count+h+0]=f[0],o[this.vertexCounter*i.count+h+1]=f[1],o[this.vertexCounter*i.count+h+2]=f[2];else if(k===e.NORMAL)for(h=0;h<n;h+=3)f.setd(l[h+0],l[h+1],l[h+2]),b.rotation.applyPost(f),o[this.vertexCounter*i.count+
h+0]=f[0],o[this.vertexCounter*i.count+h+1]=f[1],o[this.vertexCounter*i.count+h+2]=f[2];else if(k===e.TANGENT)for(h=0;h<n;h+=3)f.setd(l[h+0],l[h+1],l[h+2]),b.rotation.applyPost(f),o[this.vertexCounter*i.count+h+0]=f[0],o[this.vertexCounter*i.count+h+1]=f[1],o[this.vertexCounter*i.count+h+2]=f[2];else for(h=0;h<n;h++)o[this.vertexCounter*i.count+h]=l[h]}c=a.getIndexBuffer();h=0;for(k=a.indexCount;h<k;h++)this.indexData[this.indexCounter+h]=c[h]+this.vertexCounter;this.vertexCounter+=a.vertexCount;
this.indexCounter+=a.indexCount;this.indexLengths=a.indexLengths?this.indexLengths.concat(a.indexLengths):this.indexLengths.concat(a.getIndexBuffer().length);this.indexModes=this.indexModes.concat(a.indexModes)};a.prototype._generateMesh=function(){var a={},b;for(b in this.vertexData){var c=this.vertexData[b];a[b]=c.map}a=new e(a,this.vertexCounter,this.indexCounter);for(b in this.vertexData)c=this.vertexData[b].array,a.getAttributeBuffer(b).set(c);a.getIndexBuffer().set(this.indexData);a.indexLengths=
this.indexLengths;a.indexModes=this.indexModes;this.meshDatas.push(a);this.vertexData={};this.indexData=[];this.indexCounter=this.vertexCounter=0;this.indexLengths=[];this.indexModes=[]};a.prototype.build=function(){this.vertexCounter>0&&this._generateMesh();return this.meshDatas};return a});
define("goo/util/LightPointer","goo/renderer/MeshData,goo/util/MeshBuilder,goo/math/Transform,goo/shapes/ShapeCreator,goo/entities/components/MeshDataComponent,goo/entities/components/MeshRendererComponent,goo/renderer/Material,goo/renderer/shaders/ShaderLib,goo/math/MathUtils,goo/renderer/light/PointLight,goo/renderer/light/DirectionalLight,goo/renderer/light/SpotLight".split(","),function(e,c,b,a,f,d,g,j,k,i,h,l){function n(){}function o(a,b){for(var a=a||1,b=b||8,c=[],d=[],f=Math.PI*2/b,g=0,h=
0;g<b;g++,h+=f)c.push(Math.cos(h)*a,Math.sin(h)*a,0),d.push(g,g+1);d[d.length-1]=0;f=new e(e.defaultMap([e.POSITION]),b,d.length);f.getAttributeBuffer(e.POSITION).set(c);f.getIndexBuffer().set(d);f.indexLengths=null;f.indexModes=["Lines"];return f}n.attachPointer=function(n){var m=n.getComponent("lightComponent").light;var s;if(m instanceof i){s=new c;var q=new b,t,u=m.range,u=u||1;t=new c;var u=o(u,128),v;v=new b;t.addMeshData(u,v);v=new b;v.rotation.fromAngles(0,Math.PI/2,0);v.update();t.addMeshData(u,
v);v=new b;v.rotation.fromAngles(Math.PI/2,Math.PI/2,0);v.update();t.addMeshData(u,v);t=t.build()[0];u=a.createSphere(8,8,0.1);s.addMeshData(t,q);s.addMeshData(u,q);s=s.build()[0]}else if(m instanceof h){s=new c;q=new b;q.scale.setd(1,1,-1);q.update();t=new c;for(v=0;v<2;v++){var r=o(2,64),u=new b;u.translation.set(0,0,10*v);u.update();t.addMeshData(r,u)}r=4;u=[];v=[];for(var w=Math.PI*2/r,y=0,x=0;y<r;y++,x+=w)u.push(Math.cos(x),Math.sin(x),0),u.push(Math.cos(x),Math.sin(x),1),v.push(y*2,y*2+1);r=
new e(e.defaultMap([e.POSITION]),r*2,v.length);r.getAttributeBuffer(e.POSITION).set(u);r.getIndexBuffer().set(v);r.indexLengths=null;r.indexModes=["Lines"];u=new b;u.scale.set(2,2,20);u.update();t.addMeshData(r,u);t=t.build()[0];u=a.createSphere(8,8,0.1);s.addMeshData(t,q);s.addMeshData(u,q);s=s.build()[0]}else if(m instanceof l){s=new c;q=new b;v=m.angle;u=m.range;v=v||45;u=u||1;t=new c;u/=2;v=Math.sin(v*k.DEG_TO_RAD)*u;for(w=1;w<=2;w++)y=o(v*w,64),r=new b,r.translation.set(0,0,u*w),r.update(),t.addMeshData(y,
r);for(var y=4,r=[0,0,0],w=[],x=Math.PI*2/y,A=0,z=0;A<y;A++,z+=x)r.push(Math.cos(z),Math.sin(z),1),w.push(0,A+1);y=new e(e.defaultMap([e.POSITION]),y+1,w.length);y.getAttributeBuffer(e.POSITION).set(r);y.getIndexBuffer().set(w);y.indexLengths=null;y.indexModes=["Lines"];r=new b;r.scale.set(v*2,v*2,u*2);r.update();t.addMeshData(y,r);t=t.build()[0];u=a.createSphere(8,8,0.1);s.addMeshData(t,q);s.addMeshData(u,q);s=s.build()[0]}else s=void 0;s=new f(s);n.setComponent(s);s=new d;n.setComponent(s);s=g.createMaterial(j.simpleColored,
"");s.uniforms.color=[m.color.data[0],m.color.data[1],m.color.data[2]];n.meshRendererComponent.materials.push(s);return n};n.removeMesh=function(a){a.clearComponent("meshDataComponent");a.clearComponent("meshRendererComponent");return a};return n});
define("goo/util/NoWebGL",["goo/util/Logo"],function(e){function c(b){this.template=c.templates[b]?c.templates[b]:c.templates.standard}c.prototype.upgradeLocation="http://goodemos.com/recommended.html";c.prototype.gooLocation="http://gooengine.com";c.templates={};c.templates.standard={};c.templates.standard.css="#unsupportedBrowser {z-index: 10000;position: absolute;top: 0;left: 0;width: 100%;background: #1c1c1c;border-top: 1px solid #2a3276;font-family: Helvetica Neue, Helvetica, sans-serif;font-size: 90%;line-height: 145%;}#unsupportedBrowser a.button {-webkit-border-radius: 18px;-moz-border-radius: 18px;-o-border-radius: 18px;border-radius: 18px;margin: 5px 20px 0 0;text-align: left;padding: 10px 25px;color: #1d1d1d;font-weight: 600;font-style: italic;display: inline-block;text-shadow: 0px 1px 1px #8372da;filter: dropshadow(color=#02c2df, offx=0, offy=1);-moz-box-shadow: inset 1px 1px 2px 0 #a9b1fd;-o-box-shadow: inset 1px 1px 2px 0 #a9b1fd;-webkit-box-shadow: inset 1px 1px 2px 0 #a9b1fd;box-shadow: inset 1px 1px 2px 0 #a9b1fd;background: #2a3276;background-image: -ms-linear-gradient(top, #2a3276 0%, #6b7aff 100%);background-image: -moz-linear-gradient(top, #2a3276 0%, #6b7aff 100%);background-image: -o-linear-gradient(top, #2a3276 0%, #6b7aff 100%);background-image: -webkit-gradient(linear, left top, left bottom, color-stop(0, #2a3276), color-stop(1, #6b7aff));background-image: -webkit-linear-gradient(top, #2a3276 0%, #6b7aff 100%);background-image: linear-gradient(top, #2a3276 0%, #6b7aff 100%);filter: progid:DXImageTransform.Microsoft.gradient(startColorstr=\"#2a3276\", endColorstr=\"#6b7aff\");}#unsupportedBrowser a.button:hover {-moz-box-shadow: inset 3px 3px 5px 0 #a9b1fd;-o-box-shadow: inset 3px 3px 5px 0 #a9b1fd;-webkit-box-shadow: inset 3px 3px 5px 0 #a9b1fd;box-shadow: inset 3px 3px 5px 0 #a9b1fd;background: #6b7aff;background-image: -ms-linear-gradient(top, #6b7aff 0%, #2a3276 100%);background-image: -moz-linear-gradient(top, #6b7aff 0%, #2a3276 100%);background-image: -o-linear-gradient(top, #6b7aff 0%, #2a3276 100%);background-image: -webkit-gradient(linear, left top, left bottom, color-stop(0, #6b7aff), color-stop(1, #2a3276));background-image: -webkit-linear-gradient(top, #6b7aff 0%, #2a3276 100%);background-image: linear-gradient(top, #6b7aff 0%, #2a3276 100%);filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#6b7aff', endColorstr='#2a3276'); }#unsupportedBrowser > svg {margin-top: 5px;}#unsupportedBrowser > .logo {background-image: -moz-radial-gradient(50% 250px, circle farthest-corner, #6b7aff, #2a3276 100%);background-image: -webkit-radial-gradient(50% 250px, circle farthest-corner, #6b7aff, #2a3276 100%);background-image: -o-radial-gradient(50% 250px, circle farthest-corner, #6b7aff, #2a3276 100%);background-image: -ms-radial-gradient(50% 250px, circle farthest-corner, #6b7aff, #2a3276 100%);background-image: radial-gradient(50% 250px, circle farthest-corner, #6b7aff, #2a3276 100%);}#unsupportedBrowser > .content {color: #9f9f9f;max-width: 700px;margin-left: 120px;margin-right: 20px;padding-top: 1em;}#unsupportedBrowser p {margin: 0 0 25px 0;}#unsupportedBrowser h1 {display: inline-block;max-width: 600px;margin: 13px 0 25px 20px;color: #f1eee5;vertical-align: top;font-weight: normal}";
c.templates.standard.html='<div class="logo"><a href="http://gooengine.com">'+e.getLogo({color:e.white,shadow:!0,width:"100px",height:"70px"})+'</a><h1>Whoopsie daisy!</h1></div><div class="content"><p>Your browser doesn\'t seem to support HTML5 and WebGL. The best thing to do is upgrade to a modern browser that supports all the awesome things the web has to offer.</p><p><a data-upgrade class="button" href="">Upgrade my browser!</a><a data-close class="button" href="">Not now</a></p></div>';c.prototype.show=
function(){var b=document.createElement("div");b.innerHTML=this.template.html;b.setAttribute("id","unsupportedBrowser");var a=document.createElement("style");a.type="text/css";a.setAttribute("id","unsupportedBrowserStyles");a.stylesheet?a.stylesheet.cssText=this.template.css:a.appendChild(document.createTextNode(this.template.css));document.head.appendChild(a);document.body.appendChild(b);var a=b.querySelector("[data-close]"),c=function(a){a.preventDefault();a.stopPropagation();document.location.href=
this.gooLocation;document.body.removeChild(document.querySelector("div#unsupportedBrowser"));document.head.removeChild(document.querySelector("#unsupportedBrowserStyles"))}.bind(this);a.addEventListener("click",c);b=b.querySelector("[data-upgrade]");a=function(a){a.preventDefault();a.stopPropagation();document.location.href=this.upgradeLocation}.bind(this);b.addEventListener("click",a)};c.prototype.addTemplate=function(b,a){c.templates[b]?console.error("Template "+b+" already exists"):c.templates[b]=
a};return c});define("goo/util/Rc4Random",[],function(){return function(e){var c=[],b=0,a=0;(function(a){for(var b=0;b<256;b++)c[b]=b;for(var e=0,b=0;b<256;b++){var e=(e+c[b]+a.charCodeAt(b%a.length))%256,j=c[b];c[b]=c[e];c[e]=j}})(e);this.getRandomNumber=function(){for(var e=0,d=1,g=0;g<8;g++){b=(b+1)%256;a=(a+c[b])%256;var j=c[b];c[b]=c[a];c[a]=j;e+=c[(c[b]+c[a])%256]*d;d*=256}return e/1.8446744073709552E19}}});require("goo/addons/box2d/components/Box2DComponent,goo/addons/box2d/systems/Box2DSystem,goo/addons/cannon/components/CannonjsComponent,goo/addons/cannon/systems/CannonjsSystem,goo/addons/soundmanager2/components/SoundManager2Component,goo/addons/soundmanager2/systems/SoundManager2System,goo/addons/terrain/Terrain,goo/addons/water/FlatWaterRenderer,goo/addons/water/ProjectedGridWaterRenderer,goo/animation/AnimationManager,goo/animation/Joint,goo/animation/Skeleton,goo/animation/SkeletonPose,goo/animation/blendtree/AbstractTwoPartSource,goo/animation/blendtree/BinaryLERPSource,goo/animation/blendtree/ClipSource,goo/animation/blendtree/ExclusiveClipSource,goo/animation/blendtree/FrozenClipSource,goo/animation/blendtree/InclusiveClipSource,goo/animation/blendtree/ManagedTransformSource,goo/animation/blendtree/SimpleAnimationApplier,goo/animation/clip/AbstractAnimationChannel,goo/animation/clip/AnimationClip,goo/animation/clip/AnimationClipInstance,goo/animation/clip/GuaranteedTriggerChannel,goo/animation/clip/InterpolatedFloatChannel,goo/animation/clip/JointChannel,goo/animation/clip/JointData,goo/animation/clip/TransformChannel,goo/animation/clip/TransformData,goo/animation/clip/TriggerChannel,goo/animation/clip/TriggerData,goo/animation/layer/AnimationLayer,goo/animation/layer/LayerLERPBlender,goo/animation/state/AbstractFiniteState,goo/animation/state/AbstractTransitionState,goo/animation/state/AbstractTwoStateLerpTransition,goo/animation/state/FadeTransitionState,goo/animation/state/FrozenTransitionState,goo/animation/state/IgnoreTransitionState,goo/animation/state/ImmediateTransitionState,goo/animation/state/StateBlendType,goo/animation/state/SteadyState,goo/animation/state/SyncFadeTransitionState,goo/animation/state/loader/OutputStore,goo/entities/Entity,goo/entities/EntityUtils,goo/entities/EventHandler,goo/entities/GooRunner,goo/entities/World,goo/entities/components/AnimationComponent,goo/entities/components/CSSTransformComponent,goo/entities/components/CameraComponent,goo/entities/components/Component,goo/entities/components/LightComponent,goo/entities/components/MeshDataComponent,goo/entities/components/MeshRendererComponent,goo/entities/components/ParticleComponent,goo/entities/components/ScriptComponent,goo/entities/components/TransformComponent,goo/entities/managers/DebugManager,goo/entities/managers/EntityManager,goo/entities/managers/LightManager,goo/entities/systems/AnimationSystem,goo/entities/systems/BoundingUpdateSystem,goo/entities/systems/CSSTransformSystem,goo/entities/systems/CameraSystem,goo/entities/systems/LightingSystem,goo/entities/systems/ParticlesSystem,goo/entities/systems/PickingSystem,goo/entities/systems/RenderSystem,goo/entities/systems/ScriptSystem,goo/entities/systems/System,goo/entities/systems/TransformSystem,goo/loaders/AnimationLoader,goo/loaders/AnimationTreeLoader,goo/loaders/BundleLoader,goo/loaders/DynamicLoader,goo/loaders/EntityLoader,goo/loaders/JSONImporter,goo/loaders/JsonUtils,goo/loaders/Loader,goo/loaders/MaterialLoader,goo/loaders/MeshLoader,goo/loaders/SceneLoader,goo/loaders/ScriptLoader,goo/loaders/ShaderLoader,goo/loaders/SkeletonLoader,goo/loaders/dds/DdsLoader,goo/loaders/dds/DdsUtils,goo/loaders/handlers/CameraComponentHandler,goo/loaders/handlers/ComponentHandler,goo/loaders/handlers/ConfigHandler,goo/loaders/handlers/EntityHandler,goo/loaders/handlers/LightComponentHandler,goo/loaders/handlers/MaterialHandler,goo/loaders/handlers/MeshDataComponentHandler,goo/loaders/handlers/MeshDataHandler,goo/loaders/handlers/MeshRendererComponentHandler,goo/loaders/handlers/SceneHandler,goo/loaders/handlers/ShaderHandler,goo/loaders/handlers/SkeletonHandler,goo/loaders/handlers/TextureHandler,goo/loaders/handlers/TransformComponentHandler,goo/loaders/tga/TgaLoader,goo/math/MathUtils,goo/math/Matrix,goo/math/Matrix2x2,goo/math/Matrix3x3,goo/math/Matrix4x4,goo/math/Plane,goo/math/Quaternion,goo/math/Ray,goo/math/Transform,goo/math/Transformation,goo/math/Vector,goo/math/Vector2,goo/math/Vector3,goo/math/Vector4,goo/math/Versor,goo/noise/Noise,goo/noise/ValueNoise,goo/particles/Particle,goo/particles/ParticleEmitter,goo/particles/ParticleInfluence,goo/particles/ParticleUtils,goo/picking/BoundingTree,goo/picking/PrimitivePickLogic,goo/renderer/BufferData,goo/renderer/BufferUtils,goo/renderer/Camera,goo/renderer/Material,goo/renderer/MeshData,goo/renderer/RenderQueue,goo/renderer/Renderer,goo/renderer/RendererRecord,goo/renderer/Shader,goo/renderer/ShaderCall,goo/renderer/SimplePartitioner,goo/renderer/Texture,goo/renderer/TextureCreator,goo/renderer/Util,goo/renderer/bounds/BoundingBox,goo/renderer/bounds/BoundingSphere,goo/renderer/bounds/BoundingVolume,goo/renderer/light/DirectionalLight,goo/renderer/light/Light,goo/renderer/light/PointLight,goo/renderer/light/SpotLight,goo/renderer/pass/BloomPass,goo/renderer/pass/BlurPass,goo/renderer/pass/Composer,goo/renderer/pass/DepthPass,goo/renderer/pass/DoGPass,goo/renderer/pass/FullscreenPass,goo/renderer/pass/FullscreenUtil,goo/renderer/pass/NesPass,goo/renderer/pass/RenderPass,goo/renderer/pass/RenderTarget,goo/renderer/pass/SSAOPass,goo/renderer/shaders/ShaderBuilder,goo/renderer/shaders/ShaderFragment,goo/renderer/shaders/ShaderLib,goo/renderer/shadow/ShadowHandler,goo/scripts/BasicControlScript,goo/scripts/MouseLookControlScript,goo/scripts/OrbitCamControlScript,goo/scripts/RotationControlScript,goo/scripts/SplineInterpolator,goo/scripts/WASDControlScript,goo/shapes/Box,goo/shapes/Cylinder,goo/shapes/Disk,goo/shapes/PolyLine,goo/shapes/ProjectedGrid,goo/shapes/Quad,goo/shapes/RegularPolygon,goo/shapes/ShapeCreator,goo/shapes/SimpleBox,goo/shapes/Sphere,goo/shapes/Surface,goo/shapes/Torus,goo/shapes/Triangle,goo/util/Ajax,goo/util/ColorUtil,goo/util/ConsoleUtil,goo/util/DebugDraw,goo/util/Deferred,goo/util/Enum,goo/util/FastBuilder,goo/util/GameUtils,goo/util/Grid,goo/util/Handy,goo/util/Latch,goo/util/LightPointer,goo/util/Logo,goo/util/MeshBuilder,goo/util/NoWebGL,goo/util/ObjectUtil,goo/util/Promise,goo/util/PromiseUtil,goo/util/Rc4Random,goo/util/SimpleResourceUtil,goo/util/Stats,goo/util/StringUtil,goo/util/TangentGenerator,goo/util/URLTools,goo/util/rsvp".split(","));
define("req_temp",function(){});
}; if(window.localStorage&&window.localStorage.gooPath){ require.config({ paths: { goo: localStorage.gooPath } }); }else f(); })(window);